import { Component } from '@angular/core';
import { BsModalService } from 'ngx-bootstrap/modal';
import { CookieBannerPreferencesModalComponent } from './cookie-banner-preferences-modal/cookie-banner-preferences-modal.component';
import { CookieBannerService } from './cookie-banner.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'ngx-bootstrap/modal';
import * as ɵngcc2 from './cookie-banner.service';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '../../i18n/c8y-translate.pipe';

function CookieBannerComponent_div_2_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 14);
    ɵngcc0.ɵɵelementStart(1, "h3");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(4, "div", 11);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, ctx_r1.settings.cookieBannerTitle));
} }
function CookieBannerComponent_div_2_a_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "a", 15);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵpropertyInterpolate("href", ctx_r2.settings.policyUrl, ɵngcc0.ɵɵsanitizeUrl);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 2, "See also our Privacy Notice."), " ");
} }
function CookieBannerComponent_div_2_div_14_Template(rf, ctx) { if (rf & 1) {
    const _r6 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 10);
    ɵngcc0.ɵɵelement(1, "div", 16);
    ɵngcc0.ɵɵelementStart(2, "button", 12);
    ɵngcc0.ɵɵlistener("click", function CookieBannerComponent_div_2_div_14_Template_button_click_2_listener() { ɵngcc0.ɵɵrestoreView(_r6); const ctx_r5 = ɵngcc0.ɵɵnextContext(2); return ctx_r5.rejectCookies(); });
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", ctx_r3.shouldDisable);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 2, "Reject all"), " ");
} }
function CookieBannerComponent_div_2_div_15_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 10);
    ɵngcc0.ɵɵelement(1, "div", 16);
    ɵngcc0.ɵɵelementStart(2, "button", 17);
    ɵngcc0.ɵɵlistener("click", function CookieBannerComponent_div_2_div_15_Template_button_click_2_listener() { ɵngcc0.ɵɵrestoreView(_r8); const ctx_r7 = ɵngcc0.ɵɵnextContext(2); return ctx_r7.onConfigurePreferences(); });
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("disabled", ctx_r4.shouldDisable);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(4, 2, "Configure preferences"), " ");
} }
function CookieBannerComponent_div_2_Template(rf, ctx) { if (rf & 1) {
    const _r10 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 3);
    ɵngcc0.ɵɵtemplate(1, CookieBannerComponent_div_2_div_1_Template, 5, 3, "div", 4);
    ɵngcc0.ɵɵelementStart(2, "div", 5);
    ɵngcc0.ɵɵelementStart(3, "div", 6);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵtemplate(6, CookieBannerComponent_div_2_a_6_Template, 3, 4, "a", 7);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "div", 8);
    ɵngcc0.ɵɵelementStart(8, "div", 9);
    ɵngcc0.ɵɵelementStart(9, "div", 10);
    ɵngcc0.ɵɵelement(10, "div", 11);
    ɵngcc0.ɵɵelementStart(11, "button", 12);
    ɵngcc0.ɵɵlistener("click", function CookieBannerComponent_div_2_Template_button_click_11_listener() { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r9 = ɵngcc0.ɵɵnextContext(); return ctx_r9.acceptCookies(); });
    ɵngcc0.ɵɵtext(12);
    ɵngcc0.ɵɵpipe(13, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(14, CookieBannerComponent_div_2_div_14_Template, 5, 4, "div", 13);
    ɵngcc0.ɵɵtemplate(15, CookieBannerComponent_div_2_div_15_Template, 5, 4, "div", 13);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.settings.cookieBannerTitle);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 7, ctx_r0.settings.cookieBannerText), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.settings.policyUrl);
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("disabled", ctx_r0.shouldDisable);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(13, 9, "Agree and proceed"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", !!ctx_r0.cookiePreferences);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !!ctx_r0.cookiePreferences);
} }
export class CookieBannerComponent {
    constructor(bsModalService, cookieBannerService) {
        this.bsModalService = bsModalService;
        this.cookieBannerService = cookieBannerService;
        this.shouldDisable = false;
    }
    ngOnInit() {
        this.settings = this.cookieBannerService.getCookieBannerSettings();
        this.cookiePreferences = this.cookieBannerService.getCookiePreferencesConfig();
        this.shouldShowCookieBanner();
    }
    onConfigurePreferences() {
        this.disableButtons(true);
        const initialState = {
            configCookiePreferences: this.cookiePreferences
        };
        const modalRef = this.bsModalService.show(CookieBannerPreferencesModalComponent, {
            initialState
        });
        modalRef.content.closeSubject.subscribe((userCookiePreferences) => {
            this.disableButtons(false);
            if (userCookiePreferences) {
                this.cookieBannerService.setCookies(userCookiePreferences);
                this.setCookieBannerVisibility(false);
            }
        });
    }
    acceptCookies() {
        this.cookieBannerService.setCookies(this.cookiePreferences || { required: true });
        this.setCookieBannerVisibility(false);
    }
    rejectCookies() {
        this.cookieBannerService.setCookies({
            required: true,
            functional: false,
            marketing: false
        });
        this.setCookieBannerVisibility(false);
    }
    shouldShowCookieBanner() {
        this.setCookieBannerVisibility(this.cookieBannerService.shouldShowCookieBanner());
    }
    disableButtons(shouldDisable) {
        this.shouldDisable = shouldDisable;
    }
    setCookieBannerVisibility(shouldShow) {
        this.showBanner = shouldShow;
        this.cookieBannerService.isCookieBannerShowed$.next(shouldShow);
    }
}
CookieBannerComponent.ɵfac = function CookieBannerComponent_Factory(t) { return new (t || CookieBannerComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.BsModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.CookieBannerService)); };
CookieBannerComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: CookieBannerComponent, selectors: [["c8y-cookie-banner"]], decls: 3, vars: 1, consts: [[1, "c8y-cookie-banner"], [1, "container"], ["class", "row p-t-16 p-b-16", 4, "ngIf"], [1, "row", "p-t-16", "p-b-16"], ["class", "col-md-2", 4, "ngIf"], [1, "col-md-7"], [1, "cookie-banner-content", "text-pre-line"], ["target", "_blank", "class", "text-primary", 3, "href", 4, "ngIf"], [1, "col-md-3"], [1, "row"], [1, "col-sm-6", "col-md-12"], [1, "p-b-16", "visible-sm", "visible-xs"], [1, "btn", "btn-primary", "btn-block", 3, "disabled", "click"], ["class", "col-sm-6 col-md-12", 4, "ngIf"], [1, "col-md-2"], ["target", "_blank", 1, "text-primary", 3, "href"], [1, "p-b-16"], [1, "btn", "btn-default", "btn-block", 3, "disabled", "click"]], template: function CookieBannerComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵtemplate(2, CookieBannerComponent_div_2_Template, 16, 11, "div", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showBanner);
    } }, directives: [ɵngcc3.NgIf], pipes: [ɵngcc4.C8yTranslatePipe], encapsulation: 2 });
CookieBannerComponent.ctorParameters = () => [
    { type: BsModalService },
    { type: CookieBannerService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(CookieBannerComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-cookie-banner',
                template: "<div class=\"c8y-cookie-banner\">\n  <div class=\"container\">\n    <div class=\"row p-t-16 p-b-16\" *ngIf=\"showBanner\">\n      <div class=\"col-md-2\" *ngIf=\"settings.cookieBannerTitle\">\n        <h3>{{ settings.cookieBannerTitle | translate }}</h3>\n        <div class=\"p-b-16 visible-sm visible-xs\"></div>\n      </div>\n      <div class=\"col-md-7\">\n        <div class=\"cookie-banner-content text-pre-line\">\n          {{ settings.cookieBannerText | translate }}\n          <a href=\"{{ settings.policyUrl }}\" target=\"_blank\" *ngIf=\"settings.policyUrl\" class=\"text-primary\">\n            {{ 'See also our Privacy Notice.' | translate }}\n          </a>\n        </div>\n      </div>\n      <div class=\"col-md-3\">\n        <div class=\"row\">\n          <div class=\"col-sm-6 col-md-12\">\n            <div class=\"p-b-16 visible-sm visible-xs\"></div>\n            <button\n              class=\"btn btn-primary btn-block\"\n              (click)=\"acceptCookies()\"\n              [disabled]=\"shouldDisable\"\n            >\n              {{ 'Agree and proceed' | translate }}\n            </button>\n          </div>\n          <div class=\"col-sm-6 col-md-12\" *ngIf=\"!!cookiePreferences\">\n            <div class=\"p-b-16\"></div>\n            <button\n              class=\"btn btn-primary btn-block\"\n              (click)=\"rejectCookies()\"\n              [disabled]=\"shouldDisable\"\n            >\n              {{ 'Reject all' | translate }}\n            </button>\n          </div>\n          <div class=\"col-sm-6 col-md-12\" *ngIf=\"!!cookiePreferences\">\n            <div class=\"p-b-16\"></div>\n            <button\n              class=\"btn btn-default btn-block\"\n              (click)=\"onConfigurePreferences()\"\n              [disabled]=\"shouldDisable\"\n            >\n              {{ 'Configure preferences' | translate }}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.BsModalService }, { type: ɵngcc2.CookieBannerService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY29va2llLWJhbm5lci5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2NvcmUvYm9vdHN0cmFwL2Nvb2tpZS1iYW5uZXIvY29va2llLWJhbm5lci5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDckQsT0FBTyxFQUFFLHFDQUFxQyxFQUFFLE1BQU0sNkVBQTZFLENBQUM7QUFFcEksT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0seUJBQXlCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU05RCxNQUFNLE9BQU8scUJBQXFCO0FBQUcsSUFLbkMsWUFDVSxjQUE4QixFQUM5QixtQkFBd0M7QUFDakQsUUFGUyxtQkFBYyxHQUFkLGNBQWMsQ0FBZ0I7QUFBQyxRQUMvQix3QkFBbUIsR0FBbkIsbUJBQW1CLENBQXFCO0FBQ3BELFFBTEUsa0JBQWEsR0FBWSxLQUFLLENBQUM7QUFDakMsSUFJSyxDQUFDO0FBQ04sSUFDRSxRQUFRO0FBQ1YsUUFBSSxJQUFJLENBQUMsUUFBUSxHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyx1QkFBdUIsRUFBRSxDQUFDO0FBQ3ZFLFFBQUksSUFBSSxDQUFDLGlCQUFpQixHQUFHLElBQUksQ0FBQyxtQkFBbUIsQ0FBQywwQkFBMEIsRUFBRSxDQUFDO0FBQ25GLFFBQUksSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7QUFDbEMsSUFBRSxDQUFDO0FBQ0gsSUFDRSxzQkFBc0I7QUFDeEIsUUFBSSxJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQzlCLFFBQ0ksTUFBTSxZQUFZLEdBQUc7QUFDekIsWUFBTSx1QkFBdUIsRUFBRSxJQUFJLENBQUMsaUJBQWlCO0FBQ3JELFNBQUssQ0FBQztBQUNOLFFBQ0ksTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMscUNBQXFDLEVBQUU7QUFDckYsWUFBTSxZQUFZO0FBQ2xCLFNBQUssQ0FBQyxDQUFDO0FBQ1AsUUFDSSxRQUFRLENBQUMsT0FBTyxDQUFDLFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxxQkFBd0MsRUFBRSxFQUFFO0FBQ3pGLFlBQU0sSUFBSSxDQUFDLGNBQWMsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUNqQyxZQUFNLElBQUkscUJBQXFCLEVBQUU7QUFDakMsZ0JBQVEsSUFBSSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ25FLGdCQUFRLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUM5QyxhQUFPO0FBQ1AsUUFBSSxDQUFDLENBQUMsQ0FBQztBQUNQLElBQUUsQ0FBQztBQUNILElBQ0UsYUFBYTtBQUNmLFFBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLElBQUksRUFBRSxRQUFRLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztBQUN0RixRQUFJLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMxQyxJQUFFLENBQUM7QUFDSCxJQUNFLGFBQWE7QUFDZixRQUFJLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxVQUFVLENBQUM7QUFDeEMsWUFBTSxRQUFRLEVBQUUsSUFBSTtBQUNwQixZQUFNLFVBQVUsRUFBRSxLQUFLO0FBQ3ZCLFlBQU0sU0FBUyxFQUFFLEtBQUs7QUFDdEIsU0FBSyxDQUFDLENBQUM7QUFDUCxRQUFJLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUMxQyxJQUFFLENBQUM7QUFDSCxJQUNVLHNCQUFzQjtBQUNoQyxRQUFJLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxJQUFJLENBQUMsbUJBQW1CLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxDQUFDO0FBQ3RGLElBQUUsQ0FBQztBQUNILElBQ1UsY0FBYyxDQUFDLGFBQXNCO0FBQy9DLFFBQUksSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7QUFDdkMsSUFBRSxDQUFDO0FBQ0gsSUFDVSx5QkFBeUIsQ0FBQyxVQUFtQjtBQUN2RCxRQUFJLElBQUksQ0FBQyxVQUFVLEdBQUcsVUFBVSxDQUFDO0FBQ2pDLFFBQUksSUFBSSxDQUFDLG1CQUFtQixDQUFDLHFCQUFxQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUNwRSxJQUFFLENBQUM7QUFDSDtpREFsRUMsU0FBUyxTQUFDLGtCQUNULFFBQVEsRUFBRSxtQkFBbUIsa0JBQzdCOzs7Ozs7Ozs7OzBGQUVHO0FBQUM7QUFBK0MsWUFUNUMsY0FBYztBQUFJLFlBR2xCLG1CQUFtQjtBQUFHOzs7OztvUkFJZ0IsY0FDOUM7O3FIQUxnQztBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEJzTW9kYWxTZXJ2aWNlIH0gZnJvbSAnbmd4LWJvb3RzdHJhcC9tb2RhbCc7XG5pbXBvcnQgeyBDb29raWVCYW5uZXJQcmVmZXJlbmNlc01vZGFsQ29tcG9uZW50IH0gZnJvbSAnLi9jb29raWUtYmFubmVyLXByZWZlcmVuY2VzLW1vZGFsL2Nvb2tpZS1iYW5uZXItcHJlZmVyZW5jZXMtbW9kYWwuY29tcG9uZW50JztcbmltcG9ydCB7IENvb2tpZUJhbm5lclNldHRpbmdzLCBDb29raWVQcmVmZXJlbmNlcyB9IGZyb20gJy4vY29va2llLWJhbm5lci5tb2RlbCc7XG5pbXBvcnQgeyBDb29raWVCYW5uZXJTZXJ2aWNlIH0gZnJvbSAnLi9jb29raWUtYmFubmVyLnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktY29va2llLWJhbm5lcicsXG4gIHRlbXBsYXRlVXJsOiAnLi9jb29raWUtYmFubmVyLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBDb29raWVCYW5uZXJDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICBzZXR0aW5nczogQ29va2llQmFubmVyU2V0dGluZ3M7XG4gIHNob3dCYW5uZXI6IGJvb2xlYW47XG4gIHNob3VsZERpc2FibGU6IGJvb2xlYW4gPSBmYWxzZTtcbiAgY29va2llUHJlZmVyZW5jZXM6IENvb2tpZVByZWZlcmVuY2VzO1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGJzTW9kYWxTZXJ2aWNlOiBCc01vZGFsU2VydmljZSxcbiAgICBwcml2YXRlIGNvb2tpZUJhbm5lclNlcnZpY2U6IENvb2tpZUJhbm5lclNlcnZpY2VcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuc2V0dGluZ3MgPSB0aGlzLmNvb2tpZUJhbm5lclNlcnZpY2UuZ2V0Q29va2llQmFubmVyU2V0dGluZ3MoKTtcbiAgICB0aGlzLmNvb2tpZVByZWZlcmVuY2VzID0gdGhpcy5jb29raWVCYW5uZXJTZXJ2aWNlLmdldENvb2tpZVByZWZlcmVuY2VzQ29uZmlnKCk7XG4gICAgdGhpcy5zaG91bGRTaG93Q29va2llQmFubmVyKCk7XG4gIH1cblxuICBvbkNvbmZpZ3VyZVByZWZlcmVuY2VzKCkge1xuICAgIHRoaXMuZGlzYWJsZUJ1dHRvbnModHJ1ZSk7XG5cbiAgICBjb25zdCBpbml0aWFsU3RhdGUgPSB7XG4gICAgICBjb25maWdDb29raWVQcmVmZXJlbmNlczogdGhpcy5jb29raWVQcmVmZXJlbmNlc1xuICAgIH07XG5cbiAgICBjb25zdCBtb2RhbFJlZiA9IHRoaXMuYnNNb2RhbFNlcnZpY2Uuc2hvdyhDb29raWVCYW5uZXJQcmVmZXJlbmNlc01vZGFsQ29tcG9uZW50LCB7XG4gICAgICBpbml0aWFsU3RhdGVcbiAgICB9KTtcblxuICAgIG1vZGFsUmVmLmNvbnRlbnQuY2xvc2VTdWJqZWN0LnN1YnNjcmliZSgodXNlckNvb2tpZVByZWZlcmVuY2VzOiBDb29raWVQcmVmZXJlbmNlcykgPT4ge1xuICAgICAgdGhpcy5kaXNhYmxlQnV0dG9ucyhmYWxzZSk7XG4gICAgICBpZiAodXNlckNvb2tpZVByZWZlcmVuY2VzKSB7XG4gICAgICAgIHRoaXMuY29va2llQmFubmVyU2VydmljZS5zZXRDb29raWVzKHVzZXJDb29raWVQcmVmZXJlbmNlcyk7XG4gICAgICAgIHRoaXMuc2V0Q29va2llQmFubmVyVmlzaWJpbGl0eShmYWxzZSk7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBhY2NlcHRDb29raWVzKCkge1xuICAgIHRoaXMuY29va2llQmFubmVyU2VydmljZS5zZXRDb29raWVzKHRoaXMuY29va2llUHJlZmVyZW5jZXMgfHwgeyByZXF1aXJlZDogdHJ1ZSB9KTtcbiAgICB0aGlzLnNldENvb2tpZUJhbm5lclZpc2liaWxpdHkoZmFsc2UpO1xuICB9XG5cbiAgcmVqZWN0Q29va2llcygpIHtcbiAgICB0aGlzLmNvb2tpZUJhbm5lclNlcnZpY2Uuc2V0Q29va2llcyh7XG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgIGZ1bmN0aW9uYWw6IGZhbHNlLFxuICAgICAgbWFya2V0aW5nOiBmYWxzZVxuICAgIH0pO1xuICAgIHRoaXMuc2V0Q29va2llQmFubmVyVmlzaWJpbGl0eShmYWxzZSk7XG4gIH1cblxuICBwcml2YXRlIHNob3VsZFNob3dDb29raWVCYW5uZXIoKSB7XG4gICAgdGhpcy5zZXRDb29raWVCYW5uZXJWaXNpYmlsaXR5KHRoaXMuY29va2llQmFubmVyU2VydmljZS5zaG91bGRTaG93Q29va2llQmFubmVyKCkpO1xuICB9XG5cbiAgcHJpdmF0ZSBkaXNhYmxlQnV0dG9ucyhzaG91bGREaXNhYmxlOiBib29sZWFuKSB7XG4gICAgdGhpcy5zaG91bGREaXNhYmxlID0gc2hvdWxkRGlzYWJsZTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0Q29va2llQmFubmVyVmlzaWJpbGl0eShzaG91bGRTaG93OiBib29sZWFuKSB7XG4gICAgdGhpcy5zaG93QmFubmVyID0gc2hvdWxkU2hvdztcbiAgICB0aGlzLmNvb2tpZUJhbm5lclNlcnZpY2UuaXNDb29raWVCYW5uZXJTaG93ZWQkLm5leHQoc2hvdWxkU2hvdyk7XG4gIH1cbn1cbiJdfQ==