import { __awaiter } from "tslib";
import { Injectable } from '@angular/core';
import { InventoryService } from '@c8y/client';
import { ApiService } from '@c8y/ngx-components/api';
import { NEVER } from 'rxjs';
import { distinctUntilChanged, map, switchMap, tap } from 'rxjs/operators';
import { AppStateService } from '../common/ui-state.service';
import * as i0 from "@angular/core";
import * as i1 from "@c8y/client/lib/src/inventory/InventoryService";
import * as i2 from "@c8y/ngx-components/api";
import * as i3 from "../common/ui-state.service";
/**
 * AssetTypesService is being used to manage a cache of all existing asset types.
 * This service is injected in the AssetOverviewNavigationFactory class, which will trigger
 * the initialization of the cache as the contstructor is called.
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@c8y/client';
import * as ɵngcc2 from '@c8y/ngx-components/api';
import * as ɵngcc3 from '../common/ui-state.service';
export class AssetTypesService {
    constructor(inventory, apiService, appStateService) {
        this.inventory = inventory;
        this.apiService = apiService;
        this.appStateService = appStateService;
        this.ASSET_TYPE_GROUP_QUERY = {
            __filter: {
                __and: [{ __has: 'c8y_IsAssetType' }, { name: 'group' }]
            }
        };
        this.assetTypesCache = {};
        this.DEFAULT_GROUP_ICON = 'c8y-group';
        this.DEFAULT_GROUP_ICON_OPEN = 'c8y-group-open';
        this.appStateService.currentUser
            .pipe(map(user => user === null || user === void 0 ? void 0 : user.id), distinctUntilChanged(), switchMap(userId => {
            if (userId) {
                this.initAssetTypesCache();
                return this.subscribeForAssetTypeUpdates();
            }
            else {
                this.assetTypesCache = {};
                return NEVER;
            }
        }))
            .subscribe();
    }
    /**
     * Queries available asset types and adds every asset type to the local cache.
     * @returns void.
     */
    initAssetTypesCache() {
        return __awaiter(this, void 0, void 0, function* () {
            const { data } = yield this.inventory.list({
                fragmentType: 'c8y_IsAssetType',
                withChildren: false,
                pageSize: 2000
            });
            data.forEach(assetType => this.addAssetType(assetType));
            return;
        });
    }
    /**
     * Returns an asset type from the cache based on the unique name property.
     * @param name Name of the asset type.
     * @returns IManagedObject which represents the asset type.
     */
    getAssetTypeByName(name) {
        if (!this.assetTypesCache.hasOwnProperty(name)) {
            return undefined;
        }
        return this.assetTypesCache[name];
    }
    /**
     * Returns an asset type from the cache based on the id.
     * @param assetTypeId Id of the asset type.
     * @returns IManagedObject which represents the asset type.
     */
    getAssetTypeById(assetTypeId) {
        if (!assetTypeId) {
            return;
        }
        return Object.values(this.assetTypesCache).find((assetType) => assetType.id === assetTypeId);
    }
    /**
     * Extracts an icon from an asset type.
     * @param type Type of the asset type.
     * @param open Determines whether the method should return an alternative icon showing the open state.
     * Defaults to false.
     * @returns Returns an icon for a given asset type.
     */
    getIcon(type, open = false) {
        var _a, _b;
        const assetType = this.getAssetTypeByName(type);
        const icon = ((_b = (_a = assetType === null || assetType === void 0 ? void 0 : assetType.c8y_IsAssetType) === null || _a === void 0 ? void 0 : _a.icon) === null || _b === void 0 ? void 0 : _b.name) || this.getDefaultGroupIcon(open);
        return icon;
    }
    getDefaultGroupIcon(open = false) {
        return open ? this.DEFAULT_GROUP_ICON_OPEN : this.DEFAULT_GROUP_ICON;
    }
    /**
     * Checks if the default asset type 'group' already exists and if it doesn't it will be created.
     * @returns void.
     */
    createAssetTypeGroupIfNotExists() {
        return __awaiter(this, void 0, void 0, function* () {
            const managedObjects = (yield this.inventory.listQuery(this.ASSET_TYPE_GROUP_QUERY)).data;
            if (managedObjects.length > 0) {
                return;
            }
            // if default group asset type doesn't exit create it
            yield this.createDefaultAssetTypeGroup();
        });
    }
    /**
     * create the default asset type group in the Inventory.
     */
    createDefaultAssetTypeGroup() {
        return __awaiter(this, void 0, void 0, function* () {
            yield this.inventory.create({
                label: 'Group',
                name: 'group',
                description: 'Default group asset type',
                c8y_IsAssetType: {
                    icon: 'folder',
                    propertyIds: [],
                    allowedAssetTypeIds: [],
                    isNoneChildAssetsAllowed: 'false'
                }
            });
        });
    }
    /**
     * Add an asset type to the local cache.
     * @param assetType Asset type which should be added to the cache.
     * @returns void.
     */
    addAssetType(assetType) {
        if (!assetType) {
            console.error('Asset type must not be null');
            return;
        }
        this.assetTypesCache[assetType.name] = assetType;
    }
    /**
     * Delete an asset type from the local cache based on the given asset type id.
     * @param assetTypeId Id of the asset type which should be deleted.
     * @returns void.
     */
    deleteAssetType(assetTypeId) {
        if (!assetTypeId) {
            console.error('Asset type ID must not be null');
            return;
        }
        const assetType = this.getAssetTypeById(assetTypeId);
        if (assetType) {
            delete this.assetTypesCache[assetType.name];
        }
    }
    /**
     * Update an asset type in the local cache.
     * @param assetType Asset type which should be updated in the cache.
     * @returns void.
     */
    updateAssetType(assetType) {
        if (!assetType) {
            console.error('Asset type must not be null');
            return;
        }
        const cachedAssetType = this.getAssetTypeById(assetType.id);
        if (cachedAssetType) {
            this.assetTypesCache[cachedAssetType.name] = Object.assign(cachedAssetType, assetType);
        }
    }
    /**
     * Subscribes to api PUT, POST and DELETE requests interceptor to update local asset types cache.
     * If a new asset type has been created it will be added to the local cache. If an asset
     * type has been deleted it will be removed from the local cache.
     */
    subscribeForAssetTypeUpdates() {
        return this.apiService
            .hookResponse(c => this.checkIfInventoryMoApiCall(c))
            .pipe(tap((call) => {
            var _a;
            if (!call && !call.method) {
                return;
            }
            const bodyToParse = (_a = call.options) === null || _a === void 0 ? void 0 : _a.body;
            if (bodyToParse) {
                try {
                    const mo = JSON.parse(bodyToParse);
                    if (call.method === 'DELETE') {
                        this.deleteAssetType(mo.id);
                        return;
                    }
                    if (!mo.hasOwnProperty('c8y_IsAssetType')) {
                        return;
                    }
                    if (call.method === 'PUT') {
                        this.updateAssetType(mo);
                        return;
                    }
                    this.addAssetType(mo);
                }
                catch (error) {
                    // do nothing
                }
            }
        }));
    }
    /**
     * Managed objects inventory api filter, allowing only PUT, POST and DELETE methods.
     * @param call Api call to filter.
     * @returns Returns true if api call meets the required criteria.
     */
    checkIfInventoryMoApiCall(call) {
        if (!call) {
            return false;
        }
        const hasRequiredMethod = call.method === 'POST' || call.method === 'DELETE' || call.method === 'PUT';
        const hasRequiredUrl = call.url.includes('managedObjects');
        return hasRequiredMethod && hasRequiredUrl;
    }
}
AssetTypesService.ɵfac = function AssetTypesService_Factory(t) { return new (t || AssetTypesService)(ɵngcc0.ɵɵinject(ɵngcc1.InventoryService), ɵngcc0.ɵɵinject(ɵngcc2.ApiService), ɵngcc0.ɵɵinject(ɵngcc3.AppStateService)); };
AssetTypesService.ɵprov = i0.ɵɵdefineInjectable({ factory: function AssetTypesService_Factory() { return new AssetTypesService(i0.ɵɵinject(i1.InventoryService), i0.ɵɵinject(i2.ApiService), i0.ɵɵinject(i3.AppStateService)); }, token: AssetTypesService, providedIn: "root" });
AssetTypesService.ctorParameters = () => [
    { type: InventoryService },
    { type: ApiService },
    { type: AppStateService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(AssetTypesService, [{
        type: Injectable,
        args: [{ providedIn: 'root' }]
    }], function () { return [{ type: ɵngcc1.InventoryService }, { type: ɵngcc2.ApiService }, { type: ɵngcc3.AppStateService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYXNzZXQtdHlwZXMuc2VydmljZS5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vY29yZS9hc3NldC10eXBlcy9hc3NldC10eXBlcy5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQzNDLE9BQU8sRUFBa0IsZ0JBQWdCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDL0QsT0FBTyxFQUFXLFVBQVUsRUFBRSxNQUFNLHlCQUF5QixDQUFDO0FBQzlELE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDN0IsT0FBTyxFQUFFLG9CQUFvQixFQUFFLEdBQUcsRUFBRSxTQUFTLEVBQUUsR0FBRyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0UsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzdEO0FBRWdDO0FBQ1o7QUFBK0M7QUFGbkU7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOzs7OztBQUVILE1BQU0sT0FBTyxpQkFBaUI7QUFDOUIsSUFVRSxZQUNVLFNBQTJCLEVBQzNCLFVBQXNCLEVBQ3RCLGVBQWdDO0FBQ3pDLFFBSFMsY0FBUyxHQUFULFNBQVMsQ0FBa0I7QUFBQyxRQUM1QixlQUFVLEdBQVYsVUFBVSxDQUFZO0FBQUMsUUFDdkIsb0JBQWUsR0FBZixlQUFlLENBQWlCO0FBQzVDLFFBZG1CLDJCQUFzQixHQUFHO0FBQzVDLFlBQUksUUFBUSxFQUFFO0FBQ2QsZ0JBQU0sS0FBSyxFQUFFLENBQUMsRUFBRSxLQUFLLEVBQUUsaUJBQWlCLEVBQUUsRUFBRSxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsQ0FBQztBQUM5RCxhQUFLO0FBQ0wsU0FBRyxDQUFDO0FBQ0osUUFDVSxvQkFBZSxHQUFXLEVBQUUsQ0FBQztBQUN2QyxRQUFtQix1QkFBa0IsR0FBRyxXQUFXLENBQUM7QUFDcEQsUUFBbUIsNEJBQXVCLEdBQUcsZ0JBQWdCLENB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QUFhO0FBQUksUUFDakQsSUFBSSxDQUFDLElBQUksRUFBRTtBQUNmLFlBQU0sT0FBTyxLQUFLLENBQUM7QUFDbkIsU0FBSztBQUNMLFFBQ0ksTUFBTSxpQkFBaUIsR0FDckIsSUFBSSxDQUFDLE1BQU0sS0FBSyxNQUFNLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxRQUFRLElBQUksSUFBSSxDQUFDLE1BQU0sS0FBSyxLQUFLLENBQUM7QUFDbEYsUUFBSSxNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLFFBQVEsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO0FBQy9ELFFBQUksT0FBTyxpQkFBaUIsSUFBSSxjQUFjLENBQUM7QUFDL0MsSUFBRSxDQUFDO0FBQ0g7K05BQUM7QUFDRCxrUkFwT0s7QUFBQztFQURMLFVBQVUsU0FBQyxFQUFFLHZCQUVFLFlBYlMsZ0JBQWdCO0NBV2pCLEVBQUUsTUFBTSxFQUFFLFhBWFcsWUFDM0IsVUFBVTtBQUFJLFlBR3ZCLGVBQWU7QUFBRzs7OztnSkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgSU1hbmFnZWRPYmplY3QsIEludmVudG9yeVNlcnZpY2UgfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQgeyBBcGlDYWxsLCBBcGlTZXJ2aWNlIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cy9hcGknO1xuaW1wb3J0IHsgTkVWRVIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRpc3RpbmN0VW50aWxDaGFuZ2VkLCBtYXAsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHsgQXBwU3RhdGVTZXJ2aWNlIH0gZnJvbSAnLi4vY29tbW9uL3VpLXN0YXRlLnNlcnZpY2UnO1xuXG4vKipcbiAqIEFzc2V0VHlwZXNTZXJ2aWNlIGlzIGJlaW5nIHVzZWQgdG8gbWFuYWdlIGEgY2FjaGUgb2YgYWxsIGV4aXN0aW5nIGFzc2V0IHR5cGVzLlxuICogVGhpcyBzZXJ2aWNlIGlzIGluamVjdGVkIGluIHRoZSBBc3NldE92ZXJ2aWV3TmF2aWdhdGlvbkZhY3RvcnkgY2xhc3MsIHdoaWNoIHdpbGwgdHJpZ2dlclxuICogdGhlIGluaXRpYWxpemF0aW9uIG9mIHRoZSBjYWNoZSBhcyB0aGUgY29udHN0cnVjdG9yIGlzIGNhbGxlZC5cbiAqL1xuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBBc3NldFR5cGVzU2VydmljZSB7XG4gIHByaXZhdGUgcmVhZG9ubHkgQVNTRVRfVFlQRV9HUk9VUF9RVUVSWSA9IHtcbiAgICBfX2ZpbHRlcjoge1xuICAgICAgX19hbmQ6IFt7IF9faGFzOiAnYzh5X0lzQXNzZXRUeXBlJyB9LCB7IG5hbWU6ICdncm91cCcgfV1cbiAgICB9XG4gIH07XG5cbiAgcHJpdmF0ZSBhc3NldFR5cGVzQ2FjaGU6IG9iamVjdCA9IHt9O1xuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfR1JPVVBfSUNPTiA9ICdjOHktZ3JvdXAnO1xuICBwcml2YXRlIHJlYWRvbmx5IERFRkFVTFRfR1JPVVBfSUNPTl9PUEVOID0gJ2M4eS1ncm91cC1vcGVuJztcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGludmVudG9yeTogSW52ZW50b3J5U2VydmljZSxcbiAgICBwcml2YXRlIGFwaVNlcnZpY2U6IEFwaVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhcHBTdGF0ZVNlcnZpY2U6IEFwcFN0YXRlU2VydmljZVxuICApIHtcbiAgICB0aGlzLmFwcFN0YXRlU2VydmljZS5jdXJyZW50VXNlclxuICAgICAgLnBpcGUoXG4gICAgICAgIG1hcCh1c2VyID0+IHVzZXI/LmlkKSxcbiAgICAgICAgZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcbiAgICAgICAgc3dpdGNoTWFwKHVzZXJJZCA9PiB7XG4gICAgICAgICAgaWYgKHVzZXJJZCkge1xuICAgICAgICAgICAgdGhpcy5pbml0QXNzZXRUeXBlc0NhY2hlKCk7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5zdWJzY3JpYmVGb3JBc3NldFR5cGVVcGRhdGVzKCk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuYXNzZXRUeXBlc0NhY2hlID0ge307XG4gICAgICAgICAgICByZXR1cm4gTkVWRVI7XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFF1ZXJpZXMgYXZhaWxhYmxlIGFzc2V0IHR5cGVzIGFuZCBhZGRzIGV2ZXJ5IGFzc2V0IHR5cGUgdG8gdGhlIGxvY2FsIGNhY2hlLlxuICAgKiBAcmV0dXJucyB2b2lkLlxuICAgKi9cbiAgYXN5bmMgaW5pdEFzc2V0VHlwZXNDYWNoZSgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCB7IGRhdGEgfSA9IGF3YWl0IHRoaXMuaW52ZW50b3J5Lmxpc3Qoe1xuICAgICAgZnJhZ21lbnRUeXBlOiAnYzh5X0lzQXNzZXRUeXBlJyxcbiAgICAgIHdpdGhDaGlsZHJlbjogZmFsc2UsXG4gICAgICBwYWdlU2l6ZTogMjAwMFxuICAgIH0pO1xuICAgIGRhdGEuZm9yRWFjaChhc3NldFR5cGUgPT4gdGhpcy5hZGRBc3NldFR5cGUoYXNzZXRUeXBlKSk7XG4gICAgcmV0dXJuO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYXNzZXQgdHlwZSBmcm9tIHRoZSBjYWNoZSBiYXNlZCBvbiB0aGUgdW5pcXVlIG5hbWUgcHJvcGVydHkuXG4gICAqIEBwYXJhbSBuYW1lIE5hbWUgb2YgdGhlIGFzc2V0IHR5cGUuXG4gICAqIEByZXR1cm5zIElNYW5hZ2VkT2JqZWN0IHdoaWNoIHJlcHJlc2VudHMgdGhlIGFzc2V0IHR5cGUuXG4gICAqL1xuICBnZXRBc3NldFR5cGVCeU5hbWUobmFtZTogc3RyaW5nKTogSU1hbmFnZWRPYmplY3Qge1xuICAgIGlmICghdGhpcy5hc3NldFR5cGVzQ2FjaGUuaGFzT3duUHJvcGVydHkobmFtZSkpIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMuYXNzZXRUeXBlc0NhY2hlW25hbWVdO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYXNzZXQgdHlwZSBmcm9tIHRoZSBjYWNoZSBiYXNlZCBvbiB0aGUgaWQuXG4gICAqIEBwYXJhbSBhc3NldFR5cGVJZCBJZCBvZiB0aGUgYXNzZXQgdHlwZS5cbiAgICogQHJldHVybnMgSU1hbmFnZWRPYmplY3Qgd2hpY2ggcmVwcmVzZW50cyB0aGUgYXNzZXQgdHlwZS5cbiAgICovXG4gIGdldEFzc2V0VHlwZUJ5SWQoYXNzZXRUeXBlSWQ6IHN0cmluZyk6IElNYW5hZ2VkT2JqZWN0IHtcbiAgICBpZiAoIWFzc2V0VHlwZUlkKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgcmV0dXJuIE9iamVjdC52YWx1ZXModGhpcy5hc3NldFR5cGVzQ2FjaGUpLmZpbmQoXG4gICAgICAoYXNzZXRUeXBlOiBJTWFuYWdlZE9iamVjdCkgPT4gYXNzZXRUeXBlLmlkID09PSBhc3NldFR5cGVJZFxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogRXh0cmFjdHMgYW4gaWNvbiBmcm9tIGFuIGFzc2V0IHR5cGUuXG4gICAqIEBwYXJhbSB0eXBlIFR5cGUgb2YgdGhlIGFzc2V0IHR5cGUuXG4gICAqIEBwYXJhbSBvcGVuIERldGVybWluZXMgd2hldGhlciB0aGUgbWV0aG9kIHNob3VsZCByZXR1cm4gYW4gYWx0ZXJuYXRpdmUgaWNvbiBzaG93aW5nIHRoZSBvcGVuIHN0YXRlLlxuICAgKiBEZWZhdWx0cyB0byBmYWxzZS5cbiAgICogQHJldHVybnMgUmV0dXJucyBhbiBpY29uIGZvciBhIGdpdmVuIGFzc2V0IHR5cGUuXG4gICAqL1xuICBnZXRJY29uKHR5cGU6IHN0cmluZywgb3BlbjogYm9vbGVhbiA9IGZhbHNlKTogc3RyaW5nIHtcbiAgICBjb25zdCBhc3NldFR5cGUgPSB0aGlzLmdldEFzc2V0VHlwZUJ5TmFtZSh0eXBlKTtcbiAgICBjb25zdCBpY29uID0gYXNzZXRUeXBlPy5jOHlfSXNBc3NldFR5cGU/Lmljb24/Lm5hbWUgfHwgdGhpcy5nZXREZWZhdWx0R3JvdXBJY29uKG9wZW4pO1xuICAgIHJldHVybiBpY29uO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREZWZhdWx0R3JvdXBJY29uKG9wZW46IGJvb2xlYW4gPSBmYWxzZSkge1xuICAgIHJldHVybiBvcGVuID8gdGhpcy5ERUZBVUxUX0dST1VQX0lDT05fT1BFTiA6IHRoaXMuREVGQVVMVF9HUk9VUF9JQ09OO1xuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrcyBpZiB0aGUgZGVmYXVsdCBhc3NldCB0eXBlICdncm91cCcgYWxyZWFkeSBleGlzdHMgYW5kIGlmIGl0IGRvZXNuJ3QgaXQgd2lsbCBiZSBjcmVhdGVkLlxuICAgKiBAcmV0dXJucyB2b2lkLlxuICAgKi9cbiAgcHJpdmF0ZSBhc3luYyBjcmVhdGVBc3NldFR5cGVHcm91cElmTm90RXhpc3RzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IG1hbmFnZWRPYmplY3RzID0gKGF3YWl0IHRoaXMuaW52ZW50b3J5Lmxpc3RRdWVyeSh0aGlzLkFTU0VUX1RZUEVfR1JPVVBfUVVFUlkpKS5kYXRhO1xuXG4gICAgaWYgKG1hbmFnZWRPYmplY3RzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBpZiBkZWZhdWx0IGdyb3VwIGFzc2V0IHR5cGUgZG9lc24ndCBleGl0IGNyZWF0ZSBpdFxuICAgIGF3YWl0IHRoaXMuY3JlYXRlRGVmYXVsdEFzc2V0VHlwZUdyb3VwKCk7XG4gIH1cblxuICAvKipcbiAgICogY3JlYXRlIHRoZSBkZWZhdWx0IGFzc2V0IHR5cGUgZ3JvdXAgaW4gdGhlIEludmVudG9yeS5cbiAgICovXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlRGVmYXVsdEFzc2V0VHlwZUdyb3VwKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMuaW52ZW50b3J5LmNyZWF0ZSh7XG4gICAgICBsYWJlbDogJ0dyb3VwJyxcbiAgICAgIG5hbWU6ICdncm91cCcsXG4gICAgICBkZXNjcmlwdGlvbjogJ0RlZmF1bHQgZ3JvdXAgYXNzZXQgdHlwZScsXG4gICAgICBjOHlfSXNBc3NldFR5cGU6IHtcbiAgICAgICAgaWNvbjogJ2ZvbGRlcicsXG4gICAgICAgIHByb3BlcnR5SWRzOiBbXSxcbiAgICAgICAgYWxsb3dlZEFzc2V0VHlwZUlkczogW10sXG4gICAgICAgIGlzTm9uZUNoaWxkQXNzZXRzQWxsb3dlZDogJ2ZhbHNlJ1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZCBhbiBhc3NldCB0eXBlIHRvIHRoZSBsb2NhbCBjYWNoZS5cbiAgICogQHBhcmFtIGFzc2V0VHlwZSBBc3NldCB0eXBlIHdoaWNoIHNob3VsZCBiZSBhZGRlZCB0byB0aGUgY2FjaGUuXG4gICAqIEByZXR1cm5zIHZvaWQuXG4gICAqL1xuICBwcml2YXRlIGFkZEFzc2V0VHlwZShhc3NldFR5cGU6IElNYW5hZ2VkT2JqZWN0KTogdm9pZCB7XG4gICAgaWYgKCFhc3NldFR5cGUpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Fzc2V0IHR5cGUgbXVzdCBub3QgYmUgbnVsbCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIHRoaXMuYXNzZXRUeXBlc0NhY2hlW2Fzc2V0VHlwZS5uYW1lXSA9IGFzc2V0VHlwZTtcbiAgfVxuXG4gIC8qKlxuICAgKiBEZWxldGUgYW4gYXNzZXQgdHlwZSBmcm9tIHRoZSBsb2NhbCBjYWNoZSBiYXNlZCBvbiB0aGUgZ2l2ZW4gYXNzZXQgdHlwZSBpZC5cbiAgICogQHBhcmFtIGFzc2V0VHlwZUlkIElkIG9mIHRoZSBhc3NldCB0eXBlIHdoaWNoIHNob3VsZCBiZSBkZWxldGVkLlxuICAgKiBAcmV0dXJucyB2b2lkLlxuICAgKi9cbiAgcHJpdmF0ZSBkZWxldGVBc3NldFR5cGUoYXNzZXRUeXBlSWQ6IHN0cmluZyk6IHZvaWQge1xuICAgIGlmICghYXNzZXRUeXBlSWQpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Fzc2V0IHR5cGUgSUQgbXVzdCBub3QgYmUgbnVsbCcpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IGFzc2V0VHlwZSA9IHRoaXMuZ2V0QXNzZXRUeXBlQnlJZChhc3NldFR5cGVJZCk7XG4gICAgaWYgKGFzc2V0VHlwZSkge1xuICAgICAgZGVsZXRlIHRoaXMuYXNzZXRUeXBlc0NhY2hlW2Fzc2V0VHlwZS5uYW1lXTtcbiAgICB9XG4gIH1cbiAgLyoqXG4gICAqIFVwZGF0ZSBhbiBhc3NldCB0eXBlIGluIHRoZSBsb2NhbCBjYWNoZS5cbiAgICogQHBhcmFtIGFzc2V0VHlwZSBBc3NldCB0eXBlIHdoaWNoIHNob3VsZCBiZSB1cGRhdGVkIGluIHRoZSBjYWNoZS5cbiAgICogQHJldHVybnMgdm9pZC5cbiAgICovXG4gIHByaXZhdGUgdXBkYXRlQXNzZXRUeXBlKGFzc2V0VHlwZTogSU1hbmFnZWRPYmplY3QpOiB2b2lkIHtcbiAgICBpZiAoIWFzc2V0VHlwZSkge1xuICAgICAgY29uc29sZS5lcnJvcignQXNzZXQgdHlwZSBtdXN0IG5vdCBiZSBudWxsJyk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgY29uc3QgY2FjaGVkQXNzZXRUeXBlID0gdGhpcy5nZXRBc3NldFR5cGVCeUlkKGFzc2V0VHlwZS5pZCk7XG4gICAgaWYgKGNhY2hlZEFzc2V0VHlwZSkge1xuICAgICAgdGhpcy5hc3NldFR5cGVzQ2FjaGVbY2FjaGVkQXNzZXRUeXBlLm5hbWVdID0gT2JqZWN0LmFzc2lnbihjYWNoZWRBc3NldFR5cGUsIGFzc2V0VHlwZSk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFN1YnNjcmliZXMgdG8gYXBpIFBVVCwgUE9TVCBhbmQgREVMRVRFIHJlcXVlc3RzIGludGVyY2VwdG9yIHRvIHVwZGF0ZSBsb2NhbCBhc3NldCB0eXBlcyBjYWNoZS5cbiAgICogSWYgYSBuZXcgYXNzZXQgdHlwZSBoYXMgYmVlbiBjcmVhdGVkIGl0IHdpbGwgYmUgYWRkZWQgdG8gdGhlIGxvY2FsIGNhY2hlLiBJZiBhbiBhc3NldFxuICAgKiB0eXBlIGhhcyBiZWVuIGRlbGV0ZWQgaXQgd2lsbCBiZSByZW1vdmVkIGZyb20gdGhlIGxvY2FsIGNhY2hlLlxuICAgKi9cbiAgcHJpdmF0ZSBzdWJzY3JpYmVGb3JBc3NldFR5cGVVcGRhdGVzKCkge1xuICAgIHJldHVybiB0aGlzLmFwaVNlcnZpY2VcbiAgICAgIC5ob29rUmVzcG9uc2UoYyA9PiB0aGlzLmNoZWNrSWZJbnZlbnRvcnlNb0FwaUNhbGwoYykpXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKChjYWxsOiBBcGlDYWxsKSA9PiB7XG4gICAgICAgICAgaWYgKCFjYWxsICYmICFjYWxsLm1ldGhvZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICBjb25zdCBib2R5VG9QYXJzZSA9IGNhbGwub3B0aW9ucz8uYm9keTtcbiAgICAgICAgICBpZiAoYm9keVRvUGFyc2UpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgIGNvbnN0IG1vOiBJTWFuYWdlZE9iamVjdCA9IEpTT04ucGFyc2UoYm9keVRvUGFyc2UgYXMgc3RyaW5nKTtcblxuICAgICAgICAgICAgICBpZiAoY2FsbC5tZXRob2QgPT09ICdERUxFVEUnKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZWxldGVBc3NldFR5cGUobW8uaWQpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgIGlmICghbW8uaGFzT3duUHJvcGVydHkoJ2M4eV9Jc0Fzc2V0VHlwZScpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgaWYgKGNhbGwubWV0aG9kID09PSAnUFVUJykge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQXNzZXRUeXBlKG1vKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICB0aGlzLmFkZEFzc2V0VHlwZShtbyk7XG4gICAgICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAvLyBkbyBub3RoaW5nXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9KVxuICAgICAgKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBNYW5hZ2VkIG9iamVjdHMgaW52ZW50b3J5IGFwaSBmaWx0ZXIsIGFsbG93aW5nIG9ubHkgUFVULCBQT1NUIGFuZCBERUxFVEUgbWV0aG9kcy5cbiAgICogQHBhcmFtIGNhbGwgQXBpIGNhbGwgdG8gZmlsdGVyLlxuICAgKiBAcmV0dXJucyBSZXR1cm5zIHRydWUgaWYgYXBpIGNhbGwgbWVldHMgdGhlIHJlcXVpcmVkIGNyaXRlcmlhLlxuICAgKi9cbiAgcHJpdmF0ZSBjaGVja0lmSW52ZW50b3J5TW9BcGlDYWxsKGNhbGw6IEFwaUNhbGwpOiBib29sZWFuIHtcbiAgICBpZiAoIWNhbGwpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICBjb25zdCBoYXNSZXF1aXJlZE1ldGhvZCA9XG4gICAgICBjYWxsLm1ldGhvZCA9PT0gJ1BPU1QnIHx8IGNhbGwubWV0aG9kID09PSAnREVMRVRFJyB8fCBjYWxsLm1ldGhvZCA9PT0gJ1BVVCc7XG4gICAgY29uc3QgaGFzUmVxdWlyZWRVcmwgPSBjYWxsLnVybC5pbmNsdWRlcygnbWFuYWdlZE9iamVjdHMnKTtcbiAgICByZXR1cm4gaGFzUmVxdWlyZWRNZXRob2QgJiYgaGFzUmVxdWlyZWRVcmw7XG4gIH1cbn1cbiJdfQ==