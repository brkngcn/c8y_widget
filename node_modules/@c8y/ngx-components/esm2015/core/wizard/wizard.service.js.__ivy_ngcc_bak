import { Injectable, Injector } from '@angular/core';
import { Router } from '@angular/router';
import { BsModalService } from 'ngx-bootstrap/modal';
import { BehaviorSubject, Subject } from 'rxjs';
import { map, shareReplay } from 'rxjs/operators';
import { fromTrigger, stateToFactory } from '../common/extension-hooks';
import { StateService } from '../common/state-service.abstract';
import { WizardComponent } from './wizard.component';
import { HOOK_WIZARD } from './wizard.model';
import * as i0 from "@angular/core";
import * as i1 from "ngx-bootstrap/modal";
import * as i2 from "@angular/router";
export class WizardService extends StateService {
    constructor(bsModalService, injector, router) {
        super();
        this.bsModalService = bsModalService;
        this.injector = injector;
        this.router = router;
        /** Wizard header subject. It emits header template. */
        this.headerTemplate$ = new Subject();
        /** Wizard body subject. It emits body template. */
        this.bodyTemplate$ = new Subject();
        /** Wizard footer subject. It emits footer template. */
        this.footerTemplate$ = new Subject();
        /**
         * @ignore
         */
        this.state$ = new BehaviorSubject(new Set());
        /** Refresh the extension factories subject. */
        this.refreshTrigger = new Subject();
        /** Additional factories that can be added by plugins. */
        this.factories = [];
        this.items$ = fromTrigger(this.router, this.refreshTrigger, [
            () => this.injector.get(HOOK_WIZARD, []),
            () => this.factories,
            stateToFactory(this.state$)
        ]).pipe(map(entries => this.getUniqueListBy(entries, 'name', 'wizardId')), shareReplay(1));
    }
    /**
     * Returns the current state.
     * @returns The current set of entries.
     * @readonly
     */
    get state() {
        return this.state$.value;
    }
    /**
     * Refresh the extension factories.
     */
    refresh() {
        this.refreshTrigger.next();
    }
    /**
     * Adds a new entry in the wizard.
     * @param entry Wizard entry to add.
     */
    add(entry) {
        this.state.add(entry);
        this.emitNewState();
    }
    /**
     * Removes entry from the wizard.
     * @param entry Wizard entry to remove.
     */
    remove(entry) {
        this.state.delete(entry);
        this.emitNewState();
    }
    /**
     * List of wizard entries matching the given id.
     * @param id
     * @returns observable with list of wizard entries.
     */
    getEntriesListById(id) {
        return this.items$.pipe(map(entries => entries.filter(entry => entry.wizardId === id)));
    }
    /**
     * Shows a wizard modal.
     * @param modalOptions Modal options.
     * @returns a reference to the modal.
     */
    show(modalOptions = {}) {
        const options = Object.assign({ class: 'modal-sm', backdrop: 'static' }, modalOptions);
        return this.bsModalService.show(WizardComponent, options);
    }
    getUniqueListBy(entries, ...keys) {
        return [
            ...new Map(entries.map(item => [this.getUniqIdentifierForKeys(item, keys), item])).values()
        ];
    }
    getUniqIdentifierForKeys(entry, keys) {
        return keys.map(key => entry[key]).join('_');
    }
}
WizardService.ɵprov = i0.ɵɵdefineInjectable({ factory: function WizardService_Factory() { return new WizardService(i0.ɵɵinject(i1.BsModalService), i0.ɵɵinject(i0.INJECTOR), i0.ɵɵinject(i2.Router)); }, token: WizardService, providedIn: "root" });
WizardService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
WizardService.ctorParameters = () => [
    { type: BsModalService },
    { type: Injector },
    { type: Router }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2l6YXJkLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL3dpemFyZC93aXphcmQuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBZSxNQUFNLGVBQWUsQ0FBQztBQUNsRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFjLGNBQWMsRUFBZ0IsTUFBTSxxQkFBcUIsQ0FBQztBQUMvRSxPQUFPLEVBQUUsZUFBZSxFQUFjLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1RCxPQUFPLEVBQUUsR0FBRyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ2xELE9BQU8sRUFBa0IsV0FBVyxFQUFFLGNBQWMsRUFBRSxNQUFNLDJCQUEyQixDQUFDO0FBQ3hGLE9BQU8sRUFBRSxZQUFZLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNoRSxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sb0JBQW9CLENBQUM7QUFDckQsT0FBTyxFQUFFLFdBQVcsRUFBZ0MsTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQUszRSxNQUFNLE9BQU8sYUFBYyxTQUFRLFlBQVk7SUFvQjdDLFlBQ1UsY0FBOEIsRUFDOUIsUUFBa0IsRUFDbEIsTUFBYztRQUV0QixLQUFLLEVBQUUsQ0FBQztRQUpBLG1CQUFjLEdBQWQsY0FBYyxDQUFnQjtRQUM5QixhQUFRLEdBQVIsUUFBUSxDQUFVO1FBQ2xCLFdBQU0sR0FBTixNQUFNLENBQVE7UUFwQnhCLHVEQUF1RDtRQUM5QyxvQkFBZSxHQUN0QixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ2hCLG1EQUFtRDtRQUMxQyxrQkFBYSxHQUE4RCxJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ2xHLHVEQUF1RDtRQUM5QyxvQkFBZSxHQUN0QixJQUFJLE9BQU8sRUFBRSxDQUFDO1FBQ2hCOztXQUVH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cG9ydCB7IEluamVjdGFibGUsIEluamVjdG9yLCBUZW1wbGF0ZVJlZiB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcbmltcG9ydCB7IEJzTW9kYWxSZWYsIEJzTW9kYWxTZXJ2aWNlLCBNb2RhbE9wdGlvbnMgfSBmcm9tICduZ3gtYm9vdHN0cmFwL21vZGFsJztcbmltcG9ydCB7IEJlaGF2aW9yU3ViamVjdCwgT2JzZXJ2YWJsZSwgU3ViamVjdCB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHsgbWFwLCBzaGFyZVJlcGxheSB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEV4dGVuc2lvblBvaW50LCBmcm9tVHJpZ2dlciwgc3RhdGVUb0ZhY3RvcnkgfSBmcm9tICcuLi9jb21tb24vZXh0ZW5zaW9uLWhvb2tzJztcbmltcG9ydCB7IFN0YXRlU2VydmljZSB9IGZyb20gJy4uL2NvbW1vbi9zdGF0ZS1zZXJ2aWNlLmFic3RyYWN0JztcbmltcG9ydCB7IFdpemFyZENvbXBvbmVudCB9IGZyb20gJy4vd2l6YXJkLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBIT09LX1dJWkFSRCwgV2l6YXJkRW50cnksIFdpemFyZEV4dGVuc2lvbiB9IGZyb20gJy4vd2l6YXJkLm1vZGVsJztcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgV2l6YXJkU2VydmljZSBleHRlbmRzIFN0YXRlU2VydmljZSBpbXBsZW1lbnRzIEV4dGVuc2lvblBvaW50PFdpemFyZEV4dGVuc2lvbj4ge1xuICAvKiogV2l6YXJkIGxpc3Qgb2JzZXJ2YWJsZS4gSXQgZW1pdHMgdGhlIGN1cnJlbnQgbGlzdCBvZiB0aGUgd2l6YXJkIGVudHJpZXMuICovXG4gIHJlYWRvbmx5IGl0ZW1zJDogT2JzZXJ2YWJsZTxXaXphcmRFbnRyeVtdPjtcbiAgLyoqIFdpemFyZCBoZWFkZXIgc3ViamVjdC4gSXQgZW1pdHMgaGVhZGVyIHRlbXBsYXRlLiAqL1xuICByZWFkb25seSBoZWFkZXJUZW1wbGF0ZSQ6IFN1YmplY3Q8eyB3aXphcmRJZDogc3RyaW5nOyB0ZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiB9PiA9XG4gICAgbmV3IFN1YmplY3QoKTtcbiAgLyoqIFdpemFyZCBib2R5IHN1YmplY3QuIEl0IGVtaXRzIGJvZHkgdGVtcGxhdGUuICovXG4gIHJlYWRvbmx5IGJvZHlUZW1wbGF0ZSQ6IFN1YmplY3Q8eyB3aXphcmRJZDogc3RyaW5nOyB0ZW1wbGF0ZTogVGVtcGxhdGVSZWY8YW55PiB9PiA9IG5ldyBTdWJqZWN0KCk7XG4gIC8qKiBXaXphcmQgZm9vdGVyIHN1YmplY3QuIEl0IGVtaXRzIGZvb3RlciB0ZW1wbGF0ZS4gKi9cbiAgcmVhZG9ubHkgZm9vdGVyVGVtcGxhdGUkOiBTdWJqZWN0PHsgd2l6YXJkSWQ6IHN0cmluZzsgdGVtcGxhdGU6IFRlbXBsYXRlUmVmPGFueT4gfT4gPVxuICAgIG5ldyBTdWJqZWN0KCk7XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICByZWFkb25seSBzdGF0ZSQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PFNldDxXaXphcmRFbnRyeT4+KG5ldyBTZXQ8V2l6YXJkRW50cnk+KCkpO1xuICAvKiogUmVmcmVzaCB0aGUgZXh0ZW5zaW9uIGZhY3RvcmllcyBzdWJqZWN0LiAqL1xuICByZWFkb25seSByZWZyZXNoVHJpZ2dlciA9IG5ldyBTdWJqZWN0KCk7XG4gIC8qKiBBZGRpdGlvbmFsIGZhY3RvcmllcyB0aGF0IGNhbiBiZSBhZGRlZCBieSBwbHVnaW5zLiAqL1xuICBmYWN0b3JpZXM6IFdpemFyZEV4dGVuc2lvbltdID0gW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBic01vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBpbmplY3RvcjogSW5qZWN0b3IsXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlclxuICApIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuaXRlbXMkID0gZnJvbVRyaWdnZXIodGhpcy5yb3V0ZXIsIHRoaXMucmVmcmVzaFRyaWdnZXIsIFtcbiAgICAgICgpID0+IHRoaXMuaW5qZWN0b3IuZ2V0KEhPT0tfV0laQVJELCBbXSksXG4gICAgICAoKSA9PiB0aGlzLmZhY3RvcmllcyxcbiAgICAgIHN0YXRlVG9GYWN0b3J5KHRoaXMuc3RhdGUkKVxuICAgIF0pLnBpcGUoXG4gICAgICBtYXAoZW50cmllcyA9PiB0aGlzLmdldFVuaXF1ZUxpc3RCeShlbnRyaWVzLCAnbmFtZScsICd3aXphcmRJZCcpIGFzIFdpemFyZEVudHJ5W10pLFxuICAgICAgc2hhcmVSZXBsYXkoMSlcbiAgICApO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgdGhlIGN1cnJlbnQgc3RhdGUuXG4gICAqIEByZXR1cm5zIFRoZSBjdXJyZW50IHNldCBvZiBlbnRyaWVzLlxuICAgKiBAcmVhZG9ubHlcbiAgICovXG4gIGdldCBzdGF0ZSgpOiBTZXQ8V2l6YXJkRW50cnk+IHtcbiAgICByZXR1cm4gdGhpcy5zdGF0ZSQudmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogUmVmcmVzaCB0aGUgZXh0ZW5zaW9uIGZhY3Rvcmllcy5cbiAgICovXG4gIHJlZnJlc2goKSB7XG4gICAgdGhpcy5yZWZyZXNoVHJpZ2dlci5uZXh0KCk7XG4gIH1cblxuICAvKipcbiAgICogQWRkcyBhIG5ldyBlbnRyeSBpbiB0aGUgd2l6YXJkLlxuICAgKiBAcGFyYW0gZW50cnkgV2l6YXJkIGVudHJ5IHRvIGFkZC5cbiAgICovXG4gIGFkZChlbnRyeTogV2l6YXJkRW50cnkpIHtcbiAgICB0aGlzLnN0YXRlLmFkZChlbnRyeSk7XG4gICAgdGhpcy5lbWl0TmV3U3RhdGUoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZW1vdmVzIGVudHJ5IGZyb20gdGhlIHdpemFyZC5cbiAgICogQHBhcmFtIGVudHJ5IFdpemFyZCBlbnRyeSB0byByZW1vdmUuXG4gICAqL1xuICByZW1vdmUoZW50cnk6IFdpemFyZEVudHJ5KSB7XG4gICAgdGhpcy5zdGF0ZS5kZWxldGUoZW50cnkpO1xuICAgIHRoaXMuZW1pdE5ld1N0YXRlKCk7XG4gIH1cblxuICAvKipcbiAgICogTGlzdCBvZiB3aXphcmQgZW50cmllcyBtYXRjaGluZyB0aGUgZ2l2ZW4gaWQuXG4gICAqIEBwYXJhbSBpZFxuICAgKiBAcmV0dXJucyBvYnNlcnZhYmxlIHdpdGggbGlzdCBvZiB3aXphcmQgZW50cmllcy5cbiAgICovXG4gIGdldEVudHJpZXNMaXN0QnlJZChpZDogc3RyaW5nKTogT2JzZXJ2YWJsZTxXaXphcmRFbnRyeVtdPiB7XG4gICAgcmV0dXJuIHRoaXMuaXRlbXMkLnBpcGUobWFwKGVudHJpZXMgPT4gZW50cmllcy5maWx0ZXIoZW50cnkgPT4gZW50cnkud2l6YXJkSWQgPT09IGlkKSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIFNob3dzIGEgd2l6YXJkIG1vZGFsLlxuICAgKiBAcGFyYW0gbW9kYWxPcHRpb25zIE1vZGFsIG9wdGlvbnMuXG4gICAqIEByZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBtb2RhbC5cbiAgICovXG4gIHNob3cobW9kYWxPcHRpb25zOiBNb2RhbE9wdGlvbnMgPSB7fSk6IEJzTW9kYWxSZWY8V2l6YXJkQ29tcG9uZW50PiB7XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIGNsYXNzOiAnbW9kYWwtc20nLFxuICAgICAgYmFja2Ryb3A6ICdzdGF0aWMnLFxuICAgICAgLi4ubW9kYWxPcHRpb25zXG4gICAgfSBhcyBNb2RhbE9wdGlvbnM8V2l6YXJkQ29tcG9uZW50PjtcbiAgICByZXR1cm4gdGhpcy5ic01vZGFsU2VydmljZS5zaG93PFdpemFyZENvbXBvbmVudD4oV2l6YXJkQ29tcG9uZW50LCBvcHRpb25zKTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VW5pcXVlTGlzdEJ5PFQ+KGVudHJpZXM6IFRbXSwgLi4ua2V5czogc3RyaW5nW10pOiBUW10ge1xuICAgIHJldHVybiBbXG4gICAgICAuLi5uZXcgTWFwKGVudHJpZXMubWFwKGl0ZW0gPT4gW3RoaXMuZ2V0VW5pcUlkZW50aWZpZXJGb3JLZXlzKGl0ZW0sIGtleXMpLCBpdGVtXSkpLnZhbHVlcygpXG4gICAgXTtcbiAgfVxuXG4gIHByaXZhdGUgZ2V0VW5pcUlkZW50aWZpZXJGb3JLZXlzKGVudHJ5OiBhbnksIGtleXM6IHN0cmluZ1tdKTogc3RyaW5nIHtcbiAgICByZXR1cm4ga2V5cy5tYXAoa2V5ID0+IGVudHJ5W2tleV0pLmpvaW4oJ18nKTtcbiAgfVxufVxuIl19