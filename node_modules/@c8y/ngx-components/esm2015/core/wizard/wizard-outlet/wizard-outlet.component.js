import { Component, ComponentFactoryResolver, EventEmitter, Host, Input, Output, ViewChild, ViewContainerRef } from '@angular/core';
import { Router } from '@angular/router';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { WizardComponent } from '../wizard.component';
import { WizardService } from '../wizard.service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../wizard.component';
import * as ɵngcc2 from '@angular/router';
import * as ɵngcc3 from '../wizard.service';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '../../i18n/c8y-translate.directive';
import * as ɵngcc6 from '../../common/icon.directive';
import * as ɵngcc7 from '../../i18n/c8y-translate.pipe';

const _c0 = ["container"];
function WizardOutletComponent_div_1_div_4_button_1_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 10);
    ɵngcc0.ɵɵlistener("click", function WizardOutletComponent_div_1_div_4_button_1_Template_button_click_0_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r8); const entry_r6 = restoredCtx.$implicit; const ctx_r7 = ɵngcc0.ɵɵnextContext(3); return ctx_r7.handleEntry(entry_r6); });
    ɵngcc0.ɵɵelementStart(1, "div", 11);
    ɵngcc0.ɵɵelement(2, "i", 12);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "div", 13);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵtext(5);
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const entry_r6 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIcon", entry_r6.c8yIcon || "cogs");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(4, 3, entry_r6.name));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(6, 5, entry_r6.name), " ");
} }
function WizardOutletComponent_div_1_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 8);
    ɵngcc0.ɵɵtemplate(1, WizardOutletComponent_div_1_div_4_button_1_Template, 7, 7, "button", 9);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r2.entries);
} }
function WizardOutletComponent_div_1_ng_template_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 14);
    ɵngcc0.ɵɵelementStart(1, "p");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 1, "No options available."));
} }
function WizardOutletComponent_div_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 3);
    ɵngcc0.ɵɵelementStart(1, "p", 4);
    ɵngcc0.ɵɵelementStart(2, "span", 5);
    ɵngcc0.ɵɵtext(3, "Select method");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(4, WizardOutletComponent_div_1_div_4_Template, 2, 1, "div", 6);
    ɵngcc0.ɵɵtemplate(5, WizardOutletComponent_div_1_ng_template_5_Template, 4, 3, "ng-template", null, 7, ɵngcc0.ɵɵtemplateRefExtractor);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const _r3 = ɵngcc0.ɵɵreference(6);
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.entries.length > 0)("ngIfElse", _r3);
} }
export class WizardOutletComponent {
    constructor(wizardComponent, router, c8yWizardService, resolver) {
        this.wizardComponent = wizardComponent;
        this.router = router;
        this.c8yWizardService = c8yWizardService;
        this.resolver = resolver;
        /**
         * The event that is emitted when the wizard entry is clicked.
         */
        this.onSelect = new EventEmitter();
        /**
         * The initial state to be assigned to the created component.
         */
        this.initialState = {};
        /**
         * List of wizard entries.
         */
        this.entries = [];
        /**
         * @ignore
         */
        this.showList = true;
        /**
         * @ignore
         */
        this.destroy$ = new Subject();
    }
    ngAfterViewInit() {
        this.c8yWizardService
            .getEntriesListById(this.wizardComponent.id)
            .pipe(takeUntil(this.destroy$))
            .subscribe((entries) => {
            this.container.clear();
            this.entries = entries;
            this.onEntriesLoaded();
        });
        this.wizardComponent.onReset.pipe(takeUntil(this.destroy$)).subscribe(() => {
            if (this.componentInstance) {
                this.componentInstance = undefined;
                this.container.clear();
                this.showList = true;
            }
        });
    }
    /**
     * Handles the wizard entry, if the entry contains a path, the user will be redirected to it.
     * Otherwise, an attempt will be made to create a dynamic component provided in the entry.
     * @param entry Wizard menu entry.
     */
    handleEntry(entry = {}) {
        const { path, component } = entry;
        if (path) {
            this.handlePath(path);
            return;
        }
        if (component) {
            this.handleComponent(component);
            this.onSelect.emit(entry);
        }
    }
    ngOnDestroy() {
        if (this.componentInstance) {
            this.container.clear();
        }
        this.destroy$.next(true);
        this.destroy$.unsubscribe();
    }
    onEntriesLoaded() {
        const [firstEntry] = this.entries;
        const isSingleEntry = this.entries.length === 1;
        const shouldRedirectToPath = firstEntry && !!firstEntry.path;
        const shouldOmitListOfEntries = isSingleEntry && !shouldRedirectToPath;
        if (shouldOmitListOfEntries) {
            this.handleEntry(firstEntry);
        }
    }
    handlePath(path) {
        this.router.navigateByUrl(path);
        if (this.wizardComponent) {
            this.wizardComponent.close();
        }
    }
    handleComponent(component) {
        this.showList = false;
        const factory = this.resolver.resolveComponentFactory(component);
        const componentInstance = this.container.createComponent(factory);
        Object.assign(componentInstance.instance, this.initialState);
        this.componentInstance = componentInstance;
    }
}
WizardOutletComponent.ɵfac = function WizardOutletComponent_Factory(t) { return new (t || WizardOutletComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.WizardComponent, 1), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.WizardService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ComponentFactoryResolver)); };
WizardOutletComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: WizardOutletComponent, selectors: [["c8y-wizard-outlet"]], viewQuery: function WizardOutletComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, 5, ViewContainerRef);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.container = _t.first);
    } }, inputs: { initialState: "initialState" }, outputs: { onSelect: "onSelect" }, decls: 4, vars: 2, consts: [["class", "modal-inner-scroll animated fadeIn", 4, "ngIf"], [3, "hidden"], ["container", ""], [1, "modal-inner-scroll", "animated", "fadeIn"], [1, "p-16", "text-center", "text-medium", "separator-bottom"], ["translate", ""], ["class", "list-group list-group-links", 4, "ngIf", "ngIfElse"], ["emptyState", ""], [1, "list-group", "list-group-links"], ["type", "button", "class", "list-group-item d-flex a-i-center p-t-8 p-b-8", 3, "click", 4, "ngFor", "ngForOf"], ["type", "button", 1, "list-group-item", "d-flex", "a-i-center", "p-t-8", "p-b-8", 3, "click"], [1, "list-item-icon"], [3, "c8yIcon"], [1, "list-item-body", "text-truncate", 3, "title"], [1, "c8y-empty-state"]], template: function WizardOutletComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementContainerStart(0);
        ɵngcc0.ɵɵtemplate(1, WizardOutletComponent_div_1_Template, 7, 2, "div", 0);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelement(2, "template", 1, 2);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showList);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("hidden", ctx.showList);
    } }, directives: [ɵngcc4.NgIf, ɵngcc5.C8yTranslateDirective, ɵngcc4.NgForOf, ɵngcc6.IconDirective], pipes: [ɵngcc7.C8yTranslatePipe], encapsulation: 2 });
WizardOutletComponent.ctorParameters = () => [
    { type: WizardComponent, decorators: [{ type: Host }] },
    { type: Router },
    { type: WizardService },
    { type: ComponentFactoryResolver }
];
WizardOutletComponent.propDecorators = {
    container: [{ type: ViewChild, args: ['container', { read: ViewContainerRef },] }],
    onSelect: [{ type: Output }],
    initialState: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WizardOutletComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-wizard-outlet',
                template: "<ng-container>\n  <div class=\"modal-inner-scroll animated fadeIn\" *ngIf=\"showList\">\n    <p class=\"p-16 text-center text-medium separator-bottom\">\n      <span translate>Select method</span>\n    </p>\n    <div class=\"list-group list-group-links\" *ngIf=\"entries.length > 0; else emptyState\">\n      <button\n        *ngFor=\"let entry of entries\"\n        type=\"button\"\n        class=\"list-group-item d-flex a-i-center p-t-8 p-b-8\"\n        (click)=\"handleEntry(entry)\"\n      >\n        <div class=\"list-item-icon\">\n          <i [c8yIcon]=\"entry.c8yIcon || 'cogs'\"></i>\n        </div>\n        <div title=\"{{ entry.name | translate }}\" class=\"list-item-body text-truncate\">\n          {{ entry.name | translate }}\n        </div>\n      </button>\n    </div>\n\n    <ng-template #emptyState>\n      <div class=\"c8y-empty-state\">\n        <p>{{ 'No options available.' | translate }}</p>\n      </div>\n    </ng-template>\n  </div>\n</ng-container>\n<template #container [hidden]=\"showList\"></template>\n"
            }]
    }], function () { return [{ type: ɵngcc1.WizardComponent, decorators: [{
                type: Host
            }] }, { type: ɵngcc2.Router }, { type: ɵngcc3.WizardService }, { type: ɵngcc0.ComponentFactoryResolver }]; }, { onSelect: [{
            type: Output
        }], initialState: [{
            type: Input
        }], container: [{
            type: ViewChild,
            args: ['container', { read: ViewContainerRef }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2l6YXJkLW91dGxldC5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2NvcmUvd2l6YXJkL3dpemFyZC1vdXRsZXQvd2l6YXJkLW91dGxldC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCx3QkFBd0IsRUFFeEIsWUFBWSxFQUNaLElBQUksRUFDSixLQUFLLEVBRUwsTUFBTSxFQUVOLFNBQVMsRUFDVCxnQkFBZ0IsRUFDakIsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3pDLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDL0IsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUV0RCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sbUJBQW1CLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1sRCxNQUFNLE9BQU8scUJBQXFCO0FBQUcsSUEwQm5DLFlBQ2tCLGVBQWdDLEVBQ3hDLE1BQWMsRUFDZCxnQkFBK0IsRUFDL0IsUUFBa0M7QUFDM0MsUUFKaUIsb0JBQWUsR0FBZixlQUFlLENBQWlCO0FBQUMsUUFDekMsV0FBTSxHQUFOLE1BQU0sQ0FBUTtBQUFDLFFBQ2YscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFlO0FBQUMsUUFDaEMsYUFBUSxHQUFSLFFBQVEsQ0FBMEI7QUFDOUMsUUE3QkU7QUFDRjtBQUVBLFdBREs7QUFDTCxRQUFZLGFBQVEsR0FBOEIsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUNyRSxRQUFFO0FBQ0Y7QUFFQSxXQURLO0FBQ0wsUUFBVyxpQkFBWSxHQUFRLEVBQUUsQ0FBQztBQUNsQyxRQUFF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ZXJWaWV3SW5pdCxcbiAgQ29tcG9uZW50LFxuICBDb21wb25lbnRGYWN0b3J5UmVzb2x2ZXIsXG4gIENvbXBvbmVudFJlZixcbiAgRXZlbnRFbWl0dGVyLFxuICBIb3N0LFxuICBJbnB1dCxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG4gIFR5cGUsXG4gIFZpZXdDaGlsZCxcbiAgVmlld0NvbnRhaW5lclJlZlxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBXaXphcmRDb21wb25lbnQgfSBmcm9tICcuLi93aXphcmQuY29tcG9uZW50JztcbmltcG9ydCB7IFdpemFyZEVudHJ5IH0gZnJvbSAnLi4vd2l6YXJkLm1vZGVsJztcbmltcG9ydCB7IFdpemFyZFNlcnZpY2UgfSBmcm9tICcuLi93aXphcmQuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS13aXphcmQtb3V0bGV0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3dpemFyZC1vdXRsZXQuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFdpemFyZE91dGxldENvbXBvbmVudCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uRGVzdHJveSB7XG4gIEBWaWV3Q2hpbGQoJ2NvbnRhaW5lcicsIHsgcmVhZDogVmlld0NvbnRhaW5lclJlZiB9KSBjb250YWluZXI6IFZpZXdDb250YWluZXJSZWY7XG4gIC8qKlxuICAgKiBUaGUgZXZlbnQgdGhhdCBpcyBlbWl0dGVkIHdoZW4gdGhlIHdpemFyZCBlbnRyeSBpcyBjbGlja2VkLlxuICAgKi9cbiAgQE91dHB1dCgpIG9uU2VsZWN0OiBFdmVudEVtaXR0ZXI8V2l6YXJkRW50cnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAvKipcbiAgICogVGhlIGluaXRpYWwgc3RhdGUgdG8gYmUgYXNzaWduZWQgdG8gdGhlIGNyZWF0ZWQgY29tcG9uZW50LlxuICAgKi9cbiAgQElucHV0KCkgaW5pdGlhbFN0YXRlOiBhbnkgPSB7fTtcbiAgLyoqXG4gICAqIExpc3Qgb2Ygd2l6YXJkIGVudHJpZXMuXG4gICAqL1xuICBlbnRyaWVzOiBXaXphcmRFbnRyeVtdID0gW107XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBzaG93TGlzdDogYm9vbGVhbiA9IHRydWU7XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBwcml2YXRlIGRlc3Ryb3kkOiBTdWJqZWN0PGJvb2xlYW4+ID0gbmV3IFN1YmplY3Q8Ym9vbGVhbj4oKTtcbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIHByaXZhdGUgY29tcG9uZW50SW5zdGFuY2U6IENvbXBvbmVudFJlZjx1bmtub3duPjtcbiAgY29uc3RydWN0b3IoXG4gICAgQEhvc3QoKSBwcml2YXRlIHdpemFyZENvbXBvbmVudDogV2l6YXJkQ29tcG9uZW50LFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBjOHlXaXphcmRTZXJ2aWNlOiBXaXphcmRTZXJ2aWNlLFxuICAgIHByaXZhdGUgcmVzb2x2ZXI6IENvbXBvbmVudEZhY3RvcnlSZXNvbHZlclxuICApIHt9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuYzh5V2l6YXJkU2VydmljZVxuICAgICAgLmdldEVudHJpZXNMaXN0QnlJZCh0aGlzLndpemFyZENvbXBvbmVudC5pZClcbiAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSlcbiAgICAgIC5zdWJzY3JpYmUoKGVudHJpZXM6IFdpemFyZEVudHJ5W10pID0+IHtcbiAgICAgICAgdGhpcy5jb250YWluZXIuY2xlYXIoKTtcbiAgICAgICAgdGhpcy5lbnRyaWVzID0gZW50cmllcztcbiAgICAgICAgdGhpcy5vbkVudHJpZXNMb2FkZWQoKTtcbiAgICAgIH0pO1xuXG4gICAgdGhpcy53aXphcmRDb21wb25lbnQub25SZXNldC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3kkKSkuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgIGlmICh0aGlzLmNvbXBvbmVudEluc3RhbmNlKSB7XG4gICAgICAgIHRoaXMuY29tcG9uZW50SW5zdGFuY2UgPSB1bmRlZmluZWQ7XG4gICAgICAgIHRoaXMuY29udGFpbmVyLmNsZWFyKCk7XG4gICAgICAgIHRoaXMuc2hvd0xpc3QgPSB0cnVlO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIEhhbmRsZXMgdGhlIHdpemFyZCBlbnRyeSwgaWYgdGhlIGVudHJ5IGNvbnRhaW5zIGEgcGF0aCwgdGhlIHVzZXIgd2lsbCBiZSByZWRpcmVjdGVkIHRvIGl0LlxuICAgKiBPdGhlcndpc2UsIGFuIGF0dGVtcHQgd2lsbCBiZSBtYWRlIHRvIGNyZWF0ZSBhIGR5bmFtaWMgY29tcG9uZW50IHByb3ZpZGVkIGluIHRoZSBlbnRyeS5cbiAgICogQHBhcmFtIGVudHJ5IFdpemFyZCBtZW51IGVudHJ5LlxuICAgKi9cbiAgaGFuZGxlRW50cnkoZW50cnk6IFdpemFyZEVudHJ5ID0ge30gYXMgV2l6YXJkRW50cnkpIHtcbiAgICBjb25zdCB7IHBhdGgsIGNvbXBvbmVudCB9ID0gZW50cnk7XG4gICAgaWYgKHBhdGgpIHtcbiAgICAgIHRoaXMuaGFuZGxlUGF0aChwYXRoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoY29tcG9uZW50KSB7XG4gICAgICB0aGlzLmhhbmRsZUNvbXBvbmVudChjb21wb25lbnQpO1xuICAgICAgdGhpcy5vblNlbGVjdC5lbWl0KGVudHJ5KTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICBpZiAodGhpcy5jb21wb25lbnRJbnN0YW5jZSkge1xuICAgICAgdGhpcy5jb250YWluZXIuY2xlYXIoKTtcbiAgICB9XG4gICAgdGhpcy5kZXN0cm95JC5uZXh0KHRydWUpO1xuICAgIHRoaXMuZGVzdHJveSQudW5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIHByaXZhdGUgb25FbnRyaWVzTG9hZGVkKCkge1xuICAgIGNvbnN0IFtmaXJzdEVudHJ5XSA9IHRoaXMuZW50cmllcztcbiAgICBjb25zdCBpc1NpbmdsZUVudHJ5ID0gdGhpcy5lbnRyaWVzLmxlbmd0aCA9PT0gMTtcbiAgICBjb25zdCBzaG91bGRSZWRpcmVjdFRvUGF0aCA9IGZpcnN0RW50cnkgJiYgISFmaXJzdEVudHJ5LnBhdGg7XG4gICAgY29uc3Qgc2hvdWxkT21pdExpc3RPZkVudHJpZXMgPSBpc1NpbmdsZUVudHJ5ICYmICFzaG91bGRSZWRpcmVjdFRvUGF0aDtcblxuICAgIGlmIChzaG91bGRPbWl0TGlzdE9mRW50cmllcykge1xuICAgICAgdGhpcy5oYW5kbGVFbnRyeShmaXJzdEVudHJ5KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZVBhdGgocGF0aDogc3RyaW5nKSB7XG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChwYXRoKTtcblxuICAgIGlmICh0aGlzLndpemFyZENvbXBvbmVudCkge1xuICAgICAgdGhpcy53aXphcmRDb21wb25lbnQuY2xvc2UoKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGhhbmRsZUNvbXBvbmVudChjb21wb25lbnQ6IFR5cGU8dW5rbm93bj4pIHtcbiAgICB0aGlzLnNob3dMaXN0ID0gZmFsc2U7XG4gICAgY29uc3QgZmFjdG9yeSA9IHRoaXMucmVzb2x2ZXIucmVzb2x2ZUNvbXBvbmVudEZhY3RvcnkoY29tcG9uZW50KTtcbiAgICBjb25zdCBjb21wb25lbnRJbnN0YW5jZSA9IHRoaXMuY29udGFpbmVyLmNyZWF0ZUNvbXBvbmVudChmYWN0b3J5KTtcbiAgICBPYmplY3QuYXNzaWduKGNvbXBvbmVudEluc3RhbmNlLmluc3RhbmNlLCB0aGlzLmluaXRpYWxTdGF0ZSk7XG4gICAgdGhpcy5jb21wb25lbnRJbnN0YW5jZSA9IGNvbXBvbmVudEluc3RhbmNlO1xuICB9XG59XG4iXX0=