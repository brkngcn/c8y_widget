import { Component, ContentChild, HostBinding, Input } from '@angular/core';
import { FormControlName, NgModel } from '@angular/forms';
import { merge, Subject, timer } from 'rxjs';
import { debounce, filter, takeUntil } from 'rxjs/operators';
import { MessagesComponent } from './messages.component';
/**
 * A form group helps to validate an input of a form element.
 *
 * ## Example:
 *
 * ```html
 *  <c8y-form-group [hasWarning]="user.email.length === 0">
 *   <label translate for="userEmail">Email</label>
 *   <input
 *     id="userEmail"
 *     class="form-control"
 *     type="email"
 *     name="email"
 *     [maxlength]="254"
 *     autocomplete="off"
 *     placeholder="{{'e.g. joe.doe@example.com' | translate}}"
 *     [(ngModel)]="user.email"
 *     email
 *     required
 *   >
 *   <c8y-messages>
 *     <c8y-message *ngIf="user.email.length === 0" translate></c8y-message>
 *     <c8y-message name="required" text="The E-Mail is SUPER required"></c8y-message>
 *   </c8y-messages>
 *  </c8y-form-group>
 * ```
 *
 * @param status The current status could be error, warning or success.
 * @param hasError Set this to true to display a error.
 * @param hasWarning Set this to true to display a warning.
 * @param hasSuccess Set this to true to display a success.
 * @param novalidation Set this to true to disable automatic validation by this component.
 */
export class FormGroupComponent {
    constructor() {
        this.hasError = false;
        this.hasWarning = false;
        this.hasSuccess = false;
        this.novalidation = false;
        this.destroyed$ = new Subject();
        this.VALIDATION_DEBOUNCE_MS = 1000;
    }
    get error() {
        return this.status === 'error' || this.hasError;
    }
    get warning() {
        return this.status === 'warning' || this.hasWarning;
    }
    get success() {
        return this.status === 'success' || this.hasSuccess;
    }
    ngAfterContentInit() {
        this.initNgModel();
        this.initFormControl();
    }
    initNgModel() {
        if (this.model) {
            this.model.valueAccessor.registerOnTouched(() => {
                if (this.model.control && !this.model.control.dirty) {
                    this.model.control.markAsDirty();
                    this.model.control.updateValueAndValidity({ onlySelf: true });
                }
            });
            this.subscribeForChanges(this.model);
        }
    }
    initFormControl() {
        if (this.formControlName) {
            this.subscribeForChanges(this.formControlName.control);
        }
    }
    subscribeForChanges(control) {
        merge(control.valueChanges, control.statusChanges)
            .pipe(filter(() => control.dirty && !this.novalidation), debounce(() => (this.hasError ? timer(10) : timer(this.VALIDATION_DEBOUNCE_MS))), takeUntil(this.destroyed$))
            .subscribe(() => this.update(control));
    }
    update(control) {
        this.hasError = control.status === 'INVALID';
        if (this.customErrorMessage) {
            this.customErrorMessage.changVisibility(control.errors);
        }
        else {
            this.errors = control.errors;
        }
    }
    ngOnDestroy() {
        this.destroyed$.next();
        this.destroyed$.complete();
    }
}
FormGroupComponent.decorators = [
    { type: Component, args: [{
                selector: 'c8y-form-group',
                template: "<ng-content></ng-content>\n<c8y-messages *ngIf=\"!customErrorMessage\" [show]=\"errors\"></c8y-messages>\n",
                host: {
                    class: 'form-group'
                }
            },] }
];
FormGroupComponent.propDecorators = {
    hasError: [{ type: Input }],
    hasWarning: [{ type: Input }],
    hasSuccess: [{ type: Input }],
    novalidation: [{ type: Input }],
    status: [{ type: Input }],
    error: [{ type: HostBinding, args: ['class.has-error',] }],
    warning: [{ type: HostBinding, args: ['class.has-warning',] }],
    success: [{ type: HostBinding, args: ['class.has-success',] }],
    customErrorMessage: [{ type: ContentChild, args: [MessagesComponent, { static: false },] }],
    model: [{ type: ContentChild, args: [NgModel, { static: true },] }],
    formControlName: [{ type: ContentChild, args: [FormControlName, { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1ncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL2Zvcm1zL2Zvcm0tZ3JvdXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsWUFBWSxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDNUUsT0FBTyxFQUFlLGVBQWUsRUFBRSxPQUFPLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN2RSxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDN0MsT0FBTyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDN0QsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDekQ7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0dBZ0NHO0FBUUgsTUFBTSxPQUFPLGtCQUFrQjtJQVAvQjtRQVFXLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsZUFBVSxHQUFHLEtBQUssQ0FBQztRQUNuQixlQUFVLEdBQUcsS0FBSyxDQUFDO1FBQ25CLGlCQUFZLEdBQUcsS0FBSyxDQUFDO1FBZ0J0QixlQUFVLEdBQWtCLElBQUksT0FBTyxFQUFFLENBQUM7UUFDakMsMkJBQXNCLEdBQUcsSUFBSSxDQUFDO0lBZ0RqRCxDQUFDO0lBL0RDLElBQW9DLEtBQUs7UUFDdkMsT0FBTyxJQUFJLENBQUMsTUFBTSxLQUFLLE9BQU8sSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDO0lBQ2xELENBQUM7SUFDRCxJQUFzQyxPQUFPO1FBQzNDLE9BQU8sSUFBSSxDQUFDLE1BQU0sS0FBSyxTQUFTLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQztJQUN0RCxDQUFDO0lBQ0QsSUFBc0MsT0FBTztRQUMzQyxPQUFPLElBQUks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QUFZLFNBQUMsZUFBZSxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBIb3N0QmluZGluZywgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBGb3JtQ29udHJvbE5hbWUsIE5nTW9kZWwgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBtZXJnZSwgU3ViamVjdCwgdGltZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlLCBmaWx0ZXIsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1lc3NhZ2VzQ29tcG9uZW50IH0gZnJvbSAnLi9tZXNzYWdlcy5jb21wb25lbnQnO1xuLyoqXG4gKiBBIGZvcm0gZ3JvdXAgaGVscHMgdG8gdmFsaWRhdGUgYW4gaW5wdXQgb2YgYSBmb3JtIGVsZW1lbnQuXG4gKlxuICogIyMgRXhhbXBsZTpcbiAqXG4gKiBgYGBodG1sXG4gKiAgPGM4eS1mb3JtLWdyb3VwIFtoYXNXYXJuaW5nXT1cInVzZXIuZW1haWwubGVuZ3RoID09PSAwXCI+XG4gKiAgIDxsYWJlbCB0cmFuc2xhdGUgZm9yPVwidXNlckVtYWlsXCI+RW1haWw8L2xhYmVsPlxuICogICA8aW5wdXRcbiAqICAgICBpZD1cInVzZXJFbWFpbFwiXG4gKiAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICogICAgIHR5cGU9XCJlbWFpbFwiXG4gKiAgICAgbmFtZT1cImVtYWlsXCJcbiAqICAgICBbbWF4bGVuZ3RoXT1cIjI1NFwiXG4gKiAgICAgYXV0b2NvbXBsZXRlPVwib2ZmXCJcbiAqICAgICBwbGFjZWhvbGRlcj1cInt7J2UuZy4gam9lLmRvZUBleGFtcGxlLmNvbScgfCB0cmFuc2xhdGV9fVwiXG4gKiAgICAgWyhuZ01vZGVsKV09XCJ1c2VyLmVtYWlsXCJcbiAqICAgICBlbWFpbFxuICogICAgIHJlcXVpcmVkXG4gKiAgID5cbiAqICAgPGM4eS1tZXNzYWdlcz5cbiAqICAgICA8Yzh5LW1lc3NhZ2UgKm5nSWY9XCJ1c2VyLmVtYWlsLmxlbmd0aCA9PT0gMFwiIHRyYW5zbGF0ZT48L2M4eS1tZXNzYWdlPlxuICogICAgIDxjOHktbWVzc2FnZSBuYW1lPVwicmVxdWlyZWRcIiB0ZXh0PVwiVGhlIEUtTWFpbCBpcyBTVVBFUiByZXF1aXJlZFwiPjwvYzh5LW1lc3NhZ2U+XG4gKiAgIDwvYzh5LW1lc3NhZ2VzPlxuICogIDwvYzh5LWZvcm0tZ3JvdXA+XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gc3RhdHVzIFRoZSBjdXJyZW50IHN0YXR1cyBjb3VsZCBiZSBlcnJvciwgd2FybmluZyBvciBzdWNjZXNzLlxuICogQHBhcmFtIGhhc0Vycm9yIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzcGxheSBhIGVycm9yLlxuICogQHBhcmFtIGhhc1dhcm5pbmcgU2V0IHRoaXMgdG8gdHJ1ZSB0byBkaXNwbGF5IGEgd2FybmluZy5cbiAqIEBwYXJhbSBoYXNTdWNjZXNzIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzcGxheSBhIHN1Y2Nlc3MuXG4gKiBAcGFyYW0gbm92YWxpZGF0aW9uIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzYWJsZSBhdXRvbWF0aWMgdmFsaWRhdGlvbiBieSB0aGlzIGNvbXBvbmVudC5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWZvcm0tZ3JvdXAnLFxuICB0ZW1wbGF0ZVVybDogJy4vZm9ybS1ncm91cC5jb21wb25lbnQuaHRtbCcsXG4gIGhvc3Q6IHtcbiAgICBjbGFzczogJ2Zvcm0tZ3JvdXAnXG4gIH1cbn0pXG5leHBvcnQgY2xhc3MgRm9ybUdyb3VwQ29tcG9uZW50IHtcbiAgQElucHV0KCkgaGFzRXJyb3IgPSBmYWxzZTtcbiAgQElucHV0KCkgaGFzV2FybmluZyA9IGZhbHNlO1xuICBASW5wdXQoKSBoYXNTdWNjZXNzID0gZmFsc2U7XG4gIEBJbnB1dCgpIG5vdmFsaWRhdGlvbiA9IGZhbHNlO1xuICBASW5wdXQoKSBzdGF0dXM6IHN0cmluZztcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5oYXMtZXJyb3InKSBnZXQgZXJyb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzID09PSAnZXJyb3InIHx8IHRoaXMuaGFzRXJyb3I7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5oYXMtd2FybmluZycpIGdldCB3YXJuaW5nKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXR1cyA9PT0gJ3dhcm5pbmcnIHx8IHRoaXMuaGFzV2FybmluZztcbiAgfVxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmhhcy1zdWNjZXNzJykgZ2V0IHN1Y2Nlc3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzID09PSAnc3VjY2VzcycgfHwgdGhpcy5oYXNTdWNjZXNzO1xuICB9XG4gIEBDb250ZW50Q2hpbGQoTWVzc2FnZXNDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSBjdXN0b21FcnJvck1lc3NhZ2U6IE1lc3NhZ2VzQ29tcG9uZW50O1xuICBAQ29udGVudENoaWxkKE5nTW9kZWwsIHsgc3RhdGljOiB0cnVlIH0pIG1vZGVsOiBOZ01vZGVsO1xuICBAQ29udGVudENoaWxkKEZvcm1Db250cm9sTmFtZSwgeyBzdGF0aWM6IHRydWUgfSkgZm9ybUNvbnRyb2xOYW1lOiBGb3JtQ29udHJvbE5hbWU7XG5cbiAgZXJyb3JzOiB7fTtcbiAgcHJpdmF0ZSBkZXN0cm95ZWQkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcbiAgcHJpdmF0ZSByZWFkb25seSBWQUxJREFUSU9OX0RFQk9VTkNFX01TID0gMTAwMDtcblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbml0TmdNb2RlbCgpO1xuICAgIHRoaXMuaW5pdEZvcm1Db250cm9sKCk7XG4gIH1cblxuICBpbml0TmdNb2RlbCgpIHtcbiAgICBpZiAodGhpcy5tb2RlbCkge1xuICAgICAgdGhpcy5tb2RlbC52YWx1ZUFjY2Vzc29yLnJlZ2lzdGVyT25Ub3VjaGVkKCgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMubW9kZWwuY29udHJvbCAmJiAhdGhpcy5tb2RlbC5jb250cm9sLmRpcnR5KSB7XG4gICAgICAgICAgdGhpcy5tb2RlbC5jb250cm9sLm1hcmtBc0RpcnR5KCk7XG4gICAgICAgICAgdGhpcy5tb2RlbC5jb250cm9sLnVwZGF0ZVZhbHVlQW5kVmFsaWRpdHkoeyBvbmx5U2VsZjogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnN1YnNjcmliZUZvckNoYW5nZXModGhpcy5tb2RlbCk7XG4gICAgfVxuICB9XG5cbiAgaW5pdEZvcm1Db250cm9sKCkge1xuICAgIGlmICh0aGlzLmZvcm1Db250cm9sTmFtZSkge1xuICAgICAgdGhpcy5zdWJzY3JpYmVGb3JDaGFuZ2VzKHRoaXMuZm9ybUNvbnRyb2xOYW1lLmNvbnRyb2wpO1xuICAgIH1cbiAgfVxuXG4gIHN1YnNjcmliZUZvckNoYW5nZXMoY29udHJvbDogRm9ybUNvbnRyb2wgfCBOZ01vZGVsKSB7XG4gICAgbWVyZ2UoY29udHJvbC52YWx1ZUNoYW5nZXMsIGNvbnRyb2wuc3RhdHVzQ2hhbmdlcylcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoKCkgPT4gY29udHJvbC5kaXJ0eSAmJiAhdGhpcy5ub3ZhbGlkYXRpb24pLFxuICAgICAgICBkZWJvdW5jZSgoKSA9PiAodGhpcy5oYXNFcnJvciA/IHRpbWVyKDEwKSA6IHRpbWVyKHRoaXMuVkFMSURBVElPTl9ERUJPVU5DRV9NUykpKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy51cGRhdGUoY29udHJvbCkpO1xuICB9XG5cbiAgdXBkYXRlKGNvbnRyb2w6IEZvcm1Db250cm9sIHwgTmdNb2RlbCkge1xuICAgIHRoaXMuaGFzRXJyb3IgPSBjb250cm9sLnN0YXR1cyA9PT0gJ0lOVkFMSUQnO1xuICAgIGlmICh0aGlzLmN1c3RvbUVycm9yTWVzc2FnZSkge1xuICAgICAgdGhpcy5jdXN0b21FcnJvck1lc3NhZ2UuY2hhbmdWaXNpYmlsaXR5KGNvbnRyb2wuZXJyb3JzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lcnJvcnMgPSBjb250cm9sLmVycm9ycztcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmRlc3Ryb3llZCQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveWVkJC5jb21wbGV0ZSgpO1xuICB9XG59XG4iXX0=