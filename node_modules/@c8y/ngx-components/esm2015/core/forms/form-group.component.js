import { Component, ContentChild, HostBinding, Input } from '@angular/core';
import { FormControlName, NgModel } from '@angular/forms';
import { merge, Subject, timer } from 'rxjs';
import { debounce, filter, takeUntil } from 'rxjs/operators';
import { MessagesComponent } from './messages.component';
/**
 * A form group helps to validate an input of a form element.
 *
 * ## Example:
 *
 * ```html
 *  <c8y-form-group [hasWarning]="user.email.length === 0">
 *   <label translate for="userEmail">Email</label>
 *   <input
 *     id="userEmail"
 *     class="form-control"
 *     type="email"
 *     name="email"
 *     [maxlength]="254"
 *     autocomplete="off"
 *     placeholder="{{'e.g. joe.doe@example.com' | translate}}"
 *     [(ngModel)]="user.email"
 *     email
 *     required
 *   >
 *   <c8y-messages>
 *     <c8y-message *ngIf="user.email.length === 0" translate></c8y-message>
 *     <c8y-message name="required" text="The E-Mail is SUPER required"></c8y-message>
 *   </c8y-messages>
 *  </c8y-form-group>
 * ```
 *
 * @param status The current status could be error, warning or success.
 * @param hasError Set this to true to display a error.
 * @param hasWarning Set this to true to display a warning.
 * @param hasSuccess Set this to true to display a success.
 * @param novalidation Set this to true to disable automatic validation by this component.
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from './messages.component';

function FormGroupComponent_c8y_messages_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "c8y-messages", 1);
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("show", ctx_r0.errors);
} }
const _c0 = ["*"];
export class FormGroupComponent {
    constructor() {
        this.hasError = false;
        this.hasWarning = false;
        this.hasSuccess = false;
        this.novalidation = false;
        this.destroyed$ = new Subject();
        this.VALIDATION_DEBOUNCE_MS = 1000;
    }
    get error() {
        return this.status === 'error' || this.hasError;
    }
    get warning() {
        return this.status === 'warning' || this.hasWarning;
    }
    get success() {
        return this.status === 'success' || this.hasSuccess;
    }
    ngAfterContentInit() {
        this.initNgModel();
        this.initFormControl();
    }
    initNgModel() {
        if (this.model) {
            this.model.valueAccessor.registerOnTouched(() => {
                if (this.model.control && !this.model.control.dirty) {
                    this.model.control.markAsDirty();
                    this.model.control.updateValueAndValidity({ onlySelf: true });
                }
            });
            this.subscribeForChanges(this.model);
        }
    }
    initFormControl() {
        if (this.formControlName) {
            this.subscribeForChanges(this.formControlName.control);
        }
    }
    subscribeForChanges(control) {
        merge(control.valueChanges, control.statusChanges)
            .pipe(filter(() => control.dirty && !this.novalidation), debounce(() => (this.hasError ? timer(10) : timer(this.VALIDATION_DEBOUNCE_MS))), takeUntil(this.destroyed$))
            .subscribe(() => this.update(control));
    }
    update(control) {
        this.hasError = control.status === 'INVALID';
        if (this.customErrorMessage) {
            this.customErrorMessage.changVisibility(control.errors);
        }
        else {
            this.errors = control.errors;
        }
    }
    ngOnDestroy() {
        this.destroyed$.next();
        this.destroyed$.complete();
    }
}
FormGroupComponent.ɵfac = function FormGroupComponent_Factory(t) { return new (t || FormGroupComponent)(); };
FormGroupComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: FormGroupComponent, selectors: [["c8y-form-group"]], contentQueries: function FormGroupComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, MessagesComponent, 5);
        ɵngcc0.ɵɵcontentQuery(dirIndex, NgModel, 7);
        ɵngcc0.ɵɵcontentQuery(dirIndex, FormControlName, 7);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.customErrorMessage = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.model = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.formControlName = _t.first);
    } }, hostAttrs: [1, "form-group"], hostVars: 6, hostBindings: function FormGroupComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("has-error", ctx.error)("has-warning", ctx.warning)("has-success", ctx.success);
    } }, inputs: { hasError: "hasError", hasWarning: "hasWarning", hasSuccess: "hasSuccess", novalidation: "novalidation", status: "status" }, ngContentSelectors: _c0, decls: 2, vars: 1, consts: [[3, "show", 4, "ngIf"], [3, "show"]], template: function FormGroupComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵprojection(0);
        ɵngcc0.ɵɵtemplate(1, FormGroupComponent_c8y_messages_1_Template, 1, 1, "c8y-messages", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.customErrorMessage);
    } }, directives: [ɵngcc1.NgIf, ɵngcc2.MessagesComponent], encapsulation: 2 });
FormGroupComponent.propDecorators = {
    hasError: [{ type: Input }],
    hasWarning: [{ type: Input }],
    hasSuccess: [{ type: Input }],
    novalidation: [{ type: Input }],
    status: [{ type: Input }],
    error: [{ type: HostBinding, args: ['class.has-error',] }],
    warning: [{ type: HostBinding, args: ['class.has-warning',] }],
    success: [{ type: HostBinding, args: ['class.has-success',] }],
    customErrorMessage: [{ type: ContentChild, args: [MessagesComponent, { static: false },] }],
    model: [{ type: ContentChild, args: [NgModel, { static: true },] }],
    formControlName: [{ type: ContentChild, args: [FormControlName, { static: true },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(FormGroupComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-form-group',
                template: "<ng-content></ng-content>\n<c8y-messages *ngIf=\"!customErrorMessage\" [show]=\"errors\"></c8y-messages>\n",
                host: {
                    class: 'form-group'
                }
            }]
    }], function () { return []; }, { hasError: [{
            type: Input
        }], hasWarning: [{
            type: Input
        }], hasSuccess: [{
            type: Input
        }], novalidation: [{
            type: Input
        }], error: [{
            type: HostBinding,
            args: ['class.has-error']
        }], warning: [{
            type: HostBinding,
            args: ['class.has-warning']
        }], success: [{
            type: HostBinding,
            args: ['class.has-success']
        }], status: [{
            type: Input
        }], customErrorMessage: [{
            type: ContentChild,
            args: [MessagesComponent, { static: false }]
        }], model: [{
            type: ContentChild,
            args: [NgModel, { static: true }]
        }], formControlName: [{
            type: ContentChild,
            args: [FormControlName, { static: true }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZm9ybS1ncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvZm9ybXMvZm9ybS1ncm91cC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsV0FBVyxFQUFFLEtBQUssRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUM1RSxPQUFPLEVBQWUsZUFBZSxFQUFFLE9BQU8sRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZFLE9BQU8sRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM3QyxPQUFPLEVBQUUsUUFBUSxFQUFFLE1BQU0sRUFBRSxTQUFTLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3RCxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxzQkFBc0IsQ0FBQztBQUN6RDtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7Ozs7Ozs7Ozs7O0FBUUgsTUFBTSxPQUFPLGtCQUFrQjtBQUMvQixJQVJBO0FBQ0csUUFPUSxhQUFRLEdBQUcsS0FBSyxDQUFDO0FBQzVCLFFBQVcsZUFBVSxHQUFHLEtBQUssQ0FBQztBQUM5QixRQUFXLGVBQVUsR0FBRyxLQUFLLENBQUM7QUFDOUIsUUFBVyxpQkFBWSxHQUFHLEtBQUssQ0FBQztBQUNoQyxRQWVVLGVBQVUsR0FBa0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUNwRCxRQUFtQiwyQkFBc0IsR0FBRyxJQUFJLENBQUM7QUFDakQsSUErQ0EsQ0FBQztBQUNELElBaEVFLElBQW9DLEtBQUs7QUFDM0MsUUFBSSxPQUFPLElBQUksQ0FB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SSxJQUFJLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxDQUFDO0FBQy9CLElBQUUsQ0FBQztBQUNIOzhDQTVFQyxTQUFTLFNBQUMsa0JBQ1QsUUFBUSxFQUFFLGdCQUFnQjtnQkFDMUIsc0hBQTBDLGtCQUMxQyxJQUFJLEVBQUUsc0JBQ0osS0FBSyxFQUFFLFlBQVksa0JBQ3BCO1dBQ0Y7Ozs7Ozs7Ozs7Ozs7Ozs7O2tGQUNJO0FBQUM7QUFDSSx1QkFBUCxLQUFLO0FBQUsseUJBQ1YsS0FBSztBQUFLLHlCQUNWLEtBQUs7QUFBSywyQkFDVixLQUFLO0FBQUsscUJBQ1YsS0FBSztBQUFLLG9CQUNWLFdBQVcsU0FBQyxpQkFBaUI7QUFBTyxzQkFHcEMsV0FBVyxTQUFDLG1CQUFtQjtBQUFPLHNCQUd0QyxXQUFXLFNBQUMsbUJBQW1CO0FBQU8saUNBR3RDLFlBQVksU0FBQyxpQkFBaUIsRUFBRSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUU7QUFBTyxvQkFDeEQsWUFBWSxTQUFDLE9BQU8sRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7QUFBTyw4QkFDN0MsWUFBWSxTQUFDLGVBQWUsRUFBRSxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUU7QUFBTTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgQ29udGVudENoaWxkLCBIb3N0QmluZGluZywgSW5wdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Db250cm9sLCBGb3JtQ29udHJvbE5hbWUsIE5nTW9kZWwgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBtZXJnZSwgU3ViamVjdCwgdGltZXIgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGRlYm91bmNlLCBmaWx0ZXIsIHRha2VVbnRpbCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IE1lc3NhZ2VzQ29tcG9uZW50IH0gZnJvbSAnLi9tZXNzYWdlcy5jb21wb25lbnQnO1xuLyoqXG4gKiBBIGZvcm0gZ3JvdXAgaGVscHMgdG8gdmFsaWRhdGUgYW4gaW5wdXQgb2YgYSBmb3JtIGVsZW1lbnQuXG4gKlxuICogIyMgRXhhbXBsZTpcbiAqXG4gKiBgYGBodG1sXG4gKiAgPGM4eS1mb3JtLWdyb3VwIFtoYXNXYXJuaW5nXT1cInVzZXIuZW1haWwubGVuZ3RoID09PSAwXCI+XG4gKiAgIDxsYWJlbCB0cmFuc2xhdGUgZm9yPVwidXNlckVtYWlsXCI+RW1haWw8L2xhYmVsPlxuICogICA8aW5wdXRcbiAqICAgICBpZD1cInVzZXJFbWFpbFwiXG4gKiAgICAgY2xhc3M9XCJmb3JtLWNvbnRyb2xcIlxuICogICAgIHR5cGU9XCJlbWFpbFwiXG4gKiAgICAgbmFtZT1cImVtYWlsXCJcbiAqICAgICBbbWF4bGVuZ3RoXT1cIjI1NFwiXG4gKiAgICAgYXV0b2NvbXBsZXRlPVwib2ZmXCJcbiAqICAgICBwbGFjZWhvbGRlcj1cInt7J2UuZy4gam9lLmRvZUBleGFtcGxlLmNvbScgfCB0cmFuc2xhdGV9fVwiXG4gKiAgICAgWyhuZ01vZGVsKV09XCJ1c2VyLmVtYWlsXCJcbiAqICAgICBlbWFpbFxuICogICAgIHJlcXVpcmVkXG4gKiAgID5cbiAqICAgPGM4eS1tZXNzYWdlcz5cbiAqICAgICA8Yzh5LW1lc3NhZ2UgKm5nSWY9XCJ1c2VyLmVtYWlsLmxlbmd0aCA9PT0gMFwiIHRyYW5zbGF0ZT48L2M4eS1tZXNzYWdlPlxuICogICAgIDxjOHktbWVzc2FnZSBuYW1lPVwicmVxdWlyZWRcIiB0ZXh0PVwiVGhlIEUtTWFpbCBpcyBTVVBFUiByZXF1aXJlZFwiPjwvYzh5LW1lc3NhZ2U+XG4gKiAgIDwvYzh5LW1lc3NhZ2VzPlxuICogIDwvYzh5LWZvcm0tZ3JvdXA+XG4gKiBgYGBcbiAqXG4gKiBAcGFyYW0gc3RhdHVzIFRoZSBjdXJyZW50IHN0YXR1cyBjb3VsZCBiZSBlcnJvciwgd2FybmluZyBvciBzdWNjZXNzLlxuICogQHBhcmFtIGhhc0Vycm9yIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzcGxheSBhIGVycm9yLlxuICogQHBhcmFtIGhhc1dhcm5pbmcgU2V0IHRoaXMgdG8gdHJ1ZSB0byBkaXNwbGF5IGEgd2FybmluZy5cbiAqIEBwYXJhbSBoYXNTdWNjZXNzIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzcGxheSBhIHN1Y2Nlc3MuXG4gKiBAcGFyYW0gbm92YWxpZGF0aW9uIFNldCB0aGlzIHRvIHRydWUgdG8gZGlzYWJsZSBhdXRvbWF0aWMgdmFsaWRhdGlvbiBieSB0aGlzIGNvbXBvbmVudC5cbiAqL1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWZvcm0tZ3JvdXAnLFxuICB0ZW1wbGF0ZVVybDogJy4vZm9ybS1ncm91cC5jb21wb25lbnQuaHRtbCcsXG4gIGhvc3Q6IHtcbiAgICBjbGFzczogJ2Zvcm0tZ3JvdXAnXG4gIH1cbn0pXG5leHBvcnQgY2xhc3MgRm9ybUdyb3VwQ29tcG9uZW50IHtcbiAgQElucHV0KCkgaGFzRXJyb3IgPSBmYWxzZTtcbiAgQElucHV0KCkgaGFzV2FybmluZyA9IGZhbHNlO1xuICBASW5wdXQoKSBoYXNTdWNjZXNzID0gZmFsc2U7XG4gIEBJbnB1dCgpIG5vdmFsaWRhdGlvbiA9IGZhbHNlO1xuICBASW5wdXQoKSBzdGF0dXM6IHN0cmluZztcbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5oYXMtZXJyb3InKSBnZXQgZXJyb3IoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzID09PSAnZXJyb3InIHx8IHRoaXMuaGFzRXJyb3I7XG4gIH1cbiAgQEhvc3RCaW5kaW5nKCdjbGFzcy5oYXMtd2FybmluZycpIGdldCB3YXJuaW5nKCkge1xuICAgIHJldHVybiB0aGlzLnN0YXR1cyA9PT0gJ3dhcm5pbmcnIHx8IHRoaXMuaGFzV2FybmluZztcbiAgfVxuICBASG9zdEJpbmRpbmcoJ2NsYXNzLmhhcy1zdWNjZXNzJykgZ2V0IHN1Y2Nlc3MoKSB7XG4gICAgcmV0dXJuIHRoaXMuc3RhdHVzID09PSAnc3VjY2VzcycgfHwgdGhpcy5oYXNTdWNjZXNzO1xuICB9XG4gIEBDb250ZW50Q2hpbGQoTWVzc2FnZXNDb21wb25lbnQsIHsgc3RhdGljOiBmYWxzZSB9KSBjdXN0b21FcnJvck1lc3NhZ2U6IE1lc3NhZ2VzQ29tcG9uZW50O1xuICBAQ29udGVudENoaWxkKE5nTW9kZWwsIHsgc3RhdGljOiB0cnVlIH0pIG1vZGVsOiBOZ01vZGVsO1xuICBAQ29udGVudENoaWxkKEZvcm1Db250cm9sTmFtZSwgeyBzdGF0aWM6IHRydWUgfSkgZm9ybUNvbnRyb2xOYW1lOiBGb3JtQ29udHJvbE5hbWU7XG5cbiAgZXJyb3JzOiB7fTtcbiAgcHJpdmF0ZSBkZXN0cm95ZWQkOiBTdWJqZWN0PHZvaWQ+ID0gbmV3IFN1YmplY3QoKTtcbiAgcHJpdmF0ZSByZWFkb25seSBWQUxJREFUSU9OX0RFQk9VTkNFX01TID0gMTAwMDtcblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5pbml0TmdNb2RlbCgpO1xuICAgIHRoaXMuaW5pdEZvcm1Db250cm9sKCk7XG4gIH1cblxuICBpbml0TmdNb2RlbCgpIHtcbiAgICBpZiAodGhpcy5tb2RlbCkge1xuICAgICAgdGhpcy5tb2RlbC52YWx1ZUFjY2Vzc29yLnJlZ2lzdGVyT25Ub3VjaGVkKCgpID0+IHtcbiAgICAgICAgaWYgKHRoaXMubW9kZWwuY29udHJvbCAmJiAhdGhpcy5tb2RlbC5jb250cm9sLmRpcnR5KSB7XG4gICAgICAgICAgdGhpcy5tb2RlbC5jb250cm9sLm1hcmtBc0RpcnR5KCk7XG4gICAgICAgICAgdGhpcy5tb2RlbC5jb250cm9sLnVwZGF0ZVZhbHVlQW5kVmFsaWRpdHkoeyBvbmx5U2VsZjogdHJ1ZSB9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICB0aGlzLnN1YnNjcmliZUZvckNoYW5nZXModGhpcy5tb2RlbCk7XG4gICAgfVxuICB9XG5cbiAgaW5pdEZvcm1Db250cm9sKCkge1xuICAgIGlmICh0aGlzLmZvcm1Db250cm9sTmFtZSkge1xuICAgICAgdGhpcy5zdWJzY3JpYmVGb3JDaGFuZ2VzKHRoaXMuZm9ybUNvbnRyb2xOYW1lLmNvbnRyb2wpO1xuICAgIH1cbiAgfVxuXG4gIHN1YnNjcmliZUZvckNoYW5nZXMoY29udHJvbDogRm9ybUNvbnRyb2wgfCBOZ01vZGVsKSB7XG4gICAgbWVyZ2UoY29udHJvbC52YWx1ZUNoYW5nZXMsIGNvbnRyb2wuc3RhdHVzQ2hhbmdlcylcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoKCkgPT4gY29udHJvbC5kaXJ0eSAmJiAhdGhpcy5ub3ZhbGlkYXRpb24pLFxuICAgICAgICBkZWJvdW5jZSgoKSA9PiAodGhpcy5oYXNFcnJvciA/IHRpbWVyKDEwKSA6IHRpbWVyKHRoaXMuVkFMSURBVElPTl9ERUJPVU5DRV9NUykpKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuZGVzdHJveWVkJClcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKCkgPT4gdGhpcy51cGRhdGUoY29udHJvbCkpO1xuICB9XG5cbiAgdXBkYXRlKGNvbnRyb2w6IEZvcm1Db250cm9sIHwgTmdNb2RlbCkge1xuICAgIHRoaXMuaGFzRXJyb3IgPSBjb250cm9sLnN0YXR1cyA9PT0gJ0lOVkFMSUQnO1xuICAgIGlmICh0aGlzLmN1c3RvbUVycm9yTWVzc2FnZSkge1xuICAgICAgdGhpcy5jdXN0b21FcnJvck1lc3NhZ2UuY2hhbmdWaXNpYmlsaXR5KGNvbnRyb2wuZXJyb3JzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5lcnJvcnMgPSBjb250cm9sLmVycm9ycztcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLmRlc3Ryb3llZCQubmV4dCgpO1xuICAgIHRoaXMuZGVzdHJveWVkJC5jb21wbGV0ZSgpO1xuICB9XG59XG4iXX0=