import { __awaiter } from "tslib";
import { Compiler, Injectable, InjectFlags, Injector, NgModuleFactory } from '@angular/core';
import { ActionBarService, HOOK_ACTION_BAR } from '../action-bar/action-bar.service';
import { ActionService, HOOK_ACTION } from '../action/action.service';
import { BreadcrumbService, HOOK_BREADCRUMB } from '../breadcrumb/breadcrumb.service';
import { HOOK_DOCS } from '../docs/docs.models';
import { DocsService } from '../docs/docs.service';
import { HOOK_COMPONENTS } from '../dynamic-component/dynamic-component.model';
import { DynamicComponentService } from '../dynamic-component/dynamic-component.service';
import { HOOK_NAVIGATOR_NODES, NavigatorService } from '../navigator/navigator.service';
import { HOOK_ONCE_ROUTE, HOOK_ROUTE, RouterService } from '../router/router.service';
import { HOOK_SEARCH, SearchService } from '../search/search.service';
import { HOOK_TABS, TabsService } from '../tabs/tabs.service';
import { WizardService } from '../wizard/wizard.service';
import { HOOK_WIZARD } from '../wizard/wizard.model';
import * as i0 from "@angular/core";
import * as i1 from "../tabs/tabs.service";
import * as i2 from "../navigator/navigator.service";
import * as i3 from "../action/action.service";
import * as i4 from "../action-bar/action-bar.service";
import * as i5 from "../breadcrumb/breadcrumb.service";
import * as i6 from "../dynamic-component/dynamic-component.service";
import * as i7 from "../search/search.service";
import * as i8 from "../router/router.service";
import * as i9 from "../docs/docs.service";
import * as i10 from "../wizard/wizard.service";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../tabs/tabs.service';
import * as ɵngcc2 from '../navigator/navigator.service';
import * as ɵngcc3 from '../action/action.service';
import * as ɵngcc4 from '../action-bar/action-bar.service';
import * as ɵngcc5 from '../breadcrumb/breadcrumb.service';
import * as ɵngcc6 from '../dynamic-component/dynamic-component.service';
import * as ɵngcc7 from '../search/search.service';
import * as ɵngcc8 from '../router/router.service';
import * as ɵngcc9 from '../docs/docs.service';
import * as ɵngcc10 from '../wizard/wizard.service';
export class PluginsResolveService {
    constructor(tabs, navigator, action, actionBar, breadcrumb, dynamicComponent, search, c8yRouter, docs, wizard, compiler, injector) {
        this.tabs = tabs;
        this.navigator = navigator;
        this.action = action;
        this.actionBar = actionBar;
        this.breadcrumb = breadcrumb;
        this.dynamicComponent = dynamicComponent;
        this.search = search;
        this.c8yRouter = c8yRouter;
        this.docs = docs;
        this.wizard = wizard;
        this.compiler = compiler;
        this.injector = injector;
        this.allHooks = [
            { token: HOOK_ACTION, service: this.action, values: [] },
            { token: HOOK_ACTION_BAR, service: this.actionBar, values: [] },
            { token: HOOK_NAVIGATOR_NODES, service: this.navigator, values: [] },
            { token: HOOK_BREADCRUMB, service: this.breadcrumb, values: [] },
            { token: HOOK_COMPONENTS, service: this.dynamicComponent, values: [] },
            { token: HOOK_ONCE_ROUTE, service: this.c8yRouter, values: [] },
            { token: HOOK_ROUTE, service: this.c8yRouter, values: [] },
            { token: HOOK_SEARCH, service: this.search, values: [] },
            { token: HOOK_TABS, service: this.tabs, values: [] },
            { token: HOOK_DOCS, service: this.docs, values: [] },
            { token: HOOK_WIZARD, service: this.wizard, values: [] }
        ];
    }
    /**
     * Loads plugins by resolving the remote NgModules and injecting it. Also attaching
     * the hooks onto the root injector.
     * @param remoteModules The remote plugins to load as factory name mapping array.
     */
    resolveRemotePlugins(remoteModules) {
        return __awaiter(this, void 0, void 0, function* () {
            const remoteNgModules = remoteModules
                .filter(({ factory }) => factory)
                .map(({ name, factory }) => factory[name]);
            for (const remoteNgModule of remoteNgModules) {
                let factory;
                if (remoteNgModule instanceof NgModuleFactory) {
                    // AOT
                    factory = remoteNgModule;
                }
                else {
                    // JIT
                    factory = yield this.compiler.compileModuleAsync(remoteNgModule);
                }
                const moduleRef = factory.create(this.injector);
                this.allHooks.forEach(hook => {
                    hook.values = [...hook.values, ...moduleRef.injector.get(hook.token, [], InjectFlags.Self)];
                });
            }
            this.allHooks.forEach(hook => {
                if (hook.values.length) {
                    hook.service.factories = [...hook.service.factories, ...hook.values];
                    hook.service.refresh();
                }
            });
        });
    }
}
PluginsResolveService.ɵfac = function PluginsResolveService_Factory(t) { return new (t || PluginsResolveService)(ɵngcc0.ɵɵinject(ɵngcc1.TabsService), ɵngcc0.ɵɵinject(ɵngcc2.NavigatorService), ɵngcc0.ɵɵinject(ɵngcc3.ActionService), ɵngcc0.ɵɵinject(ɵngcc4.ActionBarService), ɵngcc0.ɵɵinject(ɵngcc5.BreadcrumbService), ɵngcc0.ɵɵinject(ɵngcc6.DynamicComponentService), ɵngcc0.ɵɵinject(ɵngcc7.SearchService), ɵngcc0.ɵɵinject(ɵngcc8.RouterService), ɵngcc0.ɵɵinject(ɵngcc9.DocsService), ɵngcc0.ɵɵinject(ɵngcc10.WizardService), ɵngcc0.ɵɵinject(ɵngcc0.Compiler), ɵngcc0.ɵɵinject(ɵngcc0.Injector)); };
PluginsResolveService.ɵprov = i0.ɵɵdefineInjectable({ factory: function PluginsResolveService_Factory() { return new PluginsResolveService(i0.ɵɵinject(i1.TabsService), i0.ɵɵinject(i2.NavigatorService), i0.ɵɵinject(i3.ActionService), i0.ɵɵinject(i4.ActionBarService), i0.ɵɵinject(i5.BreadcrumbService), i0.ɵɵinject(i6.DynamicComponentService), i0.ɵɵinject(i7.SearchService), i0.ɵɵinject(i8.RouterService), i0.ɵɵinject(i9.DocsService), i0.ɵɵinject(i10.WizardService), i0.ɵɵinject(i0.Compiler), i0.ɵɵinject(i0.INJECTOR)); }, token: PluginsResolveService, providedIn: "root" });
PluginsResolveService.ctorParameters = () => [
    { type: TabsService },
    { type: NavigatorService },
    { type: ActionService },
    { type: ActionBarService },
    { type: BreadcrumbService },
    { type: DynamicComponentService },
    { type: SearchService },
    { type: RouterService },
    { type: DocsService },
    { type: WizardService },
    { type: Compiler },
    { type: Injector }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(PluginsResolveService, [{
        type: Injectable,
        args: [{
                providedIn: 'root'
            }]
    }], function () { return [{ type: ɵngcc1.TabsService }, { type: ɵngcc2.NavigatorService }, { type: ɵngcc3.ActionService }, { type: ɵngcc4.ActionBarService }, { type: ɵngcc5.BreadcrumbService }, { type: ɵngcc6.DynamicComponentService }, { type: ɵngcc7.SearchService }, { type: ɵngcc8.RouterService }, { type: ɵngcc9.DocsService }, { type: ɵngcc10.WizardService }, { type: ɵngcc0.Compiler }, { type: ɵngcc0.Injector }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGx1Z2lucy1yZXNvbHZlLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvcGx1Z2lucy9wbHVnaW5zLXJlc29sdmUuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUNMLFFBQVEsRUFDUixVQUFVLEVBQ1YsV0FBVyxFQUVYLFFBQVEsRUFDUixlQUFlLEVBQ2hCLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNyRixPQUFPLEVBQUUsYUFBYSxFQUFFLFdBQVcsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxlQUFlLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUV0RixPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDaEQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQ25ELE9BQU8sRUFBRSxlQUFlLEVBQUUsTUFBTSw4Q0FBOEMsQ0FBQztBQUMvRSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsTUFBTSxnREFBZ0QsQ0FBQztBQUN6RixPQUFPLEVBQUUsb0JBQW9CLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUN4RixPQUFPLEVBQUUsZUFBZSxFQUFFLFVBQVUsRUFBRSxhQUFhLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUN0RixPQUFPLEVBQUUsV0FBVyxFQUFFLGFBQWEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3RFLE9BQU8sRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLE1BQU0sc0JBQXNCLENBQUM7QUFDOUQsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUNyRDtBQUdDO0FBRUk7QUFDMEI7QUFFbEI7QUFF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Q0FBQyxPQUFPLENBQUMsT0FBTyxFQUFFLENBQUM7QUFDL0IsaUJBQU87QUFDUCxZQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ1AsUUFBRSxDQUFDO0FBRUgsS0FGRztBQUNIOytrQkFBQztBQUNELDhqQkFyRUs7QUFBQztFQUhMLFVBQVUsU0FBQyxyQkFJSSxZQVJJLFdBQVc7WUFLN0IsVUFBVSxFQUFFLE1BQU0sOUJBTGUsWUFISixnQkFBZ0I7WUFTOUMsWkFUa0QsWUFQMUMsYUFBYTtBQUFJLFlBRGpCLGdCQUFnQjtBQUFJLFlBRXBCLGlCQUFpQjtBQUFJLFlBS3JCLHVCQUF1QjtBQUFJLFlBR2QsYUFBYTtBQUFJLFlBREQsYUFBYTtBQUFJLFlBSjlDLFdBQVc7QUFBSSxZQU9mLGFBQWE7QUFBSSxZQW5CeEIsUUFBUTtBQUNSLFlBR0EsUUFBUTtBQUNUOzs7Ozs7cWJBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBpbGVyLFxuICBJbmplY3RhYmxlLFxuICBJbmplY3RGbGFncyxcbiAgSW5qZWN0aW9uVG9rZW4sXG4gIEluamVjdG9yLFxuICBOZ01vZHVsZUZhY3Rvcnlcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3Rpb25CYXJTZXJ2aWNlLCBIT09LX0FDVElPTl9CQVIgfSBmcm9tICcuLi9hY3Rpb24tYmFyL2FjdGlvbi1iYXIuc2VydmljZSc7XG5pbXBvcnQgeyBBY3Rpb25TZXJ2aWNlLCBIT09LX0FDVElPTiB9IGZyb20gJy4uL2FjdGlvbi9hY3Rpb24uc2VydmljZSc7XG5pbXBvcnQgeyBCcmVhZGNydW1iU2VydmljZSwgSE9PS19CUkVBRENSVU1CIH0gZnJvbSAnLi4vYnJlYWRjcnVtYi9icmVhZGNydW1iLnNlcnZpY2UnO1xuaW1wb3J0IHsgRXh0ZW5zaW9uUG9pbnQgfSBmcm9tICcuLi9jb21tb24vZXh0ZW5zaW9uLWhvb2tzJztcbmltcG9ydCB7IEhPT0tfRE9DUyB9IGZyb20gJy4uL2RvY3MvZG9jcy5tb2RlbHMnO1xuaW1wb3J0IHsgRG9jc1NlcnZpY2UgfSBmcm9tICcuLi9kb2NzL2RvY3Muc2VydmljZSc7XG5pbXBvcnQgeyBIT09LX0NPTVBPTkVOVFMgfSBmcm9tICcuLi9keW5hbWljLWNvbXBvbmVudC9keW5hbWljLWNvbXBvbmVudC5tb2RlbCc7XG5pbXBvcnQgeyBEeW5hbWljQ29tcG9uZW50U2VydmljZSB9IGZyb20gJy4uL2R5bmFtaWMtY29tcG9uZW50L2R5bmFtaWMtY29tcG9uZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgSE9PS19OQVZJR0FUT1JfTk9ERVMsIE5hdmlnYXRvclNlcnZpY2UgfSBmcm9tICcuLi9uYXZpZ2F0b3IvbmF2aWdhdG9yLnNlcnZpY2UnO1xuaW1wb3J0IHsgSE9PS19PTkNFX1JPVVRFLCBIT09LX1JPVVRFLCBSb3V0ZXJTZXJ2aWNlIH0gZnJvbSAnLi4vcm91dGVyL3JvdXRlci5zZXJ2aWNlJztcbmltcG9ydCB7IEhPT0tfU0VBUkNILCBTZWFyY2hTZXJ2aWNlIH0gZnJvbSAnLi4vc2VhcmNoL3NlYXJjaC5zZXJ2aWNlJztcbmltcG9ydCB7IEhPT0tfVEFCUywgVGFic1NlcnZpY2UgfSBmcm9tICcuLi90YWJzL3RhYnMuc2VydmljZSc7XG5pbXBvcnQgeyBXaXphcmRTZXJ2aWNlIH0gZnJvbSAnLi4vd2l6YXJkL3dpemFyZC5zZXJ2aWNlJztcbmltcG9ydCB7IEhPT0tfV0laQVJEIH0gZnJvbSAnLi4vd2l6YXJkL3dpemFyZC5tb2RlbCc7XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFBsdWdpbnNSZXNvbHZlU2VydmljZSB7XG4gIHByaXZhdGUgYWxsSG9va3M6IEFycmF5PHtcbiAgICB0b2tlbjogSW5qZWN0aW9uVG9rZW48YW55PjtcbiAgICBzZXJ2aWNlOiBFeHRlbnNpb25Qb2ludDxhbnk+O1xuICAgIHZhbHVlczogYW55W107XG4gIH0+ID0gW1xuICAgIHsgdG9rZW46IEhPT0tfQUNUSU9OLCBzZXJ2aWNlOiB0aGlzLmFjdGlvbiwgdmFsdWVzOiBbXSB9LFxuICAgIHsgdG9rZW46IEhPT0tfQUNUSU9OX0JBUiwgc2VydmljZTogdGhpcy5hY3Rpb25CYXIsIHZhbHVlczogW10gfSxcbiAgICB7IHRva2VuOiBIT09LX05BVklHQVRPUl9OT0RFUywgc2VydmljZTogdGhpcy5uYXZpZ2F0b3IsIHZhbHVlczogW10gfSxcbiAgICB7IHRva2VuOiBIT09LX0JSRUFEQ1JVTUIsIHNlcnZpY2U6IHRoaXMuYnJlYWRjcnVtYiwgdmFsdWVzOiBbXSB9LFxuICAgIHsgdG9rZW46IEhPT0tfQ09NUE9ORU5UUywgc2VydmljZTogdGhpcy5keW5hbWljQ29tcG9uZW50LCB2YWx1ZXM6IFtdIH0sXG4gICAgeyB0b2tlbjogSE9PS19PTkNFX1JPVVRFLCBzZXJ2aWNlOiB0aGlzLmM4eVJvdXRlciwgdmFsdWVzOiBbXSB9LFxuICAgIHsgdG9rZW46IEhPT0tfUk9VVEUsIHNlcnZpY2U6IHRoaXMuYzh5Um91dGVyLCB2YWx1ZXM6IFtdIH0sXG4gICAgeyB0b2tlbjogSE9PS19TRUFSQ0gsIHNlcnZpY2U6IHRoaXMuc2VhcmNoLCB2YWx1ZXM6IFtdIH0sXG4gICAgeyB0b2tlbjogSE9PS19UQUJTLCBzZXJ2aWNlOiB0aGlzLnRhYnMsIHZhbHVlczogW10gfSxcbiAgICB7IHRva2VuOiBIT09LX0RPQ1MsIHNlcnZpY2U6IHRoaXMuZG9jcywgdmFsdWVzOiBbXSB9LFxuICAgIHsgdG9rZW46IEhPT0tfV0laQVJELCBzZXJ2aWNlOiB0aGlzLndpemFyZCwgdmFsdWVzOiBbXSB9XG4gIF07XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0YWJzOiBUYWJzU2VydmljZSxcbiAgICBwcml2YXRlIG5hdmlnYXRvcjogTmF2aWdhdG9yU2VydmljZSxcbiAgICBwcml2YXRlIGFjdGlvbjogQWN0aW9uU2VydmljZSxcbiAgICBwcml2YXRlIGFjdGlvbkJhcjogQWN0aW9uQmFyU2VydmljZSxcbiAgICBwcml2YXRlIGJyZWFkY3J1bWI6IEJyZWFkY3J1bWJTZXJ2aWNlLFxuICAgIHByaXZhdGUgZHluYW1pY0NvbXBvbmVudDogRHluYW1pY0NvbXBvbmVudFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBzZWFyY2g6IFNlYXJjaFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBjOHlSb3V0ZXI6IFJvdXRlclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBkb2NzOiBEb2NzU2VydmljZSxcbiAgICBwcml2YXRlIHdpemFyZDogV2l6YXJkU2VydmljZSxcbiAgICBwcml2YXRlIGNvbXBpbGVyOiBDb21waWxlcixcbiAgICBwcml2YXRlIGluamVjdG9yOiBJbmplY3RvclxuICApIHt9XG5cbiAgLyoqXG4gICAqIExvYWRzIHBsdWdpbnMgYnkgcmVzb2x2aW5nIHRoZSByZW1vdGUgTmdNb2R1bGVzIGFuZCBpbmplY3RpbmcgaXQuIEFsc28gYXR0YWNoaW5nXG4gICAqIHRoZSBob29rcyBvbnRvIHRoZSByb290IGluamVjdG9yLlxuICAgKiBAcGFyYW0gcmVtb3RlTW9kdWxlcyBUaGUgcmVtb3RlIHBsdWdpbnMgdG8gbG9hZCBhcyBmYWN0b3J5IG5hbWUgbWFwcGluZyBhcnJheS5cbiAgICovXG4gIGFzeW5jIHJlc29sdmVSZW1vdGVQbHVnaW5zKHJlbW90ZU1vZHVsZXM6IEFycmF5PHsgZmFjdG9yeTsgbmFtZSB9Pikge1xuICAgIGNvbnN0IHJlbW90ZU5nTW9kdWxlcyA9IHJlbW90ZU1vZHVsZXNcbiAgICAgIC5maWx0ZXIoKHsgZmFjdG9yeSB9KSA9PiBmYWN0b3J5KVxuICAgICAgLm1hcCgoeyBuYW1lLCBmYWN0b3J5IH0pID0+IGZhY3RvcnlbbmFtZV0pO1xuXG4gICAgZm9yIChjb25zdCByZW1vdGVOZ01vZHVsZSBvZiByZW1vdGVOZ01vZHVsZXMpIHtcbiAgICAgIGxldCBmYWN0b3J5OiBOZ01vZHVsZUZhY3Rvcnk8dW5rbm93bj47XG4gICAgICBpZiAocmVtb3RlTmdNb2R1bGUgaW5zdGFuY2VvZiBOZ01vZHVsZUZhY3RvcnkpIHtcbiAgICAgICAgLy8gQU9UXG4gICAgICAgIGZhY3RvcnkgPSByZW1vdGVOZ01vZHVsZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIEpJVFxuICAgICAgICBmYWN0b3J5ID0gYXdhaXQgdGhpcy5jb21waWxlci5jb21waWxlTW9kdWxlQXN5bmMocmVtb3RlTmdNb2R1bGUpO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBtb2R1bGVSZWYgPSBmYWN0b3J5LmNyZWF0ZSh0aGlzLmluamVjdG9yKTtcblxuICAgICAgdGhpcy5hbGxIb29rcy5mb3JFYWNoKGhvb2sgPT4ge1xuICAgICAgICBob29rLnZhbHVlcyA9IFsuLi5ob29rLnZhbHVlcywgLi4ubW9kdWxlUmVmLmluamVjdG9yLmdldChob29rLnRva2VuLCBbXSwgSW5qZWN0RmxhZ3MuU2VsZildO1xuICAgICAgfSk7XG4gICAgfVxuXG4gICAgdGhpcy5hbGxIb29rcy5mb3JFYWNoKGhvb2sgPT4ge1xuICAgICAgaWYgKGhvb2sudmFsdWVzLmxlbmd0aCkge1xuICAgICAgICBob29rLnNlcnZpY2UuZmFjdG9yaWVzID0gWy4uLmhvb2suc2VydmljZS5mYWN0b3JpZXMsIC4uLmhvb2sudmFsdWVzXTtcbiAgICAgICAgaG9vay5zZXJ2aWNlLnJlZnJlc2goKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxufVxuIl19