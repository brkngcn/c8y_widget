import { Component, Input, Optional, Output, EventEmitter, HostListener } from '@angular/core';
import { BsModalRef } from 'ngx-bootstrap/modal';
import { gettext } from '../i18n/gettext';
import { isEmpty } from 'lodash';
/**
 * C8y modal component.
 * ## Example:
 *
 * Creating custom modal:
 * ```typescript
 *  import { Component } from "@angular/core";
 *  import { Subject } from 'rxjs';
 *
 * @Component({
 *  selector: "my-modal",
 *  template: `
 *    <c8y-modal title="CustomTitle"
 *      (onClose)="onClose($event)"
 *      (onDismiss)="onDismiss($event)"
 *      [labels]="labels"
 *      [disabled]="true" <- will disable ok button
 *      >
 *        <span>I am body of modal</span>
 *        <span>For simple string use body="string"</span>
 *    </c8y-modal>`
 * })
 *
 * export class MyModalComponent {
 *
 *  closeSubject: Subject<boolean> = new Subject();
 *  labels : ModalLabels = {ok: "customOK", cancel: "customCancel"};
 *
 *  onDismiss(event){
 *    this.closeSubject.next(false);
 *  }
 *
 *  onClose(event) {
 *    this.closeSubject.next(true);
 *  }
 * }
 * ```
 * Showing modal:
 * ```typescript
 * import { BsModalService } from "ngx-bootstrap/modal";
 *
 * constructor(
 *  public bsModalService: BsModalService,
 * ) {}
 *
 * showModal() {
 *  const modalRef = this.bsModalService.show(MyModalComponent);
 *  modalRef.content.closeSubject.subscribe(result => {
 *    console.log('results:', result);
 *  });
 * }
 * ```
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'ngx-bootstrap/modal';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '../i18n/c8y-translate.pipe';

function ModalComponent_p_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 6);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r0.body, " ");
} }
function ModalComponent_div_10_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 10);
    ɵngcc0.ɵɵlistener("click", function ModalComponent_div_10_button_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r4 = ɵngcc0.ɵɵnextContext(2); return ctx_r4._dismiss(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r2.labels.cancel));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 4, ctx_r2.labels.cancel), " ");
} }
function ModalComponent_div_10_button_3_Template(rf, ctx) { if (rf & 1) {
    const _r7 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 11);
    ɵngcc0.ɵɵlistener("click", function ModalComponent_div_10_button_3_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r7); const ctx_r6 = ɵngcc0.ɵɵnextContext(2); return ctx_r6._close(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(1, 3, ctx_r3.labels.ok));
    ɵngcc0.ɵɵproperty("disabled", ctx_r3.disabled);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 5, ctx_r3.labels.ok), " ");
} }
function ModalComponent_div_10_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 7);
    ɵngcc0.ɵɵprojection(1, 2);
    ɵngcc0.ɵɵtemplate(2, ModalComponent_div_10_button_2_Template, 4, 6, "button", 8);
    ɵngcc0.ɵɵtemplate(3, ModalComponent_div_10_button_3_Template, 4, 7, "button", 9);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.labels.cancel);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.labels.ok);
} }
const _c0 = [[["", "c8y-modal-title", ""]], "*", [["", "c8y-modal-footer", ""]]];
const _c1 = function (a0) { return { separator: a0 }; };
const _c2 = function (a0, a1) { return { "modal-body": a0, "d-contents": a1 }; };
const _c3 = ["[c8y-modal-title]", "*", "[c8y-modal-footer]"];
export class ModalComponent {
    constructor(modal) {
        this.modal = modal;
        this.onDismiss = new EventEmitter();
        this.onClose = new EventEmitter();
        this.disabled = false;
        this.customFooter = false;
        this.headerClasses = '';
        this._labels = { ok: gettext('OK'), cancel: gettext('Cancel') };
    }
    set labels({ ok, cancel }) {
        this._labels = { ok, cancel };
    }
    get labels() { return this._labels; }
    _dismiss() {
        let fn = this.dismiss;
        if (!fn && this.modal) {
            fn = () => this.modal.hide();
        }
        if (fn) {
            fn();
        }
        this.onDismiss.emit(true);
    }
    _close() {
        let fn = this.close;
        if (!fn && this.modal) {
            fn = () => this.modal.hide();
        }
        if (fn) {
            fn();
        }
        this.onClose.emit(true);
    }
    onEnterKeyDown(event) {
        const hasOnlyOneButton = isEmpty(this.labels.ok) !== isEmpty(this.labels.cancel);
        const isCancelClickable = !this.customFooter && this.labels.cancel;
        const isOkClickable = !this.customFooter && !this.disabled && this.labels.ok;
        if (hasOnlyOneButton && isCancelClickable) {
            this._dismiss();
        }
        if (hasOnlyOneButton && isOkClickable) {
            this._close();
        }
    }
}
ModalComponent.ɵfac = function ModalComponent_Factory(t) { return new (t || ModalComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.BsModalRef, 8)); };
ModalComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ModalComponent, selectors: [["c8y-modal"]], hostBindings: function ModalComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown.enter", function ModalComponent_keydown_enter_HostBindingHandler($event) { return ctx.onEnterKeyDown($event); }, false, ɵngcc0.ɵɵresolveDocument);
    } }, inputs: { disabled: "disabled", customFooter: "customFooter", headerClasses: "headerClasses", labels: "labels", close: "close", dismiss: "dismiss", title: "title", body: "body" }, outputs: { onDismiss: "onDismiss", onClose: "onClose" }, ngContentSelectors: _c3, decls: 11, vars: 16, consts: [[1, "viewport-modal"], [3, "ngClass"], [3, "hidden"], [1, "modal-inner-scroll"], ["class", "text-center text-break-word", 4, "ngIf"], ["class", "modal-footer", 4, "ngIf"], [1, "text-center", "text-break-word"], [1, "modal-footer"], ["class", "btn btn-default", 3, "title", "click", 4, "ngIf"], ["class", "btn btn-primary", 3, "title", "disabled", "click", 4, "ngIf"], [1, "btn", "btn-default", 3, "title", "click"], [1, "btn", "btn-primary", 3, "title", "disabled", "click"]], template: function ModalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef(_c0);
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵprojection(2);
        ɵngcc0.ɵɵelementStart(3, "h3", 2);
        ɵngcc0.ɵɵtext(4);
        ɵngcc0.ɵɵpipe(5, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "div", 3);
        ɵngcc0.ɵɵelementStart(7, "div", 1);
        ɵngcc0.ɵɵtemplate(8, ModalComponent_p_8_Template, 2, 1, "p", 4);
        ɵngcc0.ɵɵprojection(9, 1);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(10, ModalComponent_div_10_Template, 4, 2, "div", 5);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵclassMapInterpolate1("modal-header ", ctx.headerClasses, "");
        ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(11, _c1, ctx.title));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("hidden", !ctx.title);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 9, ctx.title), " ");
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction2(13, _c2, !ctx.customFooter, ctx.customFooter));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.title);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.customFooter);
    } }, directives: [ɵngcc2.NgClass, ɵngcc2.NgIf], pipes: [ɵngcc3.C8yTranslatePipe], encapsulation: 2 });
ModalComponent.ctorParameters = () => [
    { type: BsModalRef, decorators: [{ type: Optional }] }
];
ModalComponent.propDecorators = {
    onDismiss: [{ type: Output }],
    onClose: [{ type: Output }],
    disabled: [{ type: Input }],
    close: [{ type: Input }],
    dismiss: [{ type: Input }],
    title: [{ type: Input }],
    body: [{ type: Input }],
    customFooter: [{ type: Input }],
    headerClasses: [{ type: Input }],
    labels: [{ type: Input }],
    onEnterKeyDown: [{ type: HostListener, args: ['document:keydown.enter', ['$event'],] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ModalComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-modal',
                template: "<div class=\"viewport-modal\">\n  <div class=\"modal-header {{ headerClasses }}\" [ngClass]=\"{ separator: title }\">\n    <ng-content select=\"[c8y-modal-title]\"></ng-content>\n    <h3 [hidden]=\"!title\">\n      {{ title | translate }}\n    </h3>\n  </div>\n  <div class=\"modal-inner-scroll\">\n    <div [ngClass]=\"{ 'modal-body': !customFooter, 'd-contents': customFooter }\">\n      <p *ngIf=\"title\" class=\"text-center text-break-word\">\n        {{ body }}\n      </p>\n      <ng-content></ng-content>\n    </div>\n  </div>\n  <div class=\"modal-footer\" *ngIf=\"!customFooter\">\n    <ng-content select=\"[c8y-modal-footer]\"></ng-content>\n    <button\n      title=\"{{ labels.cancel | translate }}\"\n      *ngIf=\"labels.cancel\"\n      class=\"btn btn-default\"\n      (click)=\"_dismiss()\"\n    >\n      {{ labels.cancel | translate }}\n    </button>\n    <button\n      title=\"{{ labels.ok | translate }}\"\n      *ngIf=\"labels.ok\"\n      class=\"btn btn-primary\"\n      (click)=\"_close()\"\n      [disabled]=\"disabled\"\n    >\n      {{ labels.ok | translate }}\n    </button>\n  </div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.BsModalRef, decorators: [{
                type: Optional
            }] }]; }, { onDismiss: [{
            type: Output
        }], onClose: [{
            type: Output
        }], disabled: [{
            type: Input
        }], customFooter: [{
            type: Input
        }], headerClasses: [{
            type: Input
        }], labels: [{
            type: Input
        }], onEnterKeyDown: [{
            type: HostListener,
            args: ['document:keydown.enter', ['$event']]
        }], close: [{
            type: Input
        }], dismiss: [{
            type: Input
        }], title: [{
            type: Input
        }], body: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL21vZGFsL21vZGFsLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBRSxRQUFRLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxZQUFZLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0YsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ2pELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMxQyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBR2pDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1ILE1BQU0sT0FBTyxjQUFjO0FBQzNCLElBaUJFLFlBQWdDLEtBQWlCO0FBQUksUUFBckIsVUFBSyxHQUFMLEtBQUssQ0FBWTtBQUFDLFFBakJ4QyxjQUFTLEdBQTBCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDbEUsUUFBWSxZQUFPLEdBQTBCLElBQUksWUFBWSxFQUFFLENBQUM7QUFDaEUsUUFBVyxhQUFRLEdBQUcsS0FBSyxDQUFDO0FBQzVCLFFBSVcsaUJBQVksR0FBWSxLQUFLLENBQUM7QUFDekMsUUFB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Q1YsS0FBSztBQUFLLDZCQXdCVixZQUFZLFNBQUMsd0JBQXdCLEVBQUUsQ0FBQyxRQUFRLENBQUM7QUFBTTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgSW5wdXQsIE9wdGlvbmFsLCBPdXRwdXQsIEV2ZW50RW1pdHRlciwgSG9zdExpc3RlbmVyIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBCc01vZGFsUmVmIH0gZnJvbSAnbmd4LWJvb3RzdHJhcC9tb2RhbCc7XG5pbXBvcnQgeyBnZXR0ZXh0IH0gZnJvbSAnLi4vaTE4bi9nZXR0ZXh0JztcbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgTW9kYWxMYWJlbHMgfSBmcm9tICcuLi9zZWxlY3QtbW9kYWwvc2VsZWN0LW1vZGFsLm1vZGVsJztcblxuLyoqXG4gKiBDOHkgbW9kYWwgY29tcG9uZW50LlxuICogIyMgRXhhbXBsZTpcbiAqXG4gKiBDcmVhdGluZyBjdXN0b20gbW9kYWw6XG4gKiBgYGB0eXBlc2NyaXB0XG4gKiAgaW1wb3J0IHsgQ29tcG9uZW50IH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcbiAqICBpbXBvcnQgeyBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG4gKlxuICogQENvbXBvbmVudCh7XG4gKiAgc2VsZWN0b3I6IFwibXktbW9kYWxcIixcbiAqICB0ZW1wbGF0ZTogYFxuICogICAgPGM4eS1tb2RhbCB0aXRsZT1cIkN1c3RvbVRpdGxlXCJcbiAqICAgICAgKG9uQ2xvc2UpPVwib25DbG9zZSgkZXZlbnQpXCJcbiAqICAgICAgKG9uRGlzbWlzcyk9XCJvbkRpc21pc3MoJGV2ZW50KVwiXG4gKiAgICAgIFtsYWJlbHNdPVwibGFiZWxzXCJcbiAqICAgICAgW2Rpc2FibGVkXT1cInRydWVcIiA8LSB3aWxsIGRpc2FibGUgb2sgYnV0dG9uXG4gKiAgICAgID5cbiAqICAgICAgICA8c3Bhbj5JIGFtIGJvZHkgb2YgbW9kYWw8L3NwYW4+XG4gKiAgICAgICAgPHNwYW4+Rm9yIHNpbXBsZSBzdHJpbmcgdXNlIGJvZHk9XCJzdHJpbmdcIjwvc3Bhbj5cbiAqICAgIDwvYzh5LW1vZGFsPmBcbiAqIH0pXG4gKlxuICogZXhwb3J0IGNsYXNzIE15TW9kYWxDb21wb25lbnQge1xuICpcbiAqICBjbG9zZVN1YmplY3Q6IFN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgU3ViamVjdCgpO1xuICogIGxhYmVscyA6IE1vZGFsTGFiZWxzID0ge29rOiBcImN1c3RvbU9LXCIsIGNhbmNlbDogXCJjdXN0b21DYW5jZWxcIn07XG4gKlxuICogIG9uRGlzbWlzcyhldmVudCl7XG4gKiAgICB0aGlzLmNsb3NlU3ViamVjdC5uZXh0KGZhbHNlKTtcbiAqICB9XG4gKlxuICogIG9uQ2xvc2UoZXZlbnQpIHtcbiAqICAgIHRoaXMuY2xvc2VTdWJqZWN0Lm5leHQodHJ1ZSk7XG4gKiAgfVxuICogfVxuICogYGBgXG4gKiBTaG93aW5nIG1vZGFsOlxuICogYGBgdHlwZXNjcmlwdFxuICogaW1wb3J0IHsgQnNNb2RhbFNlcnZpY2UgfSBmcm9tIFwibmd4LWJvb3RzdHJhcC9tb2RhbFwiO1xuICpcbiAqIGNvbnN0cnVjdG9yKFxuICogIHB1YmxpYyBic01vZGFsU2VydmljZTogQnNNb2RhbFNlcnZpY2UsXG4gKiApIHt9XG4gKlxuICogc2hvd01vZGFsKCkge1xuICogIGNvbnN0IG1vZGFsUmVmID0gdGhpcy5ic01vZGFsU2VydmljZS5zaG93KE15TW9kYWxDb21wb25lbnQpO1xuICogIG1vZGFsUmVmLmNvbnRlbnQuY2xvc2VTdWJqZWN0LnN1YnNjcmliZShyZXN1bHQgPT4ge1xuICogICAgY29uc29sZS5sb2coJ3Jlc3VsdHM6JywgcmVzdWx0KTtcbiAqICB9KTtcbiAqIH1cbiAqIGBgYFxuICovXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktbW9kYWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vbW9kYWwuY29tcG9uZW50Lmh0bWwnLFxufSlcblxuZXhwb3J0IGNsYXNzIE1vZGFsQ29tcG9uZW50IHtcbiAgQE91dHB1dCgpIG9uRGlzbWlzczogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBAT3V0cHV0KCkgb25DbG9zZTogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICBASW5wdXQoKSBkaXNhYmxlZCA9IGZhbHNlO1xuICBASW5wdXQoKSBjbG9zZTogKCkgPT4gdm9pZDtcbiAgQElucHV0KCkgZGlzbWlzczogKCkgPT4gdm9pZDtcbiAgQElucHV0KCkgdGl0bGU6IHN0cmluZztcbiAgQElucHV0KCkgYm9keTogc3RyaW5nO1xuICBASW5wdXQoKSBjdXN0b21Gb290ZXI6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQElucHV0KCkgaGVhZGVyQ2xhc3Nlczogc3RyaW5nID0gJyc7XG4gIEBJbnB1dCgpIHNldCBsYWJlbHMoe29rLCBjYW5jZWx9OiBNb2RhbExhYmVscykge1xuICAgIHRoaXMuX2xhYmVscyA9IHtvayAsIGNhbmNlbH07XG4gIH1cblxuICBnZXQgbGFiZWxzKCk6IE1vZGFsTGFiZWxzIHsgcmV0dXJuIHRoaXMuX2xhYmVsczsgfVxuXG4gIHByaXZhdGUgX2xhYmVsczogTW9kYWxMYWJlbHMgPSAgeyBvazogZ2V0dGV4dCgnT0snKSwgY2FuY2VsOiBnZXR0ZXh0KCdDYW5jZWwnKSB9O1xuXG4gIGNvbnN0cnVjdG9yKEBPcHRpb25hbCgpIHByaXZhdGUgbW9kYWw6IEJzTW9kYWxSZWYpIHt9XG5cbiAgX2Rpc21pc3MoKSB7XG4gICAgbGV0IGZuID0gdGhpcy5kaXNtaXNzO1xuICAgIGlmICghZm4gJiYgdGhpcy5tb2RhbCkgeyBmbiA9ICgpID0+IHRoaXMubW9kYWwuaGlkZSgpOyB9XG4gICAgaWYgKGZuKSB7IGZuKCk7IH1cbiAgICB0aGlzLm9uRGlzbWlzcy5lbWl0KHRydWUpO1xuICB9XG5cbiAgX2Nsb3NlKCkge1xuICAgIGxldCBmbiA9IHRoaXMuY2xvc2U7XG4gICAgaWYgKCFmbiAmJiB0aGlzLm1vZGFsKSB7IGZuID0gKCkgPT4gdGhpcy5tb2RhbC5oaWRlKCk7IH1cbiAgICBpZiAoZm4pIHsgZm4oKTsgfVxuICAgIHRoaXMub25DbG9zZS5lbWl0KHRydWUpO1xuICB9XG5cbiAgQEhvc3RMaXN0ZW5lcignZG9jdW1lbnQ6a2V5ZG93bi5lbnRlcicsIFsnJGV2ZW50J10pIG9uRW50ZXJLZXlEb3duKGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgY29uc3QgaGFzT25seU9uZUJ1dHRvbiA9IGlzRW1wdHkodGhpcy5sYWJlbHMub2spICE9PSBpc0VtcHR5KHRoaXMubGFiZWxzLmNhbmNlbCk7XG4gICAgY29uc3QgaXNDYW5jZWxDbGlja2FibGUgPSAhdGhpcy5jdXN0b21Gb290ZXIgJiYgdGhpcy5sYWJlbHMuY2FuY2VsO1xuICAgIGNvbnN0IGlzT2tDbGlja2FibGUgPSAhdGhpcy5jdXN0b21Gb290ZXIgJiYgIXRoaXMuZGlzYWJsZWQgJiYgdGhpcy5sYWJlbHMub2s7XG4gICAgaWYgKGhhc09ubHlPbmVCdXR0b24gICYmIGlzQ2FuY2VsQ2xpY2thYmxlKSB7XG4gICAgICB0aGlzLl9kaXNtaXNzKCk7XG4gICAgfVxuICAgIGlmIChoYXNPbmx5T25lQnV0dG9uICAmJiBpc09rQ2xpY2thYmxlKSB7XG4gICAgICB0aGlzLl9jbG9zZSgpO1xuICAgIH1cbiAgfVxufVxuIl19