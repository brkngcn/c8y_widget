import { Component, ContentChildren, ContentChild, ElementRef, Renderer2, Optional } from '@angular/core';
import { GuideHrefDirective } from './guide-href.directive';
import { DocsService } from './docs.service';
import { C8yTranslateDirective } from '../i18n/c8y-translate.directive';
import { ReplaySubject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './docs.service';
import * as ɵngcc2 from '../i18n/c8y-translate.directive';
import * as ɵngcc3 from '@angular/common';

const _c0 = ["c8y-guide-docs", ""];
function GuideDocsComponent_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵprojection(1);
    ɵngcc0.ɵɵelementContainerEnd();
} }
const _c1 = ["*"];
export class GuideDocsComponent {
    constructor(docs, el, renderer, translateDirective) {
        this.docs = docs;
        this.el = el;
        this.renderer = renderer;
        this.destroyed$ = new ReplaySubject(1);
        this.translateDirective = translateDirective;
    }
    get translateDirective() {
        return this._translateDirective;
    }
    set translateDirective(value) {
        if (!value) {
            return;
        }
        this._translateDirective = value;
    }
    ngOnInit() {
        this.baseUrl = this.docs.getBaseUrl();
    }
    /**
     * After content is initialized we subscribe for translation events, then we are able to modify
     * anchor just as C8yGuideHrefDirective does.
     */
    ngAfterContentInit() {
        if (this.translateDirective) {
            this.translateDirective.htmlUpdateEvent
                .pipe(takeUntil(this.destroyed$))
                .subscribe(() => {
                this.replaceAnchorAttributes();
            });
        }
        else {
            this.replaceAnchorAttributes();
        }
        this.links.forEach(guide => {
            guide.baseHref = this.baseUrl;
        });
    }
    /**
     * Find and modify anchor elements
     */
    replaceAnchorAttributes() {
        const anchors = this.findGuideAnchors(this.el.nativeElement);
        anchors.forEach(a => {
            const guideHref = `${this.baseUrl}/${a.getAttribute('c8y-guide-href')}`;
            this.renderer.setAttribute(a, 'href', guideHref);
            if (!a.hasAttribute('target')) {
                this.renderer.setAttribute(a, 'target', '_blank');
            }
        });
    }
    /**
     * Recursive function, returns array of Anchor elements inside HTMLElement.
     */
    findGuideAnchors(el) {
        const isAnchor = () => el.nodeName === 'A';
        const hasGuideHrefAttr = () => !!el.attributes.getNamedItem('c8y-guide-href');
        const hasChildren = () => el.childNodes && el.childNodes.length > 0;
        let result = [];
        if (isAnchor() && hasGuideHrefAttr()) {
            result.push(el);
        }
        else if (hasChildren()) {
            el.childNodes.forEach((node) => {
                const searchResult = this.findGuideAnchors(node);
                if (searchResult) {
                    result = [...result, ...searchResult];
                }
            });
        }
        return result;
    }
    ngOnDestroy() {
        this.destroyed$.next(true);
        this.destroyed$.complete();
    }
}
GuideDocsComponent.ɵfac = function GuideDocsComponent_Factory(t) { return new (t || GuideDocsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.DocsService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.C8yTranslateDirective, 8)); };
GuideDocsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: GuideDocsComponent, selectors: [["", "c8y-guide-docs", ""]], contentQueries: function GuideDocsComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, C8yTranslateDirective, 7);
        ɵngcc0.ɵɵcontentQuery(dirIndex, GuideHrefDirective, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.translateDirective = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.links = _t);
    } }, attrs: _c0, ngContentSelectors: _c1, decls: 1, vars: 1, consts: [[4, "ngIf"]], template: function GuideDocsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵtemplate(0, GuideDocsComponent_ng_container_0_Template, 2, 0, "ng-container", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !!ctx.baseUrl);
    } }, directives: [ɵngcc3.NgIf], encapsulation: 2 });
GuideDocsComponent.ctorParameters = () => [
    { type: DocsService },
    { type: ElementRef },
    { type: Renderer2 },
    { type: C8yTranslateDirective, decorators: [{ type: Optional }] }
];
GuideDocsComponent.propDecorators = {
    links: [{ type: ContentChildren, args: [GuideHrefDirective, { descendants: true },] }],
    translateDirective: [{ type: ContentChild, args: [C8yTranslateDirective, { static: true },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(GuideDocsComponent, [{
        type: Component,
        args: [{
                selector: '[c8y-guide-docs]',
                template: "<ng-container *ngIf=\"!!baseUrl\">\n  <ng-content></ng-content>\n</ng-container>\n"
            }]
    }], function () { return [{ type: ɵngcc1.DocsService }, { type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc2.C8yTranslateDirective, decorators: [{
                type: Optional
            }] }]; }, { translateDirective: [{
            type: ContentChild,
            args: [C8yTranslateDirective, { static: true }]
        }], links: [{
            type: ContentChildren,
            args: [GuideHrefDirective, { descendants: true }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ3VpZGUtZG9jcy5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2NvcmUvZG9jcy9ndWlkZS1kb2NzLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULGVBQWUsRUFFZixZQUFZLEVBQ1osVUFBVSxFQUNWLFNBQVMsRUFHVCxRQUFRLEVBQ1QsTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzdDLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBQ3hFLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDckMsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDOzs7Ozs7Ozs7Ozs7O0FBTTNDLE1BQU0sT0FBTyxrQkFBa0I7QUFBRyxJQXFCaEMsWUFBb0IsSUFBaUIsRUFBVSxFQUFjLEVBQVUsUUFBbUIsRUFBYyxrQkFBeUM7QUFDbkosUUFEc0IsU0FBSSxHQUFKLElBQUksQ0FBYTtBQUFDLFFBQVMsT0FBRSxHQUFGLEVBQUUsQ0FBWTtBQUFDLFFBQVMsYUFBUSxHQUFSLFFBQVEsQ0FBVztBQUFDLFFBRm5GLGVBQVUsR0FBMkIsSUFBSSxhQUFhLENBQUMsQ0FBQyxDQUFDLENBQUM7QUFDcEUsUUFFSSxJQUFJLENBQUMsa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7QUFDakQsSUFBRSxDQUFDO0FBQ0gsSUFmRSxJQUEyRCxrQkFBa0I7QUFBSyxRQUNoRixPQUFPLElBQUksQ0FBQyxtQkFBbUIsQ0FBQztBQUNwQyxJQUFFLENBQUM7QUFDSCxJQUFFLElBQUksa0JBQWtCLENBQUMsS0FBNEI7QUFDckQsUUFBSSxJQUFJLENBQUMsS0FBSyxFQUFFO0FBQ2hCLFlBQU0sT0FBTztBQUNiLFNBQUs7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QVEsSUFBSSxZQUFZLEVBQUU7QUFDMUIsb0JBQVUsTUFBTSxHQUFHLENBQUMsR0FBRyxNQUFNLEVBQUUsR0FBRyxZQUFZLENBQUMsQ0FBQztBQUNoRCxpQkFBUztBQUNULFlBQU0sQ0FBQyxDQUFDLENBQUM7QUFDVCxTQUFLO0FBQ0wsUUFBSSxPQUFPLE1BQU0sQ0FBQztBQUNsQixJQUFFLENBQUM7QUFDSCxJQUNFLFdBQVc7QUFDYixRQUFJLElBQUksQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO0FBQy9CLFFBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxRQUFRLEVBQUUsQ0FBQztBQUMvQixJQUFFLENBQUM7QUFDSDs4Q0E3RkMsU0FBUyxTQUFDLGtCQUNULFFBQVEsRUFBRSxrQkFBa0Isa0JBQzVCLDhGQUEwQyxjQUMzQzs7Ozs7Ozs7Ozs7Ozt3REFDSTtBQUFDO0FBQTRDLFlBVHpDLFdBQVc7QUFBSSxZQVB0QixVQUFVO0FBQ1YsWUFBQSxTQUFTO0FBQ1QsWUFNTyxxQkFBcUIsdUJBNkJpRSxRQUFRO0FBQU07QUFBRztBQUFzQyxvQkFuQm5KLGVBQWUsU0FBQyxrQkFBa0IsRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUU7QUFBTyxpQ0FPaEUsWUFBWSxTQUFDLHFCQUFxQixFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTtBQUFNOzs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBDb250ZW50Q2hpbGRyZW4sXG4gIFF1ZXJ5TGlzdCxcbiAgQ29udGVudENoaWxkLFxuICBFbGVtZW50UmVmLFxuICBSZW5kZXJlcjIsXG4gIE9uRGVzdHJveSxcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgT3B0aW9uYWxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBHdWlkZUhyZWZEaXJlY3RpdmUgfSBmcm9tICcuL2d1aWRlLWhyZWYuZGlyZWN0aXZlJztcbmltcG9ydCB7IERvY3NTZXJ2aWNlIH0gZnJvbSAnLi9kb2NzLnNlcnZpY2UnO1xuaW1wb3J0IHsgQzh5VHJhbnNsYXRlRGlyZWN0aXZlIH0gZnJvbSAnLi4vaTE4bi9jOHktdHJhbnNsYXRlLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBSZXBsYXlTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ1tjOHktZ3VpZGUtZG9jc10nLFxuICB0ZW1wbGF0ZVVybDogJy4vZ3VpZGUtZG9jcy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgR3VpZGVEb2NzQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3kge1xuICBiYXNlVXJsOiBzdHJpbmc7XG4gIEBDb250ZW50Q2hpbGRyZW4oR3VpZGVIcmVmRGlyZWN0aXZlLCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pIGxpbmtzOiBRdWVyeUxpc3Q8R3VpZGVIcmVmRGlyZWN0aXZlPjtcblxuICAvKipcbiAgICogUHJvdmlkZXMgYWNjZXNzIHRvIHRyYW5zbGF0ZSBkaXJlY3RpdmUsIHNvIGl0IGlzIHBvc3NpYmxlIHRvIGFkanVzdCBhbmNob3IgaHRtbCB0YWdzLCBhZnRlclxuICAgKiBjb250ZW50IGlzIHRyYW5zbGF0ZWQuXG4gICAqL1xuICBwcml2YXRlIF90cmFuc2xhdGVEaXJlY3RpdmU6IEM4eVRyYW5zbGF0ZURpcmVjdGl2ZTtcbiAgQENvbnRlbnRDaGlsZChDOHlUcmFuc2xhdGVEaXJlY3RpdmUsIHsgc3RhdGljOiB0cnVlIH0pIGdldCB0cmFuc2xhdGVEaXJlY3RpdmUoKTogQzh5VHJhbnNsYXRlRGlyZWN0aXZlIHtcbiAgICByZXR1cm4gdGhpcy5fdHJhbnNsYXRlRGlyZWN0aXZlO1xuICB9XG4gIHNldCB0cmFuc2xhdGVEaXJlY3RpdmUodmFsdWU6IEM4eVRyYW5zbGF0ZURpcmVjdGl2ZSkge1xuICAgIGlmICghdmFsdWUpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fdHJhbnNsYXRlRGlyZWN0aXZlID0gdmFsdWU7XG4gIH1cblxuICBwcml2YXRlIGRlc3Ryb3llZCQ6IFJlcGxheVN1YmplY3Q8Ym9vbGVhbj4gPSBuZXcgUmVwbGF5U3ViamVjdCgxKTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGRvY3M6IERvY3NTZXJ2aWNlLCBwcml2YXRlIGVsOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIsIEBPcHRpb25hbCgpIHRyYW5zbGF0ZURpcmVjdGl2ZTogQzh5VHJhbnNsYXRlRGlyZWN0aXZlKSB7XG4gICAgdGhpcy50cmFuc2xhdGVEaXJlY3RpdmUgPSB0cmFuc2xhdGVEaXJlY3RpdmU7XG4gIH1cblxuICBuZ09uSW5pdCgpOiB2b2lkIHtcbiAgICB0aGlzLmJhc2VVcmwgPSB0aGlzLmRvY3MuZ2V0QmFzZVVybCgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFmdGVyIGNvbnRlbnQgaXMgaW5pdGlhbGl6ZWQgd2Ugc3Vic2NyaWJlIGZvciB0cmFuc2xhdGlvbiBldmVudHMsIHRoZW4gd2UgYXJlIGFibGUgdG8gbW9kaWZ5XG4gICAqIGFuY2hvciBqdXN0IGFzIEM4eUd1aWRlSHJlZkRpcmVjdGl2ZSBkb2VzLlxuICAgKi9cbiAgbmdBZnRlckNvbnRlbnRJbml0KCkge1xuICAgIGlmICh0aGlzLnRyYW5zbGF0ZURpcmVjdGl2ZSkge1xuICAgICAgdGhpcy50cmFuc2xhdGVEaXJlY3RpdmUuaHRtbFVwZGF0ZUV2ZW50XG4gICAgICAgIC5waXBlKHRha2VVbnRpbCh0aGlzLmRlc3Ryb3llZCQpKVxuICAgICAgICAuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnJlcGxhY2VBbmNob3JBdHRyaWJ1dGVzKCk7XG4gICAgICAgIH0pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLnJlcGxhY2VBbmNob3JBdHRyaWJ1dGVzKCk7XG4gICAgfVxuICAgIHRoaXMubGlua3MuZm9yRWFjaChndWlkZSA9PiB7XG4gICAgICBndWlkZS5iYXNlSHJlZiA9IHRoaXMuYmFzZVVybDtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBGaW5kIGFuZCBtb2RpZnkgYW5jaG9yIGVsZW1lbnRzXG4gICAqL1xuICByZXBsYWNlQW5jaG9yQXR0cmlidXRlcygpIHtcbiAgICBjb25zdCBhbmNob3JzID0gdGhpcy5maW5kR3VpZGVBbmNob3JzKHRoaXMuZWwubmF0aXZlRWxlbWVudCk7XG4gICAgYW5jaG9ycy5mb3JFYWNoKGEgPT4ge1xuICAgICAgY29uc3QgZ3VpZGVIcmVmID0gYCR7dGhpcy5iYXNlVXJsfS8ke2EuZ2V0QXR0cmlidXRlKCdjOHktZ3VpZGUtaHJlZicpfWA7XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShhLCAnaHJlZicsIGd1aWRlSHJlZik7XG4gICAgICBpZiAoIWEuaGFzQXR0cmlidXRlKCd0YXJnZXQnKSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldEF0dHJpYnV0ZShhLCAndGFyZ2V0JywgJ19ibGFuaycpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlY3Vyc2l2ZSBmdW5jdGlvbiwgcmV0dXJucyBhcnJheSBvZiBBbmNob3IgZWxlbWVudHMgaW5zaWRlIEhUTUxFbGVtZW50LlxuICAgKi9cbiAgZmluZEd1aWRlQW5jaG9ycyhlbDogSFRNTEVsZW1lbnQpOiBIVE1MRWxlbWVudFtdIHtcbiAgICBjb25zdCBpc0FuY2hvciA9ICgpID0+IGVsLm5vZGVOYW1lID09PSAnQSc7XG4gICAgY29uc3QgaGFzR3VpZGVIcmVmQXR0ciA9ICgpID0+ICEhZWwuYXR0cmlidXRlcy5nZXROYW1lZEl0ZW0oJ2M4eS1ndWlkZS1ocmVmJyk7XG4gICAgY29uc3QgaGFzQ2hpbGRyZW4gPSAoKSA9PiBlbC5jaGlsZE5vZGVzICYmIGVsLmNoaWxkTm9kZXMubGVuZ3RoID4gMDtcblxuICAgIGxldCByZXN1bHQgPSBbXTtcblxuICAgIGlmIChpc0FuY2hvcigpICYmIGhhc0d1aWRlSHJlZkF0dHIoKSkge1xuICAgICAgcmVzdWx0LnB1c2goZWwpO1xuICAgIH0gZWxzZSBpZiAoaGFzQ2hpbGRyZW4oKSkge1xuICAgICAgZWwuY2hpbGROb2Rlcy5mb3JFYWNoKChub2RlOiBIVE1MRWxlbWVudCkgPT4ge1xuICAgICAgICBjb25zdCBzZWFyY2hSZXN1bHQgPSB0aGlzLmZpbmRHdWlkZUFuY2hvcnMobm9kZSk7XG4gICAgICAgIGlmIChzZWFyY2hSZXN1bHQpIHtcbiAgICAgICAgICByZXN1bHQgPSBbLi4ucmVzdWx0LCAuLi5zZWFyY2hSZXN1bHRdO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCkge1xuICAgIHRoaXMuZGVzdHJveWVkJC5uZXh0KHRydWUpO1xuICAgIHRoaXMuZGVzdHJveWVkJC5jb21wbGV0ZSgpO1xuICB9XG59XG4iXX0=