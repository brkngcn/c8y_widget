import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { uniq } from 'lodash-es';
import { BehaviorSubject, Observable, of } from 'rxjs';
import { startWith } from 'rxjs/operators';
import { AlertService } from '../alert/alert.service';
import { Permissions } from '../common/permissions.service';
import { OptionsService } from '../common/options.service';
import { AppStateService } from '../common/ui-state.service';
import { gettext } from '../i18n/gettext';
import { Steppers } from '../stepper/stepper.model';
import { StepperService } from '../stepper/stepper.service';
import { NEEDED_ROLE_FOR_SETUP, SetupState } from './setup.model';
import { BootstrapComponent } from '../bootstrap/bootstrap.component';
/**
 * This component is the parent of each setup and can be injected
 * into setup steps to control them.
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../common/options.service';
import * as ɵngcc2 from '../stepper/stepper.service';
import * as ɵngcc3 from '../common/ui-state.service';
import * as ɵngcc4 from '../alert/alert.service';
import * as ɵngcc5 from '../common/permissions.service';
import * as ɵngcc6 from '../bootstrap/bootstrap.component';
import * as ɵngcc7 from '../header/title/title.component';
import * as ɵngcc8 from '@angular/common';
import * as ɵngcc9 from '../stepper/stepper-outlet.component';
import * as ɵngcc10 from '../i18n/c8y-translate.directive';
import * as ɵngcc11 from '../properties-list/properties-list.component';
import * as ɵngcc12 from '../common/humanize-app-name.pipe';
import * as ɵngcc13 from '../i18n/c8y-translate.pipe';

function SetupComponent_div_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 2);
    ɵngcc0.ɵɵelement(1, "c8y-stepper-outlet", 3);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("showDefaultButtons", false)("steps", ctx_r0.steps);
} }
function SetupComponent_div_5_p_39_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "p", 46);
    ɵngcc0.ɵɵtext(1, " This application (or any plugin that you added recently) has pre-requirements that needs to be configured first. This wizard will guide you through the steps that are necessary to get your application up and running. ");
    ɵngcc0.ɵɵelementEnd();
} }
function SetupComponent_div_5_div_40_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 47);
    ɵngcc0.ɵɵelement(1, "c8y-properties-list", 48);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("properties", ctx_r3.properties)("data", ctx_r3.options)("title", ɵngcc0.ɵɵpipeBind1(2, 3, "Application properties"));
} }
function SetupComponent_div_5_div_41_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 49);
    ɵngcc0.ɵɵelementStart(1, "strong", 50);
    ɵngcc0.ɵɵtext(2, "No permission");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "div", 50);
    ɵngcc0.ɵɵtext(4, " You don't have sufficient rights to setup this application. Please contact an application administrator to setup the required steps. ");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} }
function SetupComponent_div_5_div_42_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 49);
    ɵngcc0.ɵɵelementStart(1, "strong", 50);
    ɵngcc0.ɵɵtext(2, "Not the owner");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "div", 50);
    ɵngcc0.ɵɵtext(4, " The current application is not owned by this tenant. Please clone the application before running the setup. ");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} }
function SetupComponent_div_5_button_44_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 51);
    ɵngcc0.ɵɵlistener("click", function SetupComponent_div_5_button_44_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r8); const ctx_r7 = ɵngcc0.ɵɵnextContext(2); return ctx_r7.skip(); });
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2, " Skip ");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(1, 1, "You can skip the setup now. It will be shown again as soon as you restart the application."));
} }
const _c0 = function (a0) { return { appName: a0 }; };
function SetupComponent_div_5_Template(rf, ctx) { if (rf & 1) {
    const _r10 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 4);
    ɵngcc0.ɵɵelementStart(1, "div", 5);
    ɵngcc0.ɵɵelementStart(2, "div", 6);
    ɵngcc0.ɵɵelementStart(3, "div", 7);
    ɵngcc0.ɵɵelementStart(4, "div", 8);
    ɵngcc0.ɵɵnamespaceSVG();
    ɵngcc0.ɵɵelementStart(5, "svg", 9);
    ɵngcc0.ɵɵelementStart(6, "g", 10);
    ɵngcc0.ɵɵelementStart(7, "g", 11);
    ɵngcc0.ɵɵelementStart(8, "g", 12);
    ɵngcc0.ɵɵelement(9, "path", 13);
    ɵngcc0.ɵɵelement(10, "ellipse", 14);
    ɵngcc0.ɵɵelement(11, "ellipse", 15);
    ɵngcc0.ɵɵelementStart(12, "g", 16);
    ɵngcc0.ɵɵelement(13, "path", 17);
    ɵngcc0.ɵɵelement(14, "path", 18);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(15, "ellipse", 19);
    ɵngcc0.ɵɵelement(16, "ellipse", 20);
    ɵngcc0.ɵɵelement(17, "ellipse", 21);
    ɵngcc0.ɵɵelement(18, "ellipse", 22);
    ɵngcc0.ɵɵelement(19, "ellipse", 23);
    ɵngcc0.ɵɵelement(20, "ellipse", 24);
    ɵngcc0.ɵɵelementStart(21, "g", 25);
    ɵngcc0.ɵɵelement(22, "path", 26);
    ɵngcc0.ɵɵelement(23, "path", 27);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(24, "rect", 28);
    ɵngcc0.ɵɵelement(25, "polygon", 29);
    ɵngcc0.ɵɵelement(26, "polygon", 30);
    ɵngcc0.ɵɵelement(27, "polygon", 31);
    ɵngcc0.ɵɵelement(28, "polygon", 32);
    ɵngcc0.ɵɵelement(29, "path", 33);
    ɵngcc0.ɵɵelement(30, "path", 34);
    ɵngcc0.ɵɵelement(31, "line", 35);
    ɵngcc0.ɵɵelement(32, "line", 36);
    ɵngcc0.ɵɵelement(33, "line", 37);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(34, "polygon", 38);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵnamespaceHTML();
    ɵngcc0.ɵɵelementStart(35, "h1", 39);
    ɵngcc0.ɵɵdisableBindings();
    ɵngcc0.ɵɵpipe(36, "async");
    ɵngcc0.ɵɵpipe(37, "humanizeAppName");
    ɵngcc0.ɵɵtext(38, " Welcome to {{ appName }} ");
    ɵngcc0.ɵɵenableBindings();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(39, SetupComponent_div_5_p_39_Template, 2, 0, "p", 40);
    ɵngcc0.ɵɵtemplate(40, SetupComponent_div_5_div_40_Template, 3, 5, "div", 41);
    ɵngcc0.ɵɵtemplate(41, SetupComponent_div_5_div_41_Template, 5, 0, "div", 42);
    ɵngcc0.ɵɵtemplate(42, SetupComponent_div_5_div_42_Template, 5, 0, "div", 42);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(43, "div", 43);
    ɵngcc0.ɵɵtemplate(44, SetupComponent_div_5_button_44_Template, 3, 3, "button", 44);
    ɵngcc0.ɵɵelementStart(45, "button", 45);
    ɵngcc0.ɵɵlistener("click", function SetupComponent_div_5_Template_button_click_45_listener() { ɵngcc0.ɵɵrestoreView(_r10); const ctx_r9 = ɵngcc0.ɵɵnextContext(); return ctx_r9.start(); });
    ɵngcc0.ɵɵpipe(46, "translate");
    ɵngcc0.ɵɵtext(47, " Start ");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(35);
    ɵngcc0.ɵɵproperty("translateParams", ɵngcc0.ɵɵpureFunction1(14, _c0, ɵngcc0.ɵɵpipeBind1(36, 8, ɵngcc0.ɵɵpipeBind1(37, 10, ctx_r1.options.name))));
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.hasRole);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.properties.length > 0);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r1.hasRole);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", !ctx_r1.isOwner);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.canSkip);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("disabled", !ctx_r1.hasRole || !ctx_r1.isOwner)("title", ɵngcc0.ɵɵpipeBind1(46, 12, "Start the setup wizard."));
} }
export class SetupComponent {
    constructor(options, stepperService, appState, alert, permissions, bootstrapComponent) {
        this.options = options;
        this.stepperService = stepperService;
        this.appState = appState;
        this.alert = alert;
        this.permissions = permissions;
        this.bootstrapComponent = bootstrapComponent;
        /**
         * A subject which can be used to exchange data between
         * steps.
         */
        this.data$ = new BehaviorSubject({});
        /**
         * The current state. SetupState.START shows an application overview
         * while SetupState.WIZARD shows the steps.
         */
        this.currentSetupState = SetupState.START;
        /**
         * Emits when the setup is done. You can add certain operations before completing the setup that needed to be awaited. Return
         * true if everything is fine, otherwise false.
         * ```typescript
         * const asyncOperation = delay(2000);
         * this.setup.completed$ = this.setup.completed$.pipe(asyncOperation, map(() => true));
         * ``
         * Note: Remember that a step can be viewed multiple times. The step needs to ensure, to only add a completed operation ones.
         */
        this.completed$ = new Observable().pipe(startWith(true));
        /**
         * @ignore
         */
        this.stepperId = Steppers.SETUP;
        /**
         * @ignore
         */
        this.setupState = SetupState;
        /**
         * @ignore
         */
        this.properties = [];
        /**
         * @ignore
         */
        this.canSkip = false;
        /**
         * @ignore
         */
        this.hasRole = false;
        /**
         * @ignore
         */
        this.isOwner = true;
        this.RELOAD_APP_TIMEOUT = 2000;
    }
    /**
     * Mark a step as completed. If the step is required, this is needed to fulfill
     * the setup.
     * @param stepIndex The index of the step you want to mark as completed
     * @param isCompleted Defaults to true to mark it as completed but can be set to false to invalidate the step.
     */
    stepCompleted(stepIndex, isCompleted = true) {
        const step = this.getByIndex(stepIndex);
        step.completed = isCompleted;
    }
    /**
     * Returns a step by it index position in the wizard.
     * @param stepIndex The step index that you want to receive.
     * @returns An indexed step definition.
     */
    getByIndex(stepIndex) {
        return this.steps.find(({ index }) => index === stepIndex);
    }
    /**
     * @ignore
     */
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            this.steps = (yield this.stepperService.getById$(this.stepperId).toPromise()).map((step, index) => (Object.assign(Object.assign({}, step), { index, completed: false })));
            if (!this.options.forceSetup) {
                const doneSetup = this.options.setup || [];
                this.steps = this.steps.filter(step => doneSetup.indexOf(step.setupId) === -1);
            }
            this.isOwner = this.appState.isOwnerOfApplication();
            this.canSkip = !this.hasRequiredSteps(this.steps);
            this.hasRole = this.permissions.hasRole(NEEDED_ROLE_FOR_SETUP);
            this.properties = [
                {
                    label: gettext('Description'),
                    key: 'description'
                },
                {
                    label: gettext('Keywords'),
                    key: 'keywords'
                },
                {
                    label: gettext('Source'),
                    key: 'repository'
                },
                {
                    label: gettext('Version'),
                    key: 'version'
                },
                {
                    label: gettext('Author'),
                    key: 'author'
                },
                {
                    label: gettext('Required platform version'),
                    key: 'requiredPlatformVersion'
                }
            ];
        });
    }
    /**
     * Skips the current setup wizard
     */
    skip() {
        this.bootstrapComponent.isSetupNeeded$ = of(false);
    }
    /**
     * Starts the wizards (or finish the setup if no steps are found)
     */
    start() {
        this.currentSetupState = SetupState.WIZARD;
    }
    /**
     * Cancels the wizards and goes back to the start view.
     */
    cancel() {
        this.currentSetupState = SetupState.START;
    }
    /**
     * Finish the wizard and will start the application.
     */
    finish() {
        this.currentSetupState = SetupState.FINALIZING;
        this.completed$.subscribe((status) => __awaiter(this, void 0, void 0, function* () {
            if (status) {
                this.finalize();
            }
            else {
                this.currentSetupState = SetupState.WIZARD;
            }
        }));
    }
    finalize() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                const doneSetup = this.steps.filter(value => value.setupId).map(value => value.setupId);
                const currentConfig = this.appState.currentApplicationConfig.value;
                yield this.appState.updateApplicationConfig({
                    setup: uniq([...(currentConfig.setupDone || []), ...doneSetup])
                });
            }
            catch (ex) {
                this.alert.addServerFailure(ex);
                this.currentSetupState = SetupState.WIZARD;
            }
            finally {
                this.currentSetupState = SetupState.RELOADING;
                // To ensure proper setup, we reload the app when setup is ready.
                setTimeout(() => this.reloadApp(), this.RELOAD_APP_TIMEOUT);
            }
        });
    }
    /**
     * Verifies every step and checks if all required are completed.
     * Updates the icons to reflect the state of the steps (error, warning, done).
     * @returns Returns true if no error was found.
     */
    verify() {
        this.steps.forEach((step, index) => {
            if (this.steps.length - 1 !== index) {
                step.state = this.getState(step);
            }
        });
        return !!this.steps.find(step => step.state !== 'error');
    }
    reloadApp() {
        const removeUrlParams = location.href.split('?')[0];
        const removedHash = removeUrlParams.split('#')[0];
        location.href = removedHash;
    }
    hasRequiredSteps(notCompletedSetupSteps) {
        return notCompletedSetupSteps.some(step => step.required);
    }
    getState(step) {
        if (!step.completed && step.required) {
            return 'error';
        }
        if (!step.completed && !step.required) {
            return 'warning';
        }
        return 'done';
    }
}
SetupComponent.ɵfac = function SetupComponent_Factory(t) { return new (t || SetupComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.OptionsService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.StepperService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.AppStateService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.AlertService), ɵngcc0.ɵɵdirectiveInject(ɵngcc5.Permissions), ɵngcc0.ɵɵdirectiveInject(ɵngcc6.BootstrapComponent)); };
SetupComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: SetupComponent, selectors: [["c8y-setup"]], decls: 6, vars: 7, consts: [["class", "card content-fullpage fadeInRightBig animated", 4, "ngIf"], ["class", "card content-fullpage d-flex d-col fadeInUpBig animated", 4, "ngIf"], [1, "card", "content-fullpage", "fadeInRightBig", "animated"], [1, "d-contents", 3, "showDefaultButtons", "steps"], [1, "card", "content-fullpage", "d-flex", "d-col", "fadeInUpBig", "animated"], [1, "inner-scroll", "flex-grow"], [1, "card-block"], [1, "row"], [1, "col-md-8", "col-md-offset-2", "col-lg-6", "col-lg-offset-3", "p-t-24"], ["viewBox", "0 0 360 190", 1, "p-t-32", 2, "max-width", "450px", "margin", "auto"], ["id", "ecosystem-welcome-illustration", "stroke", "none", "stroke-width", "1", "fill", "none", "fill-rule", "evenodd"], ["id", "medium-img"], ["id", "M---Nothing-found---illustration", "transform", "translate(27.000000, 0.000000)"], ["d", "M41.9882163,184.153177 C24.3512964,165.028818 14.796713,138.637202 18.0717117,113.128248 C21.3467105,87.6192947 38.0071399,63.7138452 61.8485298,52.9453596 C71.0829585,49.0513414 80.8096047,46.3893689 90.76767,45.0308169 C98.489456,43.8098001 118.605159,43.8098001 134.379236,43.8098001 C145.406066,43.8098001 181.235754,38.969866 207.015103,16.5355211 C213.745375,10.6511027 239.269332,-7.69357146 271.478495,5.11974949 C293.036399,13.6962892 308.780431,29.0693321 312.911736,38.3078689 C331.314825,79.4105311 320.017582,129.634042 291.233648,164.558065 C285.720232,171.251591 279.470694,177.592051 271.70384,181.608167 C268.726702,182.834918 265.624451,183.747258 262.449715,184.32971 L41.9882163,184.153177 Z", "id", "Path", "fill", "#CDE6F9", "fill-rule", "nonzero"], ["id", "Oval", "fill", "#5FAEEC", "fill-rule", "nonzero", "cx", "28.1633729", "cy", "162.880435", "rx", "2.68222598", "ry", "2.68115941"], ["id", "Oval", "fill", "#5FAEEC", "fill-rule", "nonzero", "cx", "65.7145367", "cy", "65.6884059", "rx", "4.02333899", "ry", "3.35144928"], ["id", "Group", "opacity", "0.8", "transform", "translate(8.046677, 16.757247)", "fill", "#7BCAEF", "fill-rule", "nonzero"], ["d", "M12.8344513,8.04347826 L2.50788129,8.04347826 C1.90488763,8.22105727 1.25665804,7.99364432 0.892621563,7.47681021 C0.528585083,6.95997611 0.528585083,6.26707703 0.892621563,5.75024293 C1.25665804,5.23340882 1.90488763,5.00599587 2.50788129,5.18357488 L12.8344513,5.18357488 C13.437445,5.00599587 14.0856746,5.23340882 14.4497111,5.75024293 C14.8137476,6.26707703 14.8137476,6.95997611 14.4497111,7.47681021 C14.0856746,7.99364432 13.437445,8.22105727 12.8344513,8.04347826 Z", "id", "Path"], ["d", "M7.64166184,13.2866345 C6.82691795,13.2866345 6.16643754,12.6197478 6.16643754,11.7971014 L6.16643754,1.37037037 C6.35002101,0.734836286 6.92699763,0.297906603 7.58265287,0.297906603 C8.2383081,0.297906603 8.81528471,0.734836286 8.99888356,1.37037037 L8.99888356,11.7971014 C9.00133839,12.5753731 8.40999101,13.2243764 7.64166184,13.2866345 Z", "id", "Path"], ["id", "Oval", "fill", "#5FAEEC", "fill-rule", "nonzero", "cx", "2.68222598", "cy", "90.4891305", "rx", "2.68222598", "ry", "2.68115941"], ["id", "Oval", "fill", "#5FAEEC", "fill-rule", "nonzero", "cx", "257.493695", "cy", "157.518116", "rx", "2.68222598", "ry", "2.68115941"], ["id", "Oval", "fill", "#14629F", "fill-rule", "nonzero", "cx", "299.738754", "cy", "155.507247", "rx", "2.01166949", "ry", "2.01086957"], ["id", "Oval", "fill", "#96CAF3", "fill-rule", "nonzero", "cx", "260.175921", "cy", "59.6557971", "rx", "2.68222598", "ry", "2.68115941"], ["id", "Oval", "stroke", "#5FAEEC", "stroke-width", "2", "stroke-linecap", "round", "stroke-linejoin", "round", "cx", "329.913796", "cy", "111.938406", "rx", "2.68222598", "ry", "2.68115941"], ["id", "Oval", "stroke", "#96CAF3", "cx", "95.2190226", "cy", "144.782609", "rx", "4.02333899", "ry", "3.35144928"], ["id", "Group", "opacity", "0.6", "transform", "translate(273.587050, 121.322464)", "fill", "#14629F", "fill-rule", "nonzero"], ["d", "M12.1263437,8.01368761 L1.79977363,8.01368761 C1.17034461,7.82832349 0.737612147,7.24575058 0.737612147,6.5837359 C0.737612147,5.92172124 1.17034461,5.33914833 1.79977363,5.15378421 L12.1263437,5.15378421 C12.7293374,4.97620521 13.3775669,5.20361817 13.7416034,5.72045226 C14.1056399,6.23728637 14.1056399,6.93018545 13.7416034,7.44701956 C13.3775669,7.96385365 12.7293374,8.19126661 12.1263437,8.01368761 L12.1263437,8.01368761 Z", "id", "Path"], ["d", "M6.94830642,13.2419485 C6.13356254,13.2419485 5.47308212,12.5750618 5.47308212,11.7524155 L5.47308212,1.32568438 C5.6566656,0.690150295 6.23364221,0.253220612 6.88929744,0.253220612 C7.54495269,0.253220612 8.1219293,0.690150295 8.30552815,1.32568438 L8.30552815,11.7524155 C8.30798297,12.5306871 7.71663558,13.1796904 6.94830642,13.2419485 Z", "id", "Path"], ["id", "Rectangle", "fill", "#5FAEEC", "fill-rule", "nonzero", "x", "107.28904", "y", "128.025362", "width", "109.971265", "height", "48.2608695"], ["id", "Path", "fill", "#5FAEEC", "fill-rule", "nonzero", "points", "205.744516 91.8297102 121.555988 91.8297102 107.28904 129.365942 217.260306 129.365942"], ["id", "Path", "fill", "#5FAEEC", "fill-rule", "nonzero", "points", "93.8779095 114.917472 103.478057 98.5326086 118.017943 121.471417 107.035845 128.025362"], ["id", "Path", "fill", "#5FAEEC", "fill-rule", "nonzero", "points", "209.213627 123.316736 216.813268 129.365942 232.012548 114.683402 221.373051 98.5326086"], ["id", "Path", "fill", "#96CAF3", "fill-rule", "nonzero", "points", "214.884986 105.235507 111.648803 105.235507 107.28904 129.365942 217.260306 129.365942"], ["d", "M91.6761446,30.3423163 C92.3222173,30.3423163 92.8459628,30.8537275 92.8459628,31.4845853 C92.8459628,32.1154431 92.3222173,32.6268545 91.6761446,32.6268545 C91.0300718,32.6268545 90.5063264,32.1154431 90.5063264,31.4845853 C90.5289441,30.8631053 91.0396757,30.3644014 91.6761446,30.3423163 Z M91.8662401,24.6309708 C92.4940745,24.6065819 93.1037929,24.8394323 93.5480901,25.2732662 C93.9923872,25.7071004 94.2308535,26.30246 94.2058764,26.9155089 L94.2058764,27.5152002 L89.5266036,27.5152002 L89.5266036,26.9155089 C89.4960305,26.2895723 89.7404154,25.6806341 90.1983788,25.2416359 C90.6563421,24.8026375 91.2843716,24.5752894 91.924731,24.6166924 L91.8662401,24.6309708 Z M91.8662401,23.4744232 C90.9292048,23.466734 90.0282593,23.8268063 89.3656519,24.4738094 C88.7030445,25.1208125 88.3342881,26.0005407 88.3421627,26.9155089 L88.3421627,27.5152002 L87.1723446,27.5152002 L87.1723446,35.5253623 L96.5601355,35.5253623 L96.5601355,27.5009219 L95.3903173,27.5009219 L95.3903173,26.9012306 C95.3981063,25.9961621 95.037351,25.1251451 94.3874206,24.4798095 C93.7374901,23.8344738 92.8516283,23.4676871 91.924731,23.460145 L91.8662401,23.4744232 Z", "id", "Shape", "fill", "#5FAEEC", "fill-rule", "nonzero"], ["d", "M254.811469,24.8007247 L248.113249,12.7355072 L241.400339,24.8007247 L254.811469,24.8007247 Z M248.7155,22.7874058 L247.466929,22.7874058 L247.466929,21.6411367 L248.671434,21.6411367 L248.7155,22.7874058 Z M248.7155,20.5095632 L247.466929,20.5095632 L247.466929,17.5704117 L248.671434,17.5704117 L248.7155,20.5095632 Z", "id", "Shape", "fill", "#5FAEEC", "fill-rule", "nonzero"], ["x1", "201.166949", "y1", "40.8876812", "x2", "187.755818", "y2", "60.9963769", "id", "Path", "stroke", "#5FAEEC", "stroke-width", "2", "stroke-linecap", "round", "stroke-linejoin", "round"], ["x1", "165.969438", "y1", "31.5036231", "x2", "165.285471", "y2", "55.6340579", "id", "Path", "stroke", "#5FAEEC", "stroke-width", "2", "stroke-linecap", "round", "stroke-linejoin", "round"], ["x1", "130.08796", "y1", "44.9094203", "x2", "146.181316", "y2", "63.6775362", "id", "Path", "stroke", "#5FAEEC", "stroke-width", "2", "stroke-linecap", "round", "stroke-linejoin", "round"], ["id", "Fill-56", "fill", "#A5D1FE", "fill-rule", "nonzero", "points", "0 185 335 185 335 175 0 175"], ["translate", "", 1, "p-t-16", "p-b-16", "text-center", "text-medium", 3, "translateParams"], ["class", "lead text-normal", "translate", "", 4, "ngIf"], ["class", "flex-grow", 4, "ngIf"], ["class", "alert alert-danger m-32", 4, "ngIf"], [1, "card-footer", "separator", "d-flex", "j-c-center"], ["class", "btn", "translate", "", 3, "title", "click", 4, "ngIf"], ["translate", "", 1, "btn", "btn-primary", 3, "disabled", "title", "click"], ["translate", "", 1, "lead", "text-normal"], [1, "flex-grow"], ["icon", "info", 3, "properties", "data", "title"], [1, "alert", "alert-danger", "m-32"], ["translate", ""], ["translate", "", 1, "btn", 3, "title", "click"]], template: function SetupComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "c8y-title");
        ɵngcc0.ɵɵtext(1);
        ɵngcc0.ɵɵpipe(2, "async");
        ɵngcc0.ɵɵpipe(3, "humanizeAppName");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(4, SetupComponent_div_4_Template, 2, 2, "div", 0);
        ɵngcc0.ɵɵtemplate(5, SetupComponent_div_5_Template, 48, 16, "div", 1);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(2, 3, ɵngcc0.ɵɵpipeBind1(3, 5, ctx.options.name)), "\n");
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngIf", ctx.currentSetupState !== ctx.setupState.START);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.currentSetupState === ctx.setupState.START);
    } }, directives: [ɵngcc7.TitleComponent, ɵngcc8.NgIf, ɵngcc9.StepperOutletComponent, ɵngcc10.C8yTranslateDirective, ɵngcc11.PropertiesListComponent], pipes: [ɵngcc8.AsyncPipe, ɵngcc12.HumanizeAppNamePipe, ɵngcc13.C8yTranslatePipe], encapsulation: 2 });
SetupComponent.ctorParameters = () => [
    { type: OptionsService },
    { type: StepperService },
    { type: AppStateService },
    { type: AlertService },
    { type: Permissions },
    { type: BootstrapComponent }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(SetupComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-setup',
                template: "<c8y-title>\n  {{ options.name | humanizeAppName | async }}\n</c8y-title>\n\n<div\n  class=\"card content-fullpage fadeInRightBig animated\"\n  *ngIf=\"currentSetupState !== setupState.START\"\n>\n  <c8y-stepper-outlet\n    [showDefaultButtons]=\"false\"\n    [steps]=\"steps\"\n    class=\"d-contents\"\n  ></c8y-stepper-outlet>\n</div>\n\n<div\n  class=\"card content-fullpage d-flex d-col fadeInUpBig animated\"\n  *ngIf=\"currentSetupState === setupState.START\"\n>\n  <div class=\"inner-scroll flex-grow\">\n    <div class=\"card-block\">\n      <div class=\"row\">\n        <div class=\"col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3 p-t-24\">\n          <svg class=\"p-t-32\" viewBox=\"0 0 360 190\" style=\"max-width: 450px; margin: auto\">\n            <g\n              id=\"ecosystem-welcome-illustration\"\n              stroke=\"none\"\n              stroke-width=\"1\"\n              fill=\"none\"\n              fill-rule=\"evenodd\"\n            >\n              <g id=\"medium-img\">\n                <g id=\"M---Nothing-found---illustration\" transform=\"translate(27.000000, 0.000000)\">\n                  <path\n                    d=\"M41.9882163,184.153177 C24.3512964,165.028818 14.796713,138.637202 18.0717117,113.128248 C21.3467105,87.6192947 38.0071399,63.7138452 61.8485298,52.9453596 C71.0829585,49.0513414 80.8096047,46.3893689 90.76767,45.0308169 C98.489456,43.8098001 118.605159,43.8098001 134.379236,43.8098001 C145.406066,43.8098001 181.235754,38.969866 207.015103,16.5355211 C213.745375,10.6511027 239.269332,-7.69357146 271.478495,5.11974949 C293.036399,13.6962892 308.780431,29.0693321 312.911736,38.3078689 C331.314825,79.4105311 320.017582,129.634042 291.233648,164.558065 C285.720232,171.251591 279.470694,177.592051 271.70384,181.608167 C268.726702,182.834918 265.624451,183.747258 262.449715,184.32971 L41.9882163,184.153177 Z\"\n                    id=\"Path\"\n                    fill=\"#CDE6F9\"\n                    fill-rule=\"nonzero\"\n                  ></path>\n                  <ellipse\n                    id=\"Oval\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                    cx=\"28.1633729\"\n                    cy=\"162.880435\"\n                    rx=\"2.68222598\"\n                    ry=\"2.68115941\"\n                  ></ellipse>\n                  <ellipse\n                    id=\"Oval\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                    cx=\"65.7145367\"\n                    cy=\"65.6884059\"\n                    rx=\"4.02333899\"\n                    ry=\"3.35144928\"\n                  ></ellipse>\n                  <g\n                    id=\"Group\"\n                    opacity=\"0.8\"\n                    transform=\"translate(8.046677, 16.757247)\"\n                    fill=\"#7BCAEF\"\n                    fill-rule=\"nonzero\"\n                  >\n                    <path\n                      d=\"M12.8344513,8.04347826 L2.50788129,8.04347826 C1.90488763,8.22105727 1.25665804,7.99364432 0.892621563,7.47681021 C0.528585083,6.95997611 0.528585083,6.26707703 0.892621563,5.75024293 C1.25665804,5.23340882 1.90488763,5.00599587 2.50788129,5.18357488 L12.8344513,5.18357488 C13.437445,5.00599587 14.0856746,5.23340882 14.4497111,5.75024293 C14.8137476,6.26707703 14.8137476,6.95997611 14.4497111,7.47681021 C14.0856746,7.99364432 13.437445,8.22105727 12.8344513,8.04347826 Z\"\n                      id=\"Path\"\n                    ></path>\n                    <path\n                      d=\"M7.64166184,13.2866345 C6.82691795,13.2866345 6.16643754,12.6197478 6.16643754,11.7971014 L6.16643754,1.37037037 C6.35002101,0.734836286 6.92699763,0.297906603 7.58265287,0.297906603 C8.2383081,0.297906603 8.81528471,0.734836286 8.99888356,1.37037037 L8.99888356,11.7971014 C9.00133839,12.5753731 8.40999101,13.2243764 7.64166184,13.2866345 Z\"\n                      id=\"Path\"\n                    ></path>\n                  </g>\n                  <ellipse\n                    id=\"Oval\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                    cx=\"2.68222598\"\n                    cy=\"90.4891305\"\n                    rx=\"2.68222598\"\n                    ry=\"2.68115941\"\n                  ></ellipse>\n                  <ellipse\n                    id=\"Oval\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                    cx=\"257.493695\"\n                    cy=\"157.518116\"\n                    rx=\"2.68222598\"\n                    ry=\"2.68115941\"\n                  ></ellipse>\n                  <ellipse\n                    id=\"Oval\"\n                    fill=\"#14629F\"\n                    fill-rule=\"nonzero\"\n                    cx=\"299.738754\"\n                    cy=\"155.507247\"\n                    rx=\"2.01166949\"\n                    ry=\"2.01086957\"\n                  ></ellipse>\n                  <ellipse\n                    id=\"Oval\"\n                    fill=\"#96CAF3\"\n                    fill-rule=\"nonzero\"\n                    cx=\"260.175921\"\n                    cy=\"59.6557971\"\n                    rx=\"2.68222598\"\n                    ry=\"2.68115941\"\n                  ></ellipse>\n                  <ellipse\n                    id=\"Oval\"\n                    stroke=\"#5FAEEC\"\n                    stroke-width=\"2\"\n                    stroke-linecap=\"round\"\n                    stroke-linejoin=\"round\"\n                    cx=\"329.913796\"\n                    cy=\"111.938406\"\n                    rx=\"2.68222598\"\n                    ry=\"2.68115941\"\n                  ></ellipse>\n                  <ellipse\n                    id=\"Oval\"\n                    stroke=\"#96CAF3\"\n                    cx=\"95.2190226\"\n                    cy=\"144.782609\"\n                    rx=\"4.02333899\"\n                    ry=\"3.35144928\"\n                  ></ellipse>\n                  <g\n                    id=\"Group\"\n                    opacity=\"0.6\"\n                    transform=\"translate(273.587050, 121.322464)\"\n                    fill=\"#14629F\"\n                    fill-rule=\"nonzero\"\n                  >\n                    <path\n                      d=\"M12.1263437,8.01368761 L1.79977363,8.01368761 C1.17034461,7.82832349 0.737612147,7.24575058 0.737612147,6.5837359 C0.737612147,5.92172124 1.17034461,5.33914833 1.79977363,5.15378421 L12.1263437,5.15378421 C12.7293374,4.97620521 13.3775669,5.20361817 13.7416034,5.72045226 C14.1056399,6.23728637 14.1056399,6.93018545 13.7416034,7.44701956 C13.3775669,7.96385365 12.7293374,8.19126661 12.1263437,8.01368761 L12.1263437,8.01368761 Z\"\n                      id=\"Path\"\n                    ></path>\n                    <path\n                      d=\"M6.94830642,13.2419485 C6.13356254,13.2419485 5.47308212,12.5750618 5.47308212,11.7524155 L5.47308212,1.32568438 C5.6566656,0.690150295 6.23364221,0.253220612 6.88929744,0.253220612 C7.54495269,0.253220612 8.1219293,0.690150295 8.30552815,1.32568438 L8.30552815,11.7524155 C8.30798297,12.5306871 7.71663558,13.1796904 6.94830642,13.2419485 Z\"\n                      id=\"Path\"\n                    ></path>\n                  </g>\n                  <rect\n                    id=\"Rectangle\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                    x=\"107.28904\"\n                    y=\"128.025362\"\n                    width=\"109.971265\"\n                    height=\"48.2608695\"\n                  ></rect>\n                  <polygon\n                    id=\"Path\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                    points=\"205.744516 91.8297102 121.555988 91.8297102 107.28904 129.365942 217.260306 129.365942\"\n                  ></polygon>\n                  <polygon\n                    id=\"Path\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                    points=\"93.8779095 114.917472 103.478057 98.5326086 118.017943 121.471417 107.035845 128.025362\"\n                  ></polygon>\n                  <polygon\n                    id=\"Path\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                    points=\"209.213627 123.316736 216.813268 129.365942 232.012548 114.683402 221.373051 98.5326086\"\n                  ></polygon>\n                  <polygon\n                    id=\"Path\"\n                    fill=\"#96CAF3\"\n                    fill-rule=\"nonzero\"\n                    points=\"214.884986 105.235507 111.648803 105.235507 107.28904 129.365942 217.260306 129.365942\"\n                  ></polygon>\n                  <path\n                    d=\"M91.6761446,30.3423163 C92.3222173,30.3423163 92.8459628,30.8537275 92.8459628,31.4845853 C92.8459628,32.1154431 92.3222173,32.6268545 91.6761446,32.6268545 C91.0300718,32.6268545 90.5063264,32.1154431 90.5063264,31.4845853 C90.5289441,30.8631053 91.0396757,30.3644014 91.6761446,30.3423163 Z M91.8662401,24.6309708 C92.4940745,24.6065819 93.1037929,24.8394323 93.5480901,25.2732662 C93.9923872,25.7071004 94.2308535,26.30246 94.2058764,26.9155089 L94.2058764,27.5152002 L89.5266036,27.5152002 L89.5266036,26.9155089 C89.4960305,26.2895723 89.7404154,25.6806341 90.1983788,25.2416359 C90.6563421,24.8026375 91.2843716,24.5752894 91.924731,24.6166924 L91.8662401,24.6309708 Z M91.8662401,23.4744232 C90.9292048,23.466734 90.0282593,23.8268063 89.3656519,24.4738094 C88.7030445,25.1208125 88.3342881,26.0005407 88.3421627,26.9155089 L88.3421627,27.5152002 L87.1723446,27.5152002 L87.1723446,35.5253623 L96.5601355,35.5253623 L96.5601355,27.5009219 L95.3903173,27.5009219 L95.3903173,26.9012306 C95.3981063,25.9961621 95.037351,25.1251451 94.3874206,24.4798095 C93.7374901,23.8344738 92.8516283,23.4676871 91.924731,23.460145 L91.8662401,23.4744232 Z\"\n                    id=\"Shape\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                  ></path>\n                  <path\n                    d=\"M254.811469,24.8007247 L248.113249,12.7355072 L241.400339,24.8007247 L254.811469,24.8007247 Z M248.7155,22.7874058 L247.466929,22.7874058 L247.466929,21.6411367 L248.671434,21.6411367 L248.7155,22.7874058 Z M248.7155,20.5095632 L247.466929,20.5095632 L247.466929,17.5704117 L248.671434,17.5704117 L248.7155,20.5095632 Z\"\n                    id=\"Shape\"\n                    fill=\"#5FAEEC\"\n                    fill-rule=\"nonzero\"\n                  ></path>\n                  <line\n                    x1=\"201.166949\"\n                    y1=\"40.8876812\"\n                    x2=\"187.755818\"\n                    y2=\"60.9963769\"\n                    id=\"Path\"\n                    stroke=\"#5FAEEC\"\n                    stroke-width=\"2\"\n                    stroke-linecap=\"round\"\n                    stroke-linejoin=\"round\"\n                  ></line>\n                  <line\n                    x1=\"165.969438\"\n                    y1=\"31.5036231\"\n                    x2=\"165.285471\"\n                    y2=\"55.6340579\"\n                    id=\"Path\"\n                    stroke=\"#5FAEEC\"\n                    stroke-width=\"2\"\n                    stroke-linecap=\"round\"\n                    stroke-linejoin=\"round\"\n                  ></line>\n                  <line\n                    x1=\"130.08796\"\n                    y1=\"44.9094203\"\n                    x2=\"146.181316\"\n                    y2=\"63.6775362\"\n                    id=\"Path\"\n                    stroke=\"#5FAEEC\"\n                    stroke-width=\"2\"\n                    stroke-linecap=\"round\"\n                    stroke-linejoin=\"round\"\n                  ></line>\n                </g>\n                <polygon\n                  id=\"Fill-56\"\n                  fill=\"#A5D1FE\"\n                  fill-rule=\"nonzero\"\n                  points=\"0 185 335 185 335 175 0 175\"\n                ></polygon>\n              </g>\n            </g>\n          </svg>\n          <h1\n            class=\"p-t-16 p-b-16 text-center text-medium\"\n            ngNonBindable\n            translate\n            [translateParams]=\"{ appName: options.name | humanizeAppName | async }\"\n          >\n            Welcome to {{ appName }}\n          </h1>\n          <p class=\"lead text-normal\" translate *ngIf=\"hasRole\">\n            This application (or any plugin that you added recently) has pre-requirements that needs\n            to be configured first. This wizard will guide you through the steps that are necessary\n            to get your application up and running.\n          </p>\n          <div class=\"flex-grow\" *ngIf=\"properties.length > 0\">\n            <c8y-properties-list\n              icon=\"info\"\n              [properties]=\"properties\"\n              [data]=\"options\"\n              [title]=\"'Application properties' | translate\"\n            ></c8y-properties-list>\n          </div>\n          <div class=\"alert alert-danger m-32\" *ngIf=\"!hasRole\">\n            <strong translate>No permission</strong>\n            <div translate>\n              You don't have sufficient rights to setup this application. Please contact an\n              application administrator to setup the required steps.\n            </div>\n          </div>\n          <div class=\"alert alert-danger m-32\" *ngIf=\"!isOwner\">\n            <strong translate>Not the owner</strong>\n            <div translate>\n              The current application is not owned by this tenant. Please clone the application\n              before running the setup.\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class=\"card-footer separator d-flex j-c-center\">\n    <button\n      class=\"btn\"\n      (click)=\"skip()\"\n      translate\n      *ngIf=\"canSkip\"\n      [title]=\"\n        'You can skip the setup now. It will be shown again as soon as you restart the application.'\n          | translate\n      \"\n    >\n      Skip\n    </button>\n\n    <button\n      class=\"btn btn-primary\"\n      (click)=\"start()\"\n      translate\n      [disabled]=\"!hasRole || !isOwner\"\n      [title]=\"'Start the setup wizard.' | translate\"\n    >\n      Start\n    </button>\n  </div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.OptionsService }, { type: ɵngcc2.StepperService }, { type: ɵngcc3.AppStateService }, { type: ɵngcc4.AlertService }, { type: ɵngcc5.Permissions }, { type: ɵngcc6.BootstrapComponent }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2V0dXAuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9jb3JlL3NldHVwL3NldHVwLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUNsRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2pDLE9BQU8sRUFBRSxlQUFlLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2RCxPQUFPLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDM0MsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLHdCQUF3QixDQUFDO0FBQ3RELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSwrQkFBK0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsY0FBYyxFQUFFLE1BQU0sMkJBQTJCLENBQUM7QUFDM0QsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzdELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUMxQyxPQUFPLEVBQWUsUUFBUSxFQUFFLE1BQU0sMEJBQTBCLENBQUM7QUFDakUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzVELE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxVQUFVLEVBQWEsTUFBTSxlQUFlLENBQUM7QUFDN0UsT0FBTyxFQUFFLGtCQUFrQixFQUFFLE1BQU0sa0NBQWtDLENBQUM7QUFFdEU7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUtILE1BQU0sT0FB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LFlBSGxCLGVBQWU7QUFBSSxZQUhuQixZQUFZO0FBQUksWUFDaEIsV0FBVztBQUFJLFlBT2Ysa0JBQWtCO0FBQUc7Ozs7O3NxSUFRUyxjQUN0Qzs7b1BBVCtCO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdW5pcSB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBCZWhhdmlvclN1YmplY3QsIE9ic2VydmFibGUsIG9mIH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBzdGFydFdpdGggfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBBbGVydFNlcnZpY2UgfSBmcm9tICcuLi9hbGVydC9hbGVydC5zZXJ2aWNlJztcbmltcG9ydCB7IFBlcm1pc3Npb25zIH0gZnJvbSAnLi4vY29tbW9uL3Blcm1pc3Npb25zLnNlcnZpY2UnO1xuaW1wb3J0IHsgT3B0aW9uc1NlcnZpY2UgfSBmcm9tICcuLi9jb21tb24vb3B0aW9ucy5zZXJ2aWNlJztcbmltcG9ydCB7IEFwcFN0YXRlU2VydmljZSB9IGZyb20gJy4uL2NvbW1vbi91aS1zdGF0ZS5zZXJ2aWNlJztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICcuLi9pMThuL2dldHRleHQnO1xuaW1wb3J0IHsgSW5kZXhlZFN0ZXAsIFN0ZXBwZXJzIH0gZnJvbSAnLi4vc3RlcHBlci9zdGVwcGVyLm1vZGVsJztcbmltcG9ydCB7IFN0ZXBwZXJTZXJ2aWNlIH0gZnJvbSAnLi4vc3RlcHBlci9zdGVwcGVyLnNlcnZpY2UnO1xuaW1wb3J0IHsgTkVFREVEX1JPTEVfRk9SX1NFVFVQLCBTZXR1cFN0YXRlLCBTZXR1cFN0ZXAgfSBmcm9tICcuL3NldHVwLm1vZGVsJztcbmltcG9ydCB7IEJvb3RzdHJhcENvbXBvbmVudCB9IGZyb20gJy4uL2Jvb3RzdHJhcC9ib290c3RyYXAuY29tcG9uZW50JztcblxuLyoqXG4gKiBUaGlzIGNvbXBvbmVudCBpcyB0aGUgcGFyZW50IG9mIGVhY2ggc2V0dXAgYW5kIGNhbiBiZSBpbmplY3RlZFxuICogaW50byBzZXR1cCBzdGVwcyB0byBjb250cm9sIHRoZW0uXG4gKi9cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1zZXR1cCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9zZXR1cC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgU2V0dXBDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQge1xuICAvKipcbiAgICogQSBzdWJqZWN0IHdoaWNoIGNhbiBiZSB1c2VkIHRvIGV4Y2hhbmdlIGRhdGEgYmV0d2VlblxuICAgKiBzdGVwcy5cbiAgICovXG4gIGRhdGEkID0gbmV3IEJlaGF2aW9yU3ViamVjdDxhbnk+KHt9KTtcbiAgLyoqXG4gICAqIEFsbCBjdXJyZW50IHNob3duIHNldHVwIHN0ZXBzLlxuICAgKi9cbiAgc3RlcHM6IFNldHVwU3RlcFtdO1xuICAvKipcbiAgICogVGhlIGN1cnJlbnQgc3RhdGUuIFNldHVwU3RhdGUuU1RBUlQgc2hvd3MgYW4gYXBwbGljYXRpb24gb3ZlcnZpZXdcbiAgICogd2hpbGUgU2V0dXBTdGF0ZS5XSVpBUkQgc2hvd3MgdGhlIHN0ZXBzLlxuICAgKi9cbiAgY3VycmVudFNldHVwU3RhdGUgPSBTZXR1cFN0YXRlLlNUQVJUO1xuICAvKipcbiAgICogRW1pdHMgd2hlbiB0aGUgc2V0dXAgaXMgZG9uZS4gWW91IGNhbiBhZGQgY2VydGFpbiBvcGVyYXRpb25zIGJlZm9yZSBjb21wbGV0aW5nIHRoZSBzZXR1cCB0aGF0IG5lZWRlZCB0byBiZSBhd2FpdGVkLiBSZXR1cm5cbiAgICogdHJ1ZSBpZiBldmVyeXRoaW5nIGlzIGZpbmUsIG90aGVyd2lzZSBmYWxzZS5cbiAgICogYGBgdHlwZXNjcmlwdFxuICAgKiBjb25zdCBhc3luY09wZXJhdGlvbiA9IGRlbGF5KDIwMDApO1xuICAgKiB0aGlzLnNldHVwLmNvbXBsZXRlZCQgPSB0aGlzLnNldHVwLmNvbXBsZXRlZCQucGlwZShhc3luY09wZXJhdGlvbiwgbWFwKCgpID0+IHRydWUpKTtcbiAgICogYGBcbiAgICogTm90ZTogUmVtZW1iZXIgdGhhdCBhIHN0ZXAgY2FuIGJlIHZpZXdlZCBtdWx0aXBsZSB0aW1lcy4gVGhlIHN0ZXAgbmVlZHMgdG8gZW5zdXJlLCB0byBvbmx5IGFkZCBhIGNvbXBsZXRlZCBvcGVyYXRpb24gb25lcy5cbiAgICovXG4gIGNvbXBsZXRlZCQgPSBuZXcgT2JzZXJ2YWJsZTxib29sZWFuPigpLnBpcGUoc3RhcnRXaXRoKHRydWUpKTtcbiAgLyoqXG4gICAqIEBpZ25vcmVcbiAgICovXG4gIHJlYWRvbmx5IHN0ZXBwZXJJZCA9IFN0ZXBwZXJzLlNFVFVQO1xuICAvKipcbiAgICogQGlnbm9yZVxuICAgKi9cbiAgc2V0dXBTdGF0ZSA9IFNldHVwU3RhdGU7XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBwcm9wZXJ0aWVzID0gW107XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBjYW5Ta2lwID0gZmFsc2U7XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBoYXNSb2xlID0gZmFsc2U7XG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBpc093bmVyID0gdHJ1ZTtcblxuICBwcml2YXRlIHJlYWRvbmx5IFJFTE9BRF9BUFBfVElNRU9VVCA9IDIwMDA7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIG9wdGlvbnM6IE9wdGlvbnNTZXJ2aWNlLFxuICAgIHByaXZhdGUgc3RlcHBlclNlcnZpY2U6IFN0ZXBwZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgYXBwU3RhdGU6IEFwcFN0YXRlU2VydmljZSxcbiAgICBwcml2YXRlIGFsZXJ0OiBBbGVydFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBwZXJtaXNzaW9uczogUGVybWlzc2lvbnMsXG4gICAgcHJpdmF0ZSBib290c3RyYXBDb21wb25lbnQ6IEJvb3RzdHJhcENvbXBvbmVudFxuICApIHt9XG5cbiAgLyoqXG4gICAqIE1hcmsgYSBzdGVwIGFzIGNvbXBsZXRlZC4gSWYgdGhlIHN0ZXAgaXMgcmVxdWlyZWQsIHRoaXMgaXMgbmVlZGVkIHRvIGZ1bGZpbGxcbiAgICogdGhlIHNldHVwLlxuICAgKiBAcGFyYW0gc3RlcEluZGV4IFRoZSBpbmRleCBvZiB0aGUgc3RlcCB5b3Ugd2FudCB0byBtYXJrIGFzIGNvbXBsZXRlZFxuICAgKiBAcGFyYW0gaXNDb21wbGV0ZWQgRGVmYXVsdHMgdG8gdHJ1ZSB0byBtYXJrIGl0IGFzIGNvbXBsZXRlZCBidXQgY2FuIGJlIHNldCB0byBmYWxzZSB0byBpbnZhbGlkYXRlIHRoZSBzdGVwLlxuICAgKi9cbiAgc3RlcENvbXBsZXRlZChzdGVwSW5kZXgsIGlzQ29tcGxldGVkID0gdHJ1ZSkge1xuICAgIGNvbnN0IHN0ZXAgPSB0aGlzLmdldEJ5SW5kZXgoc3RlcEluZGV4KTtcbiAgICBzdGVwLmNvbXBsZXRlZCA9IGlzQ29tcGxldGVkO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBzdGVwIGJ5IGl0IGluZGV4IHBvc2l0aW9uIGluIHRoZSB3aXphcmQuXG4gICAqIEBwYXJhbSBzdGVwSW5kZXggVGhlIHN0ZXAgaW5kZXggdGhhdCB5b3Ugd2FudCB0byByZWNlaXZlLlxuICAgKiBAcmV0dXJucyBBbiBpbmRleGVkIHN0ZXAgZGVmaW5pdGlvbi5cbiAgICovXG4gIGdldEJ5SW5kZXgoc3RlcEluZGV4KSB7XG4gICAgcmV0dXJuIHRoaXMuc3RlcHMuZmluZCgoeyBpbmRleCB9KSA9PiBpbmRleCA9PT0gc3RlcEluZGV4KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBAaWdub3JlXG4gICAqL1xuICBhc3luYyBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnN0ZXBzID0gKGF3YWl0IHRoaXMuc3RlcHBlclNlcnZpY2UuZ2V0QnlJZCQodGhpcy5zdGVwcGVySWQpLnRvUHJvbWlzZSgpKS5tYXAoXG4gICAgICAoc3RlcDogU2V0dXBTdGVwLCBpbmRleCkgPT4gKHtcbiAgICAgICAgLi4uc3RlcCxcbiAgICAgICAgaW5kZXgsXG4gICAgICAgIGNvbXBsZXRlZDogZmFsc2VcbiAgICAgIH0pXG4gICAgKTtcblxuICAgIGlmICghdGhpcy5vcHRpb25zLmZvcmNlU2V0dXApIHtcbiAgICAgIGNvbnN0IGRvbmVTZXR1cCA9IHRoaXMub3B0aW9ucy5zZXR1cCB8fCBbXTtcbiAgICAgIHRoaXMuc3RlcHMgPSB0aGlzLnN0ZXBzLmZpbHRlcihzdGVwID0+IGRvbmVTZXR1cC5pbmRleE9mKHN0ZXAuc2V0dXBJZCkgPT09IC0xKTtcbiAgICB9XG5cbiAgICB0aGlzLmlzT3duZXIgPSB0aGlzLmFwcFN0YXRlLmlzT3duZXJPZkFwcGxpY2F0aW9uKCk7XG4gICAgdGhpcy5jYW5Ta2lwID0gIXRoaXMuaGFzUmVxdWlyZWRTdGVwcyh0aGlzLnN0ZXBzKTtcbiAgICB0aGlzLmhhc1JvbGUgPSB0aGlzLnBlcm1pc3Npb25zLmhhc1JvbGUoTkVFREVEX1JPTEVfRk9SX1NFVFVQKTtcbiAgICB0aGlzLnByb3BlcnRpZXMgPSBbXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdEZXNjcmlwdGlvbicpLFxuICAgICAgICBrZXk6ICdkZXNjcmlwdGlvbidcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdLZXl3b3JkcycpLFxuICAgICAgICBrZXk6ICdrZXl3b3JkcydcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdTb3VyY2UnKSxcbiAgICAgICAga2V5OiAncmVwb3NpdG9yeSdcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdWZXJzaW9uJyksXG4gICAgICAgIGtleTogJ3ZlcnNpb24nXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBsYWJlbDogZ2V0dGV4dCgnQXV0aG9yJyksXG4gICAgICAgIGtleTogJ2F1dGhvcidcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdSZXF1aXJlZCBwbGF0Zm9ybSB2ZXJzaW9uJyksXG4gICAgICAgIGtleTogJ3JlcXVpcmVkUGxhdGZvcm1WZXJzaW9uJ1xuICAgICAgfVxuICAgIF07XG4gIH1cblxuICAvKipcbiAgICogU2tpcHMgdGhlIGN1cnJlbnQgc2V0dXAgd2l6YXJkXG4gICAqL1xuICBza2lwKCkge1xuICAgIHRoaXMuYm9vdHN0cmFwQ29tcG9uZW50LmlzU2V0dXBOZWVkZWQkID0gb2YoZmFsc2UpO1xuICB9XG5cbiAgLyoqXG4gICAqIFN0YXJ0cyB0aGUgd2l6YXJkcyAob3IgZmluaXNoIHRoZSBzZXR1cCBpZiBubyBzdGVwcyBhcmUgZm91bmQpXG4gICAqL1xuICBzdGFydCgpIHtcbiAgICB0aGlzLmN1cnJlbnRTZXR1cFN0YXRlID0gU2V0dXBTdGF0ZS5XSVpBUkQ7XG4gIH1cblxuICAvKipcbiAgICogQ2FuY2VscyB0aGUgd2l6YXJkcyBhbmQgZ29lcyBiYWNrIHRvIHRoZSBzdGFydCB2aWV3LlxuICAgKi9cbiAgY2FuY2VsKCkge1xuICAgIHRoaXMuY3VycmVudFNldHVwU3RhdGUgPSBTZXR1cFN0YXRlLlNUQVJUO1xuICB9XG5cbiAgLyoqXG4gICAqIEZpbmlzaCB0aGUgd2l6YXJkIGFuZCB3aWxsIHN0YXJ0IHRoZSBhcHBsaWNhdGlvbi5cbiAgICovXG4gIGZpbmlzaCgpIHtcbiAgICB0aGlzLmN1cnJlbnRTZXR1cFN0YXRlID0gU2V0dXBTdGF0ZS5GSU5BTElaSU5HO1xuICAgIHRoaXMuY29tcGxldGVkJC5zdWJzY3JpYmUoYXN5bmMgc3RhdHVzID0+IHtcbiAgICAgIGlmIChzdGF0dXMpIHtcbiAgICAgICAgdGhpcy5maW5hbGl6ZSgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U2V0dXBTdGF0ZSA9IFNldHVwU3RhdGUuV0laQVJEO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgYXN5bmMgZmluYWxpemUoKSB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGRvbmVTZXR1cCA9IHRoaXMuc3RlcHMuZmlsdGVyKHZhbHVlID0+IHZhbHVlLnNldHVwSWQpLm1hcCh2YWx1ZSA9PiB2YWx1ZS5zZXR1cElkKTtcbiAgICAgIGNvbnN0IGN1cnJlbnRDb25maWcgPSB0aGlzLmFwcFN0YXRlLmN1cnJlbnRBcHBsaWNhdGlvbkNvbmZpZy52YWx1ZTtcbiAgICAgIGF3YWl0IHRoaXMuYXBwU3RhdGUudXBkYXRlQXBwbGljYXRpb25Db25maWcoe1xuICAgICAgICBzZXR1cDogdW5pcShbLi4uKGN1cnJlbnRDb25maWcuc2V0dXBEb25lIHx8IFtdKSwgLi4uZG9uZVNldHVwXSlcbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGV4KSB7XG4gICAgICB0aGlzLmFsZXJ0LmFkZFNlcnZlckZhaWx1cmUoZXgpO1xuICAgICAgdGhpcy5jdXJyZW50U2V0dXBTdGF0ZSA9IFNldHVwU3RhdGUuV0laQVJEO1xuICAgIH0gZmluYWxseSB7XG4gICAgICB0aGlzLmN1cnJlbnRTZXR1cFN0YXRlID0gU2V0dXBTdGF0ZS5SRUxPQURJTkc7XG4gICAgICAvLyBUbyBlbnN1cmUgcHJvcGVyIHNldHVwLCB3ZSByZWxvYWQgdGhlIGFwcCB3aGVuIHNldHVwIGlzIHJlYWR5LlxuICAgICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnJlbG9hZEFwcCgpLCB0aGlzLlJFTE9BRF9BUFBfVElNRU9VVCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWVzIGV2ZXJ5IHN0ZXAgYW5kIGNoZWNrcyBpZiBhbGwgcmVxdWlyZWQgYXJlIGNvbXBsZXRlZC5cbiAgICogVXBkYXRlcyB0aGUgaWNvbnMgdG8gcmVmbGVjdCB0aGUgc3RhdGUgb2YgdGhlIHN0ZXBzIChlcnJvciwgd2FybmluZywgZG9uZSkuXG4gICAqIEByZXR1cm5zIFJldHVybnMgdHJ1ZSBpZiBubyBlcnJvciB3YXMgZm91bmQuXG4gICAqL1xuICB2ZXJpZnkoKSB7XG4gICAgdGhpcy5zdGVwcy5mb3JFYWNoKChzdGVwLCBpbmRleCkgPT4ge1xuICAgICAgaWYgKHRoaXMuc3RlcHMubGVuZ3RoIC0gMSAhPT0gaW5kZXgpIHtcbiAgICAgICAgc3RlcC5zdGF0ZSA9IHRoaXMuZ2V0U3RhdGUoc3RlcCk7XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuICEhdGhpcy5zdGVwcy5maW5kKHN0ZXAgPT4gc3RlcC5zdGF0ZSAhPT0gJ2Vycm9yJyk7XG4gIH1cblxuICBwcml2YXRlIHJlbG9hZEFwcCgpIHtcbiAgICBjb25zdCByZW1vdmVVcmxQYXJhbXMgPSBsb2NhdGlvbi5ocmVmLnNwbGl0KCc/JylbMF07XG4gICAgY29uc3QgcmVtb3ZlZEhhc2ggPSByZW1vdmVVcmxQYXJhbXMuc3BsaXQoJyMnKVswXTtcbiAgICBsb2NhdGlvbi5ocmVmID0gcmVtb3ZlZEhhc2g7XG4gIH1cblxuICBwcml2YXRlIGhhc1JlcXVpcmVkU3RlcHMobm90Q29tcGxldGVkU2V0dXBTdGVwczogU2V0dXBTdGVwW10pOiBib29sZWFuIHtcbiAgICByZXR1cm4gbm90Q29tcGxldGVkU2V0dXBTdGVwcy5zb21lKHN0ZXAgPT4gc3RlcC5yZXF1aXJlZCk7XG4gIH1cblxuICBwcml2YXRlIGdldFN0YXRlKHN0ZXA6IEluZGV4ZWRTdGVwKSB7XG4gICAgaWYgKCFzdGVwLmNvbXBsZXRlZCAmJiBzdGVwLnJlcXVpcmVkKSB7XG4gICAgICByZXR1cm4gJ2Vycm9yJztcbiAgICB9XG4gICAgaWYgKCFzdGVwLmNvbXBsZXRlZCAmJiAhc3RlcC5yZXF1aXJlZCkge1xuICAgICAgcmV0dXJuICd3YXJuaW5nJztcbiAgICB9XG4gICAgcmV0dXJuICdkb25lJztcbiAgfVxufVxuIl19