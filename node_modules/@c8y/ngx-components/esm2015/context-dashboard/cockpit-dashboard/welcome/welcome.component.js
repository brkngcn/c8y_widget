import { __awaiter } from "tslib";
import { Component, Input } from '@angular/core';
import { gettext, DocsService, NavigatorService } from '@c8y/ngx-components';
import { Router } from '@angular/router';
import { TenantService, ApplicationService } from '@c8y/client';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@c8y/client';
import * as ɵngcc2 from '@c8y/ngx-components';
import * as ɵngcc3 from '@angular/router';
import * as ɵngcc4 from '@angular/common';

const _c0 = function (a0) { return { link: a0 }; };
function WelcomeToCockpit_div_10_Template(rf, ctx) { if (rf & 1) {
    const _r3 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 7);
    ɵngcc0.ɵɵelementStart(1, "c8y-quick-link", 8);
    ɵngcc0.ɵɵlistener("click", function WelcomeToCockpit_div_10_Template_c8y_quick_link_click_1_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r3); const link_r1 = restoredCtx.$implicit; return link_r1.click ? link_r1.click() : false; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const link_r1 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("icon", link_r1.icon)("label", link_r1.label)("actionName", "welcomeWidgetClicked")("actionData", ɵngcc0.ɵɵpureFunction1(4, _c0, link_r1.label));
} }
export class WelcomeToCockpit {
    constructor(tenantService, docs, router, navigator, applicationService) {
        this.tenantService = tenantService;
        this.docs = docs;
        this.router = router;
        this.navigator = navigator;
        this.applicationService = applicationService;
        this.quickLinks = [];
        this.CONFIGURATION_NODE = 'Configuration';
        this.TRIAL = 'TRIAL';
    }
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            this.tenantType = yield this.tenantService.currentTenantType();
            this.setMessage();
            this.navSubscription = this.navigator.items$.subscribe(nodes => {
                this.navNodes = nodes;
                this.configurationNode = nodes.find((node) => node.label === this.CONFIGURATION_NODE);
            });
            this.docsSubscription = this.docs.items$.subscribe(links => {
                this.links = links;
            });
            // <---TRIAL & REGULAR TENANT --->
            this.createConnectSmartphoneQuickLink();
            yield this.createQuicklinkRegisterDevice();
            // <--- TRIAL TENANT --->
            if (this.tenantType === this.TRIAL) {
                this.createQuicklinkUserGuide();
                return;
            }
            // <--- REGULAR TENANT --->
            this.createQuicklinkAddGroup();
            this.createQuickLinkReports();
            this.createQuickLinkExports();
            this.createQuicklinkSmartRules();
        });
    }
    ngOnDestroy() {
        if (this.docsSubscription && !this.docsSubscription.closed) {
            this.docsSubscription.unsubscribe();
        }
        if (this.navSubscription && !this.navSubscription.closed) {
            this.navSubscription.unsubscribe();
        }
    }
    setMessage() {
        if (this.tenantType === this.TRIAL) {
            this.welcomeMessage = gettext(`
        The Cockpit application allows you to build IoT applications in minutes.
        To get started, connect any device to the platform.
        If you do not have an IoT device to hand, you can start by connecting your smartphone.
        Click below to be guided through the process.
      `);
        }
        else {
            this.welcomeMessage = gettext(`
        The Cockpit application provides you with options to manage
        and monitor Internet of Things assets and data from business perspective.
      `);
        }
    }
    createQuicklinkAddGroup() {
        // comes from angularJS factory c8yQuickLinks
        const addGroup = this.links.find(link => link.label === 'Add group');
        if (addGroup) {
            this.quickLinks.push(addGroup);
        }
    }
    createConnectSmartphoneQuickLink() {
        // Provider in SensorPhoneModule defines the
        // 'Connect smartphone' quicklink.
        const connectSmartphone = this.links.find(link => link.label === 'Connect smartphone');
        if (connectSmartphone) {
            this.quickLinks.push(connectSmartphone);
        }
    }
    createQuickLinkReports() {
        const label = gettext('Reports');
        const reports = {
            icon: 'th',
            label,
            url: '/reports'
        };
        const reportsNode = this.findNavigatorNode(label, this.navNodes);
        if (reportsNode) {
            reports.click = () => {
                reportsNode.open = true;
                this.router.navigateByUrl(reports.url);
            };
            this.quickLinks.push(reports);
        }
    }
    createQuickLinkExports() {
        const label = gettext('Exports');
        const exports = {
            icon: 'c8y-reports',
            label,
            url: '/export'
        };
        if (this.isConfigChildNodeShown(label)) {
            exports.click = () => {
                this.configurationNode.open = true;
                this.router.navigateByUrl(exports.url);
            };
            this.quickLinks.push(exports);
        }
    }
    createQuicklinkSmartRules() {
        const label = gettext('Smart rules');
        const smartRules = {
            icon: 'c8y-smart-rules',
            label,
            url: '/rules'
        };
        if (this.isConfigChildNodeShown('Global smart rules')) {
            smartRules.click = () => {
                this.configurationNode.open = true;
                this.router.navigateByUrl(smartRules.url);
            };
            this.quickLinks.push(smartRules);
        }
    }
    createQuicklinkRegisterDevice() {
        return __awaiter(this, void 0, void 0, function* () {
            const { data } = yield this.applicationService.listByUser(undefined, { pageSize: 2000 });
            if (data) {
                const deviceManagement = data.find(app => app.contextPath === 'devicemanagement');
                if (deviceManagement) {
                    const deviceMgmtUrl = this.applicationService.getHref(deviceManagement);
                    const registerDevice = {
                        icon: 'c8y-device-connect',
                        label: gettext('Register device'),
                        click: () => window.open(`${deviceMgmtUrl}/#/deviceregistration`, '_self')
                    };
                    this.quickLinks.push(registerDevice);
                }
            }
        });
    }
    createQuicklinkUserGuide() {
        const userGuide = {
            icon: 'c8y-user',
            label: gettext('User guide'),
            url: '/users-guide/getting-started',
            click: () => {
                const userGuideURL = this.docs.getUserGuideLink(userGuide.url);
                window.open(userGuideURL);
            }
        };
        this.quickLinks.push(userGuide);
    }
    isConfigChildNodeShown(nodeName) {
        if (this.configurationNode && this.configurationNode.show) {
            const navNode = this.findNavigatorNode(nodeName, this.configurationNode.children);
            return !!navNode && navNode.show;
        }
        return false;
    }
    findNavigatorNode(nodeName, navNodes) {
        if (navNodes && navNodes.length > 0) {
            return navNodes.find((node) => node.label === nodeName);
        }
        return undefined;
    }
}
WelcomeToCockpit.ɵfac = function WelcomeToCockpit_Factory(t) { return new (t || WelcomeToCockpit)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.TenantService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.DocsService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.NavigatorService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ApplicationService)); };
WelcomeToCockpit.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: WelcomeToCockpit, selectors: [["c8y-welcome-to-cockpit"]], inputs: { config: "config" }, decls: 11, vars: 7, consts: [[1, "welcome-widget", "welcome-cockpit"], [1, "flex-row"], [1, "col-xs-12", "col-md-5", "flex-item-v-stretch", "p-24"], [1, "text-light"], [1, "text-16", "text-light", "p-t-16", "p-b-24"], [1, "card-group", "interact-grid", "tight-grid"], ["class", "col-sm-4 col-xs-6", 4, "ngFor", "ngForOf"], [1, "col-sm-4", "col-xs-6"], ["c8yProductExperience", "", 1, "card", 3, "icon", "label", "actionName", "actionData", "click"]], template: function WelcomeToCockpit_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵelementStart(2, "div", 2);
        ɵngcc0.ɵɵelementStart(3, "h2", 3);
        ɵngcc0.ɵɵtext(4);
        ɵngcc0.ɵɵpipe(5, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "p", 4);
        ɵngcc0.ɵɵtext(7);
        ɵngcc0.ɵɵpipe(8, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(9, "div", 5);
        ɵngcc0.ɵɵtemplate(10, WelcomeToCockpit_div_10_Template, 2, 6, "div", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 3, "Welcome to Cockpit"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(8, 5, ctx.welcomeMessage));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.quickLinks);
    } }, directives: [ɵngcc4.NgForOf, ɵngcc2.QuickLinkComponent, ɵngcc2.ProductExperienceDirective], pipes: [ɵngcc2.C8yTranslatePipe], encapsulation: 2 });
WelcomeToCockpit.ctorParameters = () => [
    { type: TenantService },
    { type: DocsService },
    { type: Router },
    { type: NavigatorService },
    { type: ApplicationService }
];
WelcomeToCockpit.propDecorators = {
    config: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(WelcomeToCockpit, [{
        type: Component,
        args: [{
                selector: 'c8y-welcome-to-cockpit',
                template: "<div class=\"welcome-widget welcome-cockpit\">\n  <div class=\"flex-row\">\n    <div class=\"col-xs-12 col-md-5 flex-item-v-stretch p-24\">\n      <h2 class=\"text-light\">{{ 'Welcome to Cockpit' | translate }}</h2>\n      <p class=\"text-16 text-light p-t-16 p-b-24\">{{ welcomeMessage | translate }}</p>\n      <div class=\"card-group interact-grid tight-grid\">\n        <div *ngFor=\"let link of quickLinks\" class=\"col-sm-4 col-xs-6\">\n          <c8y-quick-link\n            (click)=\"link.click ? link.click() : false\"\n            [icon]=\"link.icon\"\n            [label]=\"link.label\"\n            class=\"card\"\n            c8yProductExperience\n            [actionName]=\"'welcomeWidgetClicked'\"\n            [actionData]=\"{ link: link.label }\"\n          >\n          </c8y-quick-link>\n        </div>\n      </div>\n    </div>\n    <!-- <div class=\"col-sm-6 welcome-illustration flex-item-v-stretch\"></div> -->\n  </div>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.TenantService }, { type: ɵngcc2.DocsService }, { type: ɵngcc3.Router }, { type: ɵngcc2.NavigatorService }, { type: ɵngcc1.ApplicationService }]; }, { config: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoid2VsY29tZS5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL2NvbnRleHQtZGFzaGJvYXJkL2NvY2twaXQtZGFzaGJvYXJkL3dlbGNvbWUvd2VsY29tZS5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsS0FBSyxFQUFxQixNQUFNLGVBQWUsQ0FBQztBQUNwRSxPQUFPLEVBQ0wsT0FBTyxFQUNQLFdBQVcsRUFFWCxnQkFBZ0IsRUFFakIsTUFBTSxxQkFBcUIsQ0FBQztBQUM3QixPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFFekMsT0FBTyxFQUFFLGFBQWEsRUFBRSxrQkFBa0IsRUFBZ0IsTUFBTSxhQUFhLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTTlFLE1BQU0sT0FBTyxnQkFBZ0I7QUFBRyxJQWM5QixZQUNVLGFBQTRCLEVBQzVCLElBQWlCLEVBQ2pCLE1BQWMsRUFDZCxTQUEyQixFQUMzQixrQkFBc0M7QUFDL0MsUUFMUyxrQkFBYSxHQUFiLGFBQWEsQ0FBZTtBQUFDLFFBQzdCLFNBQUksR0FBSixJQUFJLENBQWE7QUFBQyxRQUNsQixXQUFNLEdBQU4sTUFBTSxDQUFRO0FBQUMsUUFDZixjQUFTLEdBQVQsU0FBUyxDQUFrQjtBQUFDLFFBQzVCLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7QUFDbEQsUUFqQkUsZUFBVSxHQUFHLEVBQUUsQ0FBQztBQUNsQixRQUNtQix1QkFBa0IsR0FBVyxlQUFlLENBQUM7QUFDaEUsUUFBbUIsVUFBSyxHQUFXLE9BQU8sQ0FBQztBQUMzQyxJQWFLLENBQUM7QUFDTixJQUNRLFFBQVE7QUFDaEI7QUFBOEQsWUFBMUQsSUFBSSxDQUFDLFVBQVUsR0FBRyxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsaUJBQWlCLEVBQUUsQ0FBQztBQUNuRSxZQUFJLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztBQUN0QixZ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dXQsIE9uSW5pdCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1xuICBnZXR0ZXh0LFxuICBEb2NzU2VydmljZSxcbiAgRG9jTGluayxcbiAgTmF2aWdhdG9yU2VydmljZSxcbiAgTmF2aWdhdG9yTm9kZVxufSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IFJvdXRlciB9IGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgeyBTdWJzY3JpcHRpb24gfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFRlbmFudFNlcnZpY2UsIEFwcGxpY2F0aW9uU2VydmljZSwgSUFwcGxpY2F0aW9uIH0gZnJvbSAnQGM4eS9jbGllbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjOHktd2VsY29tZS10by1jb2NrcGl0JyxcbiAgdGVtcGxhdGVVcmw6ICcuL3dlbGNvbWUuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFdlbGNvbWVUb0NvY2twaXQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIEBJbnB1dCgpIGNvbmZpZztcbiAgd2VsY29tZU1lc3NhZ2U7XG4gIHF1aWNrTGlua3MgPSBbXTtcblxuICBwcml2YXRlIHJlYWRvbmx5IENPTkZJR1VSQVRJT05fTk9ERTogc3RyaW5nID0gJ0NvbmZpZ3VyYXRpb24nO1xuICBwcml2YXRlIHJlYWRvbmx5IFRSSUFMOiBzdHJpbmcgPSAnVFJJQUwnO1xuICBwcml2YXRlIHRlbmFudFR5cGU6IHN0cmluZztcbiAgcHJpdmF0ZSBuYXZOb2RlczogTmF2aWdhdG9yTm9kZVtdO1xuICBwcml2YXRlIGNvbmZpZ3VyYXRpb25Ob2RlOiBhbnk7XG4gIHByaXZhdGUgbGlua3M6IERvY0xpbmtbXTtcbiAgcHJpdmF0ZSBkb2NzU3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG4gIHByaXZhdGUgbmF2U3Vic2NyaXB0aW9uOiBTdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSB0ZW5hbnRTZXJ2aWNlOiBUZW5hbnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgZG9jczogRG9jc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICBwcml2YXRlIG5hdmlnYXRvcjogTmF2aWdhdG9yU2VydmljZSxcbiAgICBwcml2YXRlIGFwcGxpY2F0aW9uU2VydmljZTogQXBwbGljYXRpb25TZXJ2aWNlXG4gICkge31cblxuICBhc3luYyBuZ09uSW5pdCgpIHtcbiAgICB0aGlzLnRlbmFudFR5cGUgPSBhd2FpdCB0aGlzLnRlbmFudFNlcnZpY2UuY3VycmVudFRlbmFudFR5cGUoKTtcbiAgICB0aGlzLnNldE1lc3NhZ2UoKTtcbiAgICB0aGlzLm5hdlN1YnNjcmlwdGlvbiA9IHRoaXMubmF2aWdhdG9yLml0ZW1zJC5zdWJzY3JpYmUobm9kZXMgPT4ge1xuICAgICAgdGhpcy5uYXZOb2RlcyA9IG5vZGVzO1xuICAgICAgdGhpcy5jb25maWd1cmF0aW9uTm9kZSA9IG5vZGVzLmZpbmQoKG5vZGU6IGFueSkgPT4gbm9kZS5sYWJlbCA9PT0gdGhpcy5DT05GSUdVUkFUSU9OX05PREUpO1xuICAgIH0pO1xuICAgIHRoaXMuZG9jc1N1YnNjcmlwdGlvbiA9IHRoaXMuZG9jcy5pdGVtcyQuc3Vic2NyaWJlKGxpbmtzID0+IHtcbiAgICAgIHRoaXMubGlua3MgPSBsaW5rcztcbiAgICB9KTtcblxuICAgIC8vIDwtLS1UUklBTCAmIFJFR1VMQVIgVEVOQU5UIC0tLT5cbiAgICB0aGlzLmNyZWF0ZUNvbm5lY3RTbWFydHBob25lUXVpY2tMaW5rKCk7XG4gICAgYXdhaXQgdGhpcy5jcmVhdGVRdWlja2xpbmtSZWdpc3RlckRldmljZSgpO1xuXG4gICAgLy8gPC0tLSBUUklBTCBURU5BTlQgLS0tPlxuICAgIGlmICh0aGlzLnRlbmFudFR5cGUgPT09IHRoaXMuVFJJQUwpIHtcbiAgICAgIHRoaXMuY3JlYXRlUXVpY2tsaW5rVXNlckd1aWRlKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gPC0tLSBSRUdVTEFSIFRFTkFOVCAtLS0+XG4gICAgdGhpcy5jcmVhdGVRdWlja2xpbmtBZGRHcm91cCgpO1xuICAgIHRoaXMuY3JlYXRlUXVpY2tMaW5rUmVwb3J0cygpO1xuICAgIHRoaXMuY3JlYXRlUXVpY2tMaW5rRXhwb3J0cygpO1xuICAgIHRoaXMuY3JlYXRlUXVpY2tsaW5rU21hcnRSdWxlcygpO1xuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMuZG9jc1N1YnNjcmlwdGlvbiAmJiAhdGhpcy5kb2NzU3Vic2NyaXB0aW9uLmNsb3NlZCkge1xuICAgICAgdGhpcy5kb2NzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMubmF2U3Vic2NyaXB0aW9uICYmICF0aGlzLm5hdlN1YnNjcmlwdGlvbi5jbG9zZWQpIHtcbiAgICAgIHRoaXMubmF2U3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBzZXRNZXNzYWdlKCkge1xuICAgIGlmICh0aGlzLnRlbmFudFR5cGUgPT09IHRoaXMuVFJJQUwpIHtcbiAgICAgIHRoaXMud2VsY29tZU1lc3NhZ2UgPSBnZXR0ZXh0KGBcbiAgICAgICAgVGhlIENvY2twaXQgYXBwbGljYXRpb24gYWxsb3dzIHlvdSB0byBidWlsZCBJb1QgYXBwbGljYXRpb25zIGluIG1pbnV0ZXMuXG4gICAgICAgIFRvIGdldCBzdGFydGVkLCBjb25uZWN0IGFueSBkZXZpY2UgdG8gdGhlIHBsYXRmb3JtLlxuICAgICAgICBJZiB5b3UgZG8gbm90IGhhdmUgYW4gSW9UIGRldmljZSB0byBoYW5kLCB5b3UgY2FuIHN0YXJ0IGJ5IGNvbm5lY3RpbmcgeW91ciBzbWFydHBob25lLlxuICAgICAgICBDbGljayBiZWxvdyB0byBiZSBndWlkZWQgdGhyb3VnaCB0aGUgcHJvY2Vzcy5cbiAgICAgIGApO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLndlbGNvbWVNZXNzYWdlID0gZ2V0dGV4dChgXG4gICAgICAgIFRoZSBDb2NrcGl0IGFwcGxpY2F0aW9uIHByb3ZpZGVzIHlvdSB3aXRoIG9wdGlvbnMgdG8gbWFuYWdlXG4gICAgICAgIGFuZCBtb25pdG9yIEludGVybmV0IG9mIFRoaW5ncyBhc3NldHMgYW5kIGRhdGEgZnJvbSBidXNpbmVzcyBwZXJzcGVjdGl2ZS5cbiAgICAgIGApO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgY3JlYXRlUXVpY2tsaW5rQWRkR3JvdXAoKSB7XG4gICAgLy8gY29tZXMgZnJvbSBhbmd1bGFySlMgZmFjdG9yeSBjOHlRdWlja0xpbmtzXG4gICAgY29uc3QgYWRkR3JvdXA6IFBhcnRpYWw8RG9jTGluaz4gPSB0aGlzLmxpbmtzLmZpbmQobGluayA9PiBsaW5rLmxhYmVsID09PSAnQWRkIGdyb3VwJyk7XG4gICAgaWYgKGFkZEdyb3VwKSB7XG4gICAgICB0aGlzLnF1aWNrTGlua3MucHVzaChhZGRHcm91cCk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBjcmVhdGVDb25uZWN0U21hcnRwaG9uZVF1aWNrTGluaygpIHtcbiAgICAvLyBQcm92aWRlciBpbiBTZW5zb3JQaG9uZU1vZHVsZSBkZWZpbmVzIHRoZVxuICAgIC8vICdDb25uZWN0IHNtYXJ0cGhvbmUnIHF1aWNrbGluay5cbiAgICBjb25zdCBjb25uZWN0U21hcnRwaG9uZSA9IHRoaXMubGlua3MuZmluZChsaW5rID0+IGxpbmsubGFiZWwgPT09ICdDb25uZWN0IHNtYXJ0cGhvbmUnKTtcbiAgICBpZiAoY29ubmVjdFNtYXJ0cGhvbmUpIHtcbiAgICAgIHRoaXMucXVpY2tMaW5rcy5wdXNoKGNvbm5lY3RTbWFydHBob25lKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVF1aWNrTGlua1JlcG9ydHMoKSB7XG4gICAgY29uc3QgbGFiZWwgPSBnZXR0ZXh0KCdSZXBvcnRzJyk7XG4gICAgY29uc3QgcmVwb3J0czogUGFydGlhbDxEb2NMaW5rPiA9IHtcbiAgICAgIGljb246ICd0aCcsXG4gICAgICBsYWJlbCxcbiAgICAgIHVybDogJy9yZXBvcnRzJ1xuICAgIH07XG4gICAgY29uc3QgcmVwb3J0c05vZGUgPSB0aGlzLmZpbmROYXZpZ2F0b3JOb2RlKGxhYmVsLCB0aGlzLm5hdk5vZGVzKTtcbiAgICBpZiAocmVwb3J0c05vZGUpIHtcbiAgICAgIHJlcG9ydHMuY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHJlcG9ydHNOb2RlLm9wZW4gPSB0cnVlO1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKHJlcG9ydHMudXJsKTtcbiAgICAgIH07XG4gICAgICB0aGlzLnF1aWNrTGlua3MucHVzaChyZXBvcnRzKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVF1aWNrTGlua0V4cG9ydHMoKSB7XG4gICAgY29uc3QgbGFiZWwgPSBnZXR0ZXh0KCdFeHBvcnRzJyk7XG4gICAgY29uc3QgZXhwb3J0czogUGFydGlhbDxEb2NMaW5rPiA9IHtcbiAgICAgIGljb246ICdjOHktcmVwb3J0cycsXG4gICAgICBsYWJlbCxcbiAgICAgIHVybDogJy9leHBvcnQnXG4gICAgfTtcblxuICAgIGlmICh0aGlzLmlzQ29uZmlnQ2hpbGROb2RlU2hvd24obGFiZWwpKSB7XG4gICAgICBleHBvcnRzLmNsaWNrID0gKCkgPT4ge1xuICAgICAgICB0aGlzLmNvbmZpZ3VyYXRpb25Ob2RlLm9wZW4gPSB0cnVlO1xuICAgICAgICB0aGlzLnJvdXRlci5uYXZpZ2F0ZUJ5VXJsKGV4cG9ydHMudXJsKTtcbiAgICAgIH07XG4gICAgICB0aGlzLnF1aWNrTGlua3MucHVzaChleHBvcnRzKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVF1aWNrbGlua1NtYXJ0UnVsZXMoKSB7XG4gICAgY29uc3QgbGFiZWwgPSBnZXR0ZXh0KCdTbWFydCBydWxlcycpO1xuICAgIGNvbnN0IHNtYXJ0UnVsZXM6IFBhcnRpYWw8RG9jTGluaz4gPSB7XG4gICAgICBpY29uOiAnYzh5LXNtYXJ0LXJ1bGVzJyxcbiAgICAgIGxhYmVsLFxuICAgICAgdXJsOiAnL3J1bGVzJ1xuICAgIH07XG4gICAgaWYgKHRoaXMuaXNDb25maWdDaGlsZE5vZGVTaG93bignR2xvYmFsIHNtYXJ0IHJ1bGVzJykpIHtcbiAgICAgIHNtYXJ0UnVsZXMuY2xpY2sgPSAoKSA9PiB7XG4gICAgICAgIHRoaXMuY29uZmlndXJhdGlvbk5vZGUub3BlbiA9IHRydWU7XG4gICAgICAgIHRoaXMucm91dGVyLm5hdmlnYXRlQnlVcmwoc21hcnRSdWxlcy51cmwpO1xuICAgICAgfTtcbiAgICAgIHRoaXMucXVpY2tMaW5rcy5wdXNoKHNtYXJ0UnVsZXMpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgY3JlYXRlUXVpY2tsaW5rUmVnaXN0ZXJEZXZpY2UoKSB7XG4gICAgY29uc3QgeyBkYXRhIH0gPSBhd2FpdCB0aGlzLmFwcGxpY2F0aW9uU2VydmljZS5saXN0QnlVc2VyKHVuZGVmaW5lZCwgeyBwYWdlU2l6ZTogMjAwMCB9KTtcbiAgICBpZiAoZGF0YSkge1xuICAgICAgY29uc3QgZGV2aWNlTWFuYWdlbWVudDogSUFwcGxpY2F0aW9uID0gZGF0YS5maW5kKFxuICAgICAgICBhcHAgPT4gYXBwLmNvbnRleHRQYXRoID09PSAnZGV2aWNlbWFuYWdlbWVudCdcbiAgICAgICk7XG4gICAgICBpZiAoZGV2aWNlTWFuYWdlbWVudCkge1xuICAgICAgICBjb25zdCBkZXZpY2VNZ210VXJsID0gdGhpcy5hcHBsaWNhdGlvblNlcnZpY2UuZ2V0SHJlZihkZXZpY2VNYW5hZ2VtZW50KTtcbiAgICAgICAgY29uc3QgcmVnaXN0ZXJEZXZpY2U6IFBhcnRpYWw8RG9jTGluaz4gPSB7XG4gICAgICAgICAgaWNvbjogJ2M4eS1kZXZpY2UtY29ubmVjdCcsXG4gICAgICAgICAgbGFiZWw6IGdldHRleHQoJ1JlZ2lzdGVyIGRldmljZScpLFxuICAgICAgICAgIGNsaWNrOiAoKSA9PiB3aW5kb3cub3BlbihgJHtkZXZpY2VNZ210VXJsfS8jL2RldmljZXJlZ2lzdHJhdGlvbmAsICdfc2VsZicpXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMucXVpY2tMaW5rcy5wdXNoKHJlZ2lzdGVyRGV2aWNlKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGNyZWF0ZVF1aWNrbGlua1VzZXJHdWlkZSgpIHtcbiAgICBjb25zdCB1c2VyR3VpZGU6IFBhcnRpYWw8RG9jTGluaz4gPSB7XG4gICAgICBpY29uOiAnYzh5LXVzZXInLFxuICAgICAgbGFiZWw6IGdldHRleHQoJ1VzZXIgZ3VpZGUnKSxcbiAgICAgIHVybDogJy91c2Vycy1ndWlkZS9nZXR0aW5nLXN0YXJ0ZWQnLFxuICAgICAgY2xpY2s6ICgpID0+IHtcbiAgICAgICAgY29uc3QgdXNlckd1aWRlVVJMID0gdGhpcy5kb2NzLmdldFVzZXJHdWlkZUxpbmsodXNlckd1aWRlLnVybCkgYXMgc3RyaW5nO1xuICAgICAgICB3aW5kb3cub3Blbih1c2VyR3VpZGVVUkwpO1xuICAgICAgfVxuICAgIH07XG4gICAgdGhpcy5xdWlja0xpbmtzLnB1c2godXNlckd1aWRlKTtcbiAgfVxuXG4gIHByaXZhdGUgaXNDb25maWdDaGlsZE5vZGVTaG93bihub2RlTmFtZSkge1xuICAgIGlmICh0aGlzLmNvbmZpZ3VyYXRpb25Ob2RlICYmIHRoaXMuY29uZmlndXJhdGlvbk5vZGUuc2hvdykge1xuICAgICAgY29uc3QgbmF2Tm9kZSA9IHRoaXMuZmluZE5hdmlnYXRvck5vZGUobm9kZU5hbWUsIHRoaXMuY29uZmlndXJhdGlvbk5vZGUuY2hpbGRyZW4pO1xuICAgICAgcmV0dXJuICEhbmF2Tm9kZSAmJiBuYXZOb2RlLnNob3c7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgZmluZE5hdmlnYXRvck5vZGUobm9kZU5hbWU6IHN0cmluZywgbmF2Tm9kZXM6IE5hdmlnYXRvck5vZGVbXSkge1xuICAgIGlmIChuYXZOb2RlcyAmJiBuYXZOb2Rlcy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gbmF2Tm9kZXMuZmluZCgobm9kZTogYW55KSA9PiBub2RlLmxhYmVsID09PSBub2RlTmFtZSkgYXMgYW55O1xuICAgIH1cbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG59XG4iXX0=