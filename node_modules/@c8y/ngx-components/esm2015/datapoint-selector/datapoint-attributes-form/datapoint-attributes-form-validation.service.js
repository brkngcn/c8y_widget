import { Injectable } from '@angular/core';
import { FormBuilder, Validators } from '@angular/forms';
import { C8yValidators } from '@c8y/ngx-components';
import { AXIS_TYPES, CHART_LINE_TYPES, CHART_RENDER_TYPES } from './datapoint-attributes.model';
import * as i0 from "@angular/core";
import * as i1 from "@angular/forms";
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/forms';
export class DatapointAttributesFormValidationService {
    constructor(formBuilder) {
        this.formBuilder = formBuilder;
    }
    getDefaultFormGroup(fieldsToRemove = []) {
        const formFields = {
            __active: [true, []],
            __target: this.getTargetFormGroup(),
            __template: [undefined, []],
            color: ['', this.getColorValidators()],
            label: ['', this.getLabelValidators()],
            description: ['', this.getDescriptionValidators()],
            fragment: ['', this.getFragmentValidators()],
            series: ['', this.getSeriesValidators()],
            range: this.getMinMaxFormGroup(),
            unit: [undefined, this.getUnitValidators()],
            target: [undefined, this.getTargetValidators()],
            redRange: this.getMinMaxFormGroup(),
            yellowRange: this.getMinMaxFormGroup(),
            chart: this.getChartFormGroup()
        };
        if (fieldsToRemove.length) {
            for (const field of fieldsToRemove) {
                delete formFields[field];
            }
        }
        return this.formBuilder.group(formFields, {
            validators: this.getOverallValidators()
        });
    }
    convertToBackendFormat(formDataStructure) {
        if (!formDataStructure) {
            return {};
        }
        const { __active, __target, __template, color, label, description, fragment, series, range, unit, target, redRange, yellowRange, chart } = formDataStructure;
        const obj = {
            __active,
            __target,
            __template,
            color,
            label,
            description,
            fragment,
            series,
            min: range === null || range === void 0 ? void 0 : range.min,
            max: range === null || range === void 0 ? void 0 : range.max,
            unit,
            target,
            redRangeMin: redRange === null || redRange === void 0 ? void 0 : redRange.min,
            redRangeMax: redRange === null || redRange === void 0 ? void 0 : redRange.max,
            yellowRangeMin: yellowRange === null || yellowRange === void 0 ? void 0 : yellowRange.min,
            yellowRangeMax: yellowRange === null || yellowRange === void 0 ? void 0 : yellowRange.max,
            renderType: chart === null || chart === void 0 ? void 0 : chart.renderType,
            lineType: chart === null || chart === void 0 ? void 0 : chart.lineType,
            yAxisType: chart === null || chart === void 0 ? void 0 : chart.yAxisType
        };
        return obj;
    }
    convertToFormGroupFormat(backendDataStructure) {
        if (!backendDataStructure) {
            return {};
        }
        const { __active, __target, __template, color, label, description, fragment, series, min, max, unit, target, redRangeMin, redRangeMax, yellowRangeMin, yellowRangeMax, renderType, lineType, yAxisType } = backendDataStructure;
        const obj = {
            __active,
            __target,
            __template,
            color,
            label,
            description,
            fragment,
            series,
            range: {
                min: this.convertStringToNumber(min),
                max: this.convertStringToNumber(max)
            },
            unit,
            target: this.convertStringToNumber(target),
            redRange: {
                min: this.convertStringToNumber(redRangeMin),
                max: this.convertStringToNumber(redRangeMax)
            },
            yellowRange: {
                min: this.convertStringToNumber(yellowRangeMin),
                max: this.convertStringToNumber(yellowRangeMax)
            },
            chart: renderType || lineType || yAxisType ? { renderType, lineType, yAxisType } : undefined
        };
        return obj;
    }
    getColorValidators() {
        return [Validators.required, Validators.minLength(4)];
    }
    getLabelValidators() {
        return [Validators.required, Validators.minLength(1), Validators.maxLength(120)];
    }
    getDescriptionValidators() {
        return [];
    }
    getFragmentValidators() {
        return [
            Validators.required,
            Validators.minLength(1),
            Validators.maxLength(120),
            Validators.pattern(/^[^.]*$/)
        ];
    }
    getSeriesValidators() {
        return [
            Validators.required,
            Validators.minLength(1),
            Validators.maxLength(120),
            Validators.pattern(/^[^.]*$/)
        ];
    }
    getMinMaxValidators() {
        return [C8yValidators.minMaxValidator(), C8yValidators.requireBothMinAndMax()];
    }
    getUnitValidators() {
        return [];
    }
    getTargetValidators() {
        return [];
    }
    getOverallValidators() {
        return [
            C8yValidators.withinScale('redRange.min'),
            C8yValidators.withinScale('redRange.max'),
            C8yValidators.withinScale('yellowRange.min'),
            C8yValidators.withinScale('yellowRange.max'),
            C8yValidators.withinScale('target')
        ];
    }
    getMinMaxFormGroup() {
        return this.formBuilder.group({ min: [undefined, []], max: [undefined, []] }, { validators: this.getMinMaxValidators() });
    }
    getChartFormGroup() {
        return this.formBuilder.group({
            renderType: [CHART_RENDER_TYPES[0].val, []],
            lineType: [CHART_LINE_TYPES[0].val, []],
            yAxisType: [AXIS_TYPES[0].val, []]
        });
    }
    getTargetFormGroup() {
        return this.formBuilder.group({
            id: [undefined, []],
            name: [undefined, []]
        });
    }
    convertStringToNumber(possibleString) {
        if (typeof possibleString === 'string') {
            try {
                return Number.parseFloat(possibleString);
            }
            catch (_a) {
                return undefined;
            }
        }
        else {
            return possibleString;
        }
    }
}
DatapointAttributesFormValidationService.ɵfac = function DatapointAttributesFormValidationService_Factory(t) { return new (t || DatapointAttributesFormValidationService)(ɵngcc0.ɵɵinject(ɵngcc1.FormBuilder)); };
DatapointAttributesFormValidationService.ɵprov = i0.ɵɵdefineInjectable({ factory: function DatapointAttributesFormValidationService_Factory() { return new DatapointAttributesFormValidationService(i0.ɵɵinject(i1.FormBuilder)); }, token: DatapointAttributesFormValidationService, providedIn: "root" });
DatapointAttributesFormValidationService.ctorParameters = () => [
    { type: FormBuilder }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DatapointAttributesFormValidationService, [{
        type: Injectable,
        args: [{ providedIn: 'root' }]
    }], function () { return [{ type: ɵngcc1.FormBuilder }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXBvaW50LWF0dHJpYnV0ZXMtZm9ybS12YWxpZGF0aW9uLnNlcnZpY2UuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2RhdGFwb2ludC1zZWxlY3Rvci9kYXRhcG9pbnQtYXR0cmlidXRlcy1mb3JtL2RhdGFwb2ludC1hdHRyaWJ1dGVzLWZvcm0tdmFsaWRhdGlvbi5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDM0MsT0FBTyxFQUFFLFdBQVcsRUFBMEIsVUFBVSxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDakYsT0FBTyxFQUFFLGFBQWEsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3BELE9BQU8sRUFBRSxVQUFVLEVBQUUsZ0JBQWdCLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUNoRztBQUVBOzs7QUFBQSxNQUFNLE9BQU8sd0NBQXdDO0FBQ3JELElBQUUsWUFBb0IsV0FBd0I7QUFBSSxRQUE1QixnQkFBVyxHQUFYLFdBQVcsQ0FBYTtBQUFDLElBQUUsQ0FBQztBQUNsRCxJQUNFLG1CQUFtQixDQUFDLGlCQUEyQixFQUFFO0FBQUksUUFDbkQsTUFBTSxVQUFVLEdBQUc7QUFDdkIsWUFBTSxRQUFRLEVBQUUsQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDO0FBQzFCLFlBQU0sUUFBUSxFQUFFLElBQUksQ0FBQyxrQkFBa0IsRUFBRTtBQUN6QyxZQUFNLFVBQVUsRUFBRSxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUM7QUFDakMsWUFBTSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7QUFDNUMsWUFBTSxLQUFLLEVBQUUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLGtCQUFrQixFQUFFLENBQUM7QUFDNUMsWUFBTSxXQUFXLEVBQUUsQ0FBQyxFQUFFLEVBQUUsSUFBSSxDQUFDLHdCQUF3QixFQUFF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LGdCQUFnQixDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUM7QUFDN0MsWUFBTSxTQUFTLEVBQUUsQ0FBQyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQztBQUN4QyxTQUFLLENBQUMsQ0FBQztBQUNQLElBQUUsQ0FBQztBQUNILElBQ0Usa0JBQWtCO0FBQUssUUFDckIsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQztBQUNsQyxZQUFNLEVBQUUsRUFBRSxDQUFDLFNBQVMsRUFBRSxFQUFFLENBQUM7QUFDekIsWUFBTSxJQUFJLEVBQUUsQ0FBQyxTQUFTLEVBQUUsRUFBRSxDQUFDO0FBQzNCLFNBQUssQ0FBQyxDQUFDO0FBQ1AsSUFBRSxDQUFDO0FBQ0gsSUFDVSxxQkFBcUIsQ0FBQyxjQUErQjtBQUFJLFFBQy9ELElBQUksT0FBTyxjQUFjLEtBQUssUUFBUSxFQUFFO0FBQzVDLFlBQU0sSUFBSTtBQUNWLGdCQUFRLE9BQU8sTUFBTSxDQUFDLFVBQVUsQ0FBQyxjQUFjLENBQUMsQ0FBQztBQUNqRCxhQUFPO0FBQUMsWUFBQSxXQUFNO0FBQ2QsZ0JBQVEsT0FBTyxTQUFTLENBQUM7QUFDekIsYUFBTztBQUNQLFNBQUs7QUFBQyxhQUFLO0FBQ1gsWUFBTSxPQUFPLGNBQWMsQ0FBQztBQUM1QixTQUFLO0FBQ0wsSUFBRSxDQUFDO0FBQ0g7a05BQUM7QUFDRCw0U0F4Tks7QUFBQztFQURMLFVBQVUsU0FBQyxFQUFFLHZCQUVFLFlBTlAsV0FBVztBQUFHO0lBSUMsRUFBRSxNQUFNLEVBQUU7Ozs0RUFKVDtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCwgVmFsaWRhdG9yRm4sIFZhbGlkYXRvcnMgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBDOHlWYWxpZGF0b3JzIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG5pbXBvcnQgeyBBWElTX1RZUEVTLCBDSEFSVF9MSU5FX1RZUEVTLCBDSEFSVF9SRU5ERVJfVFlQRVMgfSBmcm9tICcuL2RhdGFwb2ludC1hdHRyaWJ1dGVzLm1vZGVsJztcblxuQEluamVjdGFibGUoeyBwcm92aWRlZEluOiAncm9vdCcgfSlcbmV4cG9ydCBjbGFzcyBEYXRhcG9pbnRBdHRyaWJ1dGVzRm9ybVZhbGlkYXRpb25TZXJ2aWNlIHtcbiAgY29uc3RydWN0b3IocHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIpIHt9XG5cbiAgZ2V0RGVmYXVsdEZvcm1Hcm91cChmaWVsZHNUb1JlbW92ZTogc3RyaW5nW10gPSBbXSk6IEZvcm1Hcm91cCB7XG4gICAgY29uc3QgZm9ybUZpZWxkcyA9IHtcbiAgICAgIF9fYWN0aXZlOiBbdHJ1ZSwgW11dLFxuICAgICAgX190YXJnZXQ6IHRoaXMuZ2V0VGFyZ2V0Rm9ybUdyb3VwKCksXG4gICAgICBfX3RlbXBsYXRlOiBbdW5kZWZpbmVkLCBbXV0sXG4gICAgICBjb2xvcjogWycnLCB0aGlzLmdldENvbG9yVmFsaWRhdG9ycygpXSxcbiAgICAgIGxhYmVsOiBbJycsIHRoaXMuZ2V0TGFiZWxWYWxpZGF0b3JzKCldLFxuICAgICAgZGVzY3JpcHRpb246IFsnJywgdGhpcy5nZXREZXNjcmlwdGlvblZhbGlkYXRvcnMoKV0sXG4gICAgICBmcmFnbWVudDogWycnLCB0aGlzLmdldEZyYWdtZW50VmFsaWRhdG9ycygpXSxcbiAgICAgIHNlcmllczogWycnLCB0aGlzLmdldFNlcmllc1ZhbGlkYXRvcnMoKV0sXG4gICAgICByYW5nZTogdGhpcy5nZXRNaW5NYXhGb3JtR3JvdXAoKSxcbiAgICAgIHVuaXQ6IFt1bmRlZmluZWQsIHRoaXMuZ2V0VW5pdFZhbGlkYXRvcnMoKV0sXG4gICAgICB0YXJnZXQ6IFt1bmRlZmluZWQsIHRoaXMuZ2V0VGFyZ2V0VmFsaWRhdG9ycygpXSxcbiAgICAgIHJlZFJhbmdlOiB0aGlzLmdldE1pbk1heEZvcm1Hcm91cCgpLFxuICAgICAgeWVsbG93UmFuZ2U6IHRoaXMuZ2V0TWluTWF4Rm9ybUdyb3VwKCksXG4gICAgICBjaGFydDogdGhpcy5nZXRDaGFydEZvcm1Hcm91cCgpXG4gICAgfTtcbiAgICBpZiAoZmllbGRzVG9SZW1vdmUubGVuZ3RoKSB7XG4gICAgICBmb3IgKGNvbnN0IGZpZWxkIG9mIGZpZWxkc1RvUmVtb3ZlKSB7XG4gICAgICAgIGRlbGV0ZSBmb3JtRmllbGRzW2ZpZWxkXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoZm9ybUZpZWxkcywge1xuICAgICAgdmFsaWRhdG9yczogdGhpcy5nZXRPdmVyYWxsVmFsaWRhdG9ycygpXG4gICAgfSk7XG4gIH1cblxuICBjb252ZXJ0VG9CYWNrZW5kRm9ybWF0KGZvcm1EYXRhU3RydWN0dXJlOiBhbnkpIHtcbiAgICBpZiAoIWZvcm1EYXRhU3RydWN0dXJlKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgY29uc3Qge1xuICAgICAgX19hY3RpdmUsXG4gICAgICBfX3RhcmdldCxcbiAgICAgIF9fdGVtcGxhdGUsXG4gICAgICBjb2xvcixcbiAgICAgIGxhYmVsLFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICBmcmFnbWVudCxcbiAgICAgIHNlcmllcyxcbiAgICAgIHJhbmdlLFxuICAgICAgdW5pdCxcbiAgICAgIHRhcmdldCxcbiAgICAgIHJlZFJhbmdlLFxuICAgICAgeWVsbG93UmFuZ2UsXG4gICAgICBjaGFydFxuICAgIH0gPSBmb3JtRGF0YVN0cnVjdHVyZTtcbiAgICBjb25zdCBvYmogPSB7XG4gICAgICBfX2FjdGl2ZSxcbiAgICAgIF9fdGFyZ2V0LFxuICAgICAgX190ZW1wbGF0ZSxcbiAgICAgIGNvbG9yLFxuICAgICAgbGFiZWwsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIGZyYWdtZW50LFxuICAgICAgc2VyaWVzLFxuICAgICAgbWluOiByYW5nZT8ubWluLFxuICAgICAgbWF4OiByYW5nZT8ubWF4LFxuICAgICAgdW5pdCxcbiAgICAgIHRhcmdldCxcbiAgICAgIHJlZFJhbmdlTWluOiByZWRSYW5nZT8ubWluLFxuICAgICAgcmVkUmFuZ2VNYXg6IHJlZFJhbmdlPy5tYXgsXG4gICAgICB5ZWxsb3dSYW5nZU1pbjogeWVsbG93UmFuZ2U/Lm1pbixcbiAgICAgIHllbGxvd1JhbmdlTWF4OiB5ZWxsb3dSYW5nZT8ubWF4LFxuICAgICAgcmVuZGVyVHlwZTogY2hhcnQ/LnJlbmRlclR5cGUsXG4gICAgICBsaW5lVHlwZTogY2hhcnQ/LmxpbmVUeXBlLFxuICAgICAgeUF4aXNUeXBlOiBjaGFydD8ueUF4aXNUeXBlXG4gICAgfTtcbiAgICByZXR1cm4gb2JqO1xuICB9XG5cbiAgY29udmVydFRvRm9ybUdyb3VwRm9ybWF0KGJhY2tlbmREYXRhU3RydWN0dXJlOiBhbnkpIHtcbiAgICBpZiAoIWJhY2tlbmREYXRhU3RydWN0dXJlKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuXG4gICAgY29uc3Qge1xuICAgICAgX19hY3RpdmUsXG4gICAgICBfX3RhcmdldCxcbiAgICAgIF9fdGVtcGxhdGUsXG4gICAgICBjb2xvcixcbiAgICAgIGxhYmVsLFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICBmcmFnbWVudCxcbiAgICAgIHNlcmllcyxcbiAgICAgIG1pbixcbiAgICAgIG1heCxcbiAgICAgIHVuaXQsXG4gICAgICB0YXJnZXQsXG4gICAgICByZWRSYW5nZU1pbixcbiAgICAgIHJlZFJhbmdlTWF4LFxuICAgICAgeWVsbG93UmFuZ2VNaW4sXG4gICAgICB5ZWxsb3dSYW5nZU1heCxcbiAgICAgIHJlbmRlclR5cGUsXG4gICAgICBsaW5lVHlwZSxcbiAgICAgIHlBeGlzVHlwZVxuICAgIH0gPSBiYWNrZW5kRGF0YVN0cnVjdHVyZTtcblxuICAgIGNvbnN0IG9iaiA9IHtcbiAgICAgIF9fYWN0aXZlLFxuICAgICAgX190YXJnZXQsXG4gICAgICBfX3RlbXBsYXRlLFxuICAgICAgY29sb3IsXG4gICAgICBsYWJlbCxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgZnJhZ21lbnQsXG4gICAgICBzZXJpZXMsXG4gICAgICByYW5nZToge1xuICAgICAgICBtaW46IHRoaXMuY29udmVydFN0cmluZ1RvTnVtYmVyKG1pbiksXG4gICAgICAgIG1heDogdGhpcy5jb252ZXJ0U3RyaW5nVG9OdW1iZXIobWF4KVxuICAgICAgfSxcbiAgICAgIHVuaXQsXG4gICAgICB0YXJnZXQ6IHRoaXMuY29udmVydFN0cmluZ1RvTnVtYmVyKHRhcmdldCksXG4gICAgICByZWRSYW5nZToge1xuICAgICAgICBtaW46IHRoaXMuY29udmVydFN0cmluZ1RvTnVtYmVyKHJlZFJhbmdlTWluKSxcbiAgICAgICAgbWF4OiB0aGlzLmNvbnZlcnRTdHJpbmdUb051bWJlcihyZWRSYW5nZU1heClcbiAgICAgIH0sXG4gICAgICB5ZWxsb3dSYW5nZToge1xuICAgICAgICBtaW46IHRoaXMuY29udmVydFN0cmluZ1RvTnVtYmVyKHllbGxvd1JhbmdlTWluKSxcbiAgICAgICAgbWF4OiB0aGlzLmNvbnZlcnRTdHJpbmdUb051bWJlcih5ZWxsb3dSYW5nZU1heClcbiAgICAgIH0sXG4gICAgICBjaGFydDogcmVuZGVyVHlwZSB8fCBsaW5lVHlwZSB8fCB5QXhpc1R5cGUgPyB7IHJlbmRlclR5cGUsIGxpbmVUeXBlLCB5QXhpc1R5cGUgfSA6IHVuZGVmaW5lZFxuICAgIH07XG4gICAgcmV0dXJuIG9iajtcbiAgfVxuXG4gIGdldENvbG9yVmFsaWRhdG9ycygpOiBWYWxpZGF0b3JGbltdIHtcbiAgICByZXR1cm4gW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMubWluTGVuZ3RoKDQpXTtcbiAgfVxuXG4gIGdldExhYmVsVmFsaWRhdG9ycygpOiBWYWxpZGF0b3JGbltdIHtcbiAgICByZXR1cm4gW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMubWluTGVuZ3RoKDEpLCBWYWxpZGF0b3JzLm1heExlbmd0aCgxMjApXTtcbiAgfVxuXG4gIGdldERlc2NyaXB0aW9uVmFsaWRhdG9ycygpOiBWYWxpZGF0b3JGbltdIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBnZXRGcmFnbWVudFZhbGlkYXRvcnMoKTogVmFsaWRhdG9yRm5bXSB7XG4gICAgcmV0dXJuIFtcbiAgICAgIFZhbGlkYXRvcnMucmVxdWlyZWQsXG4gICAgICBWYWxpZGF0b3JzLm1pbkxlbmd0aCgxKSxcbiAgICAgIFZhbGlkYXRvcnMubWF4TGVuZ3RoKDEyMCksXG4gICAgICBWYWxpZGF0b3JzLnBhdHRlcm4oL15bXi5dKiQvKVxuICAgIF07XG4gIH1cblxuICBnZXRTZXJpZXNWYWxpZGF0b3JzKCk6IFZhbGlkYXRvckZuW10ge1xuICAgIHJldHVybiBbXG4gICAgICBWYWxpZGF0b3JzLnJlcXVpcmVkLFxuICAgICAgVmFsaWRhdG9ycy5taW5MZW5ndGgoMSksXG4gICAgICBWYWxpZGF0b3JzLm1heExlbmd0aCgxMjApLFxuICAgICAgVmFsaWRhdG9ycy5wYXR0ZXJuKC9eW14uXSokLylcbiAgICBdO1xuICB9XG5cbiAgZ2V0TWluTWF4VmFsaWRhdG9ycygpOiBWYWxpZGF0b3JGbltdIHtcbiAgICByZXR1cm4gW0M4eVZhbGlkYXRvcnMubWluTWF4VmFsaWRhdG9yKCksIEM4eVZhbGlkYXRvcnMucmVxdWlyZUJvdGhNaW5BbmRNYXgoKV07XG4gIH1cblxuICBnZXRVbml0VmFsaWRhdG9ycygpOiBWYWxpZGF0b3JGbltdIHtcbiAgICByZXR1cm4gW107XG4gIH1cblxuICBnZXRUYXJnZXRWYWxpZGF0b3JzKCk6IFZhbGlkYXRvckZuW10ge1xuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIGdldE92ZXJhbGxWYWxpZGF0b3JzKCk6IFZhbGlkYXRvckZuW10ge1xuICAgIHJldHVybiBbXG4gICAgICBDOHlWYWxpZGF0b3JzLndpdGhpblNjYWxlKCdyZWRSYW5nZS5taW4nKSxcbiAgICAgIEM4eVZhbGlkYXRvcnMud2l0aGluU2NhbGUoJ3JlZFJhbmdlLm1heCcpLFxuICAgICAgQzh5VmFsaWRhdG9ycy53aXRoaW5TY2FsZSgneWVsbG93UmFuZ2UubWluJyksXG4gICAgICBDOHlWYWxpZGF0b3JzLndpdGhpblNjYWxlKCd5ZWxsb3dSYW5nZS5tYXgnKSxcbiAgICAgIEM4eVZhbGlkYXRvcnMud2l0aGluU2NhbGUoJ3RhcmdldCcpXG4gICAgXTtcbiAgfVxuXG4gIGdldE1pbk1heEZvcm1Hcm91cCgpOiBGb3JtR3JvdXAge1xuICAgIHJldHVybiB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKFxuICAgICAgeyBtaW46IFt1bmRlZmluZWQsIFtdXSwgbWF4OiBbdW5kZWZpbmVkLCBbXV0gfSxcbiAgICAgIHsgdmFsaWRhdG9yczogdGhpcy5nZXRNaW5NYXhWYWxpZGF0b3JzKCkgfVxuICAgICk7XG4gIH1cblxuICBnZXRDaGFydEZvcm1Hcm91cCgpOiBGb3JtR3JvdXAge1xuICAgIHJldHVybiB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKHtcbiAgICAgIHJlbmRlclR5cGU6IFtDSEFSVF9SRU5ERVJfVFlQRVNbMF0udmFsLCBbXV0sXG4gICAgICBsaW5lVHlwZTogW0NIQVJUX0xJTkVfVFlQRVNbMF0udmFsLCBbXV0sXG4gICAgICB5QXhpc1R5cGU6IFtBWElTX1RZUEVTWzBdLnZhbCwgW11dXG4gICAgfSk7XG4gIH1cblxuICBnZXRUYXJnZXRGb3JtR3JvdXAoKTogRm9ybUdyb3VwIHtcbiAgICByZXR1cm4gdGhpcy5mb3JtQnVpbGRlci5ncm91cCh7XG4gICAgICBpZDogW3VuZGVmaW5lZCwgW11dLFxuICAgICAgbmFtZTogW3VuZGVmaW5lZCwgW11dXG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIGNvbnZlcnRTdHJpbmdUb051bWJlcihwb3NzaWJsZVN0cmluZzogc3RyaW5nIHwgbnVtYmVyKTogbnVtYmVyIHtcbiAgICBpZiAodHlwZW9mIHBvc3NpYmxlU3RyaW5nID09PSAnc3RyaW5nJykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIE51bWJlci5wYXJzZUZsb2F0KHBvc3NpYmxlU3RyaW5nKTtcbiAgICAgIH0gY2F0Y2gge1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gcG9zc2libGVTdHJpbmc7XG4gICAgfVxuICB9XG59XG4iXX0=