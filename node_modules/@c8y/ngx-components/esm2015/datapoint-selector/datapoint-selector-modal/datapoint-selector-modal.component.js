import { Component, ElementRef } from '@angular/core';
import { gettext } from '@c8y/ngx-components';
import { get } from 'lodash-es';
import { BsModalRef } from 'ngx-bootstrap/modal';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'ngx-bootstrap/modal';
import * as ɵngcc2 from '../datapoint-selector.component';
import * as ɵngcc3 from '@angular/forms';
import * as ɵngcc4 from '@c8y/ngx-components';
export class DatapointSelectorModalComponent {
    constructor(bsModal, elementRef) {
        this.bsModal = bsModal;
        this.elementRef = elementRef;
        this.allowChangingContext = true;
        this.allowSearch = true;
        this.allowDatapointsFromMultipleAssets = true;
        this.selectedDatapoints = new Array();
        this.title = gettext('Data point selector');
        this.saveButtonLabel = gettext('Add data points');
        this.guessDatapointUnit = true;
        this.defaultActiveState = true;
        this.assetSelectorConfig = {};
        this.result = new Promise((resolve, reject) => {
            this.save = resolve;
            this.cancel = reject;
        });
    }
    ngOnInit() {
        this.applyWorkaroundForAngularJSModalsThatMightBeOpenedInParallel();
    }
    saveChanges() {
        this.bsModal.hide();
        this.save(this.selectedDatapoints);
    }
    close() {
        this.bsModal.hide();
        this.cancel();
    }
    /**
     * changes the z-index of the modal, to make sure this modal is on top.
     * required as angularJS modals are placing them selves on top via adjusting z-index.
     * while angular modals use the order within the dom for this..
     */
    applyWorkaroundForAngularJSModalsThatMightBeOpenedInParallel() {
        const modalContainer = get(this.elementRef, 'nativeElement.parentElement.parentElement.parentElement');
        modalContainer.style.zIndex = '1060';
    }
}
DatapointSelectorModalComponent.ɵfac = function DatapointSelectorModalComponent_Factory(t) { return new (t || DatapointSelectorModalComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.BsModalRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
DatapointSelectorModalComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DatapointSelectorModalComponent, selectors: [["c8y-datapoint-selector-modal"]], decls: 14, vars: 20, consts: [[1, "modal-header", "separator"], [1, "text-medium"], [1, "modal-inner-scroll", "modal-inner-scroll--fixed"], [3, "contextAsset", "guessDatapointUnit", "allowDatapointsFromMultipleAssets", "allowChangingContext", "defaultActiveState", "allowSearch", "ngModel", "ngModelChange"], [1, "modal-footer"], ["type", "button", "translate", "", 1, "btn", "btn-default", 3, "title", "click"], [1, "btn", "btn-primary", 3, "title", "disabled", "click"]], template: function DatapointSelectorModalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "h4", 1);
        ɵngcc0.ɵɵtext(2);
        ɵngcc0.ɵɵpipe(3, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "div", 2);
        ɵngcc0.ɵɵelementStart(5, "c8y-datapoint-selector", 3);
        ɵngcc0.ɵɵlistener("ngModelChange", function DatapointSelectorModalComponent_Template_c8y_datapoint_selector_ngModelChange_5_listener($event) { return ctx.selectedDatapoints = $event; });
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "div", 4);
        ɵngcc0.ɵɵelementStart(7, "button", 5);
        ɵngcc0.ɵɵlistener("click", function DatapointSelectorModalComponent_Template_button_click_7_listener() { return ctx.close(); });
        ɵngcc0.ɵɵpipe(8, "translate");
        ɵngcc0.ɵɵtext(9, " Cancel ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(10, "button", 6);
        ɵngcc0.ɵɵlistener("click", function DatapointSelectorModalComponent_Template_button_click_10_listener() { return ctx.saveChanges(); });
        ɵngcc0.ɵɵpipe(11, "translate");
        ɵngcc0.ɵɵtext(12);
        ɵngcc0.ɵɵpipe(13, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(3, 12, ctx.title));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("contextAsset", ctx.contextAsset)("guessDatapointUnit", ctx.guessDatapointUnit)("allowDatapointsFromMultipleAssets", ctx.allowDatapointsFromMultipleAssets)("allowChangingContext", ctx.allowChangingContext)("defaultActiveState", ctx.defaultActiveState)("allowSearch", ctx.allowSearch)("ngModel", ctx.selectedDatapoints);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(8, 14, "Cancel"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(11, 16, ctx.saveButtonLabel))("disabled", !(ctx.selectedDatapoints == null ? null : ctx.selectedDatapoints.length));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(13, 18, ctx.saveButtonLabel), " ");
    } }, directives: [ɵngcc2.DatapointSelectorComponent, ɵngcc3.NgControlStatus, ɵngcc3.NgModel, ɵngcc4.C8yTranslateDirective], pipes: [ɵngcc4.C8yTranslatePipe], encapsulation: 2 });
DatapointSelectorModalComponent.ctorParameters = () => [
    { type: BsModalRef },
    { type: ElementRef }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DatapointSelectorModalComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-datapoint-selector-modal',
                template: "<div class=\"modal-header separator\">\n  <h4 class=\"text-medium\">{{ title | translate }}</h4>\n</div>\n<div class=\"modal-inner-scroll modal-inner-scroll--fixed\">\n  <c8y-datapoint-selector\n    [contextAsset]=\"contextAsset\"\n    [guessDatapointUnit]=\"guessDatapointUnit\"\n    [allowDatapointsFromMultipleAssets]=\"allowDatapointsFromMultipleAssets\"\n    [allowChangingContext]=\"allowChangingContext\"\n    [defaultActiveState]=\"defaultActiveState\"\n    [allowSearch]=\"allowSearch\"\n    [(ngModel)]=\"selectedDatapoints\"\n  ></c8y-datapoint-selector>\n</div>\n<div class=\"modal-footer\">\n  <button\n    type=\"button\"\n    [title]=\"'Cancel' | translate\"\n    class=\"btn btn-default\"\n    (click)=\"close()\"\n    translate\n  >\n    Cancel\n  </button>\n  <button\n    [title]=\"saveButtonLabel | translate\"\n    class=\"btn btn-primary\"\n    [disabled]=\"!this.selectedDatapoints?.length\"\n    (click)=\"saveChanges()\"\n  >\n    {{ saveButtonLabel | translate }}\n  </button>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.BsModalRef }, { type: ɵngcc0.ElementRef }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXBvaW50LXNlbGVjdG9yLW1vZGFsLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vZGF0YXBvaW50LXNlbGVjdG9yL2RhdGFwb2ludC1zZWxlY3Rvci1tb2RhbC9kYXRhcG9pbnQtc2VsZWN0b3ItbW9kYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBRTlELE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM5QyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2hDLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQzs7Ozs7O0FBVWpELE1BQU0sT0FBTywrQkFBK0I7QUFBRyxJQW1CN0MsWUFBb0IsT0FBbUIsRUFBVSxVQUFzQjtBQUFJLFFBQXZELFlBQU8sR0FBUCxPQUFPLENBQVk7QUFBQyxRQUFTLGVBQVUsR0FBVixVQUFVLENBQVk7QUFBQyxRQWpCeEUseUJBQW9CLEdBQUcsSUFBSSxDQUFDO0FBQzlCLFFBQUUsZ0JBQVcsR0FBRyxJQUFJLENBQUM7QUFDckIsUUFBRSxzQ0FBaUMsR0FBRyxJQUFJLENBQUM7QUFDM0MsUUFBRSx1QkFBa0IsR0FBRyxJQUFJLEtBQUssRUFBYyxDQUFDO0FBQy9DLFFBQUUsVUFBSyxHQUFXLE9BQU8sQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ2pELFFBQUUsb0JBQWUsR0FBVyxPQUFPLENBQUMsaUJBQWlCLENBQUMsQ0FBQztBQUN2RCxRQUFFLHVCQUFrQixHQUFHLElBQUksQ0FBQztBQUM1QixRQUFFLHVCQUFrQixHQUFHLElBQUksQ0FBQztBQUM1QixRQUFFLHdCQUFtQixHQUF3RCxFQUFFLENBQUM7QUFDaEYsUUFBVyxXQUFNLEdBQTBCLElBQUksT0FBTyxDQUFDLENBQUMsT0FBTyxFQUFFLE1BQU0sRUFBRSxFQUFFO0FBQzNFLFlBQUksSUFBSSxDQUFDLElBQUksR0FBRyxPQUFPLENBQUM7QUFDeEIsWUFBSSxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztBQUN6QixRQUFFLENBQUMsQ0FBQyxDQUFDO0FBQ0wsSUFJNEUsQ0FBQztBQUM3RSxJQUNFLFFBQVE7QUFBSyxRQUNYLElBQUksQ0FBQyw0REFBNEQsRUFBRSxDQUFDO0FBQ3hFLElBQUUsQ0FBQztBQUNILElBQ0UsV0FBVztBQUFLLFFBQ2QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUN4QixRQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7QUFDdkMsSUFBRSxDQUFDO0FBQ0gsSUFDRSxLQUFLO0FBQ1AsUUFBSSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3hCLFFBQUksSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ2xCLElBQUUsQ0FBQztBQUNILElBQ0U7QUFDRjtBQUNFO0FBQ0U7QUFFSixPQURLO0FBQ0wsSUFBVSw0REFBNEQ7QUFDdEUsUUFBSSxNQUFNLGNBQWMsR0FBZ0IsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUseURBQXlELENBQUMsQ0FBQztBQUN4SCxRQUFJLGNBQWMsQ0FBQyxLQUFLLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztBQUN6QyxJQUFFLENBQUM7QUFDSDsyREFoREMsU0FBUyxTQUFDLGtCQUNULFFBQVEsRUFBRSw4QkFBOEIsa0JBQ3hDOzs7Ozs7OztDQUF3RCxjQUN6RDs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7c0xBQ0k7QUFBQztBQUF5RCxZQVZ0RCxVQUFVO0FBQUksWUFKSCxVQUFVO0FBQUc7Ozs7Ozs7d0dBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCwgRWxlbWVudFJlZiwgT25Jbml0IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJSWRlbnRpZmllZCB9IGZyb20gJ0BjOHkvY2xpZW50JztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IGdldCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBCc01vZGFsUmVmIH0gZnJvbSAnbmd4LWJvb3RzdHJhcC9tb2RhbCc7XG5pbXBvcnQge1xuICBEYXRhcG9pbnRTZWxlY3Rvck1vZGFsQXNzZXRTZWxlY3Rvck9wdGlvbnMsXG4gIEtQSURldGFpbHNcbn0gZnJvbSAnLi4vZGF0YXBvaW50LXNlbGVjdGlvbi5tb2RlbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1kYXRhcG9pbnQtc2VsZWN0b3ItbW9kYWwnLFxuICB0ZW1wbGF0ZVVybDogJy4vZGF0YXBvaW50LXNlbGVjdG9yLW1vZGFsLmNvbXBvbmVudC5odG1sJ1xufSlcbmV4cG9ydCBjbGFzcyBEYXRhcG9pbnRTZWxlY3Rvck1vZGFsQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgY29udGV4dEFzc2V0OiBJSWRlbnRpZmllZDtcbiAgYWxsb3dDaGFuZ2luZ0NvbnRleHQgPSB0cnVlO1xuICBhbGxvd1NlYXJjaCA9IHRydWU7XG4gIGFsbG93RGF0YXBvaW50c0Zyb21NdWx0aXBsZUFzc2V0cyA9IHRydWU7XG4gIHNlbGVjdGVkRGF0YXBvaW50cyA9IG5ldyBBcnJheTxLUElEZXRhaWxzPigpO1xuICB0aXRsZTogc3RyaW5nID0gZ2V0dGV4dCgnRGF0YSBwb2ludCBzZWxlY3RvcicpO1xuICBzYXZlQnV0dG9uTGFiZWw6IHN0cmluZyA9IGdldHRleHQoJ0FkZCBkYXRhIHBvaW50cycpO1xuICBndWVzc0RhdGFwb2ludFVuaXQgPSB0cnVlO1xuICBkZWZhdWx0QWN0aXZlU3RhdGUgPSB0cnVlO1xuICBhc3NldFNlbGVjdG9yQ29uZmlnOiBQYXJ0aWFsPERhdGFwb2ludFNlbGVjdG9yTW9kYWxBc3NldFNlbGVjdG9yT3B0aW9ucz4gPSB7fTtcbiAgcmVhZG9ubHkgcmVzdWx0OiBQcm9taXNlPEtQSURldGFpbHNbXT4gPSBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgdGhpcy5zYXZlID0gcmVzb2x2ZTtcbiAgICB0aGlzLmNhbmNlbCA9IHJlamVjdDtcbiAgfSk7XG5cbiAgcHJpdmF0ZSBzYXZlOiAodmFsdWU6IEtQSURldGFpbHNbXSkgPT4gdm9pZDtcbiAgcHJpdmF0ZSBjYW5jZWw6IChyZWFzb24/OiBhbnkpID0+IHZvaWQ7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSBic01vZGFsOiBCc01vZGFsUmVmLCBwcml2YXRlIGVsZW1lbnRSZWY6IEVsZW1lbnRSZWYpIHt9XG5cbiAgbmdPbkluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5hcHBseVdvcmthcm91bmRGb3JBbmd1bGFySlNNb2RhbHNUaGF0TWlnaHRCZU9wZW5lZEluUGFyYWxsZWwoKTtcbiAgfVxuXG4gIHNhdmVDaGFuZ2VzKCk6IHZvaWQge1xuICAgIHRoaXMuYnNNb2RhbC5oaWRlKCk7XG4gICAgdGhpcy5zYXZlKHRoaXMuc2VsZWN0ZWREYXRhcG9pbnRzKTtcbiAgfVxuXG4gIGNsb3NlKCkge1xuICAgIHRoaXMuYnNNb2RhbC5oaWRlKCk7XG4gICAgdGhpcy5jYW5jZWwoKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBjaGFuZ2VzIHRoZSB6LWluZGV4IG9mIHRoZSBtb2RhbCwgdG8gbWFrZSBzdXJlIHRoaXMgbW9kYWwgaXMgb24gdG9wLlxuICAgKiByZXF1aXJlZCBhcyBhbmd1bGFySlMgbW9kYWxzIGFyZSBwbGFjaW5nIHRoZW0gc2VsdmVzIG9uIHRvcCB2aWEgYWRqdXN0aW5nIHotaW5kZXguXG4gICAqIHdoaWxlIGFuZ3VsYXIgbW9kYWxzIHVzZSB0aGUgb3JkZXIgd2l0aGluIHRoZSBkb20gZm9yIHRoaXMuLlxuICAgKi9cbiAgcHJpdmF0ZSBhcHBseVdvcmthcm91bmRGb3JBbmd1bGFySlNNb2RhbHNUaGF0TWlnaHRCZU9wZW5lZEluUGFyYWxsZWwoKSB7XG4gICAgY29uc3QgbW9kYWxDb250YWluZXI6IEhUTUxFbGVtZW50ID0gZ2V0KHRoaXMuZWxlbWVudFJlZiwgJ25hdGl2ZUVsZW1lbnQucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LnBhcmVudEVsZW1lbnQnKTtcbiAgICBtb2RhbENvbnRhaW5lci5zdHlsZS56SW5kZXggPSAnMTA2MCc7XG4gIH1cbn1cbiJdfQ==