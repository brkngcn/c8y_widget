import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { C8yJSONSchema, gettext } from '@c8y/ngx-components';
import { ExtensibleDeviceRegistrationService } from './extensible-device-registration.service';
import { BsModalRef } from 'ngx-bootstrap/modal';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'ngx-bootstrap/modal';
import * as ɵngcc2 from '@c8y/ngx-components';
import * as ɵngcc3 from './extensible-device-registration.service';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from './extensible-device-registration-stepper.component';

function ExtensibleDeviceRegistrationModalComponent_ng_container_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelement(1, "c8y-extensible-device-registration-stepper", 5);
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const steps_r3 = ctx.ngIf;
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("steps", steps_r3)("labels", ctx_r0.labels)("contextPath", ctx_r0.contextPath);
} }
function ExtensibleDeviceRegistrationModalComponent_ng_template_7_ng_container_0_Template(rf, ctx) { if (rf & 1) {
    const _r8 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelement(1, "c8y-operation-result", 7);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementStart(3, "div", 8);
    ɵngcc0.ɵɵelementStart(4, "button", 9);
    ɵngcc0.ɵɵlistener("click", function ExtensibleDeviceRegistrationModalComponent_ng_template_7_ng_container_0_Template_button_click_4_listener() { ɵngcc0.ɵɵrestoreView(_r8); const ctx_r7 = ɵngcc0.ɵɵnextContext(2); return ctx_r7.bsModalRef.hide(); });
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵtext(6, " Close ");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵpropertyInterpolate("text", ɵngcc0.ɵɵpipeBind1(2, 4, ctx_r4.loadingErrorMessage));
    ɵngcc0.ɵɵproperty("size", 84)("vertical", true);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(5, 6, "Close"));
} }
function ExtensibleDeviceRegistrationModalComponent_ng_template_7_ng_template_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 10);
    ɵngcc0.ɵɵelement(1, "c8y-progress-bar", 11);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("message", ɵngcc0.ɵɵpipeBind1(2, 1, "Loading the registration form definition\u2026"));
} }
function ExtensibleDeviceRegistrationModalComponent_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ExtensibleDeviceRegistrationModalComponent_ng_template_7_ng_container_0_Template, 7, 8, "ng-container", 3);
    ɵngcc0.ɵɵtemplate(1, ExtensibleDeviceRegistrationModalComponent_ng_template_7_ng_template_1_Template, 3, 3, "ng-template", null, 6, ɵngcc0.ɵɵtemplateRefExtractor);
} if (rf & 2) {
    const _r5 = ɵngcc0.ɵɵreference(2);
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngIf", ctx_r2.loadingErrorMessage)("ngIfElse", _r5);
} }
export class ExtensibleDeviceRegistrationModalComponent {
    constructor(bsModalRef, jsonschema, registrationService) {
        this.bsModalRef = bsModalRef;
        this.jsonschema = jsonschema;
        this.registrationService = registrationService;
        this.labels = [];
    }
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            const { title, pages } = yield this.registrationService.getSchema(this.contextPath)
                .catch(error => {
                this.loadingErrorMessage = (error === null || error === void 0 ? void 0 : error.message) || gettext('Cannot fetch a form definition from the microservice.');
                return {
                    title: gettext('Error')
                };
            });
            this.title = title;
            this.pages = pages === null || pages === void 0 ? void 0 : pages.map((step) => {
                this.labels.push(step.title);
                return [this.jsonschema.toFieldConfig(step)];
            });
        });
    }
}
ExtensibleDeviceRegistrationModalComponent.ɵfac = function ExtensibleDeviceRegistrationModalComponent_Factory(t) { return new (t || ExtensibleDeviceRegistrationModalComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.BsModalRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.C8yJSONSchema), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.ExtensibleDeviceRegistrationService)); };
ExtensibleDeviceRegistrationModalComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ExtensibleDeviceRegistrationModalComponent, selectors: [["extensible-device-registration-modal"]], decls: 9, vars: 7, consts: [[3, "headerClasses", "customFooter"], ["c8y-modal-title", ""], [1, "c8y-icon", "c8y-icon-device-connect"], [4, "ngIf", "ngIfElse"], ["loadingOrError", ""], [3, "steps", "labels", "contextPath"], ["loading", ""], ["type", "error", 1, "lead", "text-regular", 3, "text", "size", "vertical"], [1, "modal-footer"], ["type", "button", "translate", "", 1, "btn", "btn-default", 3, "title", "click"], [1, "modal-header", "modal-header-info", "text-center"], [1, "text-center", 3, "message"]], template: function ExtensibleDeviceRegistrationModalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "c8y-modal", 0);
        ɵngcc0.ɵɵelementContainerStart(1, 1);
        ɵngcc0.ɵɵelement(2, "span", 2);
        ɵngcc0.ɵɵelementStart(3, "h4");
        ɵngcc0.ɵɵtext(4);
        ɵngcc0.ɵɵpipe(5, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵtemplate(6, ExtensibleDeviceRegistrationModalComponent_ng_container_6_Template, 2, 3, "ng-container", 3);
        ɵngcc0.ɵɵtemplate(7, ExtensibleDeviceRegistrationModalComponent_ng_template_7_Template, 3, 2, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        const _r1 = ɵngcc0.ɵɵreference(8);
        ɵngcc0.ɵɵproperty("headerClasses", "dialog-header")("customFooter", true);
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 5, ctx.title));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.pages)("ngIfElse", _r1);
    } }, directives: [ɵngcc2.ModalComponent, ɵngcc4.NgIf, ɵngcc5.ExtensibleDeviceRegistrationStepperComponent, ɵngcc2.OperationResultComponent, ɵngcc2.C8yTranslateDirective, ɵngcc2.ProgressBarComponent], pipes: [ɵngcc2.C8yTranslatePipe], encapsulation: 2 });
ExtensibleDeviceRegistrationModalComponent.ctorParameters = () => [
    { type: BsModalRef },
    { type: C8yJSONSchema },
    { type: ExtensibleDeviceRegistrationService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ExtensibleDeviceRegistrationModalComponent, [{
        type: Component,
        args: [{
                selector: 'extensible-device-registration-modal',
                template: "<c8y-modal [headerClasses]=\"'dialog-header'\" [customFooter]=\"true\">\n  <ng-container c8y-modal-title>\n    <span class=\"c8y-icon c8y-icon-device-connect\"></span>\n    <h4>{{ title | translate }}</h4>\n  </ng-container>\n  <ng-container *ngIf=\"pages as steps; else loadingOrError\">\n    <c8y-extensible-device-registration-stepper\n      [steps]=\"steps\"\n      [labels]=\"labels\"\n      [contextPath]=\"contextPath\"\n    ></c8y-extensible-device-registration-stepper>\n  </ng-container>\n  <ng-template #loadingOrError>\n    <ng-container *ngIf=\"loadingErrorMessage; else loading\">\n      <c8y-operation-result\n        text=\"{{ loadingErrorMessage | translate }}\"\n        [size]=\"84\"\n        [vertical]=\"true\"\n        type=\"error\"\n        class=\"lead text-regular\"\n      ></c8y-operation-result>\n      <div class=\"modal-footer\">\n        <button\n          title=\"{{ 'Close' | translate }}\"\n          (click)=\"bsModalRef.hide()\"\n          type=\"button\"\n          class=\"btn btn-default\"\n          translate\n        >\n          Close\n        </button>\n      </div>\n    </ng-container>\n    <ng-template #loading>\n      <div class=\"modal-header modal-header-info text-center\">\n        <c8y-progress-bar\n          [message]=\"'Loading the registration form definition\u2026' | translate\"\n          class=\"text-center\"\n        ></c8y-progress-bar>\n      </div>\n    </ng-template>\n  </ng-template>\n</c8y-modal>\n"
            }]
    }], function () { return [{ type: ɵngcc1.BsModalRef }, { type: ɵngcc2.C8yJSONSchema }, { type: ɵngcc3.ExtensibleDeviceRegistrationService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaWJsZS1kZXZpY2UtcmVnaXN0cmF0aW9uLW1vZGFsLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vcmVnaXN0ZXItZGV2aWNlL2V4dGVuc2libGUvc2luZ2xlL2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi1tb2RhbC5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQVUsTUFBTSxlQUFlLENBQUM7QUFDbEQsT0FBTyxFQUFFLGFBQWEsRUFBRSxPQUFPLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM3RCxPQUFPLEVBQUUsbUNBQW1DLEVBQUUsTUFBTSwwQ0FBMEMsQ0FBQztBQUkvRixPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBT2pELE1BQU0sT0FBTywwQ0FBMEM7QUFBRyxJQVF4RCxZQUNTLFVBQXNCLEVBQ3JCLFVBQXlCLEVBQ3pCLG1CQUF3RDtBQUNqRSxRQUhRLGVBQVUsR0FBVixVQUFVLENBQVk7QUFBQyxRQUN0QixlQUFVLEdBQVYsVUFBVSxDQUFlO0FBQUMsUUFDMUIsd0JBQW1CLEdBQW5CLG1CQUFtQixDQUFxQztBQUNwRSxRQVBFLFdBQU0sR0FBYSxFQUFFLENBQUM7QUFDeEIsSUFNSyxDQUFDO0FBQ04sSUFDUSxRQUFRO0FBQ2hCO0FBQThELFlBQTFELE1BQU0sRUFBRSxLQUFLLEVBQUUsS0FBSyxFQUFFLEdBQXVDLE1BQU0sSUFBSSxDQUFDLG1CQUFtQixDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDO0FBQzNILGlCQUFLLEtBQUssQ0FBQyxLQUFLLENBQUMsRUFBRTtBQUNuQixnQkFBTSxJQUFJLENBQUMsbUJBQW1CLEdBQUcsQ0FBQSxLQUFLLGFBQUwsS0FBSyx1QkFBTCxLQUFLLENBQUUsT0FBTyxLQUFJLE9BQU8sQ0FBQyx1REFBdUQsQ0FBQyxDQUFDO0FBQ3BILGdCQUFNLE9BQU87QUFDYixvQkFBUSxLQUFLLEVBQUUsT0FBTyxDQUFDLE9BQU8sQ0FBQztBQUMvQixpQkFBTyxDQUFDO0FBQ1IsWUFBSSxDQUFDLENBQUMsQ0FBQztBQUNQLFlBQUksSUFBSSxDQUFDLEtBQUssR0FBRyxLQUFLLENBQUM7QUFDdkIsWUFBSSxJQUFJLENBQUMsS0FBSyxHQUFHLEtBQUssYUFBTCxLQUFLLHVCQUFMLEtBQUssQ0FBRSxHQUFHLENBQUMsQ0FBQyxJQUFpQixFQUFFLEVBQUU7QUFDbEQsZ0JBQU0sSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO0FBQ25DLGdCQUFNLE9BQU8sQ0FBQyxJQUFJLENBQUMsVUFBVSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQXNCLENBQUMsQ0FBQztBQUN4RSxZQUFJLENBQUMsQ0FBQyxDQUFDO0FBQ1AsUUFBRSxDQUFDO0FBRUgsS0FGRztBQUNIO3NFQWpDQyxTQUFTLFNBQUMsa0JBQ1QsUUFBUSxFQUFFLHNDQUFzQyxrQkFDaEQ7Ozs7Ozs7Ozs7O3VFQUFrRSxjQUNuRTs7Ozs7Ozs7O2tRQUVHO0FBQUM7QUFBb0UsWUFQaEUsVUFBVTtBQUFJLFlBTGQsYUFBYTtBQUFJLFlBQ2pCLG1DQUFtQztBQUFHOzs7Ozs7O2lLQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQzh5SlNPTlNjaGVtYSwgZ2V0dGV4dCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgRXh0ZW5zaWJsZURldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UgfSBmcm9tICcuL2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IEV4dGVuc2libGVEZXZpY2VSZWdpc3RyYXRpb25TY2hlbWEgfSBmcm9tICcuL2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBKU09OU2NoZW1hNyB9IGZyb20gJ2pzb24tc2NoZW1hJztcbmltcG9ydCB7IEZvcm1seUZpZWxkQ29uZmlnIH0gZnJvbSAnQG5neC1mb3JtbHkvY29yZSc7XG5pbXBvcnQgeyBCc01vZGFsUmVmIH0gZnJvbSAnbmd4LWJvb3RzdHJhcC9tb2RhbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi1tb2RhbCcsXG4gIHRlbXBsYXRlVXJsOiAnZXh0ZW5zaWJsZS1kZXZpY2UtcmVnaXN0cmF0aW9uLW1vZGFsLmNvbXBvbmVudC5odG1sJ1xufSlcblxuZXhwb3J0IGNsYXNzIEV4dGVuc2libGVEZXZpY2VSZWdpc3RyYXRpb25Nb2RhbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgdGl0bGU6IHN0cmluZztcbiAgbG9hZGluZ0Vycm9yTWVzc2FnZTogc3RyaW5nO1xuICBwYWdlczogRm9ybWx5RmllbGRDb25maWdbXVtdO1xuICBsYWJlbHM6IHN0cmluZ1tdID0gW107XG4gIGNvbnRleHRQYXRoOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGJzTW9kYWxSZWY6IEJzTW9kYWxSZWYsXG4gICAgcHJpdmF0ZSBqc29uc2NoZW1hOiBDOHlKU09OU2NoZW1hLFxuICAgIHByaXZhdGUgcmVnaXN0cmF0aW9uU2VydmljZTogRXh0ZW5zaWJsZURldmljZVJlZ2lzdHJhdGlvblNlcnZpY2VcbiAgKSB7fVxuXG4gIGFzeW5jIG5nT25Jbml0KCkge1xuICAgIGNvbnN0IHsgdGl0bGUsIHBhZ2VzIH06IEV4dGVuc2libGVEZXZpY2VSZWdpc3RyYXRpb25TY2hlbWEgPSBhd2FpdCB0aGlzLnJlZ2lzdHJhdGlvblNlcnZpY2UuZ2V0U2NoZW1hKHRoaXMuY29udGV4dFBhdGgpXG4gICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIHRoaXMubG9hZGluZ0Vycm9yTWVzc2FnZSA9IGVycm9yPy5tZXNzYWdlIHx8IGdldHRleHQoJ0Nhbm5vdCBmZXRjaCBhIGZvcm0gZGVmaW5pdGlvbiBmcm9tIHRoZSBtaWNyb3NlcnZpY2UuJyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aXRsZTogZ2V0dGV4dCgnRXJyb3InKVxuICAgICAgfTtcbiAgICB9KTtcbiAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5wYWdlcyA9IHBhZ2VzPy5tYXAoKHN0ZXA6IEpTT05TY2hlbWE3KSA9PiB7XG4gICAgICB0aGlzLmxhYmVscy5wdXNoKHN0ZXAudGl0bGUpO1xuICAgICAgcmV0dXJuIFt0aGlzLmpzb25zY2hlbWEudG9GaWVsZENvbmZpZyhzdGVwKSBhcyBGb3JtbHlGaWVsZENvbmZpZ107XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==