import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { C8yJSONSchema, gettext } from '@c8y/ngx-components';
import { ExtensibleDeviceRegistrationService } from './extensible-device-registration.service';
import { BsModalRef } from 'ngx-bootstrap/modal';
export class ExtensibleDeviceRegistrationModalComponent {
    constructor(bsModalRef, jsonschema, registrationService) {
        this.bsModalRef = bsModalRef;
        this.jsonschema = jsonschema;
        this.registrationService = registrationService;
        this.labels = [];
    }
    ngOnInit() {
        return __awaiter(this, void 0, void 0, function* () {
            const { title, pages } = yield this.registrationService.getSchema(this.contextPath)
                .catch(error => {
                this.loadingErrorMessage = (error === null || error === void 0 ? void 0 : error.message) || gettext('Cannot fetch a form definition from the microservice.');
                return {
                    title: gettext('Error')
                };
            });
            this.title = title;
            this.pages = pages === null || pages === void 0 ? void 0 : pages.map((step) => {
                this.labels.push(step.title);
                return [this.jsonschema.toFieldConfig(step)];
            });
        });
    }
}
ExtensibleDeviceRegistrationModalComponent.decorators = [
    { type: Component, args: [{
                selector: 'extensible-device-registration-modal',
                template: "<c8y-modal [headerClasses]=\"'dialog-header'\" [customFooter]=\"true\">\n  <ng-container c8y-modal-title>\n    <span class=\"c8y-icon c8y-icon-device-connect\"></span>\n    <h4>{{ title | translate }}</h4>\n  </ng-container>\n  <ng-container *ngIf=\"pages as steps; else loadingOrError\">\n    <c8y-extensible-device-registration-stepper\n      [steps]=\"steps\"\n      [labels]=\"labels\"\n      [contextPath]=\"contextPath\"\n    ></c8y-extensible-device-registration-stepper>\n  </ng-container>\n  <ng-template #loadingOrError>\n    <ng-container *ngIf=\"loadingErrorMessage; else loading\">\n      <c8y-operation-result\n        text=\"{{ loadingErrorMessage | translate }}\"\n        [size]=\"84\"\n        [vertical]=\"true\"\n        type=\"error\"\n        class=\"lead text-regular\"\n      ></c8y-operation-result>\n      <div class=\"modal-footer\">\n        <button\n          title=\"{{ 'Close' | translate }}\"\n          (click)=\"bsModalRef.hide()\"\n          type=\"button\"\n          class=\"btn btn-default\"\n          translate\n        >\n          Close\n        </button>\n      </div>\n    </ng-container>\n    <ng-template #loading>\n      <div class=\"modal-header modal-header-info text-center\">\n        <c8y-progress-bar\n          [message]=\"'Loading the registration form definition\u2026' | translate\"\n          class=\"text-center\"\n        ></c8y-progress-bar>\n      </div>\n    </ng-template>\n  </ng-template>\n</c8y-modal>\n"
            },] }
];
ExtensibleDeviceRegistrationModalComponent.ctorParameters = () => [
    { type: BsModalRef },
    { type: C8yJSONSchema },
    { type: ExtensibleDeviceRegistrationService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXh0ZW5zaWJsZS1kZXZpY2UtcmVnaXN0cmF0aW9uLW1vZGFsLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uL3JlZ2lzdGVyLWRldmljZS9leHRlbnNpYmxlL3NpbmdsZS9leHRlbnNpYmxlLWRldmljZS1yZWdpc3RyYXRpb24tbW9kYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLE1BQU0sZUFBZSxDQUFDO0FBQ2xELE9BQU8sRUFBRSxhQUFhLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDN0QsT0FBTyxFQUFFLG1DQUFtQyxFQUFFLE1BQU0sMENBQTBDLENBQUM7QUFJL0YsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBT2pELE1BQU0sT0FBTywwQ0FBMEM7SUFRckQsWUFDUyxVQUFzQixFQUNyQixVQUF5QixFQUN6QixtQkFBd0Q7UUFGekQsZUFBVSxHQUFWLFVBQVUsQ0FBWTtRQUNyQixlQUFVLEdBQVYsVUFBVSxDQUFlO1FBQ3pCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FBcUM7UUFObEUsV0FBTSxHQUFhLEVBQUUsQ0FBQztJQU9uQixDQUFDO0lBRUUsUUFBUTs7WUFDWixNQUFNLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxHQUF1QyxNQUFNLElBQUksQ0FBQyxtQkFBbUIsQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQztpQkFDdEgsS0FBSyxDQUFDLEtBQUssQ0FBQyxFQUFFO2dCQUNiLElBQUksQ0FBQyxtQkFBbUIsR0FBRyxDQUFBLEtBQUssYUFBTCxLQUFLLHVCQUFMLEtBQUssQ0FBRSxPQUFPLEtBQUksT0FBTyxDQUFDLHVEQUF1RCxDQUFDLENBQUM7Z0JBQzlHLE9BQU87b0JBQ0wsS0FBSyxFQUFFLE9BQU8sQ0FBQyxPQUFPLENBQUM7aUJBQ3hCLENBQUM7WUFDSixDQUFDLENBQUMsQ0FBQztZQUNILElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxDQUFDO1lBQ25CLElBQUksQ0FBQyxLQUFLLEdBQUcsS0FBSyxhQUFMLEtBQUssdUJBQUwsS0FBSyxDQUFFLEdBQUcsQ0FBQyxDQUFDLElBQWlCLEVBQUUsRUFBRTtnQkFDNUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDO2dCQUM3QixPQUFPLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFzQixDQUFDLENBQUM7WUFDcEUsQ0FBQyxDQUFDLENBQUM7UUFDTCxDQUFDO0tBQUE7OztZQWhDRixTQUFTLFNBQUM7Z0JBQ1QsUUFBUSxFQUFFLHNDQUFzQztnQkFDaEQsMDhDQUFrRTthQUNuRTs7O1lBTFEsVUFBVTtZQUxWLGFBQWE7WUFDYixtQ0FBbUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgQzh5SlNPTlNjaGVtYSwgZ2V0dGV4dCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgRXh0ZW5zaWJsZURldmljZVJlZ2lzdHJhdGlvblNlcnZpY2UgfSBmcm9tICcuL2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IEV4dGVuc2libGVEZXZpY2VSZWdpc3RyYXRpb25TY2hlbWEgfSBmcm9tICcuL2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi5tb2RlbCc7XG5pbXBvcnQgeyBKU09OU2NoZW1hNyB9IGZyb20gJ2pzb24tc2NoZW1hJztcbmltcG9ydCB7IEZvcm1seUZpZWxkQ29uZmlnIH0gZnJvbSAnQG5neC1mb3JtbHkvY29yZSc7XG5pbXBvcnQgeyBCc01vZGFsUmVmIH0gZnJvbSAnbmd4LWJvb3RzdHJhcC9tb2RhbCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2V4dGVuc2libGUtZGV2aWNlLXJlZ2lzdHJhdGlvbi1tb2RhbCcsXG4gIHRlbXBsYXRlVXJsOiAnZXh0ZW5zaWJsZS1kZXZpY2UtcmVnaXN0cmF0aW9uLW1vZGFsLmNvbXBvbmVudC5odG1sJ1xufSlcblxuZXhwb3J0IGNsYXNzIEV4dGVuc2libGVEZXZpY2VSZWdpc3RyYXRpb25Nb2RhbENvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCB7XG5cbiAgdGl0bGU6IHN0cmluZztcbiAgbG9hZGluZ0Vycm9yTWVzc2FnZTogc3RyaW5nO1xuICBwYWdlczogRm9ybWx5RmllbGRDb25maWdbXVtdO1xuICBsYWJlbHM6IHN0cmluZ1tdID0gW107XG4gIGNvbnRleHRQYXRoOiBzdHJpbmc7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHVibGljIGJzTW9kYWxSZWY6IEJzTW9kYWxSZWYsXG4gICAgcHJpdmF0ZSBqc29uc2NoZW1hOiBDOHlKU09OU2NoZW1hLFxuICAgIHByaXZhdGUgcmVnaXN0cmF0aW9uU2VydmljZTogRXh0ZW5zaWJsZURldmljZVJlZ2lzdHJhdGlvblNlcnZpY2VcbiAgKSB7fVxuXG4gIGFzeW5jIG5nT25Jbml0KCkge1xuICAgIGNvbnN0IHsgdGl0bGUsIHBhZ2VzIH06IEV4dGVuc2libGVEZXZpY2VSZWdpc3RyYXRpb25TY2hlbWEgPSBhd2FpdCB0aGlzLnJlZ2lzdHJhdGlvblNlcnZpY2UuZ2V0U2NoZW1hKHRoaXMuY29udGV4dFBhdGgpXG4gICAgLmNhdGNoKGVycm9yID0+IHtcbiAgICAgIHRoaXMubG9hZGluZ0Vycm9yTWVzc2FnZSA9IGVycm9yPy5tZXNzYWdlIHx8IGdldHRleHQoJ0Nhbm5vdCBmZXRjaCBhIGZvcm0gZGVmaW5pdGlvbiBmcm9tIHRoZSBtaWNyb3NlcnZpY2UuJyk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB0aXRsZTogZ2V0dGV4dCgnRXJyb3InKVxuICAgICAgfTtcbiAgICB9KTtcbiAgICB0aGlzLnRpdGxlID0gdGl0bGU7XG4gICAgdGhpcy5wYWdlcyA9IHBhZ2VzPy5tYXAoKHN0ZXA6IEpTT05TY2hlbWE3KSA9PiB7XG4gICAgICB0aGlzLmxhYmVscy5wdXNoKHN0ZXAudGl0bGUpO1xuICAgICAgcmV0dXJuIFt0aGlzLmpzb25zY2hlbWEudG9GaWVsZENvbmZpZyhzdGVwKSBhcyBGb3JtbHlGaWVsZENvbmZpZ107XG4gICAgfSk7XG4gIH1cbn1cbiJdfQ==