import { __awaiter } from "tslib";
import { Injectable, NgZone } from '@angular/core';
import { Router } from '@angular/router';
import { getActivatedRoute } from '@c8y/ngx-components';
import { ContextDashboardService } from '@c8y/ngx-components/context-dashboard';
import { get } from 'lodash-es';
export class DashboardBridgeService {
    constructor(ng1Injector, zone, router, contextDashboardService) {
        this.ng1Injector = ng1Injector;
        this.zone = zone;
        this.router = router;
        this.contextDashboardService = contextDashboardService;
        this.dashboardSvc = ng1Injector.get('dashboardSvc');
        this.compile = ng1Injector.get('$compile');
    }
    get ng1Components() {
        return this.ng1Injector.get('c8yComponents');
    }
    instantiateComponent(widget, element) {
        return __awaiter(this, void 0, void 0, function* () {
            const { dashboard, context, child } = widget;
            if (dashboard) {
                const transformedChild = yield this.dashboardSvc.transformChildWithContext(this.dashboardSvc.forcedContext || context, dashboard, child);
                if (this.dashboardSvc.forcedContext || dashboard.deviceType || dashboard.updateTarget) {
                    yield this.dashboardSvc.updateConfigTargetsWithContext(this.dashboardSvc.forcedContext || context, transformedChild.config);
                }
                return this.zone.runOutsideAngular(() => this.loadTemplate(transformedChild, child, element, context));
            }
            else {
                return this.loadConfigTemplate(element, widget);
            }
        });
    }
    instantiateDeviceSelector(element, widgetConfig) {
        return this.loadConfigTemplate(element, widgetConfig, true);
    }
    loadTemplate(transformedChild, child, element, context) {
        const scope = this.ng1Injector.get('$rootScope').$new(true);
        scope.child = transformedChild;
        scope.dashboardContext = context;
        if (child.widgetComponent) {
            element.innerHTML = `<c8y-ui-component component-name="'${child.widgetComponent}'" config="child.config" context="dashboardContext"></c8y-ui-component>`;
        }
        else if (child.templateUrl) {
            element.innerHTML = `<ng-include src="'${child.templateUrl}'"></ng-include>`;
        }
        this.compile(element)(scope);
        return scope;
    }
    getDashboard() {
        return getActivatedRoute(this.router).snapshot.data.dashboard;
    }
    loadConfigTemplate(element, widgetConfig, onlyDeviceSelector = false) {
        const { settings } = widgetConfig;
        const scope = this.ng1Injector.get('$rootScope').$new(true);
        scope.settings = Object.assign(Object.assign({}, settings), settings.ng1);
        scope.options = widgetConfig.options;
        scope.config = widgetConfig;
        scope.forms = {};
        scope.rootId = settings.context.id;
        scope.dashboard = get(widgetConfig, 'settings.dashboardMo');
        let configCmp = '';
        if (!onlyDeviceSelector) {
            if (widgetConfig.settings.configComponent) {
                configCmp = `<c8y-ui-component component-name="'${widgetConfig.settings.configComponent}'" config="config"></c8y-ui-component>`;
            }
            else if (widgetConfig.settings.configTemplateUrl) {
                configCmp = `<ng-include src="'${widgetConfig.settings.configTemplateUrl}'"></ng-include>`;
            }
        }
        element.innerHTML = `
    <ng-form name="forms.componentForm">
      <div class="form-group m-0"
        ng-if="!settings.noDeviceTarget"
        ng-style="{height: settings.hideTarget && '0', overflow: 'hidden'}"
      >
      </div>
      ${configCmp}
    </ng-form>`;
        scope.$watch('forms.componentForm.$invalid', formStatus => {
            this.contextDashboardService.formDisabled = formStatus;
        });
        this.compile(element)(scope);
        this.contextDashboardService.formDisabled = scope.forms.componentForm.$invalid;
        return scope;
    }
}
DashboardBridgeService.decorators = [
    { type: Injectable }
];
DashboardBridgeService.ctorParameters = () => [
    { type: undefined },
    { type: NgZone },
    { type: Router },
    { type: ContextDashboardService }
];
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGFzaGJvYXJkLWJyaWRnZS5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vdXBncmFkZS9kYXNoYm9hcmQvZGFzaGJvYXJkLWJyaWRnZS5zZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNuRCxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0saUJBQWlCLENBQUM7QUFDekMsT0FBTyxFQUFvQixpQkFBaUIsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQzFFLE9BQU8sRUFDTCx1QkFBdUIsRUFHeEIsTUFBTSx1Q0FBdUMsQ0FBQztBQUUvQyxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBR2hDLE1BQU0sT0FBTyxzQkFBc0I7SUFLakMsWUFDVSxXQUFnQixFQUNoQixJQUFZLEVBQ1osTUFBYyxFQUNkLHVCQUFnRDtRQUhoRCxnQkFBVyxHQUFYLFdBQVcsQ0FBSztRQUNoQixTQUFJLEdBQUosSUFBSSxDQUFRO1FBQ1osV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLDRCQUF1QixHQUF2Qix1QkFBdUIsQ0FBeUI7UUFFeEQsSUFBSSxDQUFDLFlBQVksR0FBRyxXQUFXLENBQUMsR0FBRyxDQUFDLGNBQWMsQ0FBQyxDQUFDO1FBQ3BELElBQUksQ0FBQyxPQUFPLEdBQUcsV0FBVyxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUM3QyxDQUFDO0lBRUQsSUFBSSxhQUFhO1FBQ2YsT0FBTyxJQUFJLENBQUMsV0FBVyxDQUFDLEdBQUcsQ0FBQyxlQUFlLENBQUMsQ0FBQztJQUMvQyxDQUFDO0lBRUssb0JBQW9CLENBQUMsTUFBTSxFQUFFLE9BQU87O1lBQ3hDLE1BQU0sRUFBRSxTQUFTLEVBQUUsT0FBTyxFQUFFLEtBQUssRUFBRSxHQUFHLE1BQU0sQ0FBQztZQUM3QyxJQUFJLFNBQVMsRUFBRTtn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RUFBRTtZQUN2QixJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsZUFBZSxFQUFFO2dCQUN6QyxTQUFTLEdBQUcsc0NBQXNDLFlBQVksQ0FBQyxRQUFRLENBQUMsZUFBZSx3Q0FBd0MsQ0FBQzthQUNqSTtpQkFBTSxJQUFJLFlBQVksQ0FBQyxRQUFRLENBQUMsaUJBQWlCLEVBQUU7Z0JBQ2xELFNBQVMsR0FBRyxxQkFBcUIsWUFBWSxDQUFDLFFBQVEsQ0FBQyxpQkFBaUIsa0JBQWtCLENBQUM7YUFDNUY7U0FDRjtRQUVELE9BQU8sQ0FBQyxTQUFTLEdBQUc7Ozs7Ozs7UUFPaEIsU0FBUztlQUNGLENBQUM7UUFFWixLQUFLLENBQUMsTUFBTSxDQUFDLDhCQUE4QixFQUFFLFVBQVUsQ0FBQyxFQUFFO1lBQ3hELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyxZQUFZLEdBQUcsVUFBVSxDQUFDO1FBQ3pELENBQUMsQ0FBQyxDQUFDO1FBQ0gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUM3QixJQUFJLENBQUMsdUJBQXVCLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQztRQUUvRSxPQUFPLEtBQUssQ0FBQztJQUNmLENBQUM7OztZQXhHRixVQUFVOzs7O1lBWFUsTUFBTTtZQUNsQixNQUFNO1lBR2IsdUJBQXVCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSwgTmdab25lIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgQWN0aW9uQmFyU2VydmljZSwgZ2V0QWN0aXZhdGVkUm91dGUgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7XG4gIENvbnRleHREYXNoYm9hcmRTZXJ2aWNlLFxuICBDb250ZXh0RGFzaGJvYXJkTWFuYWdlZE9iamVjdCxcbiAgQ29udGV4dFdpZGdldENvbmZpZ1xufSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzL2NvbnRleHQtZGFzaGJvYXJkJztcbmltcG9ydCB7IGdldHRleHQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IGdldCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBEYXNoYm9hcmRCcmlkZ2VTZXJ2aWNlIHtcbiAgZGFzaGJvYXJkU3ZjO1xuICBjb21waWxlO1xuICBkYXNoYm9hcmRDbGlwYm9hcmQ7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBuZzFJbmplY3RvcjogYW55LFxuICAgIHByaXZhdGUgem9uZTogTmdab25lLFxuICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgcHJpdmF0ZSBjb250ZXh0RGFzaGJvYXJkU2VydmljZTogQ29udGV4dERhc2hib2FyZFNlcnZpY2VcbiAgKSB7XG4gICAgdGhpcy5kYXNoYm9hcmRTdmMgPSBuZzFJbmplY3Rvci5nZXQoJ2Rhc2hib2FyZFN2YycpO1xuICAgIHRoaXMuY29tcGlsZSA9IG5nMUluamVjdG9yLmdldCgnJGNvbXBpbGUnKTtcbiAgfVxuXG4gIGdldCBuZzFDb21wb25lbnRzKCkge1xuICAgIHJldHVybiB0aGlzLm5nMUluamVjdG9yLmdldCgnYzh5Q29tcG9uZW50cycpO1xuICB9XG5cbiAgYXN5bmMgaW5zdGFudGlhdGVDb21wb25lbnQod2lkZ2V0LCBlbGVtZW50KSB7XG4gICAgY29uc3QgeyBkYXNoYm9hcmQsIGNvbnRleHQsIGNoaWxkIH0gPSB3aWRnZXQ7XG4gICAgaWYgKGRhc2hib2FyZCkge1xuICAgICAgY29uc3QgdHJhbnNmb3JtZWRDaGlsZCA9IGF3YWl0IHRoaXMuZGFzaGJvYXJkU3ZjLnRyYW5zZm9ybUNoaWxkV2l0aENvbnRleHQoXG4gICAgICAgIHRoaXMuZGFzaGJvYXJkU3ZjLmZvcmNlZENvbnRleHQgfHwgY29udGV4dCxcbiAgICAgICAgZGFzaGJvYXJkLFxuICAgICAgICBjaGlsZFxuICAgICAgKTtcbiAgICAgIGlmICh0aGlzLmRhc2hib2FyZFN2Yy5mb3JjZWRDb250ZXh0IHx8IGRhc2hib2FyZC5kZXZpY2VUeXBlIHx8IGRhc2hib2FyZC51cGRhdGVUYXJnZXQpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5kYXNoYm9hcmRTdmMudXBkYXRlQ29uZmlnVGFyZ2V0c1dpdGhDb250ZXh0KFxuICAgICAgICAgIHRoaXMuZGFzaGJvYXJkU3ZjLmZvcmNlZENvbnRleHQgfHwgY29udGV4dCxcbiAgICAgICAgICB0cmFuc2Zvcm1lZENoaWxkLmNvbmZpZ1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXMuem9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PlxuICAgICAgICB0aGlzLmxvYWRUZW1wbGF0ZSh0cmFuc2Zvcm1lZENoaWxkLCBjaGlsZCwgZWxlbWVudCwgY29udGV4dClcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB0aGlzLmxvYWRDb25maWdUZW1wbGF0ZShlbGVtZW50LCB3aWRnZXQpO1xuICAgIH1cbiAgfVxuXG4gIGluc3RhbnRpYXRlRGV2aWNlU2VsZWN0b3IoZWxlbWVudCwgd2lkZ2V0Q29uZmlnOiBDb250ZXh0V2lkZ2V0Q29uZmlnKSB7XG4gICAgcmV0dXJuIHRoaXMubG9hZENvbmZpZ1RlbXBsYXRlKGVsZW1lbnQsIHdpZGdldENvbmZpZywgdHJ1ZSk7XG4gIH1cblxuICBwcml2YXRlIGxvYWRUZW1wbGF0ZSh0cmFuc2Zvcm1lZENoaWxkLCBjaGlsZCwgZWxlbWVudCwgY29udGV4dCkge1xuICAgIGNvbnN0IHNjb3BlID0gdGhpcy5uZzFJbmplY3Rvci5nZXQoJyRyb290U2NvcGUnKS4kbmV3KHRydWUpO1xuICAgIHNjb3BlLmNoaWxkID0gdHJhbnNmb3JtZWRDaGlsZDtcbiAgICBzY29wZS5kYXNoYm9hcmRDb250ZXh0ID0gY29udGV4dDtcbiAgICBpZiAoY2hpbGQud2lkZ2V0Q29tcG9uZW50KSB7XG4gICAgICBlbGVtZW50LmlubmVySFRNTCA9IGA8Yzh5LXVpLWNvbXBvbmVudCBjb21wb25lbnQtbmFtZT1cIicke2NoaWxkLndpZGdldENvbXBvbmVudH0nXCIgY29uZmlnPVwiY2hpbGQuY29uZmlnXCIgY29udGV4dD1cImRhc2hib2FyZENvbnRleHRcIj48L2M4eS11aS1jb21wb25lbnQ+YDtcbiAgICB9IGVsc2UgaWYgKGNoaWxkLnRlbXBsYXRlVXJsKSB7XG4gICAgICBlbGVtZW50LmlubmVySFRNTCA9IGA8bmctaW5jbHVkZSBzcmM9XCInJHtjaGlsZC50ZW1wbGF0ZVVybH0nXCI+PC9uZy1pbmNsdWRlPmA7XG4gICAgfVxuICAgIHRoaXMuY29tcGlsZShlbGVtZW50KShzY29wZSk7XG4gICAgcmV0dXJuIHNjb3BlO1xuICB9XG5cbiAgcHJpdmF0ZSBnZXREYXNoYm9hcmQoKSB7XG4gICAgcmV0dXJuIGdldEFjdGl2YXRlZFJvdXRlKHRoaXMucm91dGVyKS5zbmFwc2hvdC5kYXRhLmRhc2hib2FyZDtcbiAgfVxuXG4gIHByaXZhdGUgbG9hZENvbmZpZ1RlbXBsYXRlKFxuICAgIGVsZW1lbnQsXG4gICAgd2lkZ2V0Q29uZmlnOiBDb250ZXh0V2lkZ2V0Q29uZmlnLFxuICAgIG9ubHlEZXZpY2VTZWxlY3RvciA9IGZhbHNlXG4gICkge1xuICAgIGNvbnN0IHsgc2V0dGluZ3MgfSA9IHdpZGdldENvbmZpZztcbiAgICBjb25zdCBzY29wZSA9IHRoaXMubmcxSW5qZWN0b3IuZ2V0KCckcm9vdFNjb3BlJykuJG5ldyh0cnVlKTtcblxuICAgIHNjb3BlLnNldHRpbmdzID0geyAuLi5zZXR0aW5ncywgLi4uc2V0dGluZ3MubmcxIH07XG4gICAgc2NvcGUub3B0aW9ucyA9IHdpZGdldENvbmZpZy5vcHRpb25zO1xuICAgIHNjb3BlLmNvbmZpZyA9IHdpZGdldENvbmZpZztcbiAgICBzY29wZS5mb3JtcyA9IHt9O1xuICAgIHNjb3BlLnJvb3RJZCA9IHNldHRpbmdzLmNvbnRleHQuaWQ7XG4gICAgc2NvcGUuZGFzaGJvYXJkID0gZ2V0KHdpZGdldENvbmZpZywgJ3NldHRpbmdzLmRhc2hib2FyZE1vJyk7XG5cbiAgICBsZXQgY29uZmlnQ21wID0gJyc7XG4gICAgaWYgKCFvbmx5RGV2aWNlU2VsZWN0b3IpIHtcbiAgICAgIGlmICh3aWRnZXRDb25maWcuc2V0dGluZ3MuY29uZmlnQ29tcG9uZW50KSB7XG4gICAgICAgIGNvbmZpZ0NtcCA9IGA8Yzh5LXVpLWNvbXBvbmVudCBjb21wb25lbnQtbmFtZT1cIicke3dpZGdldENvbmZpZy5zZXR0aW5ncy5jb25maWdDb21wb25lbnR9J1wiIGNvbmZpZz1cImNvbmZpZ1wiPjwvYzh5LXVpLWNvbXBvbmVudD5gO1xuICAgICAgfSBlbHNlIGlmICh3aWRnZXRDb25maWcuc2V0dGluZ3MuY29uZmlnVGVtcGxhdGVVcmwpIHtcbiAgICAgICAgY29uZmlnQ21wID0gYDxuZy1pbmNsdWRlIHNyYz1cIicke3dpZGdldENvbmZpZy5zZXR0aW5ncy5jb25maWdUZW1wbGF0ZVVybH0nXCI+PC9uZy1pbmNsdWRlPmA7XG4gICAgICB9XG4gICAgfVxuXG4gICAgZWxlbWVudC5pbm5lckhUTUwgPSBgXG4gICAgPG5nLWZvcm0gbmFtZT1cImZvcm1zLmNvbXBvbmVudEZvcm1cIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJmb3JtLWdyb3VwIG0tMFwiXG4gICAgICAgIG5nLWlmPVwiIXNldHRpbmdzLm5vRGV2aWNlVGFyZ2V0XCJcbiAgICAgICAgbmctc3R5bGU9XCJ7aGVpZ2h0OiBzZXR0aW5ncy5oaWRlVGFyZ2V0ICYmICcwJywgb3ZlcmZsb3c6ICdoaWRkZW4nfVwiXG4gICAgICA+XG4gICAgICA8L2Rpdj5cbiAgICAgICR7Y29uZmlnQ21wfVxuICAgIDwvbmctZm9ybT5gO1xuXG4gICAgc2NvcGUuJHdhdGNoKCdmb3Jtcy5jb21wb25lbnRGb3JtLiRpbnZhbGlkJywgZm9ybVN0YXR1cyA9PiB7XG4gICAgICB0aGlzLmNvbnRleHREYXNoYm9hcmRTZXJ2aWNlLmZvcm1EaXNhYmxlZCA9IGZvcm1TdGF0dXM7XG4gICAgfSk7XG4gICAgdGhpcy5jb21waWxlKGVsZW1lbnQpKHNjb3BlKTtcbiAgICB0aGlzLmNvbnRleHREYXNoYm9hcmRTZXJ2aWNlLmZvcm1EaXNhYmxlZCA9IHNjb3BlLmZvcm1zLmNvbXBvbmVudEZvcm0uJGludmFsaWQ7XG5cbiAgICByZXR1cm4gc2NvcGU7XG4gIH1cbn1cbiJdfQ==