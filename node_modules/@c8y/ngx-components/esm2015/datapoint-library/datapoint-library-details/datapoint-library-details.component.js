import { __awaiter } from "tslib";
import { Component, Inject, Optional } from '@angular/core';
import { FormBuilder, Validators } from '@angular/forms';
import { ActivatedRoute, Router } from '@angular/router';
import { InventoryService } from '@c8y/client';
import { AlertService, gettext, HumanizePipe } from '@c8y/ngx-components';
import { TranslateService } from '@ngx-translate/core';
import { get } from 'lodash-es';
import { DATAPOINT_LIBRARY_CONFIG, pathToDatapointLibrary } from '../datapoint-library.model';
import { C8yValidators, ColorService } from '@c8y/ngx-components';
import { DatapointParserService } from '@c8y/ngx-components/datapoint-library/services';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/router';
import * as ɵngcc2 from '@c8y/client';
import * as ɵngcc3 from '@angular/forms';
import * as ɵngcc4 from '@c8y/ngx-components';
import * as ɵngcc5 from '@ngx-translate/core';
import * as ɵngcc6 from '@c8y/ngx-components/datapoint-library/services';
import * as ɵngcc7 from '@angular/common';
import * as ɵngcc8 from 'ngx-bootstrap/popover';

function DatapointLibraryDetailsComponent_c8y_title_0_small_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "small");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate2("", ctx_r3.formGroup.value == null ? null : ctx_r3.formGroup.value.fragment, " / ", ctx_r3.formGroup.value == null ? null : ctx_r3.formGroup.value.series, "");
} }
function DatapointLibraryDetailsComponent_c8y_title_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "c8y-title");
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵtemplate(2, DatapointLibraryDetailsComponent_c8y_title_0_small_2_Template, 2, 2, "small", 0);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", ctx_r0.formGroup.value == null ? null : ctx_r0.formGroup.value.label, " ");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", (ctx_r0.formGroup.value == null ? null : ctx_r0.formGroup.value.fragment) && (ctx_r0.formGroup.value == null ? null : ctx_r0.formGroup.value.series));
} }
function DatapointLibraryDetailsComponent_div_8_div_37_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 21);
    ɵngcc0.ɵɵelementStart(1, "div", 22);
    ɵngcc0.ɵɵelementStart(2, "c8y-form-group");
    ɵngcc0.ɵɵelementStart(3, "label", 38);
    ɵngcc0.ɵɵelement(4, "input", 39);
    ɵngcc0.ɵɵelement(5, "span");
    ɵngcc0.ɵɵelementStart(6, "span", 13);
    ɵngcc0.ɵɵtext(7, "Globally available");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(8, "button", 40);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelement(10, "i", 41);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(8);
    ɵngcc0.ɵɵproperty("popover", ɵngcc0.ɵɵpipeBind1(9, 3, "Will make this entry available to all users on the tenant if checked."))("outsideClick", true);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIcon", "question-circle-o");
} }
const _c0 = function () { return { example: "c8y_Temperature" }; };
const _c1 = function () { return { example: "T" }; };
const _c2 = function (a0) { return { "has-error": a0 }; };
const _c3 = function () { return { example: 0 }; };
const _c4 = function () { return { example: 100 }; };
const _c5 = function () { return { example: "\u00BAC" }; };
const _c6 = function () { return { example: 25 }; };
const _c7 = function () { return { example: 50 }; };
const _c8 = function () { return { example: 75 }; };
function DatapointLibraryDetailsComponent_div_8_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 9);
    ɵngcc0.ɵɵelementStart(1, "div", 10);
    ɵngcc0.ɵɵelementStart(2, "div", 11);
    ɵngcc0.ɵɵelementStart(3, "div", 12);
    ɵngcc0.ɵɵelementStart(4, "c8y-form-group");
    ɵngcc0.ɵɵelementStart(5, "label", 13);
    ɵngcc0.ɵɵtext(6, "Color");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "div", 14);
    ɵngcc0.ɵɵelementStart(8, "div", 15);
    ɵngcc0.ɵɵelement(9, "input", 16);
    ɵngcc0.ɵɵelement(10, "span");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(11, "c8y-form-group", 17);
    ɵngcc0.ɵɵelementStart(12, "label", 13);
    ɵngcc0.ɵɵtext(13, "Label");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(14, "input", 18);
    ɵngcc0.ɵɵpipe(15, "translate");
    ɵngcc0.ɵɵelement(16, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(17, "c8y-form-group");
    ɵngcc0.ɵɵelementStart(18, "label", 13);
    ɵngcc0.ɵɵtext(19, "Description");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(20, "textarea", 20);
    ɵngcc0.ɵɵpipe(21, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(22, "div", 21);
    ɵngcc0.ɵɵelementStart(23, "div", 22);
    ɵngcc0.ɵɵelementStart(24, "c8y-form-group");
    ɵngcc0.ɵɵelementStart(25, "label", 13);
    ɵngcc0.ɵɵtext(26, "Fragment");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(27, "input", 23);
    ɵngcc0.ɵɵpipe(28, "translate");
    ɵngcc0.ɵɵelement(29, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(30, "div", 22);
    ɵngcc0.ɵɵelementStart(31, "c8y-form-group");
    ɵngcc0.ɵɵelementStart(32, "label", 13);
    ɵngcc0.ɵɵtext(33, "Series");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(34, "input", 24);
    ɵngcc0.ɵɵpipe(35, "translate");
    ɵngcc0.ɵɵelement(36, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(37, DatapointLibraryDetailsComponent_div_8_div_37_Template, 11, 5, "div", 25);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(38, "div", 26);
    ɵngcc0.ɵɵelementStart(39, "div", 11);
    ɵngcc0.ɵɵelementStart(40, "fieldset", 27);
    ɵngcc0.ɵɵelementStart(41, "legend", 13);
    ɵngcc0.ɵɵtext(42, "Preview");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(43, "c8y-range-display", 28);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(44, "fieldset", 27);
    ɵngcc0.ɵɵelementStart(45, "legend", 13);
    ɵngcc0.ɵɵtext(46, "Range");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(47, "div", 29);
    ɵngcc0.ɵɵelementStart(48, "div", 30);
    ɵngcc0.ɵɵelementStart(49, "c8y-form-group", 31);
    ɵngcc0.ɵɵelementStart(50, "label", 13);
    ɵngcc0.ɵɵtext(51, "Min");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(52, "input", 32);
    ɵngcc0.ɵɵpipe(53, "translate");
    ɵngcc0.ɵɵelement(54, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(55, "div", 30);
    ɵngcc0.ɵɵelementStart(56, "c8y-form-group", 31);
    ɵngcc0.ɵɵelementStart(57, "label", 13);
    ɵngcc0.ɵɵtext(58, "Max");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(59, "input", 33);
    ɵngcc0.ɵɵpipe(60, "translate");
    ɵngcc0.ɵɵelement(61, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(62, "div", 21);
    ɵngcc0.ɵɵelementStart(63, "div", 30);
    ɵngcc0.ɵɵelementStart(64, "c8y-form-group");
    ɵngcc0.ɵɵelementStart(65, "label", 13);
    ɵngcc0.ɵɵtext(66, "Unit");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(67, "input", 34);
    ɵngcc0.ɵɵpipe(68, "translate");
    ɵngcc0.ɵɵelement(69, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(70, "div", 30);
    ɵngcc0.ɵɵelementStart(71, "c8y-form-group", 31);
    ɵngcc0.ɵɵelementStart(72, "label", 13);
    ɵngcc0.ɵɵtext(73, "Target");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(74, "input", 35);
    ɵngcc0.ɵɵpipe(75, "translate");
    ɵngcc0.ɵɵelement(76, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(77, "fieldset", 36);
    ɵngcc0.ɵɵelementStart(78, "legend", 13);
    ɵngcc0.ɵɵtext(79, "Yellow range");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(80, "div", 21);
    ɵngcc0.ɵɵelementStart(81, "div", 30);
    ɵngcc0.ɵɵelementStart(82, "c8y-form-group", 31);
    ɵngcc0.ɵɵelementStart(83, "label", 13);
    ɵngcc0.ɵɵtext(84, "Min");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(85, "input", 32);
    ɵngcc0.ɵɵpipe(86, "translate");
    ɵngcc0.ɵɵelement(87, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(88, "div", 30);
    ɵngcc0.ɵɵelementStart(89, "c8y-form-group", 31);
    ɵngcc0.ɵɵelementStart(90, "label", 13);
    ɵngcc0.ɵɵtext(91, "Max");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(92, "input", 33);
    ɵngcc0.ɵɵpipe(93, "translate");
    ɵngcc0.ɵɵelement(94, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(95, "fieldset", 37);
    ɵngcc0.ɵɵelementStart(96, "legend", 13);
    ɵngcc0.ɵɵtext(97, "Red range");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(98, "div", 21);
    ɵngcc0.ɵɵelementStart(99, "div", 30);
    ɵngcc0.ɵɵelementStart(100, "c8y-form-group", 31);
    ɵngcc0.ɵɵelementStart(101, "label", 13);
    ɵngcc0.ɵɵtext(102, "Min");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(103, "input", 32);
    ɵngcc0.ɵɵpipe(104, "translate");
    ɵngcc0.ɵɵelement(105, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(106, "div", 30);
    ɵngcc0.ɵɵelementStart(107, "c8y-form-group", 31);
    ɵngcc0.ɵɵelementStart(108, "label", 13);
    ɵngcc0.ɵɵtext(109, "Max");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(110, "input", 33);
    ɵngcc0.ɵɵpipe(111, "translate");
    ɵngcc0.ɵɵelement(112, "c8y-messages", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(10);
    ɵngcc0.ɵɵstyleProp("background-color", ctx_r1.formGroup.value == null ? null : ctx_r1.formGroup.value.color);
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind1(15, 34, "e.g. Temperature"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.label == null ? null : ctx_r1.formGroup.controls.label.touched) && (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.label == null ? null : ctx_r1.formGroup.controls.label.errors));
    ɵngcc0.ɵɵadvance(4);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind1(21, 36, "e.g. Ambient Temperature in Celsius"));
    ɵngcc0.ɵɵadvance(7);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(28, 38, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(68, _c0)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.fragment == null ? null : ctx_r1.formGroup.controls.fragment.touched) && (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.fragment == null ? null : ctx_r1.formGroup.controls.fragment.errors));
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(35, 41, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(69, _c1)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.series == null ? null : ctx_r1.formGroup.controls.series.touched) && (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.series == null ? null : ctx_r1.formGroup.controls.series.errors));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.config == null ? null : ctx_r1.config.showCheckboxForGlobalFragment);
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵproperty("config", ctx_r1.rangeConfig);
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(70, _c2, (ctx_r1.range == null ? null : ctx_r1.range.touched) && (ctx_r1.range == null ? null : ctx_r1.range.controls == null ? null : ctx_r1.range.controls.min == null ? null : ctx_r1.range.controls.min.errors)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(53, 44, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(72, _c3)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", (ctx_r1.range == null ? null : ctx_r1.range.touched) && (ctx_r1.range.controls == null ? null : ctx_r1.range.controls.min == null ? null : ctx_r1.range.controls.min.errors));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(73, _c2, (ctx_r1.range == null ? null : ctx_r1.range.touched) && (ctx_r1.range == null ? null : ctx_r1.range.controls == null ? null : ctx_r1.range.controls.max == null ? null : ctx_r1.range.controls.max.errors)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(60, 47, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(75, _c4)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", (ctx_r1.range == null ? null : ctx_r1.range.touched) && (ctx_r1.range.controls == null ? null : ctx_r1.range.controls.max == null ? null : ctx_r1.range.controls.max.errors));
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(68, 50, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(76, _c5)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.unit == null ? null : ctx_r1.formGroup.controls.unit.touched) && (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.unit == null ? null : ctx_r1.formGroup.controls.unit.errors));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(77, _c2, ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.target == null ? null : ctx_r1.formGroup.controls.target.touched)) && (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.target == null ? null : ctx_r1.formGroup.controls.target.errors)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(75, 53, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(79, _c6)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.target == null ? null : ctx_r1.formGroup.controls.target.touched)) && (ctx_r1.formGroup.controls == null ? null : ctx_r1.formGroup.controls.target == null ? null : ctx_r1.formGroup.controls.target.errors));
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(80, _c2, ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.yellowRange == null ? null : ctx_r1.yellowRange.touched)) && (ctx_r1.yellowRange == null ? null : ctx_r1.yellowRange.controls == null ? null : ctx_r1.yellowRange.controls.min == null ? null : ctx_r1.yellowRange.controls.min.errors)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(86, 56, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(82, _c7)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.yellowRange == null ? null : ctx_r1.yellowRange.touched)) && (ctx_r1.yellowRange.controls == null ? null : ctx_r1.yellowRange.controls.min == null ? null : ctx_r1.yellowRange.controls.min.errors));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(83, _c2, ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.yellowRange == null ? null : ctx_r1.yellowRange.touched)) && (ctx_r1.yellowRange == null ? null : ctx_r1.yellowRange.controls == null ? null : ctx_r1.yellowRange.controls.max == null ? null : ctx_r1.yellowRange.controls.max.errors)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(93, 59, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(85, _c8)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.yellowRange == null ? null : ctx_r1.yellowRange.touched)) && (ctx_r1.yellowRange.controls == null ? null : ctx_r1.yellowRange.controls.max == null ? null : ctx_r1.yellowRange.controls.max.errors));
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(86, _c2, ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.redRange == null ? null : ctx_r1.redRange.touched)) && (ctx_r1.redRange == null ? null : ctx_r1.redRange.controls == null ? null : ctx_r1.redRange.controls.min == null ? null : ctx_r1.redRange.controls.min.errors)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(104, 62, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(88, _c8)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.redRange == null ? null : ctx_r1.redRange.touched)) && (ctx_r1.redRange.controls == null ? null : ctx_r1.redRange.controls.min == null ? null : ctx_r1.redRange.controls.min.errors));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(89, _c2, ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.redRange == null ? null : ctx_r1.redRange.touched)) && (ctx_r1.redRange == null ? null : ctx_r1.redRange.controls == null ? null : ctx_r1.redRange.controls.max == null ? null : ctx_r1.redRange.controls.max.errors)));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(111, 65, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(91, _c4)));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("show", ((ctx_r1.range == null ? null : ctx_r1.range.touched) || (ctx_r1.redRange == null ? null : ctx_r1.redRange.touched)) && (ctx_r1.redRange.controls == null ? null : ctx_r1.redRange.controls.max == null ? null : ctx_r1.redRange.controls.max.errors));
} }
function DatapointLibraryDetailsComponent_button_14_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "button", 42);
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r2.formGroup.invalid || ctx_r2.formGroup.pristine)("title", ɵngcc0.ɵɵpipeBind1(1, 3, "Save"));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 5, "Save"), " ");
} }
const _c9 = function () { return ["ROLE_INVENTORY_ADMIN", "ROLE_INVENTORY_UPDATE"]; };
export class DatapointLibraryDetailsComponent {
    constructor(activatedRoute, inventory, formBuilder, alertService, router, translate, colorService, parser, config) {
        this.activatedRoute = activatedRoute;
        this.inventory = inventory;
        this.formBuilder = formBuilder;
        this.alertService = alertService;
        this.router = router;
        this.translate = translate;
        this.colorService = colorService;
        this.parser = parser;
        this.config = config;
        this.path = pathToDatapointLibrary;
        this.isLoading = true;
        this.rangeConfig = {};
        this.initForm();
    }
    ngOnInit() {
        this.routeSub = this.activatedRoute.parent.data.subscribe(data => {
            this.load(data);
        });
    }
    ngOnDestroy() {
        if (this.routeSub) {
            this.routeSub.unsubscribe();
        }
    }
    save(value) {
        var _a, _b;
        return __awaiter(this, void 0, void 0, function* () {
            const kpiValues = this.extractKpiValuesFromFormValue(value);
            const kpi = Object.assign({}, ((_a = this.datapoint) === null || _a === void 0 ? void 0 : _a.c8y_Kpi) || {}, kpiValues);
            const cleanedUpKpi = this.removeNullValues(kpi);
            const mo = {
                c8y_Kpi: cleanedUpKpi,
                c8y_Global: value.c8y_Global ? {} : null
            };
            try {
                if ((_b = this.datapoint) === null || _b === void 0 ? void 0 : _b.id) {
                    mo.id = this.datapoint.id;
                    const res = yield this.inventory.update(mo);
                    this.datapointUpdate(res.data);
                    this.alertService.saveSuccess(gettext('Data point library entry'))();
                }
                else {
                    const res = yield this.inventory.create(mo);
                    this.datapointUpdate(res.data);
                    this.alertService.createSuccess(gettext('Data point library entry'))();
                }
                this.navigateBackToList();
            }
            catch (e) {
                this.alertService.addServerFailure(e);
            }
        });
    }
    cancel() {
        this.navigateBackToList();
    }
    formChange() {
        if (this.formGroup.invalid) {
            return;
        }
        const kpiValues = this.extractKpiValuesFromFormValue(this.formGroup.value);
        this.rangeConfig = Object.assign({ orientation: 'horizontal' }, kpiValues);
    }
    navigateBackToList() {
        return this.router.navigate([pathToDatapointLibrary]);
    }
    datapointUpdate(tmpDatapoint) {
        const datapoint = this.parser.parseDatapoint(tmpDatapoint);
        this.datapoint = datapoint;
        const { fragment, series, description, unit, target, label, color, yellowRangeMin, yellowRangeMax, redRangeMin, redRangeMax, min, max } = datapoint.c8y_Kpi;
        this.formGroup.patchValue({
            fragment,
            series,
            description,
            unit,
            target,
            label,
            color,
            range: { min, max },
            yellowRange: { min: yellowRangeMin, max: yellowRangeMax },
            redRange: { min: redRangeMin, max: redRangeMax },
            c8y_Global: !!datapoint.c8y_Global
        });
        this.formChange();
    }
    extractKpiValuesFromFormValue(formValue) {
        const { fragment, series, description, unit, target, label, color } = formValue;
        return {
            fragment,
            series,
            description,
            unit,
            target,
            label,
            color,
            yellowRangeMin: get(formValue, 'yellowRange.min'),
            yellowRangeMax: get(formValue, 'yellowRange.max'),
            redRangeMin: get(formValue, 'redRange.min'),
            redRangeMax: get(formValue, 'redRange.max'),
            min: get(formValue, 'range.min'),
            max: get(formValue, 'range.max')
        };
    }
    load(data) {
        var _a;
        return __awaiter(this, void 0, void 0, function* () {
            this.isLoading = true;
            this.formGroup.reset();
            const { fragment, series } = this.activatedRoute.snapshot.queryParams;
            const humanize = new HumanizePipe();
            const label = fragment && series
                ? humanize.transform(`${fragment} => ${series}`)
                : this.translate.instant(gettext('New data point template'));
            const currentDate = new Date().toISOString();
            const color = yield this.colorService.generateColor(currentDate);
            const contextData = (data && data.contextData) || {
                c8y_Kpi: {
                    label,
                    fragment,
                    series,
                    color
                },
                c8y_Global: !((_a = this.config) === null || _a === void 0 ? void 0 : _a.doNotAddGlobalFragmentByDefault) ? {} : null
            };
            const { id } = contextData;
            if (id) {
                this.datapointUpdate((yield this.inventory.detail(id)).data);
            }
            else {
                this.datapointUpdate(contextData);
            }
            this.isLoading = false;
        });
    }
    initForm() {
        var _a;
        this.range = this.formBuilder.group({
            min: [undefined, []],
            max: [undefined, []]
        }, { validators: [C8yValidators.minMaxValidator(), C8yValidators.requireBothMinAndMax()] });
        this.redRange = this.formBuilder.group({
            min: [undefined, []],
            max: [undefined, []]
        }, { validators: [C8yValidators.minMaxValidator(), C8yValidators.requireBothMinAndMax()] });
        this.yellowRange = this.formBuilder.group({
            min: [undefined, []],
            max: [undefined, []]
        }, { validators: [C8yValidators.minMaxValidator(), C8yValidators.requireBothMinAndMax()] });
        this.formGroup = this.formBuilder.group({
            color: ['', [Validators.required, Validators.minLength(4)]],
            label: ['', [Validators.required, Validators.minLength(1), Validators.maxLength(120)]],
            description: ['', []],
            fragment: [
                '',
                [
                    Validators.required,
                    Validators.minLength(1),
                    Validators.maxLength(120),
                    Validators.pattern(/^[^.]*$/)
                ]
            ],
            series: [
                '',
                [
                    Validators.required,
                    Validators.minLength(1),
                    Validators.maxLength(120),
                    Validators.pattern(/^[^.]*$/)
                ]
            ],
            range: this.range,
            unit: [undefined, []],
            target: [undefined, []],
            redRange: this.redRange,
            yellowRange: this.yellowRange,
            c8y_Global: [!((_a = this.config) === null || _a === void 0 ? void 0 : _a.doNotAddGlobalFragmentByDefault), []]
        }, {
            validators: [
                C8yValidators.withinScale('redRange.min'),
                C8yValidators.withinScale('redRange.max'),
                C8yValidators.withinScale('yellowRange.min'),
                C8yValidators.withinScale('yellowRange.max'),
                C8yValidators.withinScale('target')
            ]
        });
    }
    removeNullValues(value) {
        // remove null values before sending data to backend
        const cleanedupValues = Object.assign({}, value);
        Object.keys(cleanedupValues).forEach(key => {
            if (cleanedupValues[key] === null) {
                delete cleanedupValues[key];
            }
        });
        return cleanedupValues;
    }
}
DatapointLibraryDetailsComponent.ɵfac = function DatapointLibraryDetailsComponent_Factory(t) { return new (t || DatapointLibraryDetailsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.ActivatedRoute), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.InventoryService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.AlertService), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.Router), ɵngcc0.ɵɵdirectiveInject(ɵngcc5.TranslateService), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.ColorService), ɵngcc0.ɵɵdirectiveInject(ɵngcc6.DatapointParserService), ɵngcc0.ɵɵdirectiveInject(DATAPOINT_LIBRARY_CONFIG, 8)); };
DatapointLibraryDetailsComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: DatapointLibraryDetailsComponent, selectors: [["c8y-datapoint-library-details"]], decls: 15, vars: 18, consts: [[4, "ngIf"], [3, "icon", "label", "path"], ["novalidate", "", 1, "card", "content-fullpage", "card--grid", "grid__col--6-6--md", "grid__row--fit-auto", 3, "formGroup", "ngSubmit", "change"], [1, "card-header", "large-padding", "separator", "grid__col--fullspan"], [1, "card-title"], ["class", "d-contents", 4, "ngIf"], [1, "card-footer", "separator", "grid__col--fullspan"], ["type", "button", 1, "btn", "btn-default", 3, "title", "click"], ["class", "btn btn-primary btn-form", "type", "submit", 3, "disabled", "title", 4, "c8yIfAllowed", "c8yIfAllowedAllowAny"], [1, "d-contents"], [1, "inner-scroll", "bg-white", "flex-grow"], [1, "card-block", "large-padding"], [1, "d-flex"], ["translate", ""], [1, "data-point-color", "form-control"], [1, "c8y-colorpicker"], ["type", "color", "name", "color", "formControlName", "color"], [1, "flex-grow", "p-l-8"], ["formControlName", "label", "name", "label", "type", "text", 1, "form-control", 3, "placeholder"], [3, "show"], ["formControlName", "description", "name", "description", "rows", "3", 1, "form-control", 3, "placeholder"], [1, "row"], [1, "col-sm-6"], ["name", "fragment", "formControlName", "fragment", "type", "text", 1, "form-control", 3, "placeholder"], ["formControlName", "series", "name", "series", "type", "text", 1, "form-control", 3, "placeholder"], ["class", "row", 4, "ngIf"], [1, "inner-scroll", "bg-gray-white"], [1, "c8y-fieldset"], [1, "m-b-16", "d-block", 3, "config"], ["formGroupName", "range", 1, "row"], [1, "col-md-6"], [3, "ngClass"], ["type", "number", "name", "min", "formControlName", "min", 1, "form-control", 3, "placeholder"], ["type", "number", "name", "max", "formControlName", "max", 1, "form-control", 3, "placeholder"], ["name", "unit", "formControlName", "unit", 1, "form-control", 3, "placeholder"], ["type", "number", "name", "target", "formControlName", "target", 1, "form-control", 3, "placeholder"], ["formGroupName", "yellowRange", 1, "c8y-fieldset"], ["formGroupName", "redRange", 1, "c8y-fieldset"], [1, "c8y-checkbox"], ["name", "c8y_Global", "formControlName", "c8y_Global", "type", "checkbox"], ["container", "body", "type", "button", 1, "btn", "btn-clean", 3, "popover", "outsideClick"], [1, "text-info", 3, "c8yIcon"], ["type", "submit", 1, "btn", "btn-primary", "btn-form", 3, "disabled", "title"]], template: function DatapointLibraryDetailsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, DatapointLibraryDetailsComponent_c8y_title_0_Template, 3, 2, "c8y-title", 0);
        ɵngcc0.ɵɵelementStart(1, "c8y-breadcrumb");
        ɵngcc0.ɵɵelement(2, "c8y-breadcrumb-item", 1);
        ɵngcc0.ɵɵpipe(3, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "form", 2);
        ɵngcc0.ɵɵlistener("ngSubmit", function DatapointLibraryDetailsComponent_Template_form_ngSubmit_4_listener() { return ctx.formGroup.valid && ctx.save(ctx.formGroup.value); })("change", function DatapointLibraryDetailsComponent_Template_form_change_4_listener() { return ctx.formChange(); });
        ɵngcc0.ɵɵelementStart(5, "div", 3);
        ɵngcc0.ɵɵelementStart(6, "h4", 4);
        ɵngcc0.ɵɵtext(7);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(8, DatapointLibraryDetailsComponent_div_8_Template, 113, 92, "div", 5);
        ɵngcc0.ɵɵelementStart(9, "div", 6);
        ɵngcc0.ɵɵelementStart(10, "button", 7);
        ɵngcc0.ɵɵlistener("click", function DatapointLibraryDetailsComponent_Template_button_click_10_listener() { return ctx.cancel(); });
        ɵngcc0.ɵɵpipe(11, "translate");
        ɵngcc0.ɵɵtext(12);
        ɵngcc0.ɵɵpipe(13, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(14, DatapointLibraryDetailsComponent_button_14_Template, 4, 7, "button", 8);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx.isLoading);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("icon", "c8y-data-points")("label", ɵngcc0.ɵɵpipeBind1(3, 11, "Data point library"))("path", ctx.path);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("formGroup", ctx.formGroup);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ctx.formGroup.value == null ? null : ctx.formGroup.value.label, " ");
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", !ctx.isLoading);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(11, 13, "Cancel"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(13, 15, "Cancel"), " ");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("c8yIfAllowed", ɵngcc0.ɵɵpureFunction0(17, _c9))("c8yIfAllowedAllowAny", true);
    } }, directives: [ɵngcc7.NgIf, ɵngcc4.BreadcrumbComponent, ɵngcc4.BreadcrumbItemComponent, ɵngcc3.ɵNgNoValidate, ɵngcc3.NgControlStatusGroup, ɵngcc3.FormGroupDirective, ɵngcc4.IfAllowedDirective, ɵngcc4.TitleComponent, ɵngcc4.FormGroupComponent, ɵngcc4.C8yTranslateDirective, ɵngcc3.DefaultValueAccessor, ɵngcc4.RequiredInputPlaceholderDirective, ɵngcc3.NgControlStatus, ɵngcc3.FormControlName, ɵngcc4.MessagesComponent, ɵngcc4.RangeDisplayComponent, ɵngcc3.FormGroupName, ɵngcc7.NgClass, ɵngcc3.NumberValueAccessor, ɵngcc3.CheckboxControlValueAccessor, ɵngcc8.PopoverDirective, ɵngcc4.IconDirective], pipes: [ɵngcc4.C8yTranslatePipe], encapsulation: 2 });
DatapointLibraryDetailsComponent.ctorParameters = () => [
    { type: ActivatedRoute },
    { type: InventoryService },
    { type: FormBuilder },
    { type: AlertService },
    { type: Router },
    { type: TranslateService },
    { type: ColorService },
    { type: DatapointParserService },
    { type: undefined, decorators: [{ type: Optional }, { type: Inject, args: [DATAPOINT_LIBRARY_CONFIG,] }] }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(DatapointLibraryDetailsComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-datapoint-library-details',
                template: "<c8y-title *ngIf=\"!isLoading\">\n  {{ formGroup.value?.label }}\n  <small *ngIf=\"formGroup.value?.fragment && formGroup.value?.series\"\n    >{{ formGroup.value?.fragment }} / {{ formGroup.value?.series }}</small\n  >\n</c8y-title>\n\n<c8y-breadcrumb>\n  <c8y-breadcrumb-item\n    [icon]=\"'c8y-data-points'\"\n    [label]=\"'Data point library' | translate\"\n    [path]=\"path\"\n  ></c8y-breadcrumb-item>\n</c8y-breadcrumb>\n\n<form\n  (ngSubmit)=\"formGroup.valid && save(formGroup.value)\"\n  (change)=\"formChange()\"\n  [formGroup]=\"formGroup\"\n  class=\"card content-fullpage card--grid grid__col--6-6--md grid__row--fit-auto\"\n  novalidate\n>\n  <div class=\"card-header large-padding separator grid__col--fullspan\">\n    <h4 class=\"card-title\">\n      {{ formGroup.value?.label }}\n    </h4>\n  </div>\n  <div *ngIf=\"!isLoading\" class=\"d-contents\">\n    <div class=\"inner-scroll bg-white flex-grow\">\n      <div class=\"card-block large-padding\">\n        <div class=\"d-flex\">\n          <c8y-form-group>\n            <label translate>Color</label>\n            <div class=\"data-point-color form-control\">\n              <div class=\"c8y-colorpicker\">\n                <input type=\"color\" name=\"color\" formControlName=\"color\" />\n                <span [style.background-color]=\"formGroup.value?.color\"></span>\n              </div>\n            </div>\n          </c8y-form-group>\n          <c8y-form-group class=\"flex-grow p-l-8\">\n            <label translate>Label</label>\n            <input\n              class=\"form-control\"\n              formControlName=\"label\"\n              name=\"label\"\n              [placeholder]=\"'e.g. Temperature' | translate\"\n              type=\"text\"\n            />\n            <c8y-messages [show]=\"formGroup.controls?.label?.touched && formGroup.controls?.label?.errors\">\n            </c8y-messages>\n          </c8y-form-group>\n        </div>\n        <!-- TODO: add description to data point library templates -->\n        <c8y-form-group>\n          <label translate>Description</label>\n          <textarea\n            class=\"form-control\"\n            formControlName=\"description\"\n            name=\"description\"\n            [placeholder]=\"'e.g. Ambient Temperature in Celsius' | translate\"\n            rows=\"3\"\n          ></textarea>\n        </c8y-form-group>\n\n        <div class=\"row\">\n          <div class=\"col-sm-6\">\n            <c8y-form-group>\n              <label translate>Fragment</label>\n              <input\n                class=\"form-control\"\n                name=\"fragment\"\n                formControlName=\"fragment\"\n                [placeholder]=\"'e.g. {{ example }}' | translate: { example: 'c8y_Temperature' }\"\n                type=\"text\"\n              />\n              <c8y-messages [show]=\"formGroup.controls?.fragment?.touched && formGroup.controls?.fragment?.errors\">\n              </c8y-messages>\n            </c8y-form-group>\n          </div>\n\n          <div class=\"col-sm-6\">\n            <c8y-form-group>\n              <label translate>Series</label>\n              <input\n                class=\"form-control\"\n                formControlName=\"series\"\n                name=\"series\"\n                [placeholder]=\"'e.g. {{ example }}' | translate: { example: 'T' }\"\n                type=\"text\"\n              />\n              <c8y-messages [show]=\"formGroup.controls?.series?.touched && formGroup.controls?.series?.errors\">\n              </c8y-messages>\n            </c8y-form-group>\n          </div>\n        </div>\n        <div class=\"row\" *ngIf=\"config?.showCheckboxForGlobalFragment\">\n          <div class=\"col-sm-6\">\n            <c8y-form-group>\n              <label class=\"c8y-checkbox\">\n                <input\n                  name=\"c8y_Global\"\n                  formControlName=\"c8y_Global\"\n                  type=\"checkbox\"\n                />\n                <span></span>\n                <span translate>Globally available</span>\n                <button\n                  class=\"btn btn-clean\"\n                  [popover]=\"'Will make this entry available to all users on the tenant if checked.' | translate\"\n                  container=\"body\"\n                  type=\"button\"\n                  [outsideClick]=\"true\"\n                >\n                  <i [c8yIcon]=\"'question-circle-o'\" class=\"text-info\"></i>\n                </button>\n              </label>\n            </c8y-form-group>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class=\"inner-scroll bg-gray-white\">\n      <div class=\"card-block large-padding\">\n        <fieldset class=\"c8y-fieldset\">\n          <legend translate>Preview</legend>\n          <c8y-range-display [config]=\"rangeConfig\" class=\"m-b-16 d-block\"></c8y-range-display>\n        </fieldset>\n        <fieldset class=\"c8y-fieldset\">\n          <legend translate>Range</legend>\n          <div class=\"row\" formGroupName=\"range\">\n            <div class=\"col-md-6\">\n              <c8y-form-group\n                [ngClass]=\"{ 'has-error': range?.touched && range?.controls?.min?.errors }\"\n              >\n                <label translate>Min</label>\n                <input\n                  type=\"number\"\n                  class=\"form-control\"\n                  name=\"min\"\n                  formControlName=\"min\"\n                  [placeholder]=\"'e.g. {{ example }}' | translate: { example: 0 }\"\n                />\n                <c8y-messages [show]=\"range?.touched && range.controls?.min?.errors\">\n                </c8y-messages>\n              </c8y-form-group>\n            </div>\n            <div class=\"col-md-6\">\n              <c8y-form-group\n                [ngClass]=\"{ 'has-error': range?.touched && range?.controls?.max?.errors }\"\n              >\n                <label translate>Max</label>\n                <input\n                  type=\"number\"\n                  class=\"form-control\"\n                  name=\"max\"\n                  formControlName=\"max\"\n                  [placeholder]=\"'e.g. {{ example }}' | translate: { example: 100 }\"\n                />\n                <c8y-messages [show]=\"range?.touched && range.controls?.max?.errors\">\n                </c8y-messages>\n              </c8y-form-group>\n            </div>\n          </div>\n          <div class=\"row\">\n            <div class=\"col-md-6\">\n              <c8y-form-group>\n                <label translate>Unit</label>\n                <input\n                  class=\"form-control\"\n                  name=\"unit\"\n                  formControlName=\"unit\"\n                  [placeholder]=\"'e.g. {{ example }}' | translate: { example: '\u00BAC' }\"\n                />\n                <c8y-messages [show]=\"formGroup.controls?.unit?.touched && formGroup.controls?.unit?.errors\">\n                </c8y-messages>\n              </c8y-form-group>\n            </div>\n\n            <div class=\"col-md-6\">\n              <c8y-form-group\n                [ngClass]=\"{\n                  'has-error':\n                    (range?.touched || formGroup.controls?.target?.touched) &&\n                    formGroup.controls?.target?.errors\n                }\"\n              >\n                <label translate>Target</label>\n                <input\n                  type=\"number\"\n                  class=\"form-control\"\n                  name=\"target\"\n                  formControlName=\"target\"\n                  [placeholder]=\"'e.g. {{ example }}' | translate: { example: 25 }\"\n                />\n                <c8y-messages [show]=\"(range?.touched || formGroup.controls?.target?.touched) && formGroup.controls?.target?.errors\">\n                </c8y-messages>\n              </c8y-form-group>\n            </div>\n          </div>\n        </fieldset>\n\n        <fieldset class=\"c8y-fieldset\" formGroupName=\"yellowRange\">\n          <legend translate>Yellow range</legend>\n          <div class=\"row\">\n            <div class=\"col-md-6\">\n              <c8y-form-group\n                [ngClass]=\"{\n                  'has-error':\n                    (range?.touched || yellowRange?.touched) && yellowRange?.controls?.min?.errors\n                }\"\n              >\n                <label translate>Min</label>\n                <input\n                  type=\"number\"\n                  class=\"form-control\"\n                  name=\"min\"\n                  formControlName=\"min\"\n                  [placeholder]=\"'e.g. {{ example }}' | translate: { example: 50 }\"\n                />\n                <c8y-messages [show]=\"(range?.touched || yellowRange?.touched) && yellowRange.controls?.min?.errors\">\n                </c8y-messages>\n              </c8y-form-group>\n            </div>\n\n            <div class=\"col-md-6\">\n              <c8y-form-group\n                [ngClass]=\"{\n                  'has-error':\n                    (range?.touched || yellowRange?.touched) && yellowRange?.controls?.max?.errors\n                }\"\n              >\n                <label translate>Max</label>\n                <input\n                  type=\"number\"\n                  class=\"form-control\"\n                  name=\"max\"\n                  formControlName=\"max\"\n                  [placeholder]=\"'e.g. {{ example }}' | translate: { example: 75 }\"\n                />\n                <c8y-messages [show]=\"(range?.touched || yellowRange?.touched) && yellowRange.controls?.max?.errors\">\n                </c8y-messages>\n              </c8y-form-group>\n            </div>\n          </div>\n        </fieldset>\n\n        <fieldset class=\"c8y-fieldset\" formGroupName=\"redRange\">\n          <legend translate>Red range</legend>\n          <div class=\"row\">\n            <div class=\"col-md-6\">\n              <c8y-form-group\n                [ngClass]=\"{\n                  'has-error':\n                    (range?.touched || redRange?.touched) && redRange?.controls?.min?.errors\n                }\"\n              >\n                <label translate>Min</label>\n                <input\n                  type=\"number\"\n                  class=\"form-control\"\n                  name=\"min\"\n                  formControlName=\"min\"\n                  [placeholder]=\"'e.g. {{ example }}' | translate: { example: 75 }\"\n                />\n                <c8y-messages [show]=\"(range?.touched || redRange?.touched) && redRange.controls?.min?.errors\">\n                </c8y-messages>\n              </c8y-form-group>\n            </div>\n\n            <div class=\"col-md-6\">\n              <c8y-form-group\n                [ngClass]=\"{\n                  'has-error':\n                    (range?.touched || redRange?.touched) && redRange?.controls?.max?.errors\n                }\"\n              >\n                <label translate>Max</label>\n                <input\n                  type=\"number\"\n                  class=\"form-control\"\n                  name=\"max\"\n                  formControlName=\"max\"\n                  [placeholder]=\"'e.g. {{ example }}' | translate: { example: 100 }\"\n                />\n                <c8y-messages [show]=\"(range?.touched || redRange?.touched) && redRange.controls?.max?.errors\">\n                </c8y-messages>\n              </c8y-form-group>\n            </div>\n          </div>\n        </fieldset>\n      </div>\n    </div>\n  </div>\n  <div class=\"card-footer separator grid__col--fullspan\">\n    <button (click)=\"cancel()\" class=\"btn btn-default\" [title]=\"'Cancel' | translate\" type=\"button\">\n      {{ 'Cancel' | translate }}\n    </button>\n    <button\n      *c8yIfAllowed=\"['ROLE_INVENTORY_ADMIN', 'ROLE_INVENTORY_UPDATE']; allowAny: true\"\n      [disabled]=\"formGroup.invalid || formGroup.pristine\"\n      class=\"btn btn-primary btn-form\"\n      [title]=\"'Save' | translate\"\n      type=\"submit\"\n    >\n      {{ 'Save' | translate }}\n    </button>\n  </div>\n</form>\n"
            }]
    }], function () { return [{ type: ɵngcc1.ActivatedRoute }, { type: ɵngcc2.InventoryService }, { type: ɵngcc3.FormBuilder }, { type: ɵngcc4.AlertService }, { type: ɵngcc1.Router }, { type: ɵngcc5.TranslateService }, { type: ɵngcc4.ColorService }, { type: ɵngcc6.DatapointParserService }, { type: undefined, decorators: [{
                type: Optional
            }, {
                type: Inject,
                args: [DATAPOINT_LIBRARY_CONFIG]
            }] }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXBvaW50LWxpYnJhcnktZGV0YWlscy5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2RhdGFwb2ludC1saWJyYXJ5L2RhdGFwb2ludC1saWJyYXJ5LWRldGFpbHMvZGF0YXBvaW50LWxpYnJhcnktZGV0YWlscy5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxFQUFxQixRQUFRLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDL0UsT0FBTyxFQUFFLFdBQVcsRUFBYSxVQUFVLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUNwRSxPQUFPLEVBQUUsY0FBYyxFQUFRLE1BQU0sRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9ELE9BQU8sRUFBa0IsZ0JBQWdCLEVBQUUsTUFBTSxhQUFhLENBQUM7QUFDL0QsT0FBTyxFQUFFLFlBQVksRUFBRSxPQUFPLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDMUUsT0FBTyxFQUFFLGdCQUFnQixFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdkQsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUVoQyxPQUFPLEVBRUwsd0JBQXdCLEVBQ3hCLHNCQUFzQixFQUN2QixNQUFNLDRCQUE0QixDQUFDO0FBQ3BDLE9BQU8sRUFBRSxhQUFhLEVBQUUsWUFBWSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDbEUsT0FBTyxFQUFFLHNCQUFzQixFQUFFLE1BQU0sZ0RBQWdELENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7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QUMsV0FBVyxDQUFDLGlCQUFpQixDQUFDO0FBQ3RELGdCQUFVLGFBQWEsQ0FBQyxXQUFXLENBQUMsaUJBQWlCLENBQUM7QUFDdEQsZ0JBQVUsYUFBYSxDQUFDLFdBQVcsQ0FBQyxRQUFRLENBQUM7QUFDN0MsYUFBUztBQUNULFNBQU8sQ0FDRixDQUFDO0FBQ04sSUFBRSxDQUFDO0FBQ0gsSUFDVSxnQkFBZ0IsQ0FBQyxLQUFLO0FBQ2hDLFFBQUksb0RBQW9EO0FBQ3hELFFBQUksTUFBTSxlQUFlLEdBQUcsTUFBTSxDQUFDLE1BQU0sQ0FBQyxFQUFFLEVBQUUsS0FBSyxDQUFDLENBQUM7QUFDckQsUUFBSSxNQUFNLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsRUFBRTtBQUMvQyxZQUFNLElBQUksZUFBZSxDQUFDLEdBQUcsQ0FBQyxLQUFLLElBQUksRUFBRTtBQUN6QyxnQkFBUSxPQUFPLGVBQWUsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUNwQyxhQUFPO0FBQ1AsUUFBSSxDQUFDLENBQUMsQ0FBQztBQUNQLFFBQUksT0FBTyxlQUFlLENBQUM7QUFDM0IsSUFBRSxDQUFDO0FBQ0g7NERBalBDLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUsK0JBQStCLGtCQUN6Qzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b3BCQUVHO0FBQUM7QUFBMEQsWUFsQnZELGNBQWM7QUFBSSxZQUNGLGdCQUFnQjtBQUFJLFlBRnBDLFdBQVc7QUFBSSxZQUdmLFlBQVk7QUFBSSxZQUZNLE1BQU07QUFBSSxZQUdoQyxnQkFBZ0I7QUFBSSxZQVFMLFlBQVk7QUFBSSxZQUMvQixzQkFBc0I7QUFBSSw0Q0E0QjlCLFFBQVEsWUFBSSxNQUFNLFNBQUMsd0JBQXdCO0FBQVE7Ozs7O3k0S0F4QkcsY0FDMUQ7Ozs7Ozs7a0NBdUJ5RDtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbmplY3QsIE9uRGVzdHJveSwgT25Jbml0LCBPcHRpb25hbCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUJ1aWxkZXIsIEZvcm1Hcm91cCwgVmFsaWRhdG9ycyB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBEYXRhLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgSU1hbmFnZWRPYmplY3QsIEludmVudG9yeVNlcnZpY2UgfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQgeyBBbGVydFNlcnZpY2UsIGdldHRleHQsIEh1bWFuaXplUGlwZSB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgVHJhbnNsYXRlU2VydmljZSB9IGZyb20gJ0BuZ3gtdHJhbnNsYXRlL2NvcmUnO1xuaW1wb3J0IHsgZ2V0IH0gZnJvbSAnbG9kYXNoLWVzJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgRGF0YXBvaW50TGlicmFyeU9wdGlvbnMsXG4gIERBVEFQT0lOVF9MSUJSQVJZX0NPTkZJRyxcbiAgcGF0aFRvRGF0YXBvaW50TGlicmFyeVxufSBmcm9tICcuLi9kYXRhcG9pbnQtbGlicmFyeS5tb2RlbCc7XG5pbXBvcnQgeyBDOHlWYWxpZGF0b3JzLCBDb2xvclNlcnZpY2UgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IERhdGFwb2ludFBhcnNlclNlcnZpY2UgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzL2RhdGFwb2ludC1saWJyYXJ5L3NlcnZpY2VzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWRhdGFwb2ludC1saWJyYXJ5LWRldGFpbHMnLFxuICB0ZW1wbGF0ZVVybDogJy4vZGF0YXBvaW50LWxpYnJhcnktZGV0YWlscy5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgRGF0YXBvaW50TGlicmFyeURldGFpbHNDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gIHBhdGggPSBwYXRoVG9EYXRhcG9pbnRMaWJyYXJ5O1xuICBmb3JtR3JvdXA6IEZvcm1Hcm91cDtcbiAgcmFuZ2U6IEZvcm1Hcm91cDtcbiAgcmVkUmFuZ2U6IEZvcm1Hcm91cDtcbiAgeWVsbG93UmFuZ2U6IEZvcm1Hcm91cDtcbiAgZGF0YXBvaW50OiBJTWFuYWdlZE9iamVjdDtcbiAgaXNMb2FkaW5nID0gdHJ1ZTtcblxuICByYW5nZUNvbmZpZyA9IHt9O1xuXG4gIHJvdXRlU3ViOiBTdWJzY3JpcHRpb247XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBhY3RpdmF0ZWRSb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgcHJpdmF0ZSBpbnZlbnRvcnk6IEludmVudG9yeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSBmb3JtQnVpbGRlcjogRm9ybUJ1aWxkZXIsXG4gICAgcHJpdmF0ZSBhbGVydFNlcnZpY2U6IEFsZXJ0U2VydmljZSxcbiAgICBwcml2YXRlIHJvdXRlcjogUm91dGVyLFxuICAgIHByaXZhdGUgdHJhbnNsYXRlOiBUcmFuc2xhdGVTZXJ2aWNlLFxuICAgIHByaXZhdGUgY29sb3JTZXJ2aWNlOiBDb2xvclNlcnZpY2UsXG4gICAgcHJpdmF0ZSBwYXJzZXI6IERhdGFwb2ludFBhcnNlclNlcnZpY2UsXG4gICAgQE9wdGlvbmFsKCkgQEluamVjdChEQVRBUE9JTlRfTElCUkFSWV9DT05GSUcpIHB1YmxpYyBjb25maWc6IERhdGFwb2ludExpYnJhcnlPcHRpb25zXG4gICkge1xuICAgIHRoaXMuaW5pdEZvcm0oKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMucm91dGVTdWIgPSB0aGlzLmFjdGl2YXRlZFJvdXRlLnBhcmVudC5kYXRhLnN1YnNjcmliZShkYXRhID0+IHtcbiAgICAgIHRoaXMubG9hZChkYXRhKTtcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnJvdXRlU3ViKSB7XG4gICAgICB0aGlzLnJvdXRlU3ViLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgc2F2ZSh2YWx1ZSkge1xuICAgIGNvbnN0IGtwaVZhbHVlcyA9IHRoaXMuZXh0cmFjdEtwaVZhbHVlc0Zyb21Gb3JtVmFsdWUodmFsdWUpO1xuICAgIGNvbnN0IGtwaSA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuZGF0YXBvaW50Py5jOHlfS3BpIHx8IHt9LCBrcGlWYWx1ZXMpO1xuICAgIGNvbnN0IGNsZWFuZWRVcEtwaSA9IHRoaXMucmVtb3ZlTnVsbFZhbHVlcyhrcGkpO1xuXG4gICAgY29uc3QgbW86IFBhcnRpYWw8SU1hbmFnZWRPYmplY3Q+ID0ge1xuICAgICAgYzh5X0twaTogY2xlYW5lZFVwS3BpLFxuICAgICAgYzh5X0dsb2JhbDogdmFsdWUuYzh5X0dsb2JhbCA/IHt9IDogbnVsbFxuICAgIH07XG4gICAgdHJ5IHtcbiAgICAgIGlmICh0aGlzLmRhdGFwb2ludD8uaWQpIHtcbiAgICAgICAgbW8uaWQgPSB0aGlzLmRhdGFwb2ludC5pZDtcbiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy5pbnZlbnRvcnkudXBkYXRlKG1vKTtcbiAgICAgICAgdGhpcy5kYXRhcG9pbnRVcGRhdGUocmVzLmRhdGEpO1xuICAgICAgICB0aGlzLmFsZXJ0U2VydmljZS5zYXZlU3VjY2VzcyhnZXR0ZXh0KCdEYXRhIHBvaW50IGxpYnJhcnkgZW50cnknKSkoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuaW52ZW50b3J5LmNyZWF0ZShtbyk7XG4gICAgICAgIHRoaXMuZGF0YXBvaW50VXBkYXRlKHJlcy5kYXRhKTtcbiAgICAgICAgdGhpcy5hbGVydFNlcnZpY2UuY3JlYXRlU3VjY2VzcyhnZXR0ZXh0KCdEYXRhIHBvaW50IGxpYnJhcnkgZW50cnknKSkoKTtcbiAgICAgIH1cbiAgICAgIHRoaXMubmF2aWdhdGVCYWNrVG9MaXN0KCk7XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgdGhpcy5hbGVydFNlcnZpY2UuYWRkU2VydmVyRmFpbHVyZShlKTtcbiAgICB9XG4gIH1cblxuICBjYW5jZWwoKSB7XG4gICAgdGhpcy5uYXZpZ2F0ZUJhY2tUb0xpc3QoKTtcbiAgfVxuXG4gIGZvcm1DaGFuZ2UoKSB7XG4gICAgaWYgKHRoaXMuZm9ybUdyb3VwLmludmFsaWQpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc3Qga3BpVmFsdWVzID0gdGhpcy5leHRyYWN0S3BpVmFsdWVzRnJvbUZvcm1WYWx1ZSh0aGlzLmZvcm1Hcm91cC52YWx1ZSk7XG4gICAgdGhpcy5yYW5nZUNvbmZpZyA9IE9iamVjdC5hc3NpZ24oeyBvcmllbnRhdGlvbjogJ2hvcml6b250YWwnIH0sIGtwaVZhbHVlcyk7XG4gIH1cblxuICBwcml2YXRlIG5hdmlnYXRlQmFja1RvTGlzdCgpIHtcbiAgICByZXR1cm4gdGhpcy5yb3V0ZXIubmF2aWdhdGUoW3BhdGhUb0RhdGFwb2ludExpYnJhcnldKTtcbiAgfVxuXG4gIHByaXZhdGUgZGF0YXBvaW50VXBkYXRlKHRtcERhdGFwb2ludDogSU1hbmFnZWRPYmplY3QpIHtcbiAgICBjb25zdCBkYXRhcG9pbnQgPSB0aGlzLnBhcnNlci5wYXJzZURhdGFwb2ludCh0bXBEYXRhcG9pbnQpO1xuICAgIHRoaXMuZGF0YXBvaW50ID0gZGF0YXBvaW50O1xuICAgIGNvbnN0IHtcbiAgICAgIGZyYWdtZW50LFxuICAgICAgc2VyaWVzLFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICB1bml0LFxuICAgICAgdGFyZ2V0LFxuICAgICAgbGFiZWwsXG4gICAgICBjb2xvcixcbiAgICAgIHllbGxvd1JhbmdlTWluLFxuICAgICAgeWVsbG93UmFuZ2VNYXgsXG4gICAgICByZWRSYW5nZU1pbixcbiAgICAgIHJlZFJhbmdlTWF4LFxuICAgICAgbWluLFxuICAgICAgbWF4XG4gICAgfSA9IGRhdGFwb2ludC5jOHlfS3BpO1xuICAgIHRoaXMuZm9ybUdyb3VwLnBhdGNoVmFsdWUoe1xuICAgICAgZnJhZ21lbnQsXG4gICAgICBzZXJpZXMsXG4gICAgICBkZXNjcmlwdGlvbixcbiAgICAgIHVuaXQsXG4gICAgICB0YXJnZXQsXG4gICAgICBsYWJlbCxcbiAgICAgIGNvbG9yLFxuICAgICAgcmFuZ2U6IHsgbWluLCBtYXggfSxcbiAgICAgIHllbGxvd1JhbmdlOiB7IG1pbjogeWVsbG93UmFuZ2VNaW4sIG1heDogeWVsbG93UmFuZ2VNYXggfSxcbiAgICAgIHJlZFJhbmdlOiB7IG1pbjogcmVkUmFuZ2VNaW4sIG1heDogcmVkUmFuZ2VNYXggfSxcbiAgICAgIGM4eV9HbG9iYWw6ICEhZGF0YXBvaW50LmM4eV9HbG9iYWxcbiAgICB9KTtcbiAgICB0aGlzLmZvcm1DaGFuZ2UoKTtcbiAgfVxuXG4gIHByaXZhdGUgZXh0cmFjdEtwaVZhbHVlc0Zyb21Gb3JtVmFsdWUoZm9ybVZhbHVlOiBhbnkpIHtcbiAgICBjb25zdCB7IGZyYWdtZW50LCBzZXJpZXMsIGRlc2NyaXB0aW9uLCB1bml0LCB0YXJnZXQsIGxhYmVsLCBjb2xvciB9ID0gZm9ybVZhbHVlO1xuICAgIHJldHVybiB7XG4gICAgICBmcmFnbWVudCxcbiAgICAgIHNlcmllcyxcbiAgICAgIGRlc2NyaXB0aW9uLFxuICAgICAgdW5pdCxcbiAgICAgIHRhcmdldCxcbiAgICAgIGxhYmVsLFxuICAgICAgY29sb3IsXG4gICAgICB5ZWxsb3dSYW5nZU1pbjogZ2V0KGZvcm1WYWx1ZSwgJ3llbGxvd1JhbmdlLm1pbicpLFxuICAgICAgeWVsbG93UmFuZ2VNYXg6IGdldChmb3JtVmFsdWUsICd5ZWxsb3dSYW5nZS5tYXgnKSxcbiAgICAgIHJlZFJhbmdlTWluOiBnZXQoZm9ybVZhbHVlLCAncmVkUmFuZ2UubWluJyksXG4gICAgICByZWRSYW5nZU1heDogZ2V0KGZvcm1WYWx1ZSwgJ3JlZFJhbmdlLm1heCcpLFxuICAgICAgbWluOiBnZXQoZm9ybVZhbHVlLCAncmFuZ2UubWluJyksXG4gICAgICBtYXg6IGdldChmb3JtVmFsdWUsICdyYW5nZS5tYXgnKVxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIGxvYWQoZGF0YTogRGF0YSkge1xuICAgIHRoaXMuaXNMb2FkaW5nID0gdHJ1ZTtcbiAgICB0aGlzLmZvcm1Hcm91cC5yZXNldCgpO1xuICAgIGNvbnN0IHsgZnJhZ21lbnQsIHNlcmllcyB9ID0gdGhpcy5hY3RpdmF0ZWRSb3V0ZS5zbmFwc2hvdC5xdWVyeVBhcmFtcztcbiAgICBjb25zdCBodW1hbml6ZSA9IG5ldyBIdW1hbml6ZVBpcGUoKTtcbiAgICBjb25zdCBsYWJlbCA9XG4gICAgICBmcmFnbWVudCAmJiBzZXJpZXNcbiAgICAgICAgPyBodW1hbml6ZS50cmFuc2Zvcm0oYCR7ZnJhZ21lbnR9ID0+ICR7c2VyaWVzfWApXG4gICAgICAgIDogdGhpcy50cmFuc2xhdGUuaW5zdGFudChnZXR0ZXh0KCdOZXcgZGF0YSBwb2ludCB0ZW1wbGF0ZScpKTtcbiAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTtcbiAgICBjb25zdCBjb2xvciA9IGF3YWl0IHRoaXMuY29sb3JTZXJ2aWNlLmdlbmVyYXRlQ29sb3IoY3VycmVudERhdGUpO1xuICAgIGNvbnN0IGNvbnRleHREYXRhID0gKGRhdGEgJiYgZGF0YS5jb250ZXh0RGF0YSkgfHwge1xuICAgICAgYzh5X0twaToge1xuICAgICAgICBsYWJlbCxcbiAgICAgICAgZnJhZ21lbnQsXG4gICAgICAgIHNlcmllcyxcbiAgICAgICAgY29sb3JcbiAgICAgIH0sXG4gICAgICBjOHlfR2xvYmFsOiAhdGhpcy5jb25maWc/LmRvTm90QWRkR2xvYmFsRnJhZ21lbnRCeURlZmF1bHQgPyB7fSA6IG51bGxcbiAgICB9O1xuICAgIGNvbnN0IHsgaWQgfSA9IGNvbnRleHREYXRhO1xuICAgIGlmIChpZCkge1xuICAgICAgdGhpcy5kYXRhcG9pbnRVcGRhdGUoKGF3YWl0IHRoaXMuaW52ZW50b3J5LmRldGFpbChpZCkpLmRhdGEpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRhdGFwb2ludFVwZGF0ZShjb250ZXh0RGF0YSk7XG4gICAgfVxuICAgIHRoaXMuaXNMb2FkaW5nID0gZmFsc2U7XG4gIH1cblxuICBwcml2YXRlIGluaXRGb3JtKCk6IHZvaWQge1xuICAgIHRoaXMucmFuZ2UgPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKFxuICAgICAge1xuICAgICAgICBtaW46IFt1bmRlZmluZWQsIFtdXSxcbiAgICAgICAgbWF4OiBbdW5kZWZpbmVkLCBbXV1cbiAgICAgIH0sXG4gICAgICB7IHZhbGlkYXRvcnM6IFtDOHlWYWxpZGF0b3JzLm1pbk1heFZhbGlkYXRvcigpLCBDOHlWYWxpZGF0b3JzLnJlcXVpcmVCb3RoTWluQW5kTWF4KCldIH1cbiAgICApO1xuICAgIHRoaXMucmVkUmFuZ2UgPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKFxuICAgICAge1xuICAgICAgICBtaW46IFt1bmRlZmluZWQsIFtdXSxcbiAgICAgICAgbWF4OiBbdW5kZWZpbmVkLCBbXV1cbiAgICAgIH0sXG4gICAgICB7IHZhbGlkYXRvcnM6IFtDOHlWYWxpZGF0b3JzLm1pbk1heFZhbGlkYXRvcigpLCBDOHlWYWxpZGF0b3JzLnJlcXVpcmVCb3RoTWluQW5kTWF4KCldIH1cbiAgICApO1xuICAgIHRoaXMueWVsbG93UmFuZ2UgPSB0aGlzLmZvcm1CdWlsZGVyLmdyb3VwKFxuICAgICAge1xuICAgICAgICBtaW46IFt1bmRlZmluZWQsIFtdXSxcbiAgICAgICAgbWF4OiBbdW5kZWZpbmVkLCBbXV1cbiAgICAgIH0sXG4gICAgICB7IHZhbGlkYXRvcnM6IFtDOHlWYWxpZGF0b3JzLm1pbk1heFZhbGlkYXRvcigpLCBDOHlWYWxpZGF0b3JzLnJlcXVpcmVCb3RoTWluQW5kTWF4KCldIH1cbiAgICApO1xuICAgIHRoaXMuZm9ybUdyb3VwID0gdGhpcy5mb3JtQnVpbGRlci5ncm91cChcbiAgICAgIHtcbiAgICAgICAgY29sb3I6IFsnJywgW1ZhbGlkYXRvcnMucmVxdWlyZWQsIFZhbGlkYXRvcnMubWluTGVuZ3RoKDQpXV0sXG4gICAgICAgIGxhYmVsOiBbJycsIFtWYWxpZGF0b3JzLnJlcXVpcmVkLCBWYWxpZGF0b3JzLm1pbkxlbmd0aCgxKSwgVmFsaWRhdG9ycy5tYXhMZW5ndGgoMTIwKV1dLFxuICAgICAgICBkZXNjcmlwdGlvbjogWycnLCBbXV0sXG4gICAgICAgIGZyYWdtZW50OiBbXG4gICAgICAgICAgJycsXG4gICAgICAgICAgW1xuICAgICAgICAgICAgVmFsaWRhdG9ycy5yZXF1aXJlZCxcbiAgICAgICAgICAgIFZhbGlkYXRvcnMubWluTGVuZ3RoKDEpLFxuICAgICAgICAgICAgVmFsaWRhdG9ycy5tYXhMZW5ndGgoMTIwKSxcbiAgICAgICAgICAgIFZhbGlkYXRvcnMucGF0dGVybigvXlteLl0qJC8pXG4gICAgICAgICAgXVxuICAgICAgICBdLFxuICAgICAgICBzZXJpZXM6IFtcbiAgICAgICAgICAnJyxcbiAgICAgICAgICBbXG4gICAgICAgICAgICBWYWxpZGF0b3JzLnJlcXVpcmVkLFxuICAgICAgICAgICAgVmFsaWRhdG9ycy5taW5MZW5ndGgoMSksXG4gICAgICAgICAgICBWYWxpZGF0b3JzLm1heExlbmd0aCgxMjApLFxuICAgICAgICAgICAgVmFsaWRhdG9ycy5wYXR0ZXJuKC9eW14uXSokLylcbiAgICAgICAgICBdXG4gICAgICAgIF0sXG4gICAgICAgIHJhbmdlOiB0aGlzLnJhbmdlLFxuICAgICAgICB1bml0OiBbdW5kZWZpbmVkLCBbXV0sXG4gICAgICAgIHRhcmdldDogW3VuZGVmaW5lZCwgW11dLFxuICAgICAgICByZWRSYW5nZTogdGhpcy5yZWRSYW5nZSxcbiAgICAgICAgeWVsbG93UmFuZ2U6IHRoaXMueWVsbG93UmFuZ2UsXG4gICAgICAgIGM4eV9HbG9iYWw6IFshdGhpcy5jb25maWc/LmRvTm90QWRkR2xvYmFsRnJhZ21lbnRCeURlZmF1bHQsIFtdXVxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgdmFsaWRhdG9yczogW1xuICAgICAgICAgIEM4eVZhbGlkYXRvcnMud2l0aGluU2NhbGUoJ3JlZFJhbmdlLm1pbicpLFxuICAgICAgICAgIEM4eVZhbGlkYXRvcnMud2l0aGluU2NhbGUoJ3JlZFJhbmdlLm1heCcpLFxuICAgICAgICAgIEM4eVZhbGlkYXRvcnMud2l0aGluU2NhbGUoJ3llbGxvd1JhbmdlLm1pbicpLFxuICAgICAgICAgIEM4eVZhbGlkYXRvcnMud2l0aGluU2NhbGUoJ3llbGxvd1JhbmdlLm1heCcpLFxuICAgICAgICAgIEM4eVZhbGlkYXRvcnMud2l0aGluU2NhbGUoJ3RhcmdldCcpXG4gICAgICAgIF1cbiAgICAgIH1cbiAgICApO1xuICB9XG5cbiAgcHJpdmF0ZSByZW1vdmVOdWxsVmFsdWVzKHZhbHVlKSB7XG4gICAgLy8gcmVtb3ZlIG51bGwgdmFsdWVzIGJlZm9yZSBzZW5kaW5nIGRhdGEgdG8gYmFja2VuZFxuICAgIGNvbnN0IGNsZWFuZWR1cFZhbHVlcyA9IE9iamVjdC5hc3NpZ24oe30sIHZhbHVlKTtcbiAgICBPYmplY3Qua2V5cyhjbGVhbmVkdXBWYWx1ZXMpLmZvckVhY2goa2V5ID0+IHtcbiAgICAgIGlmIChjbGVhbmVkdXBWYWx1ZXNba2V5XSA9PT0gbnVsbCkge1xuICAgICAgICBkZWxldGUgY2xlYW5lZHVwVmFsdWVzW2tleV07XG4gICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIGNsZWFuZWR1cFZhbHVlcztcbiAgfVxufVxuIl19