import { __awaiter } from "tslib";
import { Component } from '@angular/core';
import { gettext } from '@c8y/ngx-components';
import { FormGroup } from '@angular/forms';
import { from, forkJoin, of, BehaviorSubject, throwError, defer, Subject } from 'rxjs';
import { cloneDeep, uniq } from 'lodash-es';
import { BsModalRef } from 'ngx-bootstrap/modal';
import { ActilityDeviceRegistrationService, ErrorName } from './actility-device-registration.service';
import { map, catchError, switchMap, shareReplay, takeUntil, mergeMap } from 'rxjs/operators';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'ngx-bootstrap/modal';
import * as ɵngcc2 from './actility-device-registration.service';
import * as ɵngcc3 from '@c8y/ngx-components';
import * as ɵngcc4 from '@angular/common';
import * as ɵngcc5 from '@angular/cdk/stepper';
import * as ɵngcc6 from '@ngx-formly/core';

function ActilityDeviceRegistrationComponent_ng_container_6_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainerStart(0);
    ɵngcc0.ɵɵelementStart(1, "div", 6);
    ɵngcc0.ɵɵelement(2, "c8y-loading");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementContainerEnd();
} }
function ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_div_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 6);
    ɵngcc0.ɵɵelement(1, "c8y-loading");
    ɵngcc0.ɵɵelementEnd();
} }
function ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_c8y_operation_result_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "c8y-operation-result", 19);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵpropertyInterpolate("text", ɵngcc0.ɵɵpipeBind1(1, 3, "Device registered"));
    ɵngcc0.ɵɵproperty("size", 84)("vertical", true);
} }
const _c0 = function () { return { cancel: true, next: true }; };
const _c1 = function () { return { custom: true }; };
function ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-stepper", 8);
    ɵngcc0.ɵɵelementStart(1, "cdk-step", 9);
    ɵngcc0.ɵɵelementStart(2, "div", 10);
    ɵngcc0.ɵɵelementStart(3, "p", 11);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelement(6, "formly-form", 12);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(7, "c8y-stepper-buttons", 13);
    ɵngcc0.ɵɵlistener("onNext", function ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_Template_c8y_stepper_buttons_onNext_7_listener($event) { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r8 = ɵngcc0.ɵɵnextContext(2); return ctx_r8.register($event); })("onCancel", function ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_Template_c8y_stepper_buttons_onCancel_7_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r10 = ɵngcc0.ɵɵnextContext(2); return ctx_r10.bsModalRef.hide(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(8, "cdk-step", 14);
    ɵngcc0.ɵɵtemplate(9, ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_div_9_Template, 2, 0, "div", 15);
    ɵngcc0.ɵɵelementStart(10, "div", 16);
    ɵngcc0.ɵɵtemplate(11, ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_c8y_operation_result_11_Template, 2, 5, "c8y-operation-result", 17);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(12, "c8y-stepper-buttons", 18);
    ɵngcc0.ɵɵlistener("onCustom", function ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_Template_c8y_stepper_buttons_onCustom_12_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r11 = ɵngcc0.ɵɵnextContext(2); return ctx_r11.bsModalRef.hide(); });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r5 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("hideStepProgress", true);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("stepControl", ctx_r5.form);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(5, 14, "Register a single Actility device"), " ");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("form", ctx_r5.form)("fields", ctx_r5.fields)("model", ctx_r5.model);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("labels", ctx_r5.registrationStepLabels)("showButtons", ɵngcc0.ɵɵpureFunction0(16, _c0))("pending", ctx_r5.state === "registrationPending")("disabled", !(ctx_r5.form == null ? null : ctx_r5.form.valid));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.state === "registrationPending");
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r5.state === "registrationSuccess");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("showButtons", ɵngcc0.ɵɵpureFunction0(17, _c1))("labels", ctx_r5.finalStepLabels);
} }
function ActilityDeviceRegistrationComponent_ng_template_7_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, ActilityDeviceRegistrationComponent_ng_template_7_c8y_stepper_0_Template, 13, 18, "c8y-stepper", 7);
    ɵngcc0.ɵɵpipe(1, "async");
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    const _r3 = ɵngcc0.ɵɵreference(10);
    ɵngcc0.ɵɵproperty("ngIf", ɵngcc0.ɵɵpipeBind1(1, 2, ctx_r2.errorMessages$).length === 0)("ngIfElse", _r3);
} }
function ActilityDeviceRegistrationComponent_ng_template_9_c8y_operation_result_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "c8y-operation-result", 24);
    ɵngcc0.ɵɵpipe(1, "translate");
} if (rf & 2) {
    ɵngcc0.ɵɵpropertyInterpolate("text", ɵngcc0.ɵɵpipeBind1(1, 3, "Failed to register"));
    ɵngcc0.ɵɵproperty("size", 84)("vertical", true);
} }
const _c2 = function (a0, a1) { return { "text-center": a0, "alert alert-danger": a1 }; };
function ActilityDeviceRegistrationComponent_ng_template_9_div_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 25);
    ɵngcc0.ɵɵelement(1, "span", 26);
    ɵngcc0.ɵɵpipe(2, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const msg_r14 = ctx.$implicit;
    const ctx_r13 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction2(4, _c2, ctx_r13.state === "registrationError", ctx_r13.state === "loadError"));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("innerHTML", ɵngcc0.ɵɵpipeBind1(2, 2, msg_r14), ɵngcc0.ɵɵsanitizeHtml);
} }
function ActilityDeviceRegistrationComponent_ng_template_9_Template(rf, ctx) { if (rf & 1) {
    const _r16 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "div", 16);
    ɵngcc0.ɵɵtemplate(1, ActilityDeviceRegistrationComponent_ng_template_9_c8y_operation_result_1_Template, 2, 5, "c8y-operation-result", 20);
    ɵngcc0.ɵɵtemplate(2, ActilityDeviceRegistrationComponent_ng_template_9_div_2_Template, 3, 7, "div", 21);
    ɵngcc0.ɵɵpipe(3, "async");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(4, "div", 22);
    ɵngcc0.ɵɵelementStart(5, "button", 23);
    ɵngcc0.ɵɵlistener("click", function ActilityDeviceRegistrationComponent_ng_template_9_Template_button_click_5_listener() { ɵngcc0.ɵɵrestoreView(_r16); const ctx_r15 = ɵngcc0.ɵɵnextContext(); return ctx_r15.bsModalRef.hide(); });
    ɵngcc0.ɵɵpipe(6, "translate");
    ɵngcc0.ɵɵtext(7, " Close ");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r4.state === "registrationError");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ɵngcc0.ɵɵpipeBind1(3, 3, ctx_r4.errorMessages$));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(6, 5, "Close"));
} }
export class ActilityDeviceRegistrationComponent {
    constructor(bsModalRef, registrationService) {
        this.bsModalRef = bsModalRef;
        this.registrationService = registrationService;
        this.registrationStepLabels = {
            next: gettext('Register')
        };
        this.finalStepLabels = {
            custom: gettext('Close')
        };
        this.state = 'loadPending';
        this.errors$ = new BehaviorSubject([]);
        this.errorMessages$ = this.errors$.pipe(map(errors => errors.map(error => error.message)), map(messages => uniq(messages)));
        this.connections$ = this.getConnections$();
        this.deviceProtocols$ = this.getDeviceProtocols$();
        this.unsubscribe$ = new Subject();
        this.load$ = this.connections$.pipe(catchError((error) => of(error)), switchMap(connections => {
            if (connections instanceof Error &&
                connections.name === ErrorName.NoConnectivitySettingsError) {
                return of([connections]);
            }
            return forkJoin([
                of(connections),
                this.deviceProtocols$.pipe(catchError((error) => of(error)))
            ]);
        }), map(results => results.filter(result => result instanceof Error)), switchMap(errors => (errors.length === 0 ? of([]) : throwError(errors))));
        this.form = new FormGroup({});
        this.model = {};
        // Formly schema definition to render actility device registration form
        this.fields = [
            {
                key: 'connection',
                type: 'typeahead',
                templateOptions: {
                    label: gettext('Connection'),
                    required: true,
                    c8yForOptions: this.connections$,
                    displayProperty: 'name',
                    valueProperties: ['name']
                }
            },
            {
                key: 'deviceProfile',
                type: 'typeahead',
                templateOptions: {
                    label: gettext('Device profile'),
                    required: true,
                    displayProperty: 'name',
                    placeholder: 'IWM-LR3',
                    valueProperties: ['id', 'name', 'typeMAC']
                },
                hooks: {
                    onInit: field => {
                        const connectionControl = field.form.get('connection');
                        connectionControl.valueChanges
                            .pipe(takeUntil(this.unsubscribe$), mergeMap(() => this.getDeviceProfiles$(this.form.get('connection').value.name)))
                            .subscribe(profiles => {
                            field.templateOptions.c8yForOptions = of(profiles);
                            field.formControl.setValue(null);
                        }, error => {
                            field.form.controls.deviceProfile.setErrors({ deviceProfile: true });
                            field.validators.deviceProfile.message = error.message;
                        });
                    }
                },
                validators: {
                    deviceProfile: {
                        expression: (control) => {
                            return control.status === 'VALID';
                        },
                        message: () => ''
                    }
                }
            },
            {
                key: 'deviceType',
                type: 'typeahead',
                templateOptions: {
                    label: gettext('Device protocol'),
                    required: true,
                    c8yForOptions: this.deviceProtocols$,
                    displayProperty: 'name',
                    valueProperties: ['id', 'name']
                }
            },
            {
                key: 'devEUI',
                type: 'input',
                templateOptions: {
                    placeholder: '0018A20000000004',
                    label: gettext('Device EUI'),
                    required: true,
                    pattern: '^([a-fA-F0-9]{16})$'
                },
                validation: {
                    messages: {
                        pattern: gettext('Must be a valid 16 digit hexadecimal number.')
                    }
                }
            },
            {
                key: 'applicationEUI',
                type: 'input',
                templateOptions: {
                    placeholder: '70B3D53260000003',
                    label: gettext('Application EUI'),
                    required: true,
                    pattern: '^([a-fA-F0-9]{16})$'
                },
                validation: {
                    messages: {
                        pattern: gettext('Must be a valid 16 digit hexadecimal number.')
                    }
                }
            },
            {
                key: 'applicationKey',
                type: 'input',
                templateOptions: {
                    label: gettext('Application key'),
                    placeholder: '258DB54023EA74F0D55085F7351737D0',
                    required: true,
                    pattern: '^([a-fA-F0-9]{32})$'
                },
                validation: {
                    messages: {
                        pattern: gettext('Must be a valid 32 digit hexadecimal number.')
                    }
                }
            },
            {
                key: 'connectivityPlan',
                type: 'typeahead',
                templateOptions: {
                    label: gettext('Connectivity plan'),
                    description: gettext('Only connectivity plans with free slots are displayed'),
                    required: true,
                    placeholder: 'Dev-ope testing CP',
                    displayProperty: 'name',
                    valueProperties: ['id', 'ref', 'name', 'grantedConnections', 'usedConnections']
                },
                hooks: {
                    onInit: field => {
                        const connectionControl = field.form.get('connection');
                        connectionControl.valueChanges
                            .pipe(takeUntil(this.unsubscribe$), mergeMap(() => this.getConnectivityPlans$(this.form.get('connection').value.name)))
                            .subscribe(profiles => {
                            field.templateOptions.c8yForOptions = of(profiles);
                            field.formControl.setValue(null);
                        }, error => {
                            field.form.controls.connectivityPlan.setErrors({ connectivityPlan: true });
                            field.validators.connectivityPlan.message = error.message;
                        });
                    }
                },
                validators: {
                    connectivityPlan: {
                        expression: (control) => {
                            return control.status === 'VALID';
                        },
                        message: () => ''
                    }
                }
            }
        ];
        this.load$.subscribe(() => {
            this.state = 'loadSuccess';
        }, errors => {
            this.state = 'loadError';
            this.errors$.next(errors);
        });
    }
    getConnectivityPlans$(name) {
        return defer(() => from(this.registrationService.getConnectivityPlans(name))).pipe(shareReplay(1));
    }
    getDeviceProfiles$(name) {
        return defer(() => from(this.registrationService.getDeviceProfiles(name))).pipe(shareReplay(1));
    }
    getDeviceProtocols$() {
        return defer(() => from(this.registrationService.getDeviceProtocols())).pipe(shareReplay(1));
    }
    getConnections$() {
        return defer(() => from(this.registrationService.getConnections())).pipe(shareReplay(1));
    }
    register(event) {
        return __awaiter(this, void 0, void 0, function* () {
            event.stepper.next();
            this.state = 'registrationPending';
            try {
                const actilityDevice = this.getActilityDeviceToSend();
                yield this.registrationService.register(actilityDevice);
                this.state = 'registrationSuccess';
            }
            catch (error) {
                this.state = 'registrationError';
                this.errors$.next([error]);
            }
        });
    }
    getActilityDeviceToSend() {
        const actilityDevice = cloneDeep(this.model);
        actilityDevice.lnsConnectionName = this.model.connection.name;
        delete actilityDevice.connection;
        return actilityDevice;
    }
    ngOnDestroy() {
        this.unsubscribe$.next();
        this.unsubscribe$.complete();
    }
}
ActilityDeviceRegistrationComponent.ɵfac = function ActilityDeviceRegistrationComponent_Factory(t) { return new (t || ActilityDeviceRegistrationComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.BsModalRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ActilityDeviceRegistrationService)); };
ActilityDeviceRegistrationComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: ActilityDeviceRegistrationComponent, selectors: [["c8y-actility-registration"]], decls: 11, vars: 8, consts: [[3, "headerClasses", "customFooter"], ["c8y-modal-title", ""], [3, "c8yIcon"], [4, "ngIf", "ngIfElse"], ["registrationForm", ""], ["errorMessagesPresent", ""], [1, "p-16", "text-center"], ["linear", "", 3, "hideStepProgress", 4, "ngIf", "ngIfElse"], ["linear", "", 3, "hideStepProgress"], [3, "stepControl"], [1, "p-b-16"], [1, "p-l-24", "p-r-24", "p-t-16", "p-b-16", "m-b-0", "sticky-top", "separator-bottom", "lead", "text-center", "bg-component"], [1, "formly-group-array-cols", "d-block", "p-l-24", "p-r-24", 3, "form", "fields", "model"], [1, "sticky-bottom", "d-block", "p-t-16", "p-b-16", "separator-top", "bg-white", 3, "labels", "showButtons", "pending", "disabled", "onNext", "onCancel"], ["state", "final"], ["class", "p-16 text-center", 4, "ngIf"], [1, "m-24"], ["type", "success", "class", "lead m-b-0", 3, "text", "size", "vertical", 4, "ngIf"], [1, "sticky-bottom", "d-block", "p-t-16", "p-b-16", "separator-top", "bg-white", 3, "showButtons", "labels", "onCustom"], ["type", "success", 1, "lead", "m-b-0", 3, "text", "size", "vertical"], ["type", "error", "class", "lead", 3, "text", "size", "vertical", 4, "ngIf"], ["class", "m-b-8", 3, "ngClass", 4, "ngFor", "ngForOf"], [1, "modal-footer"], ["type", "button", "translate", "", 1, "btn", "btn-default", 3, "title", "click"], ["type", "error", 1, "lead", 3, "text", "size", "vertical"], [1, "m-b-8", 3, "ngClass"], [3, "innerHTML"]], template: function ActilityDeviceRegistrationComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "c8y-modal", 0);
        ɵngcc0.ɵɵelementContainerStart(1, 1);
        ɵngcc0.ɵɵelement(2, "span", 2);
        ɵngcc0.ɵɵelementStart(3, "h4");
        ɵngcc0.ɵɵtext(4);
        ɵngcc0.ɵɵpipe(5, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵtemplate(6, ActilityDeviceRegistrationComponent_ng_container_6_Template, 3, 0, "ng-container", 3);
        ɵngcc0.ɵɵtemplate(7, ActilityDeviceRegistrationComponent_ng_template_7_Template, 2, 4, "ng-template", null, 4, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵtemplate(9, ActilityDeviceRegistrationComponent_ng_template_9_Template, 8, 7, "ng-template", null, 5, ɵngcc0.ɵɵtemplateRefExtractor);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        const _r1 = ɵngcc0.ɵɵreference(8);
        ɵngcc0.ɵɵproperty("headerClasses", "dialog-header")("customFooter", true);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("c8yIcon", "c8y-device-connect");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 6, "Actility LoRa registration"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngIf", ctx.state === "loadPending")("ngIfElse", _r1);
    } }, directives: [ɵngcc3.ModalComponent, ɵngcc3.IconDirective, ɵngcc4.NgIf, ɵngcc3.LoadingComponent, ɵngcc3.C8yStepper, ɵngcc5.CdkStep, ɵngcc6.FormlyForm, ɵngcc3.C8yStepperButtons, ɵngcc3.OperationResultComponent, ɵngcc4.NgForOf, ɵngcc3.C8yTranslateDirective, ɵngcc4.NgClass], pipes: [ɵngcc3.C8yTranslatePipe, ɵngcc4.AsyncPipe], encapsulation: 2 });
ActilityDeviceRegistrationComponent.ctorParameters = () => [
    { type: BsModalRef },
    { type: ActilityDeviceRegistrationService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(ActilityDeviceRegistrationComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-actility-registration',
                template: "<c8y-modal [headerClasses]=\"'dialog-header'\" [customFooter]=\"true\">\n  <ng-container c8y-modal-title>\n    <span [c8yIcon]=\"'c8y-device-connect'\"></span>\n    <h4>{{ 'Actility LoRa registration' | translate }}</h4>\n  </ng-container>\n\n  <ng-container *ngIf=\"state === 'loadPending'; else registrationForm\">\n    <div class=\"p-16 text-center\">\n      <c8y-loading></c8y-loading>\n    </div>\n  </ng-container>\n\n  <!--Formly schema is rendered-->\n  <ng-template #registrationForm>\n    <c8y-stepper\n      [hideStepProgress]=\"true\"\n      linear\n      *ngIf=\"(errorMessages$ | async).length === 0; else errorMessagesPresent\"\n    >\n      <cdk-step [stepControl]=\"form\">\n        <div class=\"p-b-16\">\n          <p\n            class=\"\n              p-l-24 p-r-24 p-t-16 p-b-16\n              m-b-0\n              sticky-top\n              separator-bottom\n              lead\n              text-center\n              bg-component\n            \"\n          >\n          {{ 'Register a single Actility device' | translate }}\n          </p>\n          <formly-form\n            [form]=\"form\"\n            [fields]=\"fields\"\n            [model]=\"model\"\n            class=\"formly-group-array-cols d-block p-l-24 p-r-24\"\n          ></formly-form>\n        </div>\n\n        <c8y-stepper-buttons\n          [labels]=\"registrationStepLabels\"\n          (onNext)=\"register($event)\"\n          (onCancel)=\"bsModalRef.hide()\"\n          [showButtons]=\"{ cancel: true, next: true }\"\n          [pending]=\"state === 'registrationPending'\"\n          [disabled]=\"!form?.valid\"\n          class=\"sticky-bottom d-block p-t-16 p-b-16 separator-top bg-white\"\n        ></c8y-stepper-buttons>\n      </cdk-step>\n      <cdk-step state=\"final\">\n        <!--success scenario-->\n        <div class=\"p-16 text-center\" *ngIf=\"state === 'registrationPending'\">\n          <c8y-loading></c8y-loading>\n        </div>\n        <div class=\"m-24\">\n          <c8y-operation-result\n            *ngIf=\"state === 'registrationSuccess'\"\n            text=\"{{ 'Device registered' | translate }}\"\n            [size]=\"84\"\n            [vertical]=\"true\"\n            type=\"success\"\n            class=\"lead m-b-0\"\n          ></c8y-operation-result>\n        </div>\n        <c8y-stepper-buttons\n          class=\"sticky-bottom d-block p-t-16 p-b-16 separator-top bg-white\"\n          (onCustom)=\"bsModalRef.hide()\"\n          [showButtons]=\"{ custom: true }\"\n          [labels]=\"finalStepLabels\"\n        ></c8y-stepper-buttons>\n      </cdk-step>\n    </c8y-stepper>\n  </ng-template>\n\n  <!--Failure scenario-->\n  <ng-template #errorMessagesPresent>\n    <div class=\"m-24\">\n      <c8y-operation-result\n        *ngIf=\"state === 'registrationError'\"\n        text=\"{{ 'Failed to register' | translate }}\"\n        [size]=\"84\"\n        [vertical]=\"true\"\n        type=\"error\"\n        class=\"lead\"\n      ></c8y-operation-result>\n      <div\n        *ngFor=\"let msg of errorMessages$ | async\"\n        class=\"m-b-8\"\n        [ngClass]=\"{\n          'text-center': state === 'registrationError',\n          'alert alert-danger': state === 'loadError'\n        }\"\n      >\n        <span [innerHTML]=\"msg | translate\"></span>\n      </div>\n    </div>\n    <div class=\"modal-footer\">\n      <button\n        title=\"{{ 'Close' | translate }}\"\n        (click)=\"bsModalRef.hide()\"\n        type=\"button\"\n        class=\"btn btn-default\"\n        translate\n      >\n        Close\n      </button>\n    </div>\n  </ng-template>\n</c8y-modal>"
            }]
    }], function () { return [{ type: ɵngcc1.BsModalRef }, { type: ɵngcc2.ActilityDeviceRegistrationService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWN0aWxpdHktZGV2aWNlLXJlZ2lzdHJhdGlvbi5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL2FjdGlsaXR5LWRldmljZS1yZWdpc3RyYXRpb24vYWN0aWxpdHktZGV2aWNlLXJlZ2lzdHJhdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFMUMsT0FBTyxFQUFFLE9BQU8sRUFBYyxNQUFNLHFCQUFxQixDQUFDO0FBQzFELE9BQU8sRUFBbUIsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDNUQsT0FBTyxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsRUFBRSxFQUFFLGVBQWUsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUN2RixPQUFPLEVBQUUsU0FBUyxFQUFFLElBQUksRUFBRSxNQUFNLFdBQVcsQ0FBQztBQUU1QyxPQUFPLEVBQUUsVUFBVSxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDakQsT0FBTyxFQUNMLGlDQUFpQyxFQUNqQyxTQUFTLEVBQ1YsTUFBTSx3Q0FBd0MsQ0FBQztBQUVoRCxPQUFPLEVBQUUsR0FBRyxFQUFFLFVBQVUsRUFBRSxTQUFTLEVBQUUsV0FBVyxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQVk5RixNQUFNLE9BQU8sbUNBQW1DO0FBQ2hELElBOExFLFlBQ1MsVUFBc0IsRUFDckIsbUJBQXNEO0FBQy9ELFFBRlEsZUFBVSxHQUFWLFVBQVUsQ0FBWTtBQUFDLFFBQ3RCLHdCQUFtQixHQUFuQixtQkFBbUIsQ0FB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Q0UsdUJBQXVCO0FBQ3pCLFFBQUksTUFBTSxjQUFjLEdBQStCLFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDN0UsUUFBSSxjQUFjLENBQUMsaUJBQWlCLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDO0FBQ2xFLFFBQUksT0FBUSxjQUFzQixDQUFDLFVBQVUsQ0FBQztBQUM5QyxRQUFJLE9BQU8sY0FBYyxDQUFDO0FBQzFCLElBQUUsQ0FBQztBQUNILElBQUUsV0FBVztBQUFLLFFBQ2QsSUFBSSxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUM3QixRQUFJLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxFQUFFLENBQUM7QUFDakMsSUFBRSxDQUFDO0FBQ0g7K0RBM1BDLFNBQVMsU0FBQyxrQkFDVCxRQUFRLEVBQUUsMkJBQTJCLGtCQUNyQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7aVdBRUc7QUFBQztBQUNVLFlBbkJQLFVBQVU7QUFBSSxZQUVyQixpQ0FBaUM7QUFDbEM7NEdBYTJELGNBQzNEOzs7Ozs7K0hBZEU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENvbXBvbmVudCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybWx5RmllbGRDb25maWcgfSBmcm9tICdAbmd4LWZvcm1seS9jb3JlJztcbmltcG9ydCB7IGdldHRleHQsIEM4eVN0ZXBwZXIgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IEFic3RyYWN0Q29udHJvbCwgRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuaW1wb3J0IHsgZnJvbSwgZm9ya0pvaW4sIG9mLCBCZWhhdmlvclN1YmplY3QsIHRocm93RXJyb3IsIGRlZmVyLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBjbG9uZURlZXAsIHVuaXEgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgQ2RrU3RlcCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9zdGVwcGVyJztcbmltcG9ydCB7IEJzTW9kYWxSZWYgfSBmcm9tICduZ3gtYm9vdHN0cmFwL21vZGFsJztcbmltcG9ydCB7XG4gIEFjdGlsaXR5RGV2aWNlUmVnaXN0cmF0aW9uU2VydmljZSxcbiAgRXJyb3JOYW1lXG59IGZyb20gJy4vYWN0aWxpdHktZGV2aWNlLXJlZ2lzdHJhdGlvbi5zZXJ2aWNlJztcbmltcG9ydCB7IEFjdGlsaXR5RGV2aWNlUmVnaXN0cmF0aW9uIH0gZnJvbSAnLi9hY3RpbGl0eS1kZXZpY2UtcmVnaXN0cmF0aW9uLm1vZGVsJztcbmltcG9ydCB7IG1hcCwgY2F0Y2hFcnJvciwgc3dpdGNoTWFwLCBzaGFyZVJlcGxheSwgdGFrZVVudGlsLCBtZXJnZU1hcCB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbnR5cGUgU3RhdGUgPVxuICB8ICdsb2FkUGVuZGluZydcbiAgfCAnbG9hZFN1Y2Nlc3MnXG4gIHwgJ2xvYWRFcnJvcidcbiAgfCAncmVnaXN0cmF0aW9uUGVuZGluZydcbiAgfCAncmVnaXN0cmF0aW9uU3VjY2VzcydcbiAgfCAncmVnaXN0cmF0aW9uRXJyb3InO1xuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWFjdGlsaXR5LXJlZ2lzdHJhdGlvbicsXG4gIHRlbXBsYXRlVXJsOiAnYWN0aWxpdHktZGV2aWNlLXJlZ2lzdHJhdGlvbi5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgQWN0aWxpdHlEZXZpY2VSZWdpc3RyYXRpb25Db21wb25lbnQge1xuICBzdGVwcGVyOiBDOHlTdGVwcGVyO1xuICByZWdpc3RyYXRpb25TdGVwTGFiZWxzID0ge1xuICAgIG5leHQ6IGdldHRleHQoJ1JlZ2lzdGVyJylcbiAgfTtcbiAgZmluYWxTdGVwTGFiZWxzID0ge1xuICAgIGN1c3RvbTogZ2V0dGV4dCgnQ2xvc2UnKVxuICB9O1xuXG4gIHN0YXRlOiBTdGF0ZSA9ICdsb2FkUGVuZGluZyc7XG4gIGVycm9ycyQgPSBuZXcgQmVoYXZpb3JTdWJqZWN0PEVycm9yW10+KFtdKTtcbiAgZXJyb3JNZXNzYWdlcyQgPSB0aGlzLmVycm9ycyQucGlwZShcbiAgICBtYXAoZXJyb3JzID0+IGVycm9ycy5tYXAoZXJyb3IgPT4gZXJyb3IubWVzc2FnZSkpLFxuICAgIG1hcChtZXNzYWdlcyA9PiB1bmlxKG1lc3NhZ2VzKSlcbiAgKTtcblxuICBjb25uZWN0aW9ucyQgPSB0aGlzLmdldENvbm5lY3Rpb25zJCgpO1xuICBkZXZpY2VQcm90b2NvbHMkID0gdGhpcy5nZXREZXZpY2VQcm90b2NvbHMkKCk7XG4gIHVuc3Vic2NyaWJlJDogU3ViamVjdDx2b2lkPiA9IG5ldyBTdWJqZWN0KCk7XG4gIGxvYWQkID0gdGhpcy5jb25uZWN0aW9ucyQucGlwZShcbiAgICBjYXRjaEVycm9yKChlcnJvcjogRXJyb3IpID0+IG9mKGVycm9yKSksXG4gICAgc3dpdGNoTWFwKGNvbm5lY3Rpb25zID0+IHtcbiAgICAgIGlmIChcbiAgICAgICAgY29ubmVjdGlvbnMgaW5zdGFuY2VvZiBFcnJvciAmJlxuICAgICAgICBjb25uZWN0aW9ucy5uYW1lID09PSBFcnJvck5hbWUuTm9Db25uZWN0aXZpdHlTZXR0aW5nc0Vycm9yXG4gICAgICApIHtcbiAgICAgICAgcmV0dXJuIG9mKFtjb25uZWN0aW9uc10pO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gZm9ya0pvaW4oW1xuICAgICAgICBvZihjb25uZWN0aW9ucyksXG4gICAgICAgIHRoaXMuZGV2aWNlUHJvdG9jb2xzJC5waXBlKGNhdGNoRXJyb3IoKGVycm9yOiBFcnJvcikgPT4gb2YoZXJyb3IpKSlcbiAgICAgIF0pO1xuICAgIH0pLFxuICAgIG1hcChyZXN1bHRzID0+IHJlc3VsdHMuZmlsdGVyKHJlc3VsdCA9PiByZXN1bHQgaW5zdGFuY2VvZiBFcnJvcikpLFxuICAgIHN3aXRjaE1hcChlcnJvcnMgPT4gKGVycm9ycy5sZW5ndGggPT09IDAgPyBvZihbXSkgOiB0aHJvd0Vycm9yKGVycm9ycykpKVxuICApO1xuXG4gIGZvcm0gPSBuZXcgRm9ybUdyb3VwKHt9KTtcbiAgbW9kZWwgPSB7fSBhcyBBY3RpbGl0eURldmljZVJlZ2lzdHJhdGlvbjtcblxuICAvLyBGb3JtbHkgc2NoZW1hIGRlZmluaXRpb24gdG8gcmVuZGVyIGFjdGlsaXR5IGRldmljZSByZWdpc3RyYXRpb24gZm9ybVxuICBmaWVsZHM6IEZvcm1seUZpZWxkQ29uZmlnW10gPSBbXG4gICAge1xuICAgICAga2V5OiAnY29ubmVjdGlvbicsXG4gICAgICB0eXBlOiAndHlwZWFoZWFkJyxcbiAgICAgIHRlbXBsYXRlT3B0aW9uczoge1xuICAgICAgICBsYWJlbDogZ2V0dGV4dCgnQ29ubmVjdGlvbicpLFxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgYzh5Rm9yT3B0aW9uczogdGhpcy5jb25uZWN0aW9ucyQsXG4gICAgICAgIGRpc3BsYXlQcm9wZXJ0eTogJ25hbWUnLFxuICAgICAgICB2YWx1ZVByb3BlcnRpZXM6IFsnbmFtZSddXG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6ICdkZXZpY2VQcm9maWxlJyxcbiAgICAgIHR5cGU6ICd0eXBlYWhlYWQnLFxuICAgICAgdGVtcGxhdGVPcHRpb25zOiB7XG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdEZXZpY2UgcHJvZmlsZScpLFxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgZGlzcGxheVByb3BlcnR5OiAnbmFtZScsXG4gICAgICAgIHBsYWNlaG9sZGVyOiAnSVdNLUxSMycsXG4gICAgICAgIHZhbHVlUHJvcGVydGllczogWydpZCcsICduYW1lJywgJ3R5cGVNQUMnXVxuICAgICAgfSxcbiAgICAgIGhvb2tzOiB7XG4gICAgICAgIG9uSW5pdDogZmllbGQgPT4ge1xuICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25Db250cm9sID0gZmllbGQuZm9ybS5nZXQoJ2Nvbm5lY3Rpb24nKTtcbiAgICAgICAgICBjb25uZWN0aW9uQ29udHJvbC52YWx1ZUNoYW5nZXNcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy51bnN1YnNjcmliZSQpLFxuICAgICAgICAgICAgICBtZXJnZU1hcCgoKSA9PiB0aGlzLmdldERldmljZVByb2ZpbGVzJCh0aGlzLmZvcm0uZ2V0KCdjb25uZWN0aW9uJykudmFsdWUubmFtZSkpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICBwcm9maWxlcyA9PiB7XG4gICAgICAgICAgICAgICAgZmllbGQudGVtcGxhdGVPcHRpb25zLmM4eUZvck9wdGlvbnMgPSBvZihwcm9maWxlcyk7XG4gICAgICAgICAgICAgICAgZmllbGQuZm9ybUNvbnRyb2wuc2V0VmFsdWUobnVsbCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBmaWVsZC5mb3JtLmNvbnRyb2xzLmRldmljZVByb2ZpbGUuc2V0RXJyb3JzKHsgZGV2aWNlUHJvZmlsZTogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICBmaWVsZC52YWxpZGF0b3JzLmRldmljZVByb2ZpbGUubWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB2YWxpZGF0b3JzOiB7XG4gICAgICAgIGRldmljZVByb2ZpbGU6IHtcbiAgICAgICAgICBleHByZXNzaW9uOiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY29udHJvbC5zdGF0dXMgPT09ICdWQUxJRCc7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtZXNzYWdlOiAoKSA9PiAnJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6ICdkZXZpY2VUeXBlJyxcbiAgICAgIHR5cGU6ICd0eXBlYWhlYWQnLFxuICAgICAgdGVtcGxhdGVPcHRpb25zOiB7XG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdEZXZpY2UgcHJvdG9jb2wnKSxcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIGM4eUZvck9wdGlvbnM6IHRoaXMuZGV2aWNlUHJvdG9jb2xzJCxcbiAgICAgICAgZGlzcGxheVByb3BlcnR5OiAnbmFtZScsXG4gICAgICAgIHZhbHVlUHJvcGVydGllczogWydpZCcsICduYW1lJ11cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogJ2RldkVVSScsXG4gICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgdGVtcGxhdGVPcHRpb25zOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiAnMDAxOEEyMDAwMDAwMDAwNCcsXG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdEZXZpY2UgRVVJJyksXG4gICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICBwYXR0ZXJuOiAnXihbYS1mQS1GMC05XXsxNn0pJCdcbiAgICAgIH0sXG4gICAgICB2YWxpZGF0aW9uOiB7XG4gICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgcGF0dGVybjogZ2V0dGV4dCgnTXVzdCBiZSBhIHZhbGlkIDE2IGRpZ2l0IGhleGFkZWNpbWFsIG51bWJlci4nKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6ICdhcHBsaWNhdGlvbkVVSScsXG4gICAgICB0eXBlOiAnaW5wdXQnLFxuICAgICAgdGVtcGxhdGVPcHRpb25zOiB7XG4gICAgICAgIHBsYWNlaG9sZGVyOiAnNzBCM0Q1MzI2MDAwMDAwMycsXG4gICAgICAgIGxhYmVsOiBnZXR0ZXh0KCdBcHBsaWNhdGlvbiBFVUknKSxcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIHBhdHRlcm46ICdeKFthLWZBLUYwLTldezE2fSkkJ1xuICAgICAgfSxcbiAgICAgIHZhbGlkYXRpb246IHtcbiAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICBwYXR0ZXJuOiBnZXR0ZXh0KCdNdXN0IGJlIGEgdmFsaWQgMTYgZGlnaXQgaGV4YWRlY2ltYWwgbnVtYmVyLicpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogJ2FwcGxpY2F0aW9uS2V5JyxcbiAgICAgIHR5cGU6ICdpbnB1dCcsXG4gICAgICB0ZW1wbGF0ZU9wdGlvbnM6IHtcbiAgICAgICAgbGFiZWw6IGdldHRleHQoJ0FwcGxpY2F0aW9uIGtleScpLFxuICAgICAgICBwbGFjZWhvbGRlcjogJzI1OERCNTQwMjNFQTc0RjBENTUwODVGNzM1MTczN0QwJyxcbiAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIHBhdHRlcm46ICdeKFthLWZBLUYwLTldezMyfSkkJ1xuICAgICAgfSxcbiAgICAgIHZhbGlkYXRpb246IHtcbiAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICBwYXR0ZXJuOiBnZXR0ZXh0KCdNdXN0IGJlIGEgdmFsaWQgMzIgZGlnaXQgaGV4YWRlY2ltYWwgbnVtYmVyLicpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogJ2Nvbm5lY3Rpdml0eVBsYW4nLFxuICAgICAgdHlwZTogJ3R5cGVhaGVhZCcsXG4gICAgICB0ZW1wbGF0ZU9wdGlvbnM6IHtcbiAgICAgICAgbGFiZWw6IGdldHRleHQoJ0Nvbm5lY3Rpdml0eSBwbGFuJyksXG4gICAgICAgIGRlc2NyaXB0aW9uOiBnZXR0ZXh0KCdPbmx5IGNvbm5lY3Rpdml0eSBwbGFucyB3aXRoIGZyZWUgc2xvdHMgYXJlIGRpc3BsYXllZCcpLFxuICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgcGxhY2Vob2xkZXI6ICdEZXYtb3BlIHRlc3RpbmcgQ1AnLFxuICAgICAgICBkaXNwbGF5UHJvcGVydHk6ICduYW1lJyxcbiAgICAgICAgdmFsdWVQcm9wZXJ0aWVzOiBbJ2lkJywgJ3JlZicsICduYW1lJywgJ2dyYW50ZWRDb25uZWN0aW9ucycsICd1c2VkQ29ubmVjdGlvbnMnXVxuICAgICAgfSxcbiAgICAgIGhvb2tzOiB7XG4gICAgICAgIG9uSW5pdDogZmllbGQgPT4ge1xuICAgICAgICAgIGNvbnN0IGNvbm5lY3Rpb25Db250cm9sID0gZmllbGQuZm9ybS5nZXQoJ2Nvbm5lY3Rpb24nKTtcbiAgICAgICAgICBjb25uZWN0aW9uQ29udHJvbC52YWx1ZUNoYW5nZXNcbiAgICAgICAgICAgIC5waXBlKFxuICAgICAgICAgICAgICB0YWtlVW50aWwodGhpcy51bnN1YnNjcmliZSQpLFxuICAgICAgICAgICAgICBtZXJnZU1hcCgoKSA9PiB0aGlzLmdldENvbm5lY3Rpdml0eVBsYW5zJCh0aGlzLmZvcm0uZ2V0KCdjb25uZWN0aW9uJykudmFsdWUubmFtZSkpXG4gICAgICAgICAgICApXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICBwcm9maWxlcyA9PiB7XG4gICAgICAgICAgICAgICAgZmllbGQudGVtcGxhdGVPcHRpb25zLmM4eUZvck9wdGlvbnMgPSBvZihwcm9maWxlcyk7XG4gICAgICAgICAgICAgICAgZmllbGQuZm9ybUNvbnRyb2wuc2V0VmFsdWUobnVsbCk7XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBmaWVsZC5mb3JtLmNvbnRyb2xzLmNvbm5lY3Rpdml0eVBsYW4uc2V0RXJyb3JzKHsgY29ubmVjdGl2aXR5UGxhbjogdHJ1ZSB9KTtcbiAgICAgICAgICAgICAgICBmaWVsZC52YWxpZGF0b3JzLmNvbm5lY3Rpdml0eVBsYW4ubWVzc2FnZSA9IGVycm9yLm1lc3NhZ2U7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICk7XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB2YWxpZGF0b3JzOiB7XG4gICAgICAgIGNvbm5lY3Rpdml0eVBsYW46IHtcbiAgICAgICAgICBleHByZXNzaW9uOiAoY29udHJvbDogQWJzdHJhY3RDb250cm9sKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gY29udHJvbC5zdGF0dXMgPT09ICdWQUxJRCc7XG4gICAgICAgICAgfSxcbiAgICAgICAgICBtZXNzYWdlOiAoKSA9PiAnJ1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICBdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBic01vZGFsUmVmOiBCc01vZGFsUmVmLFxuICAgIHByaXZhdGUgcmVnaXN0cmF0aW9uU2VydmljZTogQWN0aWxpdHlEZXZpY2VSZWdpc3RyYXRpb25TZXJ2aWNlXG4gICkge1xuICAgIHRoaXMubG9hZCQuc3Vic2NyaWJlKFxuICAgICAgKCkgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlID0gJ2xvYWRTdWNjZXNzJztcbiAgICAgIH0sXG4gICAgICBlcnJvcnMgPT4ge1xuICAgICAgICB0aGlzLnN0YXRlID0gJ2xvYWRFcnJvcic7XG4gICAgICAgIHRoaXMuZXJyb3JzJC5uZXh0KGVycm9ycyk7XG4gICAgICB9XG4gICAgKTtcbiAgfVxuXG4gIGdldENvbm5lY3Rpdml0eVBsYW5zJChuYW1lKSB7XG4gICAgcmV0dXJuIGRlZmVyKCgpID0+IGZyb20odGhpcy5yZWdpc3RyYXRpb25TZXJ2aWNlLmdldENvbm5lY3Rpdml0eVBsYW5zKG5hbWUpKSkucGlwZShcbiAgICAgIHNoYXJlUmVwbGF5KDEpXG4gICAgKTtcbiAgfVxuXG4gIGdldERldmljZVByb2ZpbGVzJChuYW1lKSB7XG4gICAgcmV0dXJuIGRlZmVyKCgpID0+IGZyb20odGhpcy5yZWdpc3RyYXRpb25TZXJ2aWNlLmdldERldmljZVByb2ZpbGVzKG5hbWUpKSkucGlwZShzaGFyZVJlcGxheSgxKSk7XG4gIH1cblxuICBnZXREZXZpY2VQcm90b2NvbHMkKCkge1xuICAgIHJldHVybiBkZWZlcigoKSA9PiBmcm9tKHRoaXMucmVnaXN0cmF0aW9uU2VydmljZS5nZXREZXZpY2VQcm90b2NvbHMoKSkpLnBpcGUoc2hhcmVSZXBsYXkoMSkpO1xuICB9XG5cbiAgZ2V0Q29ubmVjdGlvbnMkKCkge1xuICAgIHJldHVybiBkZWZlcigoKSA9PiBmcm9tKHRoaXMucmVnaXN0cmF0aW9uU2VydmljZS5nZXRDb25uZWN0aW9ucygpKSkucGlwZShzaGFyZVJlcGxheSgxKSk7XG4gIH1cblxuICBhc3luYyByZWdpc3RlcihldmVudDogeyBzdGVwcGVyOiBDOHlTdGVwcGVyOyBzdGVwOiBDZGtTdGVwIH0pIHtcbiAgICBldmVudC5zdGVwcGVyLm5leHQoKTtcbiAgICB0aGlzLnN0YXRlID0gJ3JlZ2lzdHJhdGlvblBlbmRpbmcnO1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBhY3RpbGl0eURldmljZSA9IHRoaXMuZ2V0QWN0aWxpdHlEZXZpY2VUb1NlbmQoKTtcbiAgICAgIGF3YWl0IHRoaXMucmVnaXN0cmF0aW9uU2VydmljZS5yZWdpc3RlcihhY3RpbGl0eURldmljZSk7XG4gICAgICB0aGlzLnN0YXRlID0gJ3JlZ2lzdHJhdGlvblN1Y2Nlc3MnO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICB0aGlzLnN0YXRlID0gJ3JlZ2lzdHJhdGlvbkVycm9yJztcbiAgICAgIHRoaXMuZXJyb3JzJC5uZXh0KFtlcnJvcl0pO1xuICAgIH1cbiAgfVxuXG4gIGdldEFjdGlsaXR5RGV2aWNlVG9TZW5kKCkge1xuICAgIGNvbnN0IGFjdGlsaXR5RGV2aWNlOiBBY3RpbGl0eURldmljZVJlZ2lzdHJhdGlvbiA9IGNsb25lRGVlcCh0aGlzLm1vZGVsKTtcbiAgICBhY3RpbGl0eURldmljZS5sbnNDb25uZWN0aW9uTmFtZSA9IHRoaXMubW9kZWwuY29ubmVjdGlvbi5uYW1lO1xuICAgIGRlbGV0ZSAoYWN0aWxpdHlEZXZpY2UgYXMgYW55KS5jb25uZWN0aW9uO1xuICAgIHJldHVybiBhY3RpbGl0eURldmljZTtcbiAgfVxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLnVuc3Vic2NyaWJlJC5uZXh0KCk7XG4gICAgdGhpcy51bnN1YnNjcmliZSQuY29tcGxldGUoKTtcbiAgfVxufVxuIl19