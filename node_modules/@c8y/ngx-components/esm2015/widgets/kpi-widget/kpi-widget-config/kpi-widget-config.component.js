import { __awaiter } from "tslib";
import { Component, Input } from '@angular/core';
import { ControlContainer, FormBuilder, NgForm, Validators } from '@angular/forms';
import { WidgetConfigComponent } from '@c8y/ngx-components/context-dashboard';
import { DatapointLibraryService } from '@c8y/ngx-components/datapoint-selector';
import { IconSelectorService } from '@c8y/ngx-components/icon-selector';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/forms';
import * as ɵngcc2 from '@c8y/ngx-components/icon-selector';
import * as ɵngcc3 from '@c8y/ngx-components/context-dashboard';
import * as ɵngcc4 from '@c8y/ngx-components/datapoint-selector';
import * as ɵngcc5 from '@c8y/ngx-components';
import * as ɵngcc6 from 'ngx-bootstrap/popover';

const _c0 = function () { return { example: 1 }; };
const _c1 = function () { return { example: 36 }; };
export function exactlyASingleDatapointActive() {
    return (control) => {
        const datapoints = control.value;
        if (!datapoints || !datapoints.length) {
            return null;
        }
        const activeDatapoints = datapoints.filter(datapoint => datapoint.__active);
        if (activeDatapoints.length === 1) {
            return null;
        }
        return { exactlyOneDatapointNeedsToBeActive: true };
    };
}
export class KpiWidgetConfigComponent {
    constructor(formBuilder, form, iconSelector, widgetConfig, datapointLibrary) {
        this.formBuilder = formBuilder;
        this.form = form;
        this.iconSelector = iconSelector;
        this.widgetConfig = widgetConfig;
        this.datapointLibrary = datapointLibrary;
        this.datapointSelectionConfig = {};
        this.defaultFormOptions = {
            showRedRange: true,
            showYellowRange: true
        };
        this.availableIcons = [];
        this.limits = {
            fontSizeMax: 72,
            fontSizeMin: 18,
            numberOfDecimalPlacesMax: 10,
            numberOfDecimalPlacesMin: 0
        };
    }
    onBeforeSave(config) {
        if (this.formGroup.valid) {
            Object.assign(config, this.formGroup.value);
            return true;
        }
        return false;
    }
    ngOnInit() {
        var _a, _b, _c, _d;
        return __awaiter(this, void 0, void 0, function* () {
            if ((_a = this.widgetConfig.context) === null || _a === void 0 ? void 0 : _a.id) {
                this.datapointSelectionConfig.contextAsset = (_b = this.widgetConfig) === null || _b === void 0 ? void 0 : _b.context;
            }
            this.initForm();
            if ((_c = this.config) === null || _c === void 0 ? void 0 : _c.datapoints) {
                this.config.datapoints = yield this.datapointLibrary.updateDatapoints((_d = this.config) === null || _d === void 0 ? void 0 : _d.datapoints);
                this.formGroup.patchValue({ datapoints: this.config.datapoints });
            }
        });
    }
    openIconSelector() {
        return __awaiter(this, void 0, void 0, function* () {
            try {
                const icon = yield this.iconSelector.selectIcon({
                    currentSelection: this.formGroup.value.icon
                });
                this.formGroup.patchValue({ icon });
            }
            catch (_a) {
                // nothing to do
            }
        });
    }
    initForm() {
        this.formGroup = this.formBuilder.group({
            numberOfDecimalPlaces: [
                1,
                [
                    Validators.required,
                    Validators.min(this.limits.numberOfDecimalPlacesMin),
                    Validators.max(this.limits.numberOfDecimalPlacesMax)
                ]
            ],
            showTimestamp: [true, []],
            showTrend: [true, []],
            showIcon: [true, []],
            icon: ['water', [Validators.required, Validators.minLength(1)]],
            fontSize: [
                36,
                [
                    Validators.required,
                    Validators.min(this.limits.fontSizeMin),
                    Validators.max(this.limits.fontSizeMax)
                ]
            ],
            datapoints: [
                [],
                [Validators.required, Validators.minLength(1), exactlyASingleDatapointActive()]
            ]
        });
        this.form.form.addControl('config', this.formGroup);
        this.formGroup.patchValue(this.config);
    }
}
KpiWidgetConfigComponent.ɵfac = function KpiWidgetConfigComponent_Factory(t) { return new (t || KpiWidgetConfigComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.FormBuilder), ɵngcc0.ɵɵdirectiveInject(ɵngcc1.NgForm), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.IconSelectorService), ɵngcc0.ɵɵdirectiveInject(ɵngcc3.WidgetConfigComponent), ɵngcc0.ɵɵdirectiveInject(ɵngcc4.DatapointLibraryService)); };
KpiWidgetConfigComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: KpiWidgetConfigComponent, selectors: [["c8y-kpi-widget-config"]], inputs: { config: "config" }, features: [ɵngcc0.ɵɵProvidersFeature([], [{ provide: ControlContainer, useExisting: NgForm }])], decls: 56, vars: 44, consts: [[1, "row", 3, "formGroup"], [1, "col-sm-6"], ["formControlName", "datapoints", "name", "datapoints", 3, "defaultFormOptions", "config", "minActiveCount", "maxActiveCount"], ["translate", ""], [1, "d-flex", "a-i-center"], [1, "p-r-8", "icon-32", "text-muted"], [3, "c8yIcon"], [1, "btn", "btn-default", "btn-xs", 3, "click"], ["translate", "", 3, "title"], ["formControlName", "numberOfDecimalPlaces", "name", "numberOfDecimalPlaces", "type", "number", 1, "form-control", 3, "placeholder"], [3, "show"], [1, "d-flex", "gap-16", "flex-wrap"], [1, "c8y-checkbox", 3, "title"], ["type", "checkbox", "formControlName", "showTimestamp", "name", "showTimestamp"], ["type", "checkbox", "formControlName", "showIcon", "name", "showIcon"], ["type", "checkbox", "formControlName", "showTrend", "name", "showTrend"], ["container", "body", 1, "btn", "btn-clean", 3, "popover", "outsideClick"], [1, "text-info", 3, "c8yIcon"], ["formControlName", "fontSize", "name", "fontSize", "type", "number", 1, "form-control", 3, "placeholder"]], template: function KpiWidgetConfigComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "form", 0);
        ɵngcc0.ɵɵelementStart(1, "div", 1);
        ɵngcc0.ɵɵelement(2, "c8y-datapoint-selection-list", 2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(3, "div", 1);
        ɵngcc0.ɵɵelementStart(4, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(5, "label", 3);
        ɵngcc0.ɵɵtext(6, "Icon");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(7, "div", 4);
        ɵngcc0.ɵɵelementStart(8, "div", 5);
        ɵngcc0.ɵɵelement(9, "i", 6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(10, "button", 7);
        ɵngcc0.ɵɵlistener("click", function KpiWidgetConfigComponent_Template_button_click_10_listener() { return ctx.openIconSelector(); });
        ɵngcc0.ɵɵtext(11);
        ɵngcc0.ɵɵpipe(12, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(13, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(14, "label", 8);
        ɵngcc0.ɵɵpipe(15, "translate");
        ɵngcc0.ɵɵtext(16, " Number of decimal places ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(17, "input", 9);
        ɵngcc0.ɵɵpipe(18, "translate");
        ɵngcc0.ɵɵelement(19, "c8y-messages", 10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(20, "div");
        ɵngcc0.ɵɵelementStart(21, "label");
        ɵngcc0.ɵɵtext(22);
        ɵngcc0.ɵɵpipe(23, "translate");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(24, "div", 11);
        ɵngcc0.ɵɵelementStart(25, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(26, "label", 12);
        ɵngcc0.ɵɵpipe(27, "translate");
        ɵngcc0.ɵɵelement(28, "input", 13);
        ɵngcc0.ɵɵelement(29, "span");
        ɵngcc0.ɵɵelementStart(30, "span", 3);
        ɵngcc0.ɵɵtext(31, "Show timestamp");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(32, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(33, "label", 12);
        ɵngcc0.ɵɵpipe(34, "translate");
        ɵngcc0.ɵɵelement(35, "input", 14);
        ɵngcc0.ɵɵelement(36, "span");
        ɵngcc0.ɵɵelementStart(37, "span", 3);
        ɵngcc0.ɵɵtext(38, "Show icon");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(39, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(40, "label", 12);
        ɵngcc0.ɵɵpipe(41, "translate");
        ɵngcc0.ɵɵelement(42, "input", 15);
        ɵngcc0.ɵɵelement(43, "span");
        ɵngcc0.ɵɵelementStart(44, "span", 3);
        ɵngcc0.ɵɵtext(45, "Show trend icon");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(46, "button", 16);
        ɵngcc0.ɵɵpipe(47, "translate");
        ɵngcc0.ɵɵelement(48, "i", 17);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(49, "c8y-form-group");
        ɵngcc0.ɵɵelementStart(50, "label", 8);
        ɵngcc0.ɵɵpipe(51, "translate");
        ɵngcc0.ɵɵtext(52, " Font size of measurement value (px) ");
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(53, "input", 18);
        ɵngcc0.ɵɵpipe(54, "translate");
        ɵngcc0.ɵɵelement(55, "c8y-messages", 10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("formGroup", ctx.formGroup);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("defaultFormOptions", ctx.defaultFormOptions)("config", ctx.datapointSelectionConfig)("minActiveCount", 1)("maxActiveCount", 1);
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵproperty("c8yIcon", ctx.formGroup.value.icon);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(12, 20, "Change"), " ");
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(15, 22, "Number of decimal places"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(18, 24, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(42, _c0)));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("show", (ctx.formGroup.controls == null ? null : ctx.formGroup.controls.numberOfDecimalPlaces == null ? null : ctx.formGroup.controls.numberOfDecimalPlaces.touched) && (ctx.formGroup == null ? null : ctx.formGroup.controls == null ? null : ctx.formGroup.controls.numberOfDecimalPlaces == null ? null : ctx.formGroup.controls.numberOfDecimalPlaces.errors));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(23, 27, "Display"), "");
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(27, 29, "Show timestamp"));
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(34, 31, "Show icon"));
        ɵngcc0.ɵɵadvance(7);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(41, 33, "Show trend icon"));
        ɵngcc0.ɵɵadvance(6);
        ɵngcc0.ɵɵpropertyInterpolate("popover", ɵngcc0.ɵɵpipeBind1(47, 35, "Indicates the trend between the last two measurement values."));
        ɵngcc0.ɵɵproperty("outsideClick", true);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("c8yIcon", "question-circle-o");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("title", ɵngcc0.ɵɵpipeBind1(51, 37, "Font size of measurement value (px)"));
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵproperty("placeholder", ɵngcc0.ɵɵpipeBind2(54, 39, "e.g. {{ example }}", ɵngcc0.ɵɵpureFunction0(43, _c1)));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("show", (ctx.formGroup.controls == null ? null : ctx.formGroup.controls.fontSize == null ? null : ctx.formGroup.controls.fontSize.touched) && (ctx.formGroup == null ? null : ctx.formGroup.controls == null ? null : ctx.formGroup.controls.fontSize == null ? null : ctx.formGroup.controls.fontSize.errors));
    } }, directives: [ɵngcc1.ɵNgNoValidate, ɵngcc1.NgControlStatusGroup, ɵngcc1.FormGroupDirective, ɵngcc4.DatapointSelectionListComponent, ɵngcc1.NgControlStatus, ɵngcc1.FormControlName, ɵngcc5.FormGroupComponent, ɵngcc5.C8yTranslateDirective, ɵngcc5.IconDirective, ɵngcc1.DefaultValueAccessor, ɵngcc5.RequiredInputPlaceholderDirective, ɵngcc1.NumberValueAccessor, ɵngcc5.MessagesComponent, ɵngcc1.CheckboxControlValueAccessor, ɵngcc6.PopoverDirective], pipes: [ɵngcc5.C8yTranslatePipe], encapsulation: 2 });
KpiWidgetConfigComponent.ctorParameters = () => [
    { type: FormBuilder },
    { type: NgForm },
    { type: IconSelectorService },
    { type: WidgetConfigComponent },
    { type: DatapointLibraryService }
];
KpiWidgetConfigComponent.propDecorators = {
    config: [{ type: Input }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(KpiWidgetConfigComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-kpi-widget-config',
                template: "<form [formGroup]=\"formGroup\" class=\"row\">\n  <div class=\"col-sm-6\">\n    <c8y-datapoint-selection-list\n      [defaultFormOptions]=\"defaultFormOptions\"\n      [config]=\"datapointSelectionConfig\"\n      [minActiveCount]=\"1\"\n      [maxActiveCount]=\"1\"\n      formControlName=\"datapoints\"\n      name=\"datapoints\"\n    >\n    </c8y-datapoint-selection-list>\n  </div>\n  <div class=\"col-sm-6\">\n    <c8y-form-group>\n      <label translate>Icon</label>\n      <div class=\"d-flex a-i-center\">\n        <div class=\"p-r-8 icon-32 text-muted\">\n          <i [c8yIcon]=\"formGroup.value.icon\"></i>\n        </div>\n        <button class=\"btn btn-default btn-xs\" (click)=\"openIconSelector()\">\n          {{ 'Change' | translate }}\n        </button>\n      </div>\n    </c8y-form-group>\n    <c8y-form-group>\n      <label [title]=\"'Number of decimal places' | translate\" translate>\n        Number of decimal places\n      </label>\n      <input\n        class=\"form-control\"\n        formControlName=\"numberOfDecimalPlaces\"\n        name=\"numberOfDecimalPlaces\"\n        type=\"number\"\n        [placeholder]=\"'e.g. {{ example }}' | translate: { example: 1 }\"\n      />\n      <c8y-messages [show]=\"formGroup.controls?.numberOfDecimalPlaces?.touched && formGroup?.controls?.numberOfDecimalPlaces?.errors\">\n      </c8y-messages>\n    </c8y-form-group>\n    <div>\n      <label> {{ 'Display' | translate }}</label>\n      <div class=\"d-flex gap-16 flex-wrap\">\n        <c8y-form-group>\n          <label [title]=\"'Show timestamp' | translate\" class=\"c8y-checkbox\">\n            <input type=\"checkbox\" formControlName=\"showTimestamp\" name=\"showTimestamp\" />\n            <span></span>\n            <span translate>Show timestamp</span>\n          </label>\n        </c8y-form-group>\n\n        <c8y-form-group>\n          <label [title]=\"'Show icon' | translate\" class=\"c8y-checkbox\">\n            <input type=\"checkbox\" formControlName=\"showIcon\" name=\"showIcon\" />\n            <span></span>\n            <span translate>Show icon</span>\n          </label>\n        </c8y-form-group>\n\n        <c8y-form-group>\n          <label [title]=\"'Show trend icon' | translate\" class=\"c8y-checkbox\">\n            <input type=\"checkbox\" formControlName=\"showTrend\" name=\"showTrend\" />\n            <span></span>\n            <span translate>Show trend icon</span>\n            <button\n              class=\"btn btn-clean\"\n              popover=\"{{\n                'Indicates the trend between the last two measurement values.' | translate\n              }}\"\n              container=\"body\"\n              [outsideClick]=\"true\"\n            >\n              <i [c8yIcon]=\"'question-circle-o'\" class=\"text-info\"></i>\n            </button>\n          </label>\n        </c8y-form-group>\n      </div>\n\n      <c8y-form-group>\n        <label [title]=\"'Font size of measurement value (px)' | translate\" translate>\n          Font size of measurement value (px)\n        </label>\n        <input\n          class=\"form-control\"\n          formControlName=\"fontSize\"\n          name=\"fontSize\"\n          type=\"number\"\n          [placeholder]=\"'e.g. {{ example }}' | translate: { example: 36 }\"\n        />\n        <c8y-messages [show]=\"formGroup.controls?.fontSize?.touched && formGroup?.controls?.fontSize?.errors\">\n        </c8y-messages>\n      </c8y-form-group>\n    </div>\n  </div>\n</form>\n",
                viewProviders: [{ provide: ControlContainer, useExisting: NgForm }]
            }]
    }], function () { return [{ type: ɵngcc1.FormBuilder }, { type: ɵngcc1.NgForm }, { type: ɵngcc2.IconSelectorService }, { type: ɵngcc3.WidgetConfigComponent }, { type: ɵngcc4.DatapointLibraryService }]; }, { config: [{
            type: Input
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoia3BpLXdpZGdldC1jb25maWcuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi93aWRnZXRzL2twaS13aWRnZXQva3BpLXdpZGdldC1jb25maWcva3BpLXdpZGdldC1jb25maWcuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxNQUFNLGVBQWUsQ0FBQztBQUN6RCxPQUFPLEVBRUwsZ0JBQWdCLEVBQ2hCLFdBQVcsRUFFWCxNQUFNLEVBR04sVUFBVSxFQUNYLE1BQU0sZ0JBQWdCLENBQUM7QUFFeEIsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sdUNBQXVDLENBQUM7QUFDOUUsT0FBTyxFQUVMLHVCQUF1QixFQUd4QixNQUFNLHdDQUF3QyxDQUFDO0FBQ2hELE9BQU8sRUFBRSxtQkFBbUIsRUFBRSxNQUFNLG1DQUFtQyxDQUFDOzs7Ozs7Ozs7OztBQUl4RSxNQUFNLFVBQVUsNkJBQTZCO0FBQUssSUFDaEQsT0FBTyxDQUFDLE9BQXdCLEVBQTJCLEVBQUU7QUFDL0QsUUFBSSxNQUFNLFVBQVUsR0FBaUIsT0FBTyxDQUFDLEtBQUssQ0FBQztBQUNuRCxRQUNJLElBQUksQ0FBQyxVQUFVLElBQUksQ0FBQyxVQUFVLENBQUMsTUFBTSxFQUFFO0FBQzNDLFlBQU0sT0FBTyxJQUFJLENBQUM7QUFDbEIsU0FBSztBQUNMLFFBQ0ksTUFBTSxnQkFBZ0IsR0FBRyxVQUFVLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxFQUFFLENBQUMsU0FBUyxDQUFDLFFBQVEsQ0FBQyxDQUFDO0FBQ2hGLFFBQ0ksSUFBSSxnQkFBZ0IsQ0FBQyxNQUFNLEtBQUssQ0FBQyxFQUFFO0FBQ3ZDLFlBQU0sT0FBTyxJQUFJLENBQUM7QUFDbEIsU0FBSztBQUNMLFFBQ0ksT0FBTyxFQUFFLGtDQUFrQyxFQUFFLElBQUksRUFBRSxDQUFDO0FBQ3hELElBQUUsQ0FBQyxDQUFDO0FBQ0osQ0FB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QU0sQ0FBQyxDQUFDO0FBQzNDLElBQUUsQ0FBQztBQUNIO29EQTNGQyxTQUFTLFNBQUMsa0JBQ1QsUUFBUSxFQUFFLHVCQUF1QixrQkFDakM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O3dCQUFpRDtXQUNqRCxhQUFhLEVBQUUsQ0FBQyxFQUFFO0tBQU8sRUFBRSxnQkFBZ0IsRUFBRTtLQUFXLEVBQUUsTUFBTSxFQUFFLENBQUMsY0FDcEU7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7NmZBQ0k7QUFBQztBQUFrRCxZQTFDdEQsV0FBVztBQUNYLFlBQ0EsTUFBTTtBQUNOLFlBWU8sbUJBQW1CO0FBQUksWUFQdkIscUJBQXFCO0FBQUksWUFHaEMsdUJBQXVCO0FBQ3hCO0FBQUc7QUFFRixxQkE2QkMsS0FBSztBQUFJOzs7Ozs7Ozs7O29CQUFFO0FBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIElucHV0LCBPbkluaXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG4gIEFic3RyYWN0Q29udHJvbCxcbiAgQ29udHJvbENvbnRhaW5lcixcbiAgRm9ybUJ1aWxkZXIsXG4gIEZvcm1Hcm91cCxcbiAgTmdGb3JtLFxuICBWYWxpZGF0aW9uRXJyb3JzLFxuICBWYWxpZGF0b3JGbixcbiAgVmFsaWRhdG9yc1xufSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBPbkJlZm9yZVNhdmUgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IFdpZGdldENvbmZpZ0NvbXBvbmVudCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMvY29udGV4dC1kYXNoYm9hcmQnO1xuaW1wb3J0IHtcbiAgRGF0YXBvaW50QXR0cmlidXRlc0Zvcm1Db25maWcsXG4gIERhdGFwb2ludExpYnJhcnlTZXJ2aWNlLFxuICBEYXRhcG9pbnRTZWxlY3Rvck1vZGFsT3B0aW9ucyxcbiAgS1BJRGV0YWlsc1xufSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzL2RhdGFwb2ludC1zZWxlY3Rvcic7XG5pbXBvcnQgeyBJY29uU2VsZWN0b3JTZXJ2aWNlIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cy9pY29uLXNlbGVjdG9yJztcbmltcG9ydCB7IE9ic2VydmFibGUgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEtwaVdpZGdldENvbmZpZyB9IGZyb20gJy4uL2twaS13aWRnZXQubW9kZWwnO1xuXG5leHBvcnQgZnVuY3Rpb24gZXhhY3RseUFTaW5nbGVEYXRhcG9pbnRBY3RpdmUoKTogVmFsaWRhdG9yRm4ge1xuICByZXR1cm4gKGNvbnRyb2w6IEFic3RyYWN0Q29udHJvbCk6IFZhbGlkYXRpb25FcnJvcnMgfCBudWxsID0+IHtcbiAgICBjb25zdCBkYXRhcG9pbnRzOiBLUElEZXRhaWxzW10gPSBjb250cm9sLnZhbHVlO1xuXG4gICAgaWYgKCFkYXRhcG9pbnRzIHx8ICFkYXRhcG9pbnRzLmxlbmd0aCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgYWN0aXZlRGF0YXBvaW50cyA9IGRhdGFwb2ludHMuZmlsdGVyKGRhdGFwb2ludCA9PiBkYXRhcG9pbnQuX19hY3RpdmUpO1xuXG4gICAgaWYgKGFjdGl2ZURhdGFwb2ludHMubGVuZ3RoID09PSAxKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4geyBleGFjdGx5T25lRGF0YXBvaW50TmVlZHNUb0JlQWN0aXZlOiB0cnVlIH07XG4gIH07XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1rcGktd2lkZ2V0LWNvbmZpZycsXG4gIHRlbXBsYXRlVXJsOiAnLi9rcGktd2lkZ2V0LWNvbmZpZy5jb21wb25lbnQuaHRtbCcsXG4gIHZpZXdQcm92aWRlcnM6IFt7IHByb3ZpZGU6IENvbnRyb2xDb250YWluZXIsIHVzZUV4aXN0aW5nOiBOZ0Zvcm0gfV1cbn0pXG5leHBvcnQgY2xhc3MgS3BpV2lkZ2V0Q29uZmlnQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkJlZm9yZVNhdmUge1xuICBASW5wdXQoKSBjb25maWc6IEtwaVdpZGdldENvbmZpZztcbiAgZGF0YXBvaW50U2VsZWN0aW9uQ29uZmlnOiBQYXJ0aWFsPERhdGFwb2ludFNlbGVjdG9yTW9kYWxPcHRpb25zPiA9IHt9O1xuICBkZWZhdWx0Rm9ybU9wdGlvbnM6IFBhcnRpYWw8RGF0YXBvaW50QXR0cmlidXRlc0Zvcm1Db25maWc+ID0ge1xuICAgIHNob3dSZWRSYW5nZTogdHJ1ZSxcbiAgICBzaG93WWVsbG93UmFuZ2U6IHRydWVcbiAgfTtcbiAgZm9ybUdyb3VwOiBGb3JtR3JvdXA7XG4gIGF2YWlsYWJsZUljb25zOiBzdHJpbmdbXSA9IFtdO1xuICBsaW1pdHMgPSB7XG4gICAgZm9udFNpemVNYXg6IDcyLFxuICAgIGZvbnRTaXplTWluOiAxOCxcbiAgICBudW1iZXJPZkRlY2ltYWxQbGFjZXNNYXg6IDEwLFxuICAgIG51bWJlck9mRGVjaW1hbFBsYWNlc01pbjogMFxuICB9O1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgZm9ybUJ1aWxkZXI6IEZvcm1CdWlsZGVyLFxuICAgIHByaXZhdGUgZm9ybTogTmdGb3JtLFxuICAgIHByaXZhdGUgaWNvblNlbGVjdG9yOiBJY29uU2VsZWN0b3JTZXJ2aWNlLFxuICAgIHByaXZhdGUgd2lkZ2V0Q29uZmlnOiBXaWRnZXRDb25maWdDb21wb25lbnQsXG4gICAgcHJpdmF0ZSBkYXRhcG9pbnRMaWJyYXJ5OiBEYXRhcG9pbnRMaWJyYXJ5U2VydmljZVxuICApIHt9XG5cbiAgb25CZWZvcmVTYXZlKGNvbmZpZz86IEtwaVdpZGdldENvbmZpZyk6IGJvb2xlYW4gfCBQcm9taXNlPGJvb2xlYW4+IHwgT2JzZXJ2YWJsZTxib29sZWFuPiB7XG4gICAgaWYgKHRoaXMuZm9ybUdyb3VwLnZhbGlkKSB7XG4gICAgICBPYmplY3QuYXNzaWduKGNvbmZpZywgdGhpcy5mb3JtR3JvdXAudmFsdWUpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIGFzeW5jIG5nT25Jbml0KCkge1xuICAgIGlmICh0aGlzLndpZGdldENvbmZpZy5jb250ZXh0Py5pZCkge1xuICAgICAgdGhpcy5kYXRhcG9pbnRTZWxlY3Rpb25Db25maWcuY29udGV4dEFzc2V0ID0gdGhpcy53aWRnZXRDb25maWc/LmNvbnRleHQ7XG4gICAgfVxuICAgIHRoaXMuaW5pdEZvcm0oKTtcbiAgICBpZiAodGhpcy5jb25maWc/LmRhdGFwb2ludHMpIHtcbiAgICAgIHRoaXMuY29uZmlnLmRhdGFwb2ludHMgPSBhd2FpdCB0aGlzLmRhdGFwb2ludExpYnJhcnkudXBkYXRlRGF0YXBvaW50cyhcbiAgICAgICAgdGhpcy5jb25maWc/LmRhdGFwb2ludHNcbiAgICAgICk7XG4gICAgICB0aGlzLmZvcm1Hcm91cC5wYXRjaFZhbHVlKHsgZGF0YXBvaW50czogdGhpcy5jb25maWcuZGF0YXBvaW50cyB9KTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBvcGVuSWNvblNlbGVjdG9yKCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBpY29uID0gYXdhaXQgdGhpcy5pY29uU2VsZWN0b3Iuc2VsZWN0SWNvbih7XG4gICAgICAgIGN1cnJlbnRTZWxlY3Rpb246IHRoaXMuZm9ybUdyb3VwLnZhbHVlLmljb25cbiAgICAgIH0pO1xuICAgICAgdGhpcy5mb3JtR3JvdXAucGF0Y2hWYWx1ZSh7IGljb24gfSk7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyBub3RoaW5nIHRvIGRvXG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBpbml0Rm9ybSgpOiB2b2lkIHtcbiAgICB0aGlzLmZvcm1Hcm91cCA9IHRoaXMuZm9ybUJ1aWxkZXIuZ3JvdXAoe1xuICAgICAgbnVtYmVyT2ZEZWNpbWFsUGxhY2VzOiBbXG4gICAgICAgIDEsXG4gICAgICAgIFtcbiAgICAgICAgICBWYWxpZGF0b3JzLnJlcXVpcmVkLFxuICAgICAgICAgIFZhbGlkYXRvcnMubWluKHRoaXMubGltaXRzLm51bWJlck9mRGVjaW1hbFBsYWNlc01pbiksXG4gICAgICAgICAgVmFsaWRhdG9ycy5tYXgodGhpcy5saW1pdHMubnVtYmVyT2ZEZWNpbWFsUGxhY2VzTWF4KVxuICAgICAgICBdXG4gICAgICBdLFxuICAgICAgc2hvd1RpbWVzdGFtcDogW3RydWUsIFtdXSxcbiAgICAgIHNob3dUcmVuZDogW3RydWUsIFtdXSxcbiAgICAgIHNob3dJY29uOiBbdHJ1ZSwgW11dLFxuICAgICAgaWNvbjogWyd3YXRlcicsIFtWYWxpZGF0b3JzLnJlcXVpcmVkLCBWYWxpZGF0b3JzLm1pbkxlbmd0aCgxKV1dLFxuICAgICAgZm9udFNpemU6IFtcbiAgICAgICAgMzYsXG4gICAgICAgIFtcbiAgICAgICAgICBWYWxpZGF0b3JzLnJlcXVpcmVkLFxuICAgICAgICAgIFZhbGlkYXRvcnMubWluKHRoaXMubGltaXRzLmZvbnRTaXplTWluKSxcbiAgICAgICAgICBWYWxpZGF0b3JzLm1heCh0aGlzLmxpbWl0cy5mb250U2l6ZU1heClcbiAgICAgICAgXVxuICAgICAgXSxcbiAgICAgIGRhdGFwb2ludHM6IFtcbiAgICAgICAgW10sXG4gICAgICAgIFtWYWxpZGF0b3JzLnJlcXVpcmVkLCBWYWxpZGF0b3JzLm1pbkxlbmd0aCgxKSwgZXhhY3RseUFTaW5nbGVEYXRhcG9pbnRBY3RpdmUoKV1cbiAgICAgIF1cbiAgICB9KTtcbiAgICB0aGlzLmZvcm0uZm9ybS5hZGRDb250cm9sKCdjb25maWcnLCB0aGlzLmZvcm1Hcm91cCk7XG4gICAgdGhpcy5mb3JtR3JvdXAucGF0Y2hWYWx1ZSh0aGlzLmNvbmZpZyk7XG4gIH1cbn1cbiJdfQ==