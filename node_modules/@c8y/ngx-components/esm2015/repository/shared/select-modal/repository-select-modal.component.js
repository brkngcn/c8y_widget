import { __awaiter } from "tslib";
import { Component, EventEmitter } from '@angular/core';
import { QueriesUtil } from '@c8y/client';
import { gettext, ModalSelectionMode } from '@c8y/ngx-components';
import { TranslateService } from '@ngx-translate/core';
import { get, has, isEmpty, isEqual, omitBy } from 'lodash-es';
import { BehaviorSubject, merge, of, Subject } from 'rxjs';
import { map, mergeMap, switchMap, tap } from 'rxjs/operators';
import { RepositoryService } from '../repository.service';
// MODAL STRUCTURE
// - selectModalObject (repository entry (repositoryCategory) -> type c8y_Firmware/c8y_Software)
//   -- ISelectModalOption (repository binary entry (repositoryBinary) => type c8y_FirmwareBinary/c8y_SoftwareBinary)
//   -- ISelectModalOption...
// - selectModalObject...
/**
 * RepositorySelectModalComponent displays repository entries options and allows to select them.
 *
 * @example
 * ```
 * import { take } from 'rxjs/operators';
 * import { RepositorySelectModalComponent, ModalSelectionMode, RepositoryType } from '@c8y/ngx-components/repository/shared';
 *
 * const initialState = {
 *   repositoryType: RepositoryType.FIRMWARE,
 *   title: gettext('Install firmware'),
 *   subTitle: gettext('Available firmwares matching the device type'),
 *   icon: 'c8y-firmware',
 *   mode: ModalSelectionMode.SINGLE,
 *   labels: { ok: gettext('Install') },
 *   disableSelected: false
 * };
 *
 * const modal = this.bsModal.show(RepositorySelectModalComponent, {
 *   ignoreBackdropClick: true,
 *   initialState
 * });
 *
 * modal.content.load.next();
 * modal.content.resultEmitter.pipe(take(1)).subscribe((firmware) => {
 *   ...
 * })
 * ```
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '../repository.service';
import * as ɵngcc2 from '@ngx-translate/core';
import * as ɵngcc3 from '@c8y/ngx-components';
import * as ɵngcc4 from '@angular/common';
export class RepositorySelectModalComponent {
    constructor(repositoryService, translateService) {
        this.repositoryService = repositoryService;
        this.translateService = translateService;
        /**
         * Optional
         * Allows to provide custom data.
         * @example
         * ```
         * import { from } from 'rxjs';
         *
         * const repositoryEntry = { name: 'ExampleEntry', type: 'c8y_Firmware' };
         * const versions = [{ c8y_Firmware: { version: '1.0.0', url: 'http://example.com' } }];
         *
         * const initialState = {repositoryEntriesWithVersions$: from({ ...repositoryEntry, versions })};
         * ```
         */
        this.repositoryEntriesWithVersions$ = undefined;
        /**
         * Optional
         * Allows to use custom badges templates.
         * @example
         * ```
         * import { gettext } from '@c8y/ngx-components';
         *
         * const badgeTemplates = { '=1': gettext('{{count}} version'), other: gettext('{{count}} versions') };
         * const initialState = { badgeTemplates };
         * ```
         */
        this.badgeTemplates = { '=1': gettext('{{count}} version'), other: gettext('{{count}} versions') };
        /**
         * Optional
         * Allows to provide custom modal title.
         */
        this.title = gettext('Select repository entry');
        /**
         * Loads the content of the modal.
         * Must be invoked by the modal's caller.
         */
        this.load = new Subject();
        /**
         * Triggers an update of the item list emitted.
         */
        this.updateInstallableList$ = new Subject();
        /**
         * Optional
         * Emits a filter criteria object currently entered in the filter input.
         * Use it to filter the items if you use custom repositoryEntriesWithVersions$.
         */
        this.searchTerm = new BehaviorSubject({});
        /**
         * Optional
         * Allows to provide device type query to restrict search criteria.
         * Only takes effect when repositoryEntriesWithVersions$ is not provided,
         * otherwise modal's caller have to provide already filtered data in the repositoryEntriesWithVersions$.
         */
        this.deviceTypeQuery = {};
        /**
         * Optional
         * Allows to provide query to restrict search criteria.
         * Only takes effect when repositoryEntriesWithVersions$ is not provided,
         * otherwise modal's caller have to provide already filtered data in the repositoryEntriesWithVersions$.
         */
        this.searchQuery = {};
        /**
         * Optional
         * Allows to provide custom labels for the buttons responsible for confirm/dismiss modal actions.
         */
        this.labels = { ok: gettext('Save') };
        /**
         * Optional
         * Allows to hide the name filter input field.
         * By default, the filter input field is displayed.
         */
        this.showFilter = true;
        /**
         * Optional
         * Allows to show a warning that the search criteria should be narrowed down.
         * By default, this warning is hidden.
         */
        this.areMoreEntries = false;
        /**
         * Emits whenever a new repository binary have been selected in the modal.
         */
        this.onChoiceUpdated = new EventEmitter();
        /**
         * Emits the list of selected options.
         */
        this.resultEmitter = new EventEmitter();
        /**
         * Optional
         * Allows to change selection mode.
         * Supported options:
         *   * single: only single option can be selected.
         *   * multiple: multiple options can be selected.
         */
        this.mode = ModalSelectionMode.SINGLE;
        /**
         * Allows to block selection of the other versions from the same repository entry.
         */
        this.disableSelected = true;
        this.filterCriteria = {};
        this.repositoryEntries$ = this.load.pipe(switchMap(() => this.repositoryEntriesWithVersions$), mergeMap(mos => this.aggregate(mos)), tap(items => {
            this.areMoreEntries = items.length >= this.PAGE_SIZE ? true : false;
        }), tap(items => (this.repositoryEntries = items)));
        this.modalEntries = merge(this.repositoryEntries$, this.updateInstallableList$.pipe(map((updateItemEvent) => {
            const itemToUpdate = (this.repositoryEntries || []).find(item => item.groupId === updateItemEvent.object.groupId);
            if (itemToUpdate) {
                const optionToUpdate = (itemToUpdate.options || []).find(option => option.obj.id === updateItemEvent.object.selectedId);
                if (optionToUpdate) {
                    optionToUpdate.template = updateItemEvent.template;
                    if (updateItemEvent.mapper) {
                        optionToUpdate.obj = updateItemEvent.mapper(optionToUpdate.obj);
                    }
                }
            }
            return this.repositoryEntries;
        })));
        this.PAGE_SIZE = 100;
        this.queriesUtil = new QueriesUtil();
    }
    ngOnInit() {
        if (!this.repositoryType) {
            throw new Error('Repository type must be defined');
        }
        if (!this.repositoryEntriesWithVersions$) {
            this.repositoryEntriesWithVersions$ = of(1).pipe(mergeMap(() => this.repositoryService.listRepositoryEntries(this.repositoryType, {
                query: this.queriesUtil.addAndFilter(this.deviceTypeQuery, has(this.searchQuery, 'name')
                    ? Object.assign(Object.assign({}, this.searchQuery), { name: `*${this.searchQuery.name}*` }) : this.searchQuery),
                params: { pageSize: this.PAGE_SIZE }
            })), map(({ data }) => data), map(mos => this.getAndAssignRepositoryBinaries(mos)));
        }
    }
    getAndAssignRepositoryBinaries(mos) {
        mos.forEach(mo => {
            mo.versions = this.repositoryService.listAllVersions(mo);
        });
        return mos;
    }
    search(filterCriteria) {
        this.filterCriteria = omitBy(Object.assign(Object.assign({}, this.filterCriteria), filterCriteria), isEmpty);
        if (!isEqual(this.filterCriteria, this.searchQuery)) {
            this.searchTerm.next(this.filterCriteria);
            this.searchQuery = this.filterCriteria;
            this.load.next();
        }
    }
    result(selectedItems) {
        this.resultEmitter.emit(selectedItems);
    }
    aggregate(mos) {
        return __awaiter(this, void 0, void 0, function* () {
            const repositoryType = this.repositoryType;
            const selectedItems = this.selected;
            return Promise.all(mos.map((repositoryEntry) => __awaiter(this, void 0, void 0, function* () {
                const options = this.getSelectModalOptions(yield this.repositoryService.fetchAllItemsFromList(repositoryEntry.versions), selectedItems, repositoryEntry, repositoryType);
                const selectModalObject = this.getSelectModalObject(repositoryEntry, options);
                return selectModalObject;
            })));
        });
    }
    getSelectModalOptions(versions, selectedItems, repositoryEntry, repositoryType) {
        const selectModalOptions = [];
        versions.forEach(repositoryBinary => {
            const isSelected = this.isBinaryRepositorySelected(selectedItems, repositoryEntry, repositoryBinary, repositoryType);
            const { version } = repositoryBinary[`${repositoryType}`];
            const bodyValue = version || `(${this.translateService.instant(gettext('not specified`version`'))})`;
            const bodyClass = version ? '' : 'text-muted';
            selectModalOptions.push({
                body: [
                    {
                        value: bodyValue,
                        class: bodyClass
                    }
                ],
                obj: Object.assign(Object.assign(Object.assign({ id: repositoryBinary.id, name: repositoryEntry.name, version }, (get(repositoryBinary, 'c8y_Patch.dependency') && {
                    dependency: get(repositoryBinary, 'c8y_Patch.dependency')
                })), (get(repositoryBinary, 'c8y_Patch') && { isPatch: true })), { url: repositoryBinary[`${repositoryType}`].url, softwareType: repositoryEntry.softwareType }),
                selected: isSelected
            });
        });
        return selectModalOptions;
    }
    isBinaryRepositorySelected(selectedItems, repositoryEntry, repositoryBinary, repositoryType) {
        const isSelected = selectedItems
            ? selectedItems.filter(repositoryFragment => repositoryFragment.name === repositoryEntry.name &&
                repositoryFragment.version === repositoryBinary[`${repositoryType}`].version).length > 0
            : false;
        return isSelected;
    }
    getSelectModalObject(repositoryEntry, options) {
        const label = options.length === 1
            ? this.translateService.instant(this.badgeTemplates['=1'], { count: options.length })
            : this.translateService.instant(this.badgeTemplates.other, { count: options.length });
        const selectModalObject = {
            groupId: repositoryEntry.id,
            body: [
                { value: repositoryEntry.name, class: 'text-truncate' },
                { value: repositoryEntry.description, class: 'text-truncate text-muted' }
            ],
            additionalInformation: { value: label, class: 'label label-info' },
            options
        };
        return selectModalObject;
    }
}
RepositorySelectModalComponent.ɵfac = function RepositorySelectModalComponent_Factory(t) { return new (t || RepositorySelectModalComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.RepositoryService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.TranslateService)); };
RepositorySelectModalComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: RepositorySelectModalComponent, selectors: [["c8y-repository-select-modal"]], decls: 2, vars: 13, consts: [[3, "icon", "title", "subTitle", "items", "mode", "disableSelected", "labels", "showFilter", "additionalFilterTemplate", "areMoreEntries", "noItemsMessage", "search", "onChoiceUpdated", "result"]], template: function RepositorySelectModalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "c8y-select-modal", 0);
        ɵngcc0.ɵɵlistener("search", function RepositorySelectModalComponent_Template_c8y_select_modal_search_0_listener($event) { return ctx.search({ name: $event }); })("onChoiceUpdated", function RepositorySelectModalComponent_Template_c8y_select_modal_onChoiceUpdated_0_listener($event) { return ctx.onChoiceUpdated.emit($event); })("result", function RepositorySelectModalComponent_Template_c8y_select_modal_result_0_listener($event) { return ctx.result($event); });
        ɵngcc0.ɵɵpipe(1, "async");
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("icon", ctx.icon)("title", ctx.title)("subTitle", ctx.subTitle)("items", ɵngcc0.ɵɵpipeBind1(1, 11, ctx.modalEntries))("mode", ctx.mode)("disableSelected", ctx.disableSelected)("labels", ctx.labels)("showFilter", ctx.showFilter)("additionalFilterTemplate", ctx.additionalFilterTemplate)("areMoreEntries", ctx.areMoreEntries)("noItemsMessage", ctx.noItemsMessage);
    } }, directives: [ɵngcc3.SelectModalComponent], pipes: [ɵngcc4.AsyncPipe], encapsulation: 2 });
RepositorySelectModalComponent.ctorParameters = () => [
    { type: RepositoryService },
    { type: TranslateService }
];
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(RepositorySelectModalComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-repository-select-modal',
                template: "<c8y-select-modal\n  [icon]=\"icon\"\n  [title]=\"title\"\n  [subTitle]=\"subTitle\"\n  [items]=\"modalEntries | async\"\n  [mode]=\"mode\"\n  [disableSelected]=\"disableSelected\"\n  [labels]=\"labels\"\n  [showFilter]=\"showFilter\"\n  [additionalFilterTemplate]=\"additionalFilterTemplate\"\n  [areMoreEntries]=\"areMoreEntries\"\n  [noItemsMessage]=\"noItemsMessage\"\n  (search)=\"search({ name: $event })\"\n  (onChoiceUpdated)=\"onChoiceUpdated.emit($event)\"\n  (result)=\"result($event)\"\n>\n</c8y-select-modal>\n"
            }]
    }], function () { return [{ type: ɵngcc1.RepositoryService }, { type: ɵngcc2.TranslateService }]; }, null); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicmVwb3NpdG9yeS1zZWxlY3QtbW9kYWwuY29tcG9uZW50LmpzIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9yZXBvc2l0b3J5L3NoYXJlZC9zZWxlY3QtbW9kYWwvcmVwb3NpdG9yeS1zZWxlY3QtbW9kYWwuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBZSxNQUFNLGVBQWUsQ0FBQztBQUNyRSxPQUFPLEVBQWtCLFdBQVcsRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUMxRCxPQUFPLEVBQ0wsT0FBTyxFQUtQLGtCQUFrQixFQUNuQixNQUFNLHFCQUFxQixDQUFDO0FBQzdCLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHFCQUFxQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxHQUFHLEVBQUUsR0FBRyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQy9ELE9BQU8sRUFBRSxlQUFlLEVBQUUsS0FBSyxFQUFjLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDdkUsT0FBTyxFQUFFLEdBQUcsRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLEdBQUcsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBUS9ELE9BQU8sRUFBRSxpQkFBaUIsRUFBRSxNQUFNLHVCQUF1QixDQUFDO0FBRTFELGtCQUFrQjtBQUNsQixnR0FBZ0c7QUFDaEcscUhBQXFIO0FBQ3JILDZCQUE2QjtBQUM3Qix5QkFBeUI7QUFFekI7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOzs7Ozs7QUFNSCxNQUFNLE9BQU8sOEJBQThCO0FBQzNDLElBeUtFLFlBQ1UsaUJBQW9DLEVBQ3BDLGdCQUFrQztBQUMzQyxRQUZTLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7QUFBQyxRQUNyQyxxQkFBZ0IsR0FBaEIsZ0JBQWdCLENBQWtCO0FBQzlDLFFBNUtFO0FBQ0Y7QUFDTTtBQUNNO0FBRUg7QUFBZTtBQUVDO0FBQVc7QUFDTTtBQUVDO0FBQVc7QUFHVDtBQUFlLFdBRHZEO0FBQ0wsUUFBRSxtQ0FBOEIsR0FBaUMsU0FBUyxDQUFDO0FBQzNFLFFBSUU7QUFDRjtBQUNNO0FBQ007QUFFSDtBQUFlO0FBRUM7QUFBVztBQUNNO0FBR1Q7QUFBZSxXQUQzQztBQUNMLFFBQUUsbUJBQWMsR0FBRyxFQUFFLElBQUksRUFBRSxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFBRSxLQUFLLEVBQUUsT0FBTyxDQUFDLG9CQUFvQixDQUFDLEVBQUUsQ0FBQztBQUNoRyxRQUFFO0FBQ0Y7QUFDTTtBQUVBLFdBREQ7QUFDTCxRQUFFLFVBQUssR0FBVyxPQUFPLENBQUMseUJBQXlCLENBQUMsQ0FBQztBQUNyRCxRQUtFO0FBQ0Y7QUFDTTtBQUVBLFdBREQ7QUFDTCxRQUFFLFNBQUksR0FBa0IsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUN0QyxRQUFFO0FBQ0Y7QUFFQSxXQURLO0FBQ0wsUUFBRSwyQkFBc0IsR0FBbUMsSUFBSSxPQUFPLEVBQUUsQ0FBQztBQUN6RSxRQUFFO0FBQ0Y7QUFDTTtBQUNNO0FBRUEsV0FEUDtBQUNMLFFBQUUsZUFBVSxHQUFvQyxJQUFJLGVBQWUsQ0FBQyxFQUFFLENBQUMsQ0FBQztBQUN4RSxRQUFFO0FBQ0Y7QUFDTTtBQUNNO0FBQ007QUFFQSxXQURiO0FBQ0wsUUFBRSxvQkFBZSxHQUFRLEVBQUUsQ0FBQztBQUM1QixRQUFFO0FBQ0Y7QUFDTTtBQUNNO0FBQ007QUFFQSxXQURiO0FBQ0wsUUFBRSxnQkFBVyxHQUFRLEVBQUUsQ0FBQztBQUN4QixRQUFFO0FBQ0Y7QUFDTTtBQUVBLFdBREQ7QUFDTCxRQUFFLFdBQU0sR0FBZ0IsRUFBRSxFQUFFLEVBQUUsT0FBTyxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUM7QUFDaEQsUUFBRTtBQUNGO0FBQ007QUFDTTtBQUVBLFdBRFA7QUFDTCxRQUFFLGVBQVUsR0FBWSxJQUFJLENBQUM7QUFDN0IsUUFBRTtBQUNGO0FBQ007QUFDTTtBQUVBLFdBRFA7QUFDTCxRQUFFLG1CQUFjLEdBQVksS0FBSyxDQUFDO0FBQ2xDLFFBVUU7QUFDRjtBQUVBLFdBREs7QUFDTCxRQUFFLG9CQUFlLEdBQXFDLElBQUksWUFBWSxFQUFzQixDQUFDO0FBQzdGLFFBQUU7QUFDRjtBQUVBLFdBREs7QUFDTCxRQUFFLGtCQUFhLEdBQTZDLElBQUksWUFBWSxFQUV2RSxDQUFDO0FBQ04sUUFBRTtBQUNGO0FBQ007QUFDTTtBQUNNO0FBQ007QUFFQSxXQURuQjtBQUNMLFFBQUUsU0FBSSxHQUF1QixrQkFBa0IsQ0FBQyxNQUFNLENBQUM7QUFDdkQsUUFLRTtBQUNGO0FBRUEsV0FESztBQUNMLFFBQUUsb0JBQWUsR0FBWSxJQUFJLENBQUM7QUFDbEMsUUFDRSxtQkFBYyxHQUFtQixFQUFFLENBQUM7QUFDdEMsUUFDRSx1QkFBa0IsR0FBcUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQ25FLFNBQVMsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxJQUFJLENBQUMsOEJBQThCLENBQUMsRUFDcEQsUUFBUSxDQUFDLEdBQUcsQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUNwQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDaEIsWUFBTSxJQUFJLENBQUMsY0FBYyxHQUFHLEtBQUssQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUM7QUFDMUUsUUFBSSxDQUFDLENBQUMsRUFDRixHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FBQyxpQkFBaUIsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUMvQyxDQUFDO0FBQ0osUUFDRSxpQkFBWSxHQUFxQyxLQUFLLENBQ3BELElBQUksQ0FBQyxrQkFBa0IsRUFDdkIsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FDOUIsR0FBRyxDQUFDLENBQUMsZUFBc0MsRUFBRSxFQUFFO0FBQ3JELFlBQVEsTUFBTSxZQUFZLEdBQXVCLENBQUMsSUFBSSxDQUFDLGlCQUFpQixJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FDMUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUMsT0FBTyxLQUFLLGVBQWUsQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUN4RCxDQUFDO0FBQ1YsWUFBUSxJQUFJLFlBQVksRUFBRTtBQUMxQixnQkFBVSxNQUFNLGNBQWMsR0FBdUIsQ0FBQyxZQUFZLENBQUMsT0FBTyxJQUFJLEVBQUUsQ0FBQyxDQUFDLElBQUksQ0FDMUUsTUFBTSxDQUFDLEVBQUUsQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLEVBQUUsS0FBTSxlQUFlLENBQUMsTUFBYyxDQUFDLFVBQVUsQ0FDdkUsQ0FBQztBQUNaLGdCQUFVLElBQUksY0FBYyxFQUFFO0FBQzlCLG9CQUFZLGNBQWMsQ0FBQyxRQUFRLEdBQUcsZUFBZSxDQUFDLFFBQVEsQ0FBQztBQUMvRCxvQkFBWSxJQUFJLGVBQWUsQ0FBQyxNQUFNLEVBQUU7QUFDeEMsd0JBQWMsY0FBYyxDQUFDLEdBQUcsR0FBRyxlQUFlLENBQUMsTUFBTSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM5RSxxQkFBYTtBQUNiLGlCQUFXO0FBQ1gsYUFBUztBQUNULFlBQVEsT0FBTyxJQUFJLENBQUMsaUJBQWlCLENBQUM7QUFDdEMsUUFBTSxDQUFDLENBQUMsQ0FDSCxDQUNGLENBQUM7QUFDSixRQVFVLGNBQVMsR0FBRyxHQUFHLENBQUM7QUFDMUIsUUFPSSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksV0FBVyxFQUFFLENBQUM7QUFDekMsSUFBRSxDQUFDO0FBQ0gsSUFDRSxRQUFRO0FBQ1YsUUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRTtBQUM5QixZQUFNLE1BQU0sSUFBSSxLQUFLLENBQUMsaUNBQWlDLENBQUMsQ0FBQztBQUN6RCxTQUFLO0FBQ0wsUUFDSSxJQUFJLENBQUMsSUFBSSxDQUFDLDhCQUE4QixFQUFFO0FBQzlDLFlBQU0sSUFBSSxDQUFDLDhCQUE4QixHQUFHLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQzlDLFFBQVEsQ0FBQyxHQUFHLEVBQUUsQ0FDWixJQUFJLENBQUMsaUJBQWlCLENBQUMscUJBQXFCLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRTtBQUM1RSxnQkFBWSxLQUFLLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxZQUFZLENBQ2xDLElBQUksQ0FBQyxlQUFlLEVBQ3BCLEdBQUcsQ0FBQyxJQUFJLENBQUMsV0FBVyxFQUFFLE1BQU0sQ0FBQztBQUMzQyxvQkFBZ0IsQ0FBQyxpQ0FBTSxJQUFJLENBQUMsV0FBVyxLQUFFLElBQUksRUFBRSxJQUFJLElBQUksQ0FBQyxXQUFXLENBQUMsSUFBSSxHQUFHLElBQzNELENBQUMsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUNyQjtBQUNiLGdCQUFZLE1BQU0sRUFBRSxFQUFFLFFBQVEsRUFBRSxJQUFJLENBQUMsU0FBUyxFQUFFO0FBQ2hELGFBQVcsQ0FBQyxDQUNILEVBQ0QsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsRUFBRSxFQUFFLENBQUMsSUFBSSxDQUFDLEVBQ3ZCLEdBQUcsQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyw4QkFBOEIsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUNyRCxDQUFDO0FBQ1IsU0FBSztBQUNMLElBQUUsQ0FBQztBQUNILElBQ0UsOEJBQThCLENBQUMsR0FBcUI7QUFDdEQsUUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFO0FBQ3JCLFlBQU0sRUFBRSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUMsaUJBQWlCLENBQUMsZUFBZSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQy9ELFFBQUksQ0FBQyxDQUFDLENBQUM7QUFDUCxRQUFJLE9BQU8sR0FBRyxDQUFDO0FBQ2YsSUFBRSxDQUFDO0FBQ0gsSUFDRSxNQUFNLENBQUMsY0FBOEI7QUFDdkMsUUFBSSxJQUFJLENBQUMsY0FBYyxHQUFHLE1BQU0saUNBRXJCLElBQUksQ0FBQyxjQUFjLEdBQ25CLGNBQWMsR0FFbkIsT0FBTyxDQUNSLENBQUM7QUFDTixRQUNJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxJQUFJLENBQUMsV0FBVyxDQUFDLEVBQUU7QUFDekQsWUFBTSxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7QUFDaEQsWUFBTSxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUM7QUFDN0MsWUFBTSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ3ZCLFNBQUs7QUFDTCxJQUFFLENBQUM7QUFDSCxJQUNFLE1BQU0sQ0FBQyxhQUF5QztBQUNsRCxRQUFJLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO0FBQzNDLElBQUUsQ0FBQztBQUNILElBQ1EsU0FBUyxDQUFDLEdBQXFCO0FBQUk7QUFDWixZQUEzQixNQUFNLGNBQWMsR0FBRyxJQUFJLENBQUMsY0FBYyxDQUFDO0FBQy9DLFlBQUksTUFBTSxhQUFhLEdBQStCLElBQUksQ0FBQyxRQUFRLENBQUM7QUFDcEUsWUFDSSxPQUFPLE9BQU8sQ0FBQyxHQUFHLENBQ2hCLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBTSxlQUFlLEVBQUMsRUFBRTtBQUNPLGdCQUFyQyxNQUFNLE9BQU8sR0FBeUIsSUFBSSxDQUFDLHFCQUFxQixDQUM5RCxNQUFNLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxxQkFBcUIsQ0FBQyxlQUFlLENBQUMsUUFBUSxDQUFDLEVBQzVFLGFBQWEsRUFDYixlQUFxQyxFQUNyQyxjQUFjLENBQ2YsQ0FBQztBQUNWLGdCQUFRLE1BQU0saUJBQWlCLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUNqRCxlQUFxQyxFQUNyQyxPQUFPLENBQ1IsQ0FBQztBQUNWLGdCQUNRLE9BQU8saUJBQWlCLENBQUM7QUFDakMsWUFBTSxDQUFDLENBQUEsQ0FBQyxDQUNILENBQUM7QUFDTixRQUFFLENBQUM7QUFFRixLQUZFO0FBQ0gsSUFDRSxxQkFBcUIsQ0FDbkIsUUFBNEIsRUFDNUIsYUFBeUMsRUFDekMsZUFBbUMsRUFDbkMsY0FBOEI7QUFDL0IsUUFDQyxNQUFNLGtCQUFrQixHQUF5QixFQUFFLENBQUM7QUFDeEQsUUFBSSxRQUFRLENBQUMsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEVBQUU7QUFDeEMsWUFBTSxNQUFNLFVBQVUsR0FBWSxJQUFJLENBQUMsMEJBQTBCLENBQ3pELGFBQWEsRUFDYixlQUFlLEVBQ2YsZ0JBQWdCLEVBQ2hCLGNBQWMsQ0FDZixDQUFDO0FBQ1IsWUFDTSxNQUFNLEVBQUUsT0FBTyxFQUFFLEdBQUcsZ0JBQWdCLENBQUMsR0FBRyxjQUFjLEVBQUUsQ0FBQyxDQUFDO0FBQ2hFLFlBQU0sTUFBTSxTQUFTLEdBQ2IsT0FBTyxJQUFJLElBQUksSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsd0JBQXdCLENBQUMsQ0FBQyxHQUFHLENBQUM7QUFDM0YsWUFBTSxNQUFNLFNBQVMsR0FBRyxPQUFPLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDO0FBQ3BELFlBQU0sa0JBQWtCLENBQUMsSUFBSSxDQUFDO0FBQzlCLGdCQUFRLElBQUksRUFBRTtBQUNkLG9CQUFVO0FBQ1Ysd0JBQVksS0FBSyxFQUFFLFNBQVM7QUFDNUIsd0JBQVksS0FBSyxFQUFFLFNBQVM7QUFDNUIscUJBQVc7QUFDWCxpQkFBUztBQUNULGdCQUFRLEdBQUcsOENBQ0QsRUFBRSxFQUFFLGdCQUFnQixDQUFDLEVBQUUsRUFDdkIsSUFBSSxFQUFFLGVBQWUsQ0FBQyxJQUFJLEVBQzFCLE9BQU8sSUFDSixDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxzQkFBc0IsQ0FBQyxJQUFJO0FBQy9ELG9CQUFZLFVBQVUsRUFBRSxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsc0JBQXNCLENBQUM7QUFDckUsaUJBQVcsQ0FBQyxHQUNDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLFdBQVcsQ0FBQyxJQUFJLEVBQUUsT0FBTyxFQUFFLElBQUksRUFBRSxDQUFDLEtBQzVELEdBQUcsRUFBRSxnQkFBZ0IsQ0FBQyxHQUFHLGNBQWMsRUFBRSxDQUFDLENBQUMsR0FBRyxFQUM5QyxZQUFZLEVBQUUsZUFBZSxDQUFDLFlBQVksR0FDM0M7QUFDVCxnQkFBUSxRQUFRLEVBQUUsVUFBVTtBQUM1QixhQUFPLENBQUMsQ0FBQztBQUNULFFBQUksQ0FBQyxDQUFDLENBQUM7QUFDUCxRQUFJLE9BQU8sa0JBQWtCLENBQUM7QUFDOUIsSUFBRSxDQUFDO0FBQ0gsSUFDRSwwQkFBMEIsQ0FDeEIsYUFBeUMsRUFDekMsZUFBbUMsRUFDbkMsZ0JBQWtDLEVBQ2xDLGNBQThCO0FBQy9CLFFBQ0MsTUFBTSxVQUFVLEdBQUcsYUFBYTtBQUNwQyxZQUFNLENBQUMsQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUNsQixrQkFBa0IsQ0FBQyxFQUFFLENBQ25CLGtCQUFrQixDQUFDLElBQUksS0FBSyxlQUFlLENBQUMsSUFBSTtBQUM1RCxnQkFBWSxrQkFBa0IsQ0FBQyxPQUFPLEtBQUssZ0JBQWdCLENBQUMsR0FBRyxjQUFjLEVBQUUsQ0FBQyxDQUFDLE9BQU8sQ0FDL0UsQ0FBQyxNQUFNLEdBQUcsQ0FBQztBQUNwQixZQUFNLENBQUMsQ0FBQyxLQUFLLENBQUM7QUFDZCxRQUNJLE9BQU8sVUFBVSxDQUFDO0FBQ3RCLElBQUUsQ0FBQztBQUNILElBQ0Usb0JBQW9CLENBQ2xCLGVBQW1DLEVBQ25DLE9BQTZCO0FBQzlCLFFBQ0MsTUFBTSxLQUFLLEdBQ1QsT0FBTyxDQUFDLE1BQU0sS0FBSyxDQUFDO0FBQzFCLFlBQVEsQ0FBQyxDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDN0YsWUFBUSxDQUFDLENBQUMsSUFBSSxDQUFDLGdCQUFnQixDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsY0FBYyxDQUFDLEtBQUssRUFBRSxFQUFFLEtBQUssRUFBRSxPQUFPLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztBQUM5RixRQUNJLE1BQU0saUJBQWlCLEdBQXVCO0FBQ2xELFlBQU0sT0FBTyxFQUFFLGVBQWUsQ0FBQyxFQUFFO0FBQ2pDLFlBQU0sSUFBSSxFQUFFO0FBQ1osZ0JBQVEsRUFBRSxLQUFLLEVBQUUsZUFBZSxDQUFDLElBQUksRUFBRSxLQUFLLEVBQUUsZUFBZSxFQUFFO0FBQy9ELGdCQUFRLEVBQUUsS0FBSyxFQUFFLGVBQWUsQ0FBQyxXQUFXLEVBQUUsS0FBSyxFQUFFLDBCQUEwQixFQUFFO0FBQ2pGLGFBQU87QUFDUCxZQUFNLHFCQUFxQixFQUFFLEVBQUUsS0FBSyxFQUFFLEtBQUssRUFBRSxLQUFLLEVBQUUsa0JBQWtCLEVBQUU7QUFDeEUsWUFBTSxPQUFPO0FBQ2IsU0FBSyxDQUFDO0FBQ04sUUFDSSxPQUFPLGlCQUFpQixDQUFDO0FBQzdCLElBQUUsQ0FBQztBQUNIOzBEQS9VQyxTQUFTLFNBQUMsa0JBQ1QsUUFBUSxFQUFFLDZCQUE2QixrQkFDdkM7dWJBQXVELGNBQ3hEOzs7Ozs7O21HQUNJO0FBQUM7QUFFSSxZQTVDRCxpQkFBaUI7QUFBSSxZQVhyQixnQkFBZ0I7QUFBRzs7Ozs7OztxSEFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBFdmVudEVtaXR0ZXIsIFRlbXBsYXRlUmVmIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBJTWFuYWdlZE9iamVjdCwgUXVlcmllc1V0aWwgfSBmcm9tICdAYzh5L2NsaWVudCc7XG5pbXBvcnQge1xuICBnZXR0ZXh0LFxuICBJU2VsZWN0TW9kYWxPYmplY3QsXG4gIElTZWxlY3RNb2RhbE9wdGlvbixcbiAgSVVwZGF0ZUl0ZW1FdmVudCxcbiAgTW9kYWxMYWJlbHMsXG4gIE1vZGFsU2VsZWN0aW9uTW9kZVxufSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tICdAbmd4LXRyYW5zbGF0ZS9jb3JlJztcbmltcG9ydCB7IGdldCwgaGFzLCBpc0VtcHR5LCBpc0VxdWFsLCBvbWl0QnkgfSBmcm9tICdsb2Rhc2gtZXMnO1xuaW1wb3J0IHsgQmVoYXZpb3JTdWJqZWN0LCBtZXJnZSwgT2JzZXJ2YWJsZSwgb2YsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IG1hcCwgbWVyZ2VNYXAsIHN3aXRjaE1hcCwgdGFwIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuaW1wb3J0IHtcbiAgRmlsdGVyQ3JpdGVyaWEsXG4gIFJlcG9zaXRvcnlCaW5hcnksXG4gIFJlcG9zaXRvcnlDYXRlZ29yeSxcbiAgUmVwb3NpdG9yeVR5cGUsXG4gIFNlbGVjdGVkUmVwb3NpdG9yeUJpbmFyeVxufSBmcm9tICcuLi9yZXBvc2l0b3J5Lm1vZGVsJztcbmltcG9ydCB7IFJlcG9zaXRvcnlTZXJ2aWNlIH0gZnJvbSAnLi4vcmVwb3NpdG9yeS5zZXJ2aWNlJztcblxuLy8gTU9EQUwgU1RSVUNUVVJFXG4vLyAtIHNlbGVjdE1vZGFsT2JqZWN0IChyZXBvc2l0b3J5IGVudHJ5IChyZXBvc2l0b3J5Q2F0ZWdvcnkpIC0+IHR5cGUgYzh5X0Zpcm13YXJlL2M4eV9Tb2Z0d2FyZSlcbi8vICAgLS0gSVNlbGVjdE1vZGFsT3B0aW9uIChyZXBvc2l0b3J5IGJpbmFyeSBlbnRyeSAocmVwb3NpdG9yeUJpbmFyeSkgPT4gdHlwZSBjOHlfRmlybXdhcmVCaW5hcnkvYzh5X1NvZnR3YXJlQmluYXJ5KVxuLy8gICAtLSBJU2VsZWN0TW9kYWxPcHRpb24uLi5cbi8vIC0gc2VsZWN0TW9kYWxPYmplY3QuLi5cblxuLyoqXG4gKiBSZXBvc2l0b3J5U2VsZWN0TW9kYWxDb21wb25lbnQgZGlzcGxheXMgcmVwb3NpdG9yeSBlbnRyaWVzIG9wdGlvbnMgYW5kIGFsbG93cyB0byBzZWxlY3QgdGhlbS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgXG4gKiBpbXBvcnQgeyB0YWtlIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuICogaW1wb3J0IHsgUmVwb3NpdG9yeVNlbGVjdE1vZGFsQ29tcG9uZW50LCBNb2RhbFNlbGVjdGlvbk1vZGUsIFJlcG9zaXRvcnlUeXBlIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cy9yZXBvc2l0b3J5L3NoYXJlZCc7XG4gKlxuICogY29uc3QgaW5pdGlhbFN0YXRlID0ge1xuICogICByZXBvc2l0b3J5VHlwZTogUmVwb3NpdG9yeVR5cGUuRklSTVdBUkUsXG4gKiAgIHRpdGxlOiBnZXR0ZXh0KCdJbnN0YWxsIGZpcm13YXJlJyksXG4gKiAgIHN1YlRpdGxlOiBnZXR0ZXh0KCdBdmFpbGFibGUgZmlybXdhcmVzIG1hdGNoaW5nIHRoZSBkZXZpY2UgdHlwZScpLFxuICogICBpY29uOiAnYzh5LWZpcm13YXJlJyxcbiAqICAgbW9kZTogTW9kYWxTZWxlY3Rpb25Nb2RlLlNJTkdMRSxcbiAqICAgbGFiZWxzOiB7IG9rOiBnZXR0ZXh0KCdJbnN0YWxsJykgfSxcbiAqICAgZGlzYWJsZVNlbGVjdGVkOiBmYWxzZVxuICogfTtcbiAqXG4gKiBjb25zdCBtb2RhbCA9IHRoaXMuYnNNb2RhbC5zaG93KFJlcG9zaXRvcnlTZWxlY3RNb2RhbENvbXBvbmVudCwge1xuICogICBpZ25vcmVCYWNrZHJvcENsaWNrOiB0cnVlLFxuICogICBpbml0aWFsU3RhdGVcbiAqIH0pO1xuICpcbiAqIG1vZGFsLmNvbnRlbnQubG9hZC5uZXh0KCk7XG4gKiBtb2RhbC5jb250ZW50LnJlc3VsdEVtaXR0ZXIucGlwZSh0YWtlKDEpKS5zdWJzY3JpYmUoKGZpcm13YXJlKSA9PiB7XG4gKiAgIC4uLlxuICogfSlcbiAqIGBgYFxuICovXG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1yZXBvc2l0b3J5LXNlbGVjdC1tb2RhbCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9yZXBvc2l0b3J5LXNlbGVjdC1tb2RhbC5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgUmVwb3NpdG9yeVNlbGVjdE1vZGFsQ29tcG9uZW50IHtcbiAgLyoqXG4gICAqIE9wdGlvbmFsXG4gICAqIEFsbG93cyB0byBwcm92aWRlIGN1c3RvbSBkYXRhLlxuICAgKiBAZXhhbXBsZVxuICAgKiBgYGBcbiAgICogaW1wb3J0IHsgZnJvbSB9IGZyb20gJ3J4anMnO1xuICAgKlxuICAgKiBjb25zdCByZXBvc2l0b3J5RW50cnkgPSB7IG5hbWU6ICdFeGFtcGxlRW50cnknLCB0eXBlOiAnYzh5X0Zpcm13YXJlJyB9O1xuICAgKiBjb25zdCB2ZXJzaW9ucyA9IFt7IGM4eV9GaXJtd2FyZTogeyB2ZXJzaW9uOiAnMS4wLjAnLCB1cmw6ICdodHRwOi8vZXhhbXBsZS5jb20nIH0gfV07XG4gICAqXG4gICAqIGNvbnN0IGluaXRpYWxTdGF0ZSA9IHtyZXBvc2l0b3J5RW50cmllc1dpdGhWZXJzaW9ucyQ6IGZyb20oeyAuLi5yZXBvc2l0b3J5RW50cnksIHZlcnNpb25zIH0pfTtcbiAgICogYGBgXG4gICAqL1xuICByZXBvc2l0b3J5RW50cmllc1dpdGhWZXJzaW9ucyQ6IE9ic2VydmFibGU8SU1hbmFnZWRPYmplY3RbXT4gPSB1bmRlZmluZWQ7XG4gIC8qKlxuICAgKiBSZXBvc2l0b3J5IGVudHJ5IHR5cGUuXG4gICAqL1xuICByZXBvc2l0b3J5VHlwZTogUmVwb3NpdG9yeVR5cGUuRklSTVdBUkUgfCBSZXBvc2l0b3J5VHlwZS5TT0ZUV0FSRTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsXG4gICAqIEFsbG93cyB0byB1c2UgY3VzdG9tIGJhZGdlcyB0ZW1wbGF0ZXMuXG4gICAqIEBleGFtcGxlXG4gICAqIGBgYFxuICAgKiBpbXBvcnQgeyBnZXR0ZXh0IH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cyc7XG4gICAqXG4gICAqIGNvbnN0IGJhZGdlVGVtcGxhdGVzID0geyAnPTEnOiBnZXR0ZXh0KCd7e2NvdW50fX0gdmVyc2lvbicpLCBvdGhlcjogZ2V0dGV4dCgne3tjb3VudH19IHZlcnNpb25zJykgfTtcbiAgICogY29uc3QgaW5pdGlhbFN0YXRlID0geyBiYWRnZVRlbXBsYXRlcyB9O1xuICAgKiBgYGBcbiAgICovXG4gIGJhZGdlVGVtcGxhdGVzID0geyAnPTEnOiBnZXR0ZXh0KCd7e2NvdW50fX0gdmVyc2lvbicpLCBvdGhlcjogZ2V0dGV4dCgne3tjb3VudH19IHZlcnNpb25zJykgfTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsXG4gICAqIEFsbG93cyB0byBwcm92aWRlIGN1c3RvbSBtb2RhbCB0aXRsZS5cbiAgICovXG4gIHRpdGxlOiBzdHJpbmcgPSBnZXR0ZXh0KCdTZWxlY3QgcmVwb3NpdG9yeSBlbnRyeScpO1xuICAvKipcbiAgICogT3B0aW9uYWxcbiAgICogQWxsb3dzIHRvIHByb3ZpZGUgY3VzdG9tIG1vZGFsIHN1YnRpdGxlLlxuICAgKi9cbiAgc3ViVGl0bGU6IHN0cmluZztcbiAgLyoqXG4gICAqIExvYWRzIHRoZSBjb250ZW50IG9mIHRoZSBtb2RhbC5cbiAgICogTXVzdCBiZSBpbnZva2VkIGJ5IHRoZSBtb2RhbCdzIGNhbGxlci5cbiAgICovXG4gIGxvYWQ6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xuICAvKipcbiAgICogVHJpZ2dlcnMgYW4gdXBkYXRlIG9mIHRoZSBpdGVtIGxpc3QgZW1pdHRlZC5cbiAgICovXG4gIHVwZGF0ZUluc3RhbGxhYmxlTGlzdCQ6IFN1YmplY3Q8SVVwZGF0ZUl0ZW1FdmVudDxhbnk+PiA9IG5ldyBTdWJqZWN0KCk7XG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBFbWl0cyBhIGZpbHRlciBjcml0ZXJpYSBvYmplY3QgY3VycmVudGx5IGVudGVyZWQgaW4gdGhlIGZpbHRlciBpbnB1dC5cbiAgICogVXNlIGl0IHRvIGZpbHRlciB0aGUgaXRlbXMgaWYgeW91IHVzZSBjdXN0b20gcmVwb3NpdG9yeUVudHJpZXNXaXRoVmVyc2lvbnMkLlxuICAgKi9cbiAgc2VhcmNoVGVybTogQmVoYXZpb3JTdWJqZWN0PEZpbHRlckNyaXRlcmlhPiA9IG5ldyBCZWhhdmlvclN1YmplY3Qoe30pO1xuICAvKipcbiAgICogT3B0aW9uYWxcbiAgICogQWxsb3dzIHRvIHByb3ZpZGUgZGV2aWNlIHR5cGUgcXVlcnkgdG8gcmVzdHJpY3Qgc2VhcmNoIGNyaXRlcmlhLlxuICAgKiBPbmx5IHRha2VzIGVmZmVjdCB3aGVuIHJlcG9zaXRvcnlFbnRyaWVzV2l0aFZlcnNpb25zJCBpcyBub3QgcHJvdmlkZWQsXG4gICAqIG90aGVyd2lzZSBtb2RhbCdzIGNhbGxlciBoYXZlIHRvIHByb3ZpZGUgYWxyZWFkeSBmaWx0ZXJlZCBkYXRhIGluIHRoZSByZXBvc2l0b3J5RW50cmllc1dpdGhWZXJzaW9ucyQuXG4gICAqL1xuICBkZXZpY2VUeXBlUXVlcnk6IGFueSA9IHt9O1xuICAvKipcbiAgICogT3B0aW9uYWxcbiAgICogQWxsb3dzIHRvIHByb3ZpZGUgcXVlcnkgdG8gcmVzdHJpY3Qgc2VhcmNoIGNyaXRlcmlhLlxuICAgKiBPbmx5IHRha2VzIGVmZmVjdCB3aGVuIHJlcG9zaXRvcnlFbnRyaWVzV2l0aFZlcnNpb25zJCBpcyBub3QgcHJvdmlkZWQsXG4gICAqIG90aGVyd2lzZSBtb2RhbCdzIGNhbGxlciBoYXZlIHRvIHByb3ZpZGUgYWxyZWFkeSBmaWx0ZXJlZCBkYXRhIGluIHRoZSByZXBvc2l0b3J5RW50cmllc1dpdGhWZXJzaW9ucyQuXG4gICAqL1xuICBzZWFyY2hRdWVyeTogYW55ID0ge307XG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBBbGxvd3MgdG8gcHJvdmlkZSBjdXN0b20gbGFiZWxzIGZvciB0aGUgYnV0dG9ucyByZXNwb25zaWJsZSBmb3IgY29uZmlybS9kaXNtaXNzIG1vZGFsIGFjdGlvbnMuXG4gICAqL1xuICBsYWJlbHM6IE1vZGFsTGFiZWxzID0geyBvazogZ2V0dGV4dCgnU2F2ZScpIH07XG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBBbGxvd3MgdG8gaGlkZSB0aGUgbmFtZSBmaWx0ZXIgaW5wdXQgZmllbGQuXG4gICAqIEJ5IGRlZmF1bHQsIHRoZSBmaWx0ZXIgaW5wdXQgZmllbGQgaXMgZGlzcGxheWVkLlxuICAgKi9cbiAgc2hvd0ZpbHRlcjogYm9vbGVhbiA9IHRydWU7XG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBBbGxvd3MgdG8gc2hvdyBhIHdhcm5pbmcgdGhhdCB0aGUgc2VhcmNoIGNyaXRlcmlhIHNob3VsZCBiZSBuYXJyb3dlZCBkb3duLlxuICAgKiBCeSBkZWZhdWx0LCB0aGlzIHdhcm5pbmcgaXMgaGlkZGVuLlxuICAgKi9cbiAgYXJlTW9yZUVudHJpZXM6IGJvb2xlYW4gPSBmYWxzZTtcbiAgLyoqXG4gICAqIE9wdGlvbmFsXG4gICAqIEFsbG93cyB0byBkaXNwbGF5IGEgbW9yZSBzcGVjaWZpYyB0aGFuIHRoZSBkZWZhdWx0IG1lc3NhZ2UgaW4gY2FzZSB0aGVyZSBhcmUgbm8gaXRlbXMgdG8gZGlzcGxheS5cbiAgICovXG4gIG5vSXRlbXNNZXNzYWdlOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBBbGxvd3MgdG8gcGFzcyB0aGUgYXJyYXkgb2YgaXRlbXMuIEVhY2ggaXRlbSBmcm9tIHRoaXMgYXJyYXkgd2lsbCBiZSBtYXJrZWQgYXMgc2VsZWN0ZWQgaW4gdGhlIG1vZGFsLlxuICAgKi9cbiAgc2VsZWN0ZWQ6IFNlbGVjdGVkUmVwb3NpdG9yeUJpbmFyeVtdO1xuICAvKipcbiAgICogRW1pdHMgd2hlbmV2ZXIgYSBuZXcgcmVwb3NpdG9yeSBiaW5hcnkgaGF2ZSBiZWVuIHNlbGVjdGVkIGluIHRoZSBtb2RhbC5cbiAgICovXG4gIG9uQ2hvaWNlVXBkYXRlZDogRXZlbnRFbWl0dGVyPElTZWxlY3RNb2RhbE9iamVjdD4gPSBuZXcgRXZlbnRFbWl0dGVyPElTZWxlY3RNb2RhbE9iamVjdD4oKTtcbiAgLyoqXG4gICAqIEVtaXRzIHRoZSBsaXN0IG9mIHNlbGVjdGVkIG9wdGlvbnMuXG4gICAqL1xuICByZXN1bHRFbWl0dGVyOiBFdmVudEVtaXR0ZXI8U2VsZWN0ZWRSZXBvc2l0b3J5QmluYXJ5W10+ID0gbmV3IEV2ZW50RW1pdHRlcjxcbiAgICBTZWxlY3RlZFJlcG9zaXRvcnlCaW5hcnlbXVxuICA+KCk7XG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBBbGxvd3MgdG8gY2hhbmdlIHNlbGVjdGlvbiBtb2RlLlxuICAgKiBTdXBwb3J0ZWQgb3B0aW9uczpcbiAgICogICAqIHNpbmdsZTogb25seSBzaW5nbGUgb3B0aW9uIGNhbiBiZSBzZWxlY3RlZC5cbiAgICogICAqIG11bHRpcGxlOiBtdWx0aXBsZSBvcHRpb25zIGNhbiBiZSBzZWxlY3RlZC5cbiAgICovXG4gIG1vZGU6IE1vZGFsU2VsZWN0aW9uTW9kZSA9IE1vZGFsU2VsZWN0aW9uTW9kZS5TSU5HTEU7XG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBBbGxvd3MgdG8gdXNlIGN1c3RvbSBpY29uIGluIHRoZSBtb2RhbCBoZWFkZXIuXG4gICAqL1xuICBpY29uOiBzdHJpbmc7XG4gIC8qKlxuICAgKiBBbGxvd3MgdG8gYmxvY2sgc2VsZWN0aW9uIG9mIHRoZSBvdGhlciB2ZXJzaW9ucyBmcm9tIHRoZSBzYW1lIHJlcG9zaXRvcnkgZW50cnkuXG4gICAqL1xuICBkaXNhYmxlU2VsZWN0ZWQ6IGJvb2xlYW4gPSB0cnVlO1xuXG4gIGZpbHRlckNyaXRlcmlhOiBGaWx0ZXJDcml0ZXJpYSA9IHt9O1xuXG4gIHJlcG9zaXRvcnlFbnRyaWVzJDogT2JzZXJ2YWJsZTxJU2VsZWN0TW9kYWxPYmplY3RbXT4gPSB0aGlzLmxvYWQucGlwZShcbiAgICBzd2l0Y2hNYXAoKCkgPT4gdGhpcy5yZXBvc2l0b3J5RW50cmllc1dpdGhWZXJzaW9ucyQpLFxuICAgIG1lcmdlTWFwKG1vcyA9PiB0aGlzLmFnZ3JlZ2F0ZShtb3MpKSxcbiAgICB0YXAoaXRlbXMgPT4ge1xuICAgICAgdGhpcy5hcmVNb3JlRW50cmllcyA9IGl0ZW1zLmxlbmd0aCA+PSB0aGlzLlBBR0VfU0laRSA/IHRydWUgOiBmYWxzZTtcbiAgICB9KSxcbiAgICB0YXAoaXRlbXMgPT4gKHRoaXMucmVwb3NpdG9yeUVudHJpZXMgPSBpdGVtcykpXG4gICk7XG5cbiAgbW9kYWxFbnRyaWVzOiBPYnNlcnZhYmxlPElTZWxlY3RNb2RhbE9iamVjdFtdPiA9IG1lcmdlKFxuICAgIHRoaXMucmVwb3NpdG9yeUVudHJpZXMkLFxuICAgIHRoaXMudXBkYXRlSW5zdGFsbGFibGVMaXN0JC5waXBlKFxuICAgICAgbWFwKCh1cGRhdGVJdGVtRXZlbnQ6IElVcGRhdGVJdGVtRXZlbnQ8YW55PikgPT4ge1xuICAgICAgICBjb25zdCBpdGVtVG9VcGRhdGU6IElTZWxlY3RNb2RhbE9iamVjdCA9ICh0aGlzLnJlcG9zaXRvcnlFbnRyaWVzIHx8IFtdKS5maW5kKFxuICAgICAgICAgIGl0ZW0gPT4gaXRlbS5ncm91cElkID09PSB1cGRhdGVJdGVtRXZlbnQub2JqZWN0Lmdyb3VwSWRcbiAgICAgICAgKTtcbiAgICAgICAgaWYgKGl0ZW1Ub1VwZGF0ZSkge1xuICAgICAgICAgIGNvbnN0IG9wdGlvblRvVXBkYXRlOiBJU2VsZWN0TW9kYWxPcHRpb24gPSAoaXRlbVRvVXBkYXRlLm9wdGlvbnMgfHwgW10pLmZpbmQoXG4gICAgICAgICAgICBvcHRpb24gPT4gb3B0aW9uLm9iai5pZCA9PT0gKHVwZGF0ZUl0ZW1FdmVudC5vYmplY3QgYXMgYW55KS5zZWxlY3RlZElkXG4gICAgICAgICAgKTtcbiAgICAgICAgICBpZiAob3B0aW9uVG9VcGRhdGUpIHtcbiAgICAgICAgICAgIG9wdGlvblRvVXBkYXRlLnRlbXBsYXRlID0gdXBkYXRlSXRlbUV2ZW50LnRlbXBsYXRlO1xuICAgICAgICAgICAgaWYgKHVwZGF0ZUl0ZW1FdmVudC5tYXBwZXIpIHtcbiAgICAgICAgICAgICAgb3B0aW9uVG9VcGRhdGUub2JqID0gdXBkYXRlSXRlbUV2ZW50Lm1hcHBlcihvcHRpb25Ub1VwZGF0ZS5vYmopO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5yZXBvc2l0b3J5RW50cmllcztcbiAgICAgIH0pXG4gICAgKVxuICApO1xuXG4gIC8qKlxuICAgKiBPcHRpb25hbFxuICAgKiBBbGxvd3MgdG8gcHJvdmlkZSBhZGRpdGlvbmFsIHRlbXBsYXRlIHRoYXQgd2lsbCBiZSByZW5kZXJlZCBpbiB0aGVcbiAgICogZmlsdGVycyBibG9jayBvbiB0b3Agb2YgdGhlIHJlc3VsdHMgbGlzdCBpbiB0aGUgc2VsZWN0IG1vZGFsLlxuICAgKi9cbiAgYWRkaXRpb25hbEZpbHRlclRlbXBsYXRlOiBUZW1wbGF0ZVJlZjxhbnk+O1xuXG4gIHByaXZhdGUgUEFHRV9TSVpFID0gMTAwO1xuICBwcml2YXRlIHF1ZXJpZXNVdGlsOiBRdWVyaWVzVXRpbDtcbiAgcHJpdmF0ZSByZXBvc2l0b3J5RW50cmllczogSVNlbGVjdE1vZGFsT2JqZWN0W107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSByZXBvc2l0b3J5U2VydmljZTogUmVwb3NpdG9yeVNlcnZpY2UsXG4gICAgcHJpdmF0ZSB0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGVTZXJ2aWNlXG4gICkge1xuICAgIHRoaXMucXVlcmllc1V0aWwgPSBuZXcgUXVlcmllc1V0aWwoKTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIGlmICghdGhpcy5yZXBvc2l0b3J5VHlwZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdSZXBvc2l0b3J5IHR5cGUgbXVzdCBiZSBkZWZpbmVkJyk7XG4gICAgfVxuXG4gICAgaWYgKCF0aGlzLnJlcG9zaXRvcnlFbnRyaWVzV2l0aFZlcnNpb25zJCkge1xuICAgICAgdGhpcy5yZXBvc2l0b3J5RW50cmllc1dpdGhWZXJzaW9ucyQgPSBvZigxKS5waXBlKFxuICAgICAgICBtZXJnZU1hcCgoKSA9PlxuICAgICAgICAgIHRoaXMucmVwb3NpdG9yeVNlcnZpY2UubGlzdFJlcG9zaXRvcnlFbnRyaWVzKHRoaXMucmVwb3NpdG9yeVR5cGUsIHtcbiAgICAgICAgICAgIHF1ZXJ5OiB0aGlzLnF1ZXJpZXNVdGlsLmFkZEFuZEZpbHRlcihcbiAgICAgICAgICAgICAgdGhpcy5kZXZpY2VUeXBlUXVlcnksXG4gICAgICAgICAgICAgIGhhcyh0aGlzLnNlYXJjaFF1ZXJ5LCAnbmFtZScpXG4gICAgICAgICAgICAgICAgPyB7IC4uLnRoaXMuc2VhcmNoUXVlcnksIG5hbWU6IGAqJHt0aGlzLnNlYXJjaFF1ZXJ5Lm5hbWV9KmAgfVxuICAgICAgICAgICAgICAgIDogdGhpcy5zZWFyY2hRdWVyeVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHBhcmFtczogeyBwYWdlU2l6ZTogdGhpcy5QQUdFX1NJWkUgfVxuICAgICAgICAgIH0pXG4gICAgICAgICksXG4gICAgICAgIG1hcCgoeyBkYXRhIH0pID0+IGRhdGEpLFxuICAgICAgICBtYXAobW9zID0+IHRoaXMuZ2V0QW5kQXNzaWduUmVwb3NpdG9yeUJpbmFyaWVzKG1vcykpXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIGdldEFuZEFzc2lnblJlcG9zaXRvcnlCaW5hcmllcyhtb3M6IElNYW5hZ2VkT2JqZWN0W10pIHtcbiAgICBtb3MuZm9yRWFjaChtbyA9PiB7XG4gICAgICBtby52ZXJzaW9ucyA9IHRoaXMucmVwb3NpdG9yeVNlcnZpY2UubGlzdEFsbFZlcnNpb25zKG1vKTtcbiAgICB9KTtcbiAgICByZXR1cm4gbW9zO1xuICB9XG5cbiAgc2VhcmNoKGZpbHRlckNyaXRlcmlhOiBGaWx0ZXJDcml0ZXJpYSkge1xuICAgIHRoaXMuZmlsdGVyQ3JpdGVyaWEgPSBvbWl0QnkoXG4gICAgICB7XG4gICAgICAgIC4uLnRoaXMuZmlsdGVyQ3JpdGVyaWEsXG4gICAgICAgIC4uLmZpbHRlckNyaXRlcmlhXG4gICAgICB9LFxuICAgICAgaXNFbXB0eVxuICAgICk7XG5cbiAgICBpZiAoIWlzRXF1YWwodGhpcy5maWx0ZXJDcml0ZXJpYSwgdGhpcy5zZWFyY2hRdWVyeSkpIHtcbiAgICAgIHRoaXMuc2VhcmNoVGVybS5uZXh0KHRoaXMuZmlsdGVyQ3JpdGVyaWEpO1xuICAgICAgdGhpcy5zZWFyY2hRdWVyeSA9IHRoaXMuZmlsdGVyQ3JpdGVyaWE7XG4gICAgICB0aGlzLmxvYWQubmV4dCgpO1xuICAgIH1cbiAgfVxuXG4gIHJlc3VsdChzZWxlY3RlZEl0ZW1zOiBTZWxlY3RlZFJlcG9zaXRvcnlCaW5hcnlbXSkge1xuICAgIHRoaXMucmVzdWx0RW1pdHRlci5lbWl0KHNlbGVjdGVkSXRlbXMpO1xuICB9XG5cbiAgYXN5bmMgYWdncmVnYXRlKG1vczogSU1hbmFnZWRPYmplY3RbXSk6IFByb21pc2U8SVNlbGVjdE1vZGFsT2JqZWN0W10+IHtcbiAgICBjb25zdCByZXBvc2l0b3J5VHlwZSA9IHRoaXMucmVwb3NpdG9yeVR5cGU7XG4gICAgY29uc3Qgc2VsZWN0ZWRJdGVtczogU2VsZWN0ZWRSZXBvc2l0b3J5QmluYXJ5W10gPSB0aGlzLnNlbGVjdGVkO1xuXG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFxuICAgICAgbW9zLm1hcChhc3luYyByZXBvc2l0b3J5RW50cnkgPT4ge1xuICAgICAgICBjb25zdCBvcHRpb25zOiBJU2VsZWN0TW9kYWxPcHRpb25bXSA9IHRoaXMuZ2V0U2VsZWN0TW9kYWxPcHRpb25zKFxuICAgICAgICAgIGF3YWl0IHRoaXMucmVwb3NpdG9yeVNlcnZpY2UuZmV0Y2hBbGxJdGVtc0Zyb21MaXN0KHJlcG9zaXRvcnlFbnRyeS52ZXJzaW9ucyksXG4gICAgICAgICAgc2VsZWN0ZWRJdGVtcyxcbiAgICAgICAgICByZXBvc2l0b3J5RW50cnkgYXMgUmVwb3NpdG9yeUNhdGVnb3J5LFxuICAgICAgICAgIHJlcG9zaXRvcnlUeXBlXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHNlbGVjdE1vZGFsT2JqZWN0ID0gdGhpcy5nZXRTZWxlY3RNb2RhbE9iamVjdChcbiAgICAgICAgICByZXBvc2l0b3J5RW50cnkgYXMgUmVwb3NpdG9yeUNhdGVnb3J5LFxuICAgICAgICAgIG9wdGlvbnNcbiAgICAgICAgKTtcblxuICAgICAgICByZXR1cm4gc2VsZWN0TW9kYWxPYmplY3Q7XG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBnZXRTZWxlY3RNb2RhbE9wdGlvbnMoXG4gICAgdmVyc2lvbnM6IFJlcG9zaXRvcnlCaW5hcnlbXSxcbiAgICBzZWxlY3RlZEl0ZW1zOiBTZWxlY3RlZFJlcG9zaXRvcnlCaW5hcnlbXSxcbiAgICByZXBvc2l0b3J5RW50cnk6IFJlcG9zaXRvcnlDYXRlZ29yeSxcbiAgICByZXBvc2l0b3J5VHlwZTogUmVwb3NpdG9yeVR5cGVcbiAgKTogSVNlbGVjdE1vZGFsT3B0aW9uW10ge1xuICAgIGNvbnN0IHNlbGVjdE1vZGFsT3B0aW9uczogSVNlbGVjdE1vZGFsT3B0aW9uW10gPSBbXTtcbiAgICB2ZXJzaW9ucy5mb3JFYWNoKHJlcG9zaXRvcnlCaW5hcnkgPT4ge1xuICAgICAgY29uc3QgaXNTZWxlY3RlZDogYm9vbGVhbiA9IHRoaXMuaXNCaW5hcnlSZXBvc2l0b3J5U2VsZWN0ZWQoXG4gICAgICAgIHNlbGVjdGVkSXRlbXMsXG4gICAgICAgIHJlcG9zaXRvcnlFbnRyeSxcbiAgICAgICAgcmVwb3NpdG9yeUJpbmFyeSxcbiAgICAgICAgcmVwb3NpdG9yeVR5cGVcbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IHsgdmVyc2lvbiB9ID0gcmVwb3NpdG9yeUJpbmFyeVtgJHtyZXBvc2l0b3J5VHlwZX1gXTtcbiAgICAgIGNvbnN0IGJvZHlWYWx1ZSA9XG4gICAgICAgIHZlcnNpb24gfHwgYCgke3RoaXMudHJhbnNsYXRlU2VydmljZS5pbnN0YW50KGdldHRleHQoJ25vdCBzcGVjaWZpZWRgdmVyc2lvbmAnKSl9KWA7XG4gICAgICBjb25zdCBib2R5Q2xhc3MgPSB2ZXJzaW9uID8gJycgOiAndGV4dC1tdXRlZCc7XG4gICAgICBzZWxlY3RNb2RhbE9wdGlvbnMucHVzaCh7XG4gICAgICAgIGJvZHk6IFtcbiAgICAgICAgICB7XG4gICAgICAgICAgICB2YWx1ZTogYm9keVZhbHVlLFxuICAgICAgICAgICAgY2xhc3M6IGJvZHlDbGFzc1xuICAgICAgICAgIH1cbiAgICAgICAgXSxcbiAgICAgICAgb2JqOiB7XG4gICAgICAgICAgaWQ6IHJlcG9zaXRvcnlCaW5hcnkuaWQsXG4gICAgICAgICAgbmFtZTogcmVwb3NpdG9yeUVudHJ5Lm5hbWUsXG4gICAgICAgICAgdmVyc2lvbixcbiAgICAgICAgICAuLi4oZ2V0KHJlcG9zaXRvcnlCaW5hcnksICdjOHlfUGF0Y2guZGVwZW5kZW5jeScpICYmIHtcbiAgICAgICAgICAgIGRlcGVuZGVuY3k6IGdldChyZXBvc2l0b3J5QmluYXJ5LCAnYzh5X1BhdGNoLmRlcGVuZGVuY3knKVxuICAgICAgICAgIH0pLFxuICAgICAgICAgIC4uLihnZXQocmVwb3NpdG9yeUJpbmFyeSwgJ2M4eV9QYXRjaCcpICYmIHsgaXNQYXRjaDogdHJ1ZSB9KSxcbiAgICAgICAgICB1cmw6IHJlcG9zaXRvcnlCaW5hcnlbYCR7cmVwb3NpdG9yeVR5cGV9YF0udXJsLFxuICAgICAgICAgIHNvZnR3YXJlVHlwZTogcmVwb3NpdG9yeUVudHJ5LnNvZnR3YXJlVHlwZVxuICAgICAgICB9LFxuICAgICAgICBzZWxlY3RlZDogaXNTZWxlY3RlZFxuICAgICAgfSk7XG4gICAgfSk7XG4gICAgcmV0dXJuIHNlbGVjdE1vZGFsT3B0aW9ucztcbiAgfVxuXG4gIGlzQmluYXJ5UmVwb3NpdG9yeVNlbGVjdGVkKFxuICAgIHNlbGVjdGVkSXRlbXM6IFNlbGVjdGVkUmVwb3NpdG9yeUJpbmFyeVtdLFxuICAgIHJlcG9zaXRvcnlFbnRyeTogUmVwb3NpdG9yeUNhdGVnb3J5LFxuICAgIHJlcG9zaXRvcnlCaW5hcnk6IFJlcG9zaXRvcnlCaW5hcnksXG4gICAgcmVwb3NpdG9yeVR5cGU6IFJlcG9zaXRvcnlUeXBlXG4gICk6IGJvb2xlYW4ge1xuICAgIGNvbnN0IGlzU2VsZWN0ZWQgPSBzZWxlY3RlZEl0ZW1zXG4gICAgICA/IHNlbGVjdGVkSXRlbXMuZmlsdGVyKFxuICAgICAgICAgIHJlcG9zaXRvcnlGcmFnbWVudCA9PlxuICAgICAgICAgICAgcmVwb3NpdG9yeUZyYWdtZW50Lm5hbWUgPT09IHJlcG9zaXRvcnlFbnRyeS5uYW1lICYmXG4gICAgICAgICAgICByZXBvc2l0b3J5RnJhZ21lbnQudmVyc2lvbiA9PT0gcmVwb3NpdG9yeUJpbmFyeVtgJHtyZXBvc2l0b3J5VHlwZX1gXS52ZXJzaW9uXG4gICAgICAgICkubGVuZ3RoID4gMFxuICAgICAgOiBmYWxzZTtcblxuICAgIHJldHVybiBpc1NlbGVjdGVkO1xuICB9XG5cbiAgZ2V0U2VsZWN0TW9kYWxPYmplY3QoXG4gICAgcmVwb3NpdG9yeUVudHJ5OiBSZXBvc2l0b3J5Q2F0ZWdvcnksXG4gICAgb3B0aW9uczogSVNlbGVjdE1vZGFsT3B0aW9uW11cbiAgKTogSVNlbGVjdE1vZGFsT2JqZWN0IHtcbiAgICBjb25zdCBsYWJlbCA9XG4gICAgICBvcHRpb25zLmxlbmd0aCA9PT0gMVxuICAgICAgICA/IHRoaXMudHJhbnNsYXRlU2VydmljZS5pbnN0YW50KHRoaXMuYmFkZ2VUZW1wbGF0ZXNbJz0xJ10sIHsgY291bnQ6IG9wdGlvbnMubGVuZ3RoIH0pXG4gICAgICAgIDogdGhpcy50cmFuc2xhdGVTZXJ2aWNlLmluc3RhbnQodGhpcy5iYWRnZVRlbXBsYXRlcy5vdGhlciwgeyBjb3VudDogb3B0aW9ucy5sZW5ndGggfSk7XG5cbiAgICBjb25zdCBzZWxlY3RNb2RhbE9iamVjdDogSVNlbGVjdE1vZGFsT2JqZWN0ID0ge1xuICAgICAgZ3JvdXBJZDogcmVwb3NpdG9yeUVudHJ5LmlkLFxuICAgICAgYm9keTogW1xuICAgICAgICB7IHZhbHVlOiByZXBvc2l0b3J5RW50cnkubmFtZSwgY2xhc3M6ICd0ZXh0LXRydW5jYXRlJyB9LFxuICAgICAgICB7IHZhbHVlOiByZXBvc2l0b3J5RW50cnkuZGVzY3JpcHRpb24sIGNsYXNzOiAndGV4dC10cnVuY2F0ZSB0ZXh0LW11dGVkJyB9XG4gICAgICBdLFxuICAgICAgYWRkaXRpb25hbEluZm9ybWF0aW9uOiB7IHZhbHVlOiBsYWJlbCwgY2xhc3M6ICdsYWJlbCBsYWJlbC1pbmZvJyB9LFxuICAgICAgb3B0aW9uc1xuICAgIH07XG5cbiAgICByZXR1cm4gc2VsZWN0TW9kYWxPYmplY3Q7XG4gIH1cbn1cbiJdfQ==