import { BaseDeviceGridColumn } from './base.device-grid-column';
import { StatusCellRendererComponent } from './status.cell-renderer.component';
import { PushStatus, SendStatus, gettext } from '@c8y/ngx-components';
import { FormGroup } from '@angular/forms';
export class StatusDeviceGridColumn extends BaseDeviceGridColumn {
    constructor() {
        super();
        const responseIntervalPath = 'c8y_RequiredAvailability.responseInterval';
        const responseIntervalLessThanOrEqualTo0 = { [responseIntervalPath]: { __le: 0 } };
        const responseIntervalNotDefined = { __not: { __has: responseIntervalPath } };
        const availabilityStatusPath = 'c8y_Availability.status';
        const availabilityStatusAvailable = { [availabilityStatusPath]: SendStatus.AVAILABLE };
        const availabilityStatusUnavailable = { [availabilityStatusPath]: SendStatus.UNAVAILABLE };
        const availabilityStatusMaintenance = { [availabilityStatusPath]: SendStatus.MAINTENANCE };
        const availabilityStatusNotDefined = { __not: { __has: availabilityStatusPath } };
        const connectionStatusPath = 'c8y_Connection.status';
        const connectionStatusConnected = { [connectionStatusPath]: PushStatus.CONNECTED };
        const connectionStatusDisconnected = { [connectionStatusPath]: PushStatus.DISCONNECTED };
        const connectionStatusMaintenance = { [connectionStatusPath]: PushStatus.MAINTENANCE };
        const deviceUnderMaintenance = {
            __or: [
                responseIntervalLessThanOrEqualTo0,
                availabilityStatusMaintenance,
                connectionStatusMaintenance
            ]
        };
        const deviceNotUnderMaintenance = {
            // using __and of __nots because backend does not support __not with __ors
            __and: [
                { __not: responseIntervalLessThanOrEqualTo0 },
                { __not: availabilityStatusMaintenance },
                { __not: connectionStatusMaintenance }
            ]
        };
        this.name = 'status';
        this.header = gettext('Status');
        this.dataType = "icon" /* Icon */;
        this.cellRendererComponent = StatusCellRendererComponent;
        this.resizable = false;
        this.filterable = true;
        this.filteringConfig = {
            schema: {
                type: 'object',
                properties: {
                    sendStatus: {
                        title: gettext('Show devices with send status'),
                        type: 'object',
                        properties: {
                            sendOnline: {
                                type: 'switch',
                                title: gettext('Online')
                            },
                            sendOffline: {
                                type: 'switch',
                                title: gettext('Offline')
                            },
                            sendUnknown: {
                                type: 'switch',
                                title: gettext('Unknown')
                            },
                            sendNotMonitored: {
                                type: 'switch',
                                title: gettext('Not monitored')
                            },
                        }
                    },
                    pushStatus: {
                        title: gettext('Show devices with push status'),
                        type: 'object',
                        properties: {
                            pushOnline: {
                                type: 'switch',
                                title: gettext('Online')
                            },
                            pushOffline: {
                                type: 'switch',
                                title: gettext('Offline')
                            },
                            pushNotMonitored: {
                                type: 'switch',
                                title: gettext('Not monitored')
                            },
                        }
                    },
                    maintenanceStatus: {
                        title: gettext('Show devices with maintenance status'),
                        type: 'object',
                        properties: {
                            maintenance: {
                                type: 'switch',
                                title: gettext('Device is under maintenance')
                            }
                        }
                    }
                }
            },
            formGroup: new FormGroup({}),
            getFilter(model) {
                var _a, _b, _c, _d, _e, _f, _g, _h;
                const filter = {};
                const ors = [];
                if ((_a = model === null || model === void 0 ? void 0 : model.sendStatus) === null || _a === void 0 ? void 0 : _a.sendOnline) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, availabilityStatusAvailable]
                    });
                }
                if ((_b = model === null || model === void 0 ? void 0 : model.sendStatus) === null || _b === void 0 ? void 0 : _b.sendOffline) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, availabilityStatusUnavailable]
                    });
                }
                if ((_c = model === null || model === void 0 ? void 0 : model.sendStatus) === null || _c === void 0 ? void 0 : _c.sendUnknown) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, availabilityStatusNotDefined]
                    });
                }
                if (((_d = model === null || model === void 0 ? void 0 : model.sendStatus) === null || _d === void 0 ? void 0 : _d.sendNotMonitored) || ((_e = model === null || model === void 0 ? void 0 : model.pushStatus) === null || _e === void 0 ? void 0 : _e.pushNotMonitored)) {
                    ors.push(responseIntervalNotDefined);
                }
                if ((_f = model === null || model === void 0 ? void 0 : model.pushStatus) === null || _f === void 0 ? void 0 : _f.pushOnline) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, connectionStatusConnected]
                    });
                }
                if ((_g = model === null || model === void 0 ? void 0 : model.pushStatus) === null || _g === void 0 ? void 0 : _g.pushOffline) {
                    ors.push({
                        __and: [deviceNotUnderMaintenance, connectionStatusDisconnected]
                    });
                }
                if ((_h = model === null || model === void 0 ? void 0 : model.maintenanceStatus) === null || _h === void 0 ? void 0 : _h.maintenance) {
                    ors.push(deviceUnderMaintenance);
                }
                if (ors.length) {
                    filter.__or = ors;
                }
                return filter;
            }
        };
        this.sortable = true;
        this.sortingConfig = {
            pathSortingConfigs: [{ path: availabilityStatusPath }]
        };
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2RldmljZS1ncmlkL2NvbHVtbnMvc3RhdHVzLmRldmljZS1ncmlkLWNvbHVtbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsb0JBQW9CLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQUNqRSxPQUFPLEVBQUUsMkJBQTJCLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUMvRSxPQUFPLEVBQWtCLFVBQVUsRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLE1BQU0scUJBQXFCLENBQUM7QUFDdEYsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBRTNDLE1BQU0sT0FBTyxzQkFBdUIsU0FBUSxvQkFBb0I7SUFDOUQ7UUFDRSxLQUFLLEVBQUUsQ0FBQztRQUVSLE1BQU0sb0JBQW9CLEdBQUcsMkNBQTJDLENBQUM7UUFDekUsTUFBTSxrQ0FBa0MsR0FBRyxFQUFFLENBQUMsb0JBQW9CLENBQUMsRUFBRSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQ25GLE1BQU0sMEJBQTBCLEdBQUcsRUFBRSxLQUFLLEVBQUUsRUFBRSxLQUFLLEVBQUUsb0JBQW9CLEVBQUUsRUFBRSxDQUFDO1FBRTlFLE1BQU0sc0JBQXNCLEdBQUcseUJBQXlCLENBQUM7UUFDekQsTUFBTSwyQkFBMkIsR0FBRyxFQUFFLENBQUMsc0JBQXNCLENBQUMsRUFBRSxVQUFVLENBQUMsU0FBUyxFQUFFLENBQUM7UUFDdkYsTUFBTSw2QkFBNkIsR0FBRyxFQUFFLENBQUMsc0JBQXNCLENBQUMsRUFBRSxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0YsTUFBTSw2QkFBNkIsR0FBRyxFQUFFLENBQUMsc0JBQXNCLENBQUMsRUFBRSxVQUFVLENBQUMsV0FBVyxFQUFFLENBQUM7UUFDM0YsTUFBTSw0QkFBNEIsR0FBRyxF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S0FBSyxDQUFFLFVBQVUsMENBQUUsVUFBVSxFQUFFO29CQUNqQyxHQUFHLENBQUMsSUFBSSxDQUFDO3dCQUNQLEtBQUssRUFBRSxDQUFDLHlCQUF5QixFQUFFLHlCQUF5QixDQUFDO3FCQUM5RCxDQUFDLENBQUM7aUJBQ0o7Z0JBRUQsSUFBSSxNQUFBLEtBQUssYUFBTCxLQUFLLHVCQUFMLEtBQUssQ0FBRSxVQUFVLDBDQUFFLFdBQVcsRUFBRTtvQkFDbEMsR0FBRyxDQUFDLElBQUksQ0FBQzt3QkFDUCxLQUFLLEVBQUUsQ0FBQyx5QkFBeUIsRUFBRSw0QkFBNEIsQ0FBQztxQkFDakUsQ0FBQyxDQUFDO2lCQUNKO2dCQUVELElBQUksTUFBQSxLQUFLLGFBQUwsS0FBSyx1QkFBTCxLQUFLLENBQUUsaUJBQWlCLDBDQUFFLFdBQVcsRUFBRTtvQkFDekMsR0FBRyxDQUFDLElBQUksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFDO2lCQUNsQztnQkFFRCxJQUFJLEdBQUcsQ0FBQyxNQUFNLEVBQUU7b0JBQ2QsTUFBTSxDQUFDLElBQUksR0FBRyxHQUFHLENBQUM7aUJBQ25CO2dCQUVELE9BQU8sTUFBTSxDQUFDO1lBQ2hCLENBQUM7U0FDRixDQUFDO1FBRUYsSUFBSSxDQUFDLFFBQVEsR0FBRyxJQUFJLENBQUM7UUFDckIsSUFBSSxDQUFDLGFBQWEsR0FBRztZQUNuQixrQkFBa0IsRUFBRSxDQUFDLEVBQUUsSUFBSSxFQUFFLHNCQUFzQixFQUFFLENBQUM7U0FDdkQsQ0FBQztJQUNKLENBQUM7Q0FDRiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEJhc2VEZXZpY2VHcmlkQ29sdW1uIH0gZnJvbSAnLi9iYXNlLmRldmljZS1ncmlkLWNvbHVtbic7XG5pbXBvcnQgeyBTdGF0dXNDZWxsUmVuZGVyZXJDb21wb25lbnQgfSBmcm9tICcuL3N0YXR1cy5jZWxsLXJlbmRlcmVyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBDb2x1bW5EYXRhVHlwZSwgUHVzaFN0YXR1cywgU2VuZFN0YXR1cywgZ2V0dGV4dCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMnO1xuaW1wb3J0IHsgRm9ybUdyb3VwIH0gZnJvbSAnQGFuZ3VsYXIvZm9ybXMnO1xuXG5leHBvcnQgY2xhc3MgU3RhdHVzRGV2aWNlR3JpZENvbHVtbiBleHRlbmRzIEJhc2VEZXZpY2VHcmlkQ29sdW1uIHtcbiAgY29uc3RydWN0b3IoKSB7XG4gICAgc3VwZXIoKTtcblxuICAgIGNvbnN0IHJlc3BvbnNlSW50ZXJ2YWxQYXRoID0gJ2M4eV9SZXF1aXJlZEF2YWlsYWJpbGl0eS5yZXNwb25zZUludGVydmFsJztcbiAgICBjb25zdCByZXNwb25zZUludGVydmFsTGVzc1RoYW5PckVxdWFsVG8wID0geyBbcmVzcG9uc2VJbnRlcnZhbFBhdGhdOiB7IF9fbGU6IDAgfSB9O1xuICAgIGNvbnN0IHJlc3BvbnNlSW50ZXJ2YWxOb3REZWZpbmVkID0geyBfX25vdDogeyBfX2hhczogcmVzcG9uc2VJbnRlcnZhbFBhdGggfSB9O1xuXG4gICAgY29uc3QgYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCA9ICdjOHlfQXZhaWxhYmlsaXR5LnN0YXR1cyc7XG4gICAgY29uc3QgYXZhaWxhYmlsaXR5U3RhdHVzQXZhaWxhYmxlID0geyBbYXZhaWxhYmlsaXR5U3RhdHVzUGF0aF06IFNlbmRTdGF0dXMuQVZBSUxBQkxFIH07XG4gICAgY29uc3QgYXZhaWxhYmlsaXR5U3RhdHVzVW5hdmFpbGFibGUgPSB7IFthdmFpbGFiaWxpdHlTdGF0dXNQYXRoXTogU2VuZFN0YXR1cy5VTkFWQUlMQUJMRSB9O1xuICAgIGNvbnN0IGF2YWlsYWJpbGl0eVN0YXR1c01haW50ZW5hbmNlID0geyBbYXZhaWxhYmlsaXR5U3RhdHVzUGF0aF06IFNlbmRTdGF0dXMuTUFJTlRFTkFOQ0UgfTtcbiAgICBjb25zdCBhdmFpbGFiaWxpdHlTdGF0dXNOb3REZWZpbmVkID0geyBfX25vdDogeyBfX2hhczogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9IH07XG5cbiAgICBjb25zdCBjb25uZWN0aW9uU3RhdHVzUGF0aCA9ICdjOHlfQ29ubmVjdGlvbi5zdGF0dXMnO1xuICAgIGNvbnN0IGNvbm5lY3Rpb25TdGF0dXNDb25uZWN0ZWQgPSB7IFtjb25uZWN0aW9uU3RhdHVzUGF0aF06IFB1c2hTdGF0dXMuQ09OTkVDVEVEIH07XG4gICAgY29uc3QgY29ubmVjdGlvblN0YXR1c0Rpc2Nvbm5lY3RlZCA9IHsgW2Nvbm5lY3Rpb25TdGF0dXNQYXRoXTogUHVzaFN0YXR1cy5ESVNDT05ORUNURUQgfTtcbiAgICBjb25zdCBjb25uZWN0aW9uU3RhdHVzTWFpbnRlbmFuY2UgPSB7IFtjb25uZWN0aW9uU3RhdHVzUGF0aF06IFB1c2hTdGF0dXMuTUFJTlRFTkFOQ0UgfTtcblxuICAgIGNvbnN0IGRldmljZVVuZGVyTWFpbnRlbmFuY2UgPSB7XG4gICAgICBfX29yOiBbXG4gICAgICAgIHJlc3BvbnNlSW50ZXJ2YWxMZXNzVGhhbk9yRXF1YWxUbzAsXG4gICAgICAgIGF2YWlsYWJpbGl0eVN0YXR1c01haW50ZW5hbmNlLFxuICAgICAgICBjb25uZWN0aW9uU3RhdHVzTWFpbnRlbmFuY2VcbiAgICAgIF1cbiAgICB9O1xuICAgIGNvbnN0IGRldmljZU5vdFVuZGVyTWFpbnRlbmFuY2UgPSB7XG4gICAgICAvLyB1c2luZyBfX2FuZCBvZiBfX25vdHMgYmVjYXVzZSBiYWNrZW5kIGRvZXMgbm90IHN1cHBvcnQgX19ub3Qgd2l0aCBfX29yc1xuICAgICAgX19hbmQ6IFtcbiAgICAgICAgeyBfX25vdDogcmVzcG9uc2VJbnRlcnZhbExlc3NUaGFuT3JFcXVhbFRvMCB9LFxuICAgICAgICB7IF9fbm90OiBhdmFpbGFiaWxpdHlTdGF0dXNNYWludGVuYW5jZSB9LFxuICAgICAgICB7IF9fbm90OiBjb25uZWN0aW9uU3RhdHVzTWFpbnRlbmFuY2UgfVxuICAgICAgXVxuICAgIH07XG5cbiAgICB0aGlzLm5hbWUgPSAnc3RhdHVzJztcbiAgICB0aGlzLmhlYWRlciA9IGdldHRleHQoJ1N0YXR1cycpO1xuICAgIHRoaXMuZGF0YVR5cGUgPSBDb2x1bW5EYXRhVHlwZS5JY29uO1xuICAgIHRoaXMuY2VsbFJlbmRlcmVyQ29tcG9uZW50ID0gU3RhdHVzQ2VsbFJlbmRlcmVyQ29tcG9uZW50O1xuICAgIHRoaXMucmVzaXphYmxlID0gZmFsc2U7XG5cbiAgICB0aGlzLmZpbHRlcmFibGUgPSB0cnVlO1xuICAgIHRoaXMuZmlsdGVyaW5nQ29uZmlnID0ge1xuICAgICAgc2NoZW1hOiB7XG4gICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICBwcm9wZXJ0aWVzOiB7XG4gICAgICAgICAgc2VuZFN0YXR1czoge1xuICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ1Nob3cgZGV2aWNlcyB3aXRoIHNlbmQgc3RhdHVzJyksXG4gICAgICAgICAgICB0eXBlOiAnb2JqZWN0JyxcbiAgICAgICAgICAgIHByb3BlcnRpZXM6IHtcbiAgICAgICAgICAgICAgc2VuZE9ubGluZToge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdzd2l0Y2gnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPbmxpbmUnKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBzZW5kT2ZmbGluZToge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdzd2l0Y2gnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdPZmZsaW5lJylcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgc2VuZFVua25vd246IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3dpdGNoJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnVW5rbm93bicpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHNlbmROb3RNb25pdG9yZWQ6IHtcbiAgICAgICAgICAgICAgICB0eXBlOiAnc3dpdGNoJyxcbiAgICAgICAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnTm90IG1vbml0b3JlZCcpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBwdXNoU3RhdHVzOiB7XG4gICAgICAgICAgICB0aXRsZTogZ2V0dGV4dCgnU2hvdyBkZXZpY2VzIHdpdGggcHVzaCBzdGF0dXMnKSxcbiAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICBwdXNoT25saW5lOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09ubGluZScpXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHB1c2hPZmZsaW5lOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ09mZmxpbmUnKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBwdXNoTm90TW9uaXRvcmVkOiB7XG4gICAgICAgICAgICAgICAgdHlwZTogJ3N3aXRjaCcsXG4gICAgICAgICAgICAgICAgdGl0bGU6IGdldHRleHQoJ05vdCBtb25pdG9yZWQnKVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbWFpbnRlbmFuY2VTdGF0dXM6IHtcbiAgICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdTaG93IGRldmljZXMgd2l0aCBtYWludGVuYW5jZSBzdGF0dXMnKSxcbiAgICAgICAgICAgIHR5cGU6ICdvYmplY3QnLFxuICAgICAgICAgICAgcHJvcGVydGllczoge1xuICAgICAgICAgICAgICBtYWludGVuYW5jZToge1xuICAgICAgICAgICAgICAgIHR5cGU6ICdzd2l0Y2gnLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBnZXR0ZXh0KCdEZXZpY2UgaXMgdW5kZXIgbWFpbnRlbmFuY2UnKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZm9ybUdyb3VwOiBuZXcgRm9ybUdyb3VwKHt9KSxcbiAgICAgIGdldEZpbHRlcihtb2RlbCkge1xuICAgICAgICBjb25zdCBmaWx0ZXI6IGFueSA9IHt9O1xuICAgICAgICBjb25zdCBvcnMgPSBbXTtcblxuICAgICAgICBpZiAobW9kZWw/LnNlbmRTdGF0dXM/LnNlbmRPbmxpbmUpIHtcbiAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICBfX2FuZDogW2RldmljZU5vdFVuZGVyTWFpbnRlbmFuY2UsIGF2YWlsYWJpbGl0eVN0YXR1c0F2YWlsYWJsZV1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb2RlbD8uc2VuZFN0YXR1cz8uc2VuZE9mZmxpbmUpIHtcbiAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICBfX2FuZDogW2RldmljZU5vdFVuZGVyTWFpbnRlbmFuY2UsIGF2YWlsYWJpbGl0eVN0YXR1c1VuYXZhaWxhYmxlXVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG1vZGVsPy5zZW5kU3RhdHVzPy5zZW5kVW5rbm93bikge1xuICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgIF9fYW5kOiBbZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSwgYXZhaWxhYmlsaXR5U3RhdHVzTm90RGVmaW5lZF1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb2RlbD8uc2VuZFN0YXR1cz8uc2VuZE5vdE1vbml0b3JlZCB8fCBtb2RlbD8ucHVzaFN0YXR1cz8ucHVzaE5vdE1vbml0b3JlZCkge1xuICAgICAgICAgIG9ycy5wdXNoKHJlc3BvbnNlSW50ZXJ2YWxOb3REZWZpbmVkKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb2RlbD8ucHVzaFN0YXR1cz8ucHVzaE9ubGluZSkge1xuICAgICAgICAgIG9ycy5wdXNoKHtcbiAgICAgICAgICAgIF9fYW5kOiBbZGV2aWNlTm90VW5kZXJNYWludGVuYW5jZSwgY29ubmVjdGlvblN0YXR1c0Nvbm5lY3RlZF1cbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChtb2RlbD8ucHVzaFN0YXR1cz8ucHVzaE9mZmxpbmUpIHtcbiAgICAgICAgICBvcnMucHVzaCh7XG4gICAgICAgICAgICBfX2FuZDogW2RldmljZU5vdFVuZGVyTWFpbnRlbmFuY2UsIGNvbm5lY3Rpb25TdGF0dXNEaXNjb25uZWN0ZWRdXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAobW9kZWw/Lm1haW50ZW5hbmNlU3RhdHVzPy5tYWludGVuYW5jZSkge1xuICAgICAgICAgIG9ycy5wdXNoKGRldmljZVVuZGVyTWFpbnRlbmFuY2UpO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKG9ycy5sZW5ndGgpIHtcbiAgICAgICAgICBmaWx0ZXIuX19vciA9IG9ycztcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiBmaWx0ZXI7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHRoaXMuc29ydGFibGUgPSB0cnVlO1xuICAgIHRoaXMuc29ydGluZ0NvbmZpZyA9IHtcbiAgICAgIHBhdGhTb3J0aW5nQ29uZmlnczogW3sgcGF0aDogYXZhaWxhYmlsaXR5U3RhdHVzUGF0aCB9XVxuICAgIH07XG4gIH1cbn1cbiJdfQ==