import { coerceBooleanProperty } from '@angular/cdk/coercion';
import { Component, EventEmitter, HostBinding, Input, Output } from '@angular/core';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from 'ngx-bootstrap/dropdown';
import * as ɵngcc2 from '@angular/common';
import * as ɵngcc3 from '@c8y/ngx-components';

function StatusFilterComponent_span_3_span_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 6);
    ɵngcc0.ɵɵelement(1, "i", 7);
    ɵngcc0.ɵɵelementStart(2, "span", 8);
    ɵngcc0.ɵɵtext(3);
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const option_r3 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("c8yIcon", option_r3.option.icon)("ngClass", option_r3.option.styleClass);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(4, 3, option_r3.option.label));
} }
function StatusFilterComponent_span_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 5);
    ɵngcc0.ɵɵtemplate(1, StatusFilterComponent_span_3_span_1_Template, 5, 5, "span", 3);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const option_r3 = ctx.$implicit;
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", option_r3.selected);
} }
function StatusFilterComponent_span_4_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 6);
    ɵngcc0.ɵɵelement(1, "i", 9);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(3, 1, "All statuses"), " ");
} }
const _c0 = function (a0) { return { active: a0 }; };
function StatusFilterComponent_ul_5_li_1_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "li", 12);
    ɵngcc0.ɵɵelementStart(1, "button", 14);
    ɵngcc0.ɵɵlistener("click", function StatusFilterComponent_ul_5_li_1_Template_button_click_1_listener() { const restoredCtx = ɵngcc0.ɵɵrestoreView(_r9); const option_r7 = restoredCtx.$implicit; const ctx_r8 = ɵngcc0.ɵɵnextContext(2); return ctx_r8.changeFilter(option_r7); });
    ɵngcc0.ɵɵelement(2, "i", 7);
    ɵngcc0.ɵɵelementStart(3, "span", 8);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵpipe(5, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const option_r7 = ctx.$implicit;
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(6, _c0, option_r7.selected));
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("c8yIcon", option_r7.option.icon)("ngClass", option_r7.option.styleClass);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵtextInterpolate(ɵngcc0.ɵɵpipeBind1(5, 4, option_r7.option.label));
} }
function StatusFilterComponent_ul_5_Template(rf, ctx) { if (rf & 1) {
    const _r11 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "ul", 10);
    ɵngcc0.ɵɵtemplate(1, StatusFilterComponent_ul_5_li_1_Template, 6, 8, "li", 11);
    ɵngcc0.ɵɵelementStart(2, "li", 12);
    ɵngcc0.ɵɵelementStart(3, "button", 13);
    ɵngcc0.ɵɵlistener("click", function StatusFilterComponent_ul_5_Template_button_click_3_listener() { ɵngcc0.ɵɵrestoreView(_r11); const ctx_r10 = ɵngcc0.ɵɵnextContext(); return ctx_r10.removeFilter(); });
    ɵngcc0.ɵɵpipe(4, "translate");
    ɵngcc0.ɵɵelement(5, "i", 9);
    ɵngcc0.ɵɵtext(6);
    ɵngcc0.ɵɵpipe(7, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r2.statusOptions);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(8, _c0, ctx_r2.isAllButtonSelected));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(4, 4, "All"));
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(7, 6, "All statuses"), " ");
} }
export class StatusFilterComponent {
    constructor() {
        this.statusOptions = [];
        this.onFilterChanged = new EventEmitter();
        this.isAllButtonSelected = true;
    }
    /** List of filter options to be displayed */
    set options(options) {
        this.statusOptions = (Object.values(options) || []).map(option => ({
            selected: false,
            option
        }));
    }
    /**
     * Allows multiple options to be active simultaneosly.
     */
    set _multiple(multiple) {
        this.multiple = coerceBooleanProperty(multiple);
    }
    /** Display the filter as a small button group */
    set _small(small) {
        this.small = coerceBooleanProperty(small);
    }
    get displaySmall() {
        return this.small;
    }
    changeFilter(option) {
        this.isAllButtonSelected = false;
        let emitNeeded = false;
        if (this.multiple) {
            option.selected = !option.selected;
            emitNeeded = true;
        }
        else if (!option.selected) {
            option.selected = true;
            this.statusOptions.filter(op => op !== option).forEach(op => (op.selected = false));
            emitNeeded = true;
        }
        if (emitNeeded) {
            this.emitSelectedOptions();
        }
    }
    removeFilter() {
        this.isAllButtonSelected = true;
        this.statusOptions.forEach(op => (op.selected = false));
        this.emitSelectedOptions();
    }
    /**
     * Allows the filter to be initalliy displayed with some preset filters.
     *
     * @param filters An `StatusOption` array defining filter options to be preset.
     * @param emit  (optional) If `true` component will emit `onFilterChanged` event.
     */
    preset(filters, emit = true) {
        let firstSelected = false;
        this.statusOptions.forEach(option => (option.selected = false));
        this.statusOptions
            .filter(option => (filters || []).map(o => o.label).includes(option.option.label))
            .filter(() => {
            // only first option passed will be set in single selection mode
            const include = this.multiple || !firstSelected;
            if (include) {
                firstSelected = true;
            }
            return include;
        })
            .forEach(option => (option.selected = true));
        this.isAllButtonSelected = !(filters && filters.length);
        if (emit) {
            this.emitSelectedOptions();
        }
    }
    reset() {
        this.removeFilter();
    }
    activeFilters() {
        return this.statusOptions.filter(option => option.selected).map(option => option.option);
    }
    isFilterApplied() {
        return this.statusOptions.some(option => option.selected);
    }
    emitSelectedOptions() {
        this.onFilterChanged.emit(this.statusOptions.filter(option => option.selected).map(option => option.option));
    }
}
StatusFilterComponent.ɵfac = function StatusFilterComponent_Factory(t) { return new (t || StatusFilterComponent)(); };
StatusFilterComponent.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: StatusFilterComponent, selectors: [["c8y-status-filter"]], hostVars: 2, hostBindings: function StatusFilterComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("btn-group-sm", ctx.displaySmall);
    } }, inputs: { options: "options", _multiple: ["multiple", "_multiple"], _small: ["small", "_small"] }, outputs: { onFilterChanged: "onFilterChanged" }, decls: 6, vars: 5, consts: [["dropdown", "", "placement", "bottom left", 1, "dropdown", "c8y-child-assets-selector"], ["id", "status-filter", "dropdownToggle", "", "type", "button", "aria-controls", "dropdown-status-filter", 1, "btn", "dropdown-toggle", "d-flex", "a-i-center", "c8y-dropdown", 3, "title"], ["class", "d-contents", 4, "ngFor", "ngForOf"], ["class", "text-truncate", 4, "ngIf"], ["id", "dropdown-status-filter", "class", "dropdown-menu", "role", "menu", "aria-labelledby", "status-filter", 4, "dropdownMenu"], [1, "d-contents"], [1, "text-truncate"], [3, "c8yIcon", "ngClass"], [1, "m-l-4"], ["c8yIcon", "c8y-energy", 1, "m-r-4", "text-info"], ["id", "dropdown-status-filter", "role", "menu", "aria-labelledby", "status-filter", 1, "dropdown-menu"], [3, "ngClass", 4, "ngFor", "ngForOf"], [3, "ngClass"], [3, "title", "click"], [3, "click"]], template: function StatusFilterComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelementStart(1, "button", 1);
        ɵngcc0.ɵɵpipe(2, "translate");
        ɵngcc0.ɵɵtemplate(3, StatusFilterComponent_span_3_Template, 2, 1, "span", 2);
        ɵngcc0.ɵɵtemplate(4, StatusFilterComponent_span_4_Template, 4, 3, "span", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(5, StatusFilterComponent_ul_5_Template, 8, 10, "ul", 4);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵpropertyInterpolate("title", ɵngcc0.ɵɵpipeBind1(2, 3, "Status filter"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.statusOptions);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isAllButtonSelected);
    } }, directives: [ɵngcc1.BsDropdownDirective, ɵngcc1.BsDropdownToggleDirective, ɵngcc2.NgForOf, ɵngcc2.NgIf, ɵngcc1.BsDropdownMenuDirective, ɵngcc3.IconDirective, ɵngcc2.NgClass], pipes: [ɵngcc3.C8yTranslatePipe], encapsulation: 2 });
StatusFilterComponent.propDecorators = {
    options: [{ type: Input }],
    _multiple: [{ type: Input, args: ['multiple',] }],
    _small: [{ type: Input, args: ['small',] }],
    displaySmall: [{ type: HostBinding, args: ['class.btn-group-sm',] }],
    onFilterChanged: [{ type: Output }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(StatusFilterComponent, [{
        type: Component,
        args: [{
                selector: 'c8y-status-filter',
                template: "<div dropdown placement=\"bottom left\" class=\"dropdown c8y-child-assets-selector\">\n  <button\n    id=\"status-filter\"\n    dropdownToggle\n    type=\"button\"\n    class=\"btn dropdown-toggle d-flex a-i-center c8y-dropdown\"\n    title=\"{{ 'Status filter' | translate }}\"\n    aria-controls=\"dropdown-status-filter\"\n  >\n    <span *ngFor=\"let option of statusOptions\" class=\"d-contents\">\n      <span class=\"text-truncate\" *ngIf=\"option.selected\">\n        <i [c8yIcon]=\"option.option.icon\" [ngClass]=\"option.option.styleClass\"></i>\n        <span class=\"m-l-4\">{{ option.option.label | translate }}</span>\n      </span>\n    </span>\n    <span class=\"text-truncate\" *ngIf=\"isAllButtonSelected\">\n      <i c8yIcon=\"c8y-energy\" class=\"m-r-4 text-info\"></i>\n      {{ 'All statuses' | translate }}\n    </span>\n  </button>\n  <ul\n    id=\"dropdown-status-filter\"\n    *dropdownMenu\n    class=\"dropdown-menu\"\n    role=\"menu\"\n    aria-labelledby=\"status-filter\"\n  >\n    <li *ngFor=\"let option of statusOptions\" [ngClass]=\"{ active: option.selected }\">\n      <button (click)=\"changeFilter(option)\">\n        <i [c8yIcon]=\"option.option.icon\" [ngClass]=\"option.option.styleClass\"></i>\n        <span class=\"m-l-4\">{{ option.option.label | translate }}</span>\n      </button>\n    </li>\n    <li [ngClass]=\"{ active: isAllButtonSelected }\">\n      <button title=\"{{ 'All' | translate }}\" (click)=\"removeFilter()\">\n        <i c8yIcon=\"c8y-energy\" class=\"m-r-4 text-info\"></i>\n        {{ 'All statuses' | translate }}\n      </button>\n    </li>\n  </ul>\n</div>\n"
            }]
    }], function () { return []; }, { onFilterChanged: [{
            type: Output
        }], options: [{
            type: Input
        }], _multiple: [{
            type: Input,
            args: ['multiple']
        }], _small: [{
            type: Input,
            args: ['small']
        }], displaySmall: [{
            type: HostBinding,
            args: ['class.btn-group-sm']
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdHVzLWZpbHRlci5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL29wZXJhdGlvbnMvc3RhdHVzLWZpbHRlci9zdGF0dXMtZmlsdGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSx1QkFBdUIsQ0FBQztBQUM5RCxPQUFPLEVBQUUsU0FBUyxFQUFFLFlBQVksRUFBRSxXQUFXLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFPcEYsTUFBTSxPQUFPLHFCQUFxQjtBQUNsQyxJQUxBO0FBQ0csUUFJRCxrQkFBYSxHQUF1RCxFQUFFLENBQUM7QUFDekUsUUF5Qlksb0JBQWUsR0FBaUMsSUFBSSxZQUFZLEVBQUUsQ0FBQztBQUMvRSxRQUNFLHdCQUFtQixHQUFZLElBQUksQ0FBQztBQUN0QyxJQTZFQSxDQUFDO0FBQ0QsSUF6R0UsNkNBQTZDO0FBQy9DLElBQUUsSUFBYSxPQUFPLENBQUMsT0FBa0M7QUFDekQsUUFBSSxJQUFJLENBQUMsYUFBYSxHQUFHLENBQUMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQ3ZFLFlBQU0sUUFBUSxFQUFFLEtBQUs7QUFDckIsWUFBTSxNQUFNO0FBQ1osU0FBSyxDQUFDLENBQUMsQ0FBQztBQUNSLElBQUUsQ0FBQztBQUNILElBQ0U7QUFDRjtBQUNFLE9BQUc7QUFDTCxJQUFFLElBQXVCLFNBQVMsQ0FBQyxRQUFpQjtBQUNwRCxRQUFJLElBQUksQ0FBQyxRQUFRLEdBQUcscUJBQXFCLENBQUMsUUFBUSxDQUFDLENBQUM7QUFDcEQsSUFBRSxD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dkMsTUFBTTtBQUFJOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29lcmNlQm9vbGVhblByb3BlcnR5IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NvZXJjaW9uJztcbmltcG9ydCB7IENvbXBvbmVudCwgRXZlbnRFbWl0dGVyLCBIb3N0QmluZGluZywgSW5wdXQsIE91dHB1dCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU3RhdHVzT3B0aW9uLCBPcGVyYXRpb25TdGF0dXNPcHRpb25zTWFwIH0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cy9vcGVyYXRpb25zL3NoYXJlZCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1zdGF0dXMtZmlsdGVyJyxcbiAgdGVtcGxhdGVVcmw6ICcuL3N0YXR1cy1maWx0ZXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIFN0YXR1c0ZpbHRlckNvbXBvbmVudCB7XG4gIHN0YXR1c09wdGlvbnM6IEFycmF5PHsgc2VsZWN0ZWQ6IGJvb2xlYW47IG9wdGlvbjogU3RhdHVzT3B0aW9uIH0+ID0gW107XG5cbiAgLyoqIExpc3Qgb2YgZmlsdGVyIG9wdGlvbnMgdG8gYmUgZGlzcGxheWVkICovXG4gIEBJbnB1dCgpIHNldCBvcHRpb25zKG9wdGlvbnM6IE9wZXJhdGlvblN0YXR1c09wdGlvbnNNYXApIHtcbiAgICB0aGlzLnN0YXR1c09wdGlvbnMgPSAoT2JqZWN0LnZhbHVlcyhvcHRpb25zKSB8fCBbXSkubWFwKG9wdGlvbiA9PiAoe1xuICAgICAgc2VsZWN0ZWQ6IGZhbHNlLFxuICAgICAgb3B0aW9uXG4gICAgfSkpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG93cyBtdWx0aXBsZSBvcHRpb25zIHRvIGJlIGFjdGl2ZSBzaW11bHRhbmVvc2x5LlxuICAgKi9cbiAgQElucHV0KCdtdWx0aXBsZScpIHNldCBfbXVsdGlwbGUobXVsdGlwbGU6IGJvb2xlYW4pIHtcbiAgICB0aGlzLm11bHRpcGxlID0gY29lcmNlQm9vbGVhblByb3BlcnR5KG11bHRpcGxlKTtcbiAgfVxuXG4gIC8qKiBEaXNwbGF5IHRoZSBmaWx0ZXIgYXMgYSBzbWFsbCBidXR0b24gZ3JvdXAgKi9cbiAgQElucHV0KCdzbWFsbCcpIHNldCBfc21hbGwoc21hbGw6IGJvb2xlYW4pIHtcbiAgICB0aGlzLnNtYWxsID0gY29lcmNlQm9vbGVhblByb3BlcnR5KHNtYWxsKTtcbiAgfVxuXG4gIEBIb3N0QmluZGluZygnY2xhc3MuYnRuLWdyb3VwLXNtJykgZ2V0IGRpc3BsYXlTbWFsbCgpIHtcbiAgICByZXR1cm4gdGhpcy5zbWFsbDtcbiAgfVxuXG4gIEBPdXRwdXQoKSBvbkZpbHRlckNoYW5nZWQ6IEV2ZW50RW1pdHRlcjxTdGF0dXNPcHRpb25bXT4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG5cbiAgaXNBbGxCdXR0b25TZWxlY3RlZDogYm9vbGVhbiA9IHRydWU7XG5cbiAgcHJpdmF0ZSBtdWx0aXBsZTogYm9vbGVhbjtcbiAgcHJpdmF0ZSBzbWFsbDogYm9vbGVhbjtcblxuICBjaGFuZ2VGaWx0ZXIob3B0aW9uOiB7IHNlbGVjdGVkOiBib29sZWFuOyBvcHRpb246IFN0YXR1c09wdGlvbiB9KSB7XG4gICAgdGhpcy5pc0FsbEJ1dHRvblNlbGVjdGVkID0gZmFsc2U7XG4gICAgbGV0IGVtaXROZWVkZWQ6IGJvb2xlYW4gPSBmYWxzZTtcblxuICAgIGlmICh0aGlzLm11bHRpcGxlKSB7XG4gICAgICBvcHRpb24uc2VsZWN0ZWQgPSAhb3B0aW9uLnNlbGVjdGVkO1xuICAgICAgZW1pdE5lZWRlZCA9IHRydWU7XG4gICAgfSBlbHNlIGlmICghb3B0aW9uLnNlbGVjdGVkKSB7XG4gICAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgdGhpcy5zdGF0dXNPcHRpb25zLmZpbHRlcihvcCA9PiBvcCAhPT0gb3B0aW9uKS5mb3JFYWNoKG9wID0+IChvcC5zZWxlY3RlZCA9IGZhbHNlKSk7XG4gICAgICBlbWl0TmVlZGVkID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoZW1pdE5lZWRlZCkge1xuICAgICAgdGhpcy5lbWl0U2VsZWN0ZWRPcHRpb25zKCk7XG4gICAgfVxuICB9XG5cbiAgcmVtb3ZlRmlsdGVyKCkge1xuICAgIHRoaXMuaXNBbGxCdXR0b25TZWxlY3RlZCA9IHRydWU7XG4gICAgdGhpcy5zdGF0dXNPcHRpb25zLmZvckVhY2gob3AgPT4gKG9wLnNlbGVjdGVkID0gZmFsc2UpKTtcblxuICAgIHRoaXMuZW1pdFNlbGVjdGVkT3B0aW9ucygpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFsbG93cyB0aGUgZmlsdGVyIHRvIGJlIGluaXRhbGxpeSBkaXNwbGF5ZWQgd2l0aCBzb21lIHByZXNldCBmaWx0ZXJzLlxuICAgKlxuICAgKiBAcGFyYW0gZmlsdGVycyBBbiBgU3RhdHVzT3B0aW9uYCBhcnJheSBkZWZpbmluZyBmaWx0ZXIgb3B0aW9ucyB0byBiZSBwcmVzZXQuXG4gICAqIEBwYXJhbSBlbWl0ICAob3B0aW9uYWwpIElmIGB0cnVlYCBjb21wb25lbnQgd2lsbCBlbWl0IGBvbkZpbHRlckNoYW5nZWRgIGV2ZW50LlxuICAgKi9cbiAgcHJlc2V0KGZpbHRlcnM6IFN0YXR1c09wdGlvbltdLCBlbWl0OiBib29sZWFuID0gdHJ1ZSkge1xuICAgIGxldCBmaXJzdFNlbGVjdGVkOiBib29sZWFuID0gZmFsc2U7XG5cbiAgICB0aGlzLnN0YXR1c09wdGlvbnMuZm9yRWFjaChvcHRpb24gPT4gKG9wdGlvbi5zZWxlY3RlZCA9IGZhbHNlKSk7XG5cbiAgICB0aGlzLnN0YXR1c09wdGlvbnNcbiAgICAgIC5maWx0ZXIob3B0aW9uID0+IChmaWx0ZXJzIHx8IFtdKS5tYXAobyA9PiBvLmxhYmVsKS5pbmNsdWRlcyhvcHRpb24ub3B0aW9uLmxhYmVsKSlcbiAgICAgIC5maWx0ZXIoKCkgPT4ge1xuICAgICAgICAvLyBvbmx5IGZpcnN0IG9wdGlvbiBwYXNzZWQgd2lsbCBiZSBzZXQgaW4gc2luZ2xlIHNlbGVjdGlvbiBtb2RlXG4gICAgICAgIGNvbnN0IGluY2x1ZGU6IGJvb2xlYW4gPSB0aGlzLm11bHRpcGxlIHx8ICFmaXJzdFNlbGVjdGVkO1xuICAgICAgICBpZiAoaW5jbHVkZSkge1xuICAgICAgICAgIGZpcnN0U2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGluY2x1ZGU7XG4gICAgICB9KVxuICAgICAgLmZvckVhY2gob3B0aW9uID0+IChvcHRpb24uc2VsZWN0ZWQgPSB0cnVlKSk7XG5cbiAgICB0aGlzLmlzQWxsQnV0dG9uU2VsZWN0ZWQgPSAhKGZpbHRlcnMgJiYgZmlsdGVycy5sZW5ndGgpO1xuXG4gICAgaWYgKGVtaXQpIHtcbiAgICAgIHRoaXMuZW1pdFNlbGVjdGVkT3B0aW9ucygpO1xuICAgIH1cbiAgfVxuXG4gIHJlc2V0KCkge1xuICAgIHRoaXMucmVtb3ZlRmlsdGVyKCk7XG4gIH1cblxuICBhY3RpdmVGaWx0ZXJzKCk6IFN0YXR1c09wdGlvbltdIHtcbiAgICByZXR1cm4gdGhpcy5zdGF0dXNPcHRpb25zLmZpbHRlcihvcHRpb24gPT4gb3B0aW9uLnNlbGVjdGVkKS5tYXAob3B0aW9uID0+IG9wdGlvbi5vcHRpb24pO1xuICB9XG5cbiAgaXNGaWx0ZXJBcHBsaWVkKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLnN0YXR1c09wdGlvbnMuc29tZShvcHRpb24gPT4gb3B0aW9uLnNlbGVjdGVkKTtcbiAgfVxuXG4gIHByaXZhdGUgZW1pdFNlbGVjdGVkT3B0aW9ucygpIHtcbiAgICB0aGlzLm9uRmlsdGVyQ2hhbmdlZC5lbWl0KFxuICAgICAgdGhpcy5zdGF0dXNPcHRpb25zLmZpbHRlcihvcHRpb24gPT4gb3B0aW9uLnNlbGVjdGVkKS5tYXAob3B0aW9uID0+IG9wdGlvbi5vcHRpb24pXG4gICAgKTtcbiAgfVxufVxuIl19