import { __awaiter } from "tslib";
import { Component, Input, ViewChild } from '@angular/core';
import { ActivatedRoute, Router } from '@angular/router';
import { OperationStatus } from '@c8y/client';
import { gettext } from '@c8y/ngx-components';
import { BulkOperationListItemService } from '@c8y/ngx-components/operations/bulk-operation-list-item';
import { OperationsService, OPERATION_STATUS_OPTIONS_MAP } from '@c8y/ngx-components/operations/shared';
import { OperationsListService } from './operations-list.service';
export class OperationsListItemComponent {
    constructor(bulkOperationListItemService, sharedService, operationsListService, route, router) {
        var _a, _b, _c, _d;
        this.bulkOperationListItemService = bulkOperationListItemService;
        this.sharedService = sharedService;
        this.operationsListService = operationsListService;
        this.route = route;
        this.router = router;
        this.collapsed = true;
        this.readOnly = false;
        this.noExpandToggle = false;
        this.refreshLoading = false;
        this.OPERATION_STATUS = OperationStatus;
        this.OPERATION_STATUS_OPTIONS_MAP = OPERATION_STATUS_OPTIONS_MAP;
        this.deviceId = ((_b = (_a = this.route.snapshot.parent) === null || _a === void 0 ? void 0 : _a.data.contextData) === null || _b === void 0 ? void 0 : _b.id) ||
            ((_d = (_c = this.route.snapshot.firstChild) === null || _c === void 0 ? void 0 : _c.data.contextData) === null || _d === void 0 ? void 0 : _d.id);
        this.isSmartRulesMicroserviceAvailable = false;
    }
    ngOnInit() {
        var _a;
        return __awaiter(this, void 0, void 0, function* () {
            this.isSmartRulesMicroserviceAvailable =
                yield this.operationsListService.isSmartRulesMicroserviceAvailable();
            this.operationTitle =
                ((_a = this.operation.c8y_Command) === null || _a === void 0 ? void 0 : _a.text) ||
                    this.operation.description ||
                    gettext('No command text or description available');
            const smartRulesCreatePermissions = this.operationsListService.getSmartRulesCreatePermissions();
            if (smartRulesCreatePermissions) {
                this.inventoryPermissions = smartRulesCreatePermissions[0].anyRole;
                this.smartRuleAdminPermissions = smartRulesCreatePermissions[1].anyRole;
            }
        });
    }
    createCustomizedBulkOperation($event) {
        if ($event) {
            $event.stopPropagation();
        }
        this.router.navigateByUrl(`/devicecontrol/single/create-bulk/${this.operation.id}`);
    }
}
OperationsListItemComponent.decorators = [
    { type: Component, args: [{
                selector: 'c8y-operations-list-item',
                template: "<c8y-li\n  class=\"c8y-list__item--double-actions\"\n  [ngClass]=\"{ 'c8y-list__item--no-expand': noExpandToggle }\"\n  [collapsed]=\"collapsed\"\n  #listItem\n  id=\"{{ operation.id }}\"\n>\n  <c8y-li-icon>\n    <i\n      [c8yIcon]=\"OPERATION_STATUS_OPTIONS_MAP[operation.status].icon\"\n      [ngClass]=\"OPERATION_STATUS_OPTIONS_MAP[operation.status].styleClass\"\n      [tooltip]=\"OPERATION_STATUS_OPTIONS_MAP[operation.status].label | translate\"\n    ></i>\n  </c8y-li-icon>\n  <div\n    [ngClass]=\"{ 'content-flex-58': !readOnly, 'content-flex-50': readOnly }\"\n    [style.cursor]=\"!noExpandToggle ? 'pointer' : ''\"\n    (click)=\"!noExpandToggle && listItem.toggleCollapsed()\"\n  >\n    <div class=\"col-5\">\n      <span class=\"text-truncate\" title=\"{{ operationTitle | translate }}\">\n        {{ operationTitle | translate }}\n      </span>\n    </div>\n    <div class=\"col-3\" *ngIf=\"!deviceId\">\n      <a [routerLink]=\"['/device', operation.deviceId, 'device-info']\" routerLinkActive=\"active\">\n        {{ operation.deviceName }}\n      </a>\n    </div>\n    <div class=\"col-3\">\n      <small class=\"icon-flex text-muted\">\n        <i c8yIcon=\"calendar\" class=\"m-r-4\"></i>\n        {{ operation.creationTime | c8yDate }}\n      </small>\n    </div>\n  </div>\n  <ng-container *ngIf=\"!readOnly\">\n    <c8y-li-action\n      label=\"{{ 'Schedule as bulk operation' | translate }}\"\n      (click)=\"createCustomizedBulkOperation($event)\"\n      icon=\"c8y-icon c8y-icon-energy\"\n    >\n    </c8y-li-action>\n    <ng-container *c8yIfAllowed=\"inventoryPermissions; allowAny: true\">\n      <ng-container *c8yIfAllowed=\"smartRuleAdminPermissions; allowAny: true\">\n        <c8y-li-action\n          *ngIf=\"isSmartRulesMicroserviceAvailable\"\n          label=\"{{ 'Create smart rule' | translate }}\"\n          (click)=\"operationsListService.createSmartRule(operation)\"\n          icon=\"sliders\"\n        >\n        </c8y-li-action>\n      </ng-container>\n    </ng-container>\n    <c8y-li-action\n      *ngIf=\"operation.status === OPERATION_STATUS.PENDING\"\n      label=\"{{ 'Cancel operation' | translate }}\"\n      (click)=\"$event.stopPropagation(); sharedService.cancel(operation)\"\n      icon=\"times\"\n    >\n    </c8y-li-action>\n  </ng-container>\n  <c8y-li-collapse class=\"m-b-16\">\n    <c8y-operation-details-tabs\n      *ngIf=\"!listItem.collapsed\"\n      [operation]=\"operation\"\n      [bulkOperationModalDetailsService]=\"bulkOperationListItemService\"\n    ></c8y-operation-details-tabs>\n  </c8y-li-collapse>\n</c8y-li>\n"
            },] }
];
OperationsListItemComponent.ctorParameters = () => [
    { type: BulkOperationListItemService },
    { type: OperationsService },
    { type: OperationsListService },
    { type: ActivatedRoute },
    { type: Router }
];
OperationsListItemComponent.propDecorators = {
    operation: [{ type: Input }],
    collapsed: [{ type: Input }],
    readOnly: [{ type: Input }],
    noExpandToggle: [{ type: Input }],
    listItem: [{ type: ViewChild, args: ['listItem', { static: true },] }]
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoib3BlcmF0aW9ucy1saXN0LWl0ZW0uY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vb3BlcmF0aW9ucy9vcGVyYXRpb25zLWxpc3Qvb3BlcmF0aW9ucy1saXN0LWl0ZW0uY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFFLEtBQUssRUFBVSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFDcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUN6RCxPQUFPLEVBQWMsZUFBZSxFQUFFLE1BQU0sYUFBYSxDQUFDO0FBQzFELE9BQU8sRUFBRSxPQUFPLEVBQXFCLE1BQU0scUJBQXFCLENBQUM7QUFDakUsT0FBTyxFQUFFLDRCQUE0QixFQUFFLE1BQU0seURBQXlELENBQUM7QUFDdkcsT0FBTyxFQUNMLGlCQUFpQixFQUVqQiw0QkFBNEIsRUFDN0IsTUFBTSx1Q0FBdUMsQ0FBQztBQUMvQyxPQUFPLEVBQUUscUJBQXFCLEVBQUUsTUFBTSwyQkFBMkIsQ0FBQztBQU1sRSxNQUFNLE9BQU8sMkJBQTJCO0lBcUJ0QyxZQUNTLDRCQUEwRCxFQUMxRCxhQUFnQyxFQUNoQyxxQkFBNEMsRUFDM0MsS0FBcUIsRUFDckIsTUFBYzs7UUFKZixpQ0FBNEIsR0FBNUIsNEJBQTRCLENBQThCO1FBQzFELGtCQUFhLEdBQWIsYUFBYSxDQUFtQjtRQUNoQywwQkFBcUIsR0FBckIscUJBQXFCLENBQXVCO1FBQzNDLFVBQUssR0FBTCxLQUFLLENBQWdCO1FBQ3JCLFdBQU0sR0FBTixNQUFNLENBQVE7UUF0QnhCLGNBQVMsR0FBWSxJQUFJLENBQUM7UUFFMUIsYUFBUSxHQUFZLEtBQUssQ0FBQztRQUUxQixtQkFBYyxHQUFZLEtBQUssQ0FBQztRQUVoQyxtQkFBYyxHQUFHLEtBQUssQ0FBQztRQUN2QixxQkFBZ0IsR0FBRyxlQUFlLENBQUM7UUFDbkMsaUNBQTRCLEdBQThCLDRCQUE0QixDQUFDO1FBQ3ZGLGFBQVEsR0FDTixDQUFBLE1BQUEsTUFBQSxJQUFJLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxNQUFNLDBDQUFFLElBQUksQ0FBQyxXQUFXLDBDQUFFLEVBQUU7YUFDaEQsTUFBQSxNQUFBLElBQUksQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLFVBQVUsMENBQUUsSUFBSSxDQUFDLFdBQVcsMENBQUUsRUFBRSxDQUFBLENBQUM7UUFDdkQsc0NBQWlDLEdBQVksS0FBSyxDQUFDO0lBV2hELENBQUM7SUFFRSxRQUFROzs7WUFDWixJQUFJLENBQUMsaUNBQWlDO2dCQUNwQyxNQUFNLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxpQ0FBaUMsRUFBRSxDQUFDO1lBRXZFLElBQUksQ0FBQyxjQUFjO2dCQUNqQixDQUFBLE1BQUEsSUFBSSxDQUFDLFNBQVMsQ0FBQyxXQUFXLDBDQUFFLElBQUk7b0JBQ2hDLElBQUksQ0FBQyxTQUFTLENBQUMsV0FBVztvQkFDMUIsT0FBTyxDQUFDLDBDQUEwQyxDQUFDLENBQUM7WUFFdEQsTUFBTSwyQkFBMkIsR0FBRyxJQUFJLENBQUMscUJBQXFCLENBQUMsOEJBQThCLEVBQUUsQ0FBQztZQUNoRyxJQUFJLDJCQUEyQixFQUFFO2dCQUMvQixJQUFJLENBQUMsb0JBQW9CLEdBQUcsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO2dCQUNuRSxJQUFJLENBQUMseUJBQXlCLEdBQUcsMkJBQTJCLENBQUMsQ0FBQyxDQUFDLENBQUMsT0FBTyxDQUFDO2FBQ3pFOztLQUNGO0lBRUQsNkJBQTZCLENBQUMsTUFBYztRQUMxQyxJQUFJLE1BQU0sRUFBRTtZQUNWLE1BQU0sQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUMxQjtRQUVELElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLHFDQUFxQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDdEYsQ0FBQzs7O1lBdkRGLFNBQVMsU0FBQztnQkFDVCxRQUFRLEVBQUUsMEJBQTBCO2dCQUNwQyw0aUZBQW9EO2FBQ3JEOzs7WUFYUSw0QkFBNEI7WUFFbkMsaUJBQWlCO1lBSVYscUJBQXFCO1lBVHJCLGNBQWM7WUFBRSxNQUFNOzs7d0JBZ0I1QixLQUFLO3dCQUVMLEtBQUs7dUJBRUwsS0FBSzs2QkFFTCxLQUFLO3VCQUVMLFNBQVMsU0FBQyxVQUFVLEVBQUUsRUFBRSxNQUFNLEVBQUUsSUFBSSxFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBJbnB1dCwgT25Jbml0LCBWaWV3Q2hpbGQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEFjdGl2YXRlZFJvdXRlLCBSb3V0ZXIgfSBmcm9tICdAYW5ndWxhci9yb3V0ZXInO1xuaW1wb3J0IHsgSU9wZXJhdGlvbiwgT3BlcmF0aW9uU3RhdHVzIH0gZnJvbSAnQGM4eS9jbGllbnQnO1xuaW1wb3J0IHsgZ2V0dGV4dCwgTGlzdEl0ZW1Db21wb25lbnQgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IEJ1bGtPcGVyYXRpb25MaXN0SXRlbVNlcnZpY2UgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzL29wZXJhdGlvbnMvYnVsay1vcGVyYXRpb24tbGlzdC1pdGVtJztcbmltcG9ydCB7XG4gIE9wZXJhdGlvbnNTZXJ2aWNlLFxuICBPcGVyYXRpb25TdGF0dXNPcHRpb25zTWFwLFxuICBPUEVSQVRJT05fU1RBVFVTX09QVElPTlNfTUFQXG59IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMvb3BlcmF0aW9ucy9zaGFyZWQnO1xuaW1wb3J0IHsgT3BlcmF0aW9uc0xpc3RTZXJ2aWNlIH0gZnJvbSAnLi9vcGVyYXRpb25zLWxpc3Quc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2M4eS1vcGVyYXRpb25zLWxpc3QtaXRlbScsXG4gIHRlbXBsYXRlVXJsOiAnLi9vcGVyYXRpb25zLWxpc3QtaXRlbS5jb21wb25lbnQuaHRtbCdcbn0pXG5leHBvcnQgY2xhc3MgT3BlcmF0aW9uc0xpc3RJdGVtQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KClcbiAgb3BlcmF0aW9uOiBQYXJ0aWFsPElPcGVyYXRpb24+O1xuICBASW5wdXQoKVxuICBjb2xsYXBzZWQ6IGJvb2xlYW4gPSB0cnVlO1xuICBASW5wdXQoKVxuICByZWFkT25seTogYm9vbGVhbiA9IGZhbHNlO1xuICBASW5wdXQoKVxuICBub0V4cGFuZFRvZ2dsZTogYm9vbGVhbiA9IGZhbHNlO1xuICBAVmlld0NoaWxkKCdsaXN0SXRlbScsIHsgc3RhdGljOiB0cnVlIH0pIGxpc3RJdGVtOiBMaXN0SXRlbUNvbXBvbmVudDtcbiAgcmVmcmVzaExvYWRpbmcgPSBmYWxzZTtcbiAgT1BFUkFUSU9OX1NUQVRVUyA9IE9wZXJhdGlvblN0YXR1cztcbiAgT1BFUkFUSU9OX1NUQVRVU19PUFRJT05TX01BUDogT3BlcmF0aW9uU3RhdHVzT3B0aW9uc01hcCA9IE9QRVJBVElPTl9TVEFUVVNfT1BUSU9OU19NQVA7XG4gIGRldmljZUlkOiBzdHJpbmcgfCBudW1iZXIgPVxuICAgIHRoaXMucm91dGUuc25hcHNob3QucGFyZW50Py5kYXRhLmNvbnRleHREYXRhPy5pZCB8fFxuICAgIHRoaXMucm91dGUuc25hcHNob3QuZmlyc3RDaGlsZD8uZGF0YS5jb250ZXh0RGF0YT8uaWQ7XG4gIGlzU21hcnRSdWxlc01pY3Jvc2VydmljZUF2YWlsYWJsZTogYm9vbGVhbiA9IGZhbHNlO1xuICBpbnZlbnRvcnlQZXJtaXNzaW9uczogc3RyaW5nW107XG4gIHNtYXJ0UnVsZUFkbWluUGVybWlzc2lvbnM6IHN0cmluZ1tdO1xuICBvcGVyYXRpb25UaXRsZTogc3RyaW5nO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHB1YmxpYyBidWxrT3BlcmF0aW9uTGlzdEl0ZW1TZXJ2aWNlOiBCdWxrT3BlcmF0aW9uTGlzdEl0ZW1TZXJ2aWNlLFxuICAgIHB1YmxpYyBzaGFyZWRTZXJ2aWNlOiBPcGVyYXRpb25zU2VydmljZSxcbiAgICBwdWJsaWMgb3BlcmF0aW9uc0xpc3RTZXJ2aWNlOiBPcGVyYXRpb25zTGlzdFNlcnZpY2UsXG4gICAgcHJpdmF0ZSByb3V0ZTogQWN0aXZhdGVkUm91dGUsXG4gICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlclxuICApIHt9XG5cbiAgYXN5bmMgbmdPbkluaXQoKSB7XG4gICAgdGhpcy5pc1NtYXJ0UnVsZXNNaWNyb3NlcnZpY2VBdmFpbGFibGUgPVxuICAgICAgYXdhaXQgdGhpcy5vcGVyYXRpb25zTGlzdFNlcnZpY2UuaXNTbWFydFJ1bGVzTWljcm9zZXJ2aWNlQXZhaWxhYmxlKCk7XG5cbiAgICB0aGlzLm9wZXJhdGlvblRpdGxlID1cbiAgICAgIHRoaXMub3BlcmF0aW9uLmM4eV9Db21tYW5kPy50ZXh0IHx8XG4gICAgICB0aGlzLm9wZXJhdGlvbi5kZXNjcmlwdGlvbiB8fFxuICAgICAgZ2V0dGV4dCgnTm8gY29tbWFuZCB0ZXh0IG9yIGRlc2NyaXB0aW9uIGF2YWlsYWJsZScpO1xuXG4gICAgY29uc3Qgc21hcnRSdWxlc0NyZWF0ZVBlcm1pc3Npb25zID0gdGhpcy5vcGVyYXRpb25zTGlzdFNlcnZpY2UuZ2V0U21hcnRSdWxlc0NyZWF0ZVBlcm1pc3Npb25zKCk7XG4gICAgaWYgKHNtYXJ0UnVsZXNDcmVhdGVQZXJtaXNzaW9ucykge1xuICAgICAgdGhpcy5pbnZlbnRvcnlQZXJtaXNzaW9ucyA9IHNtYXJ0UnVsZXNDcmVhdGVQZXJtaXNzaW9uc1swXS5hbnlSb2xlO1xuICAgICAgdGhpcy5zbWFydFJ1bGVBZG1pblBlcm1pc3Npb25zID0gc21hcnRSdWxlc0NyZWF0ZVBlcm1pc3Npb25zWzFdLmFueVJvbGU7XG4gICAgfVxuICB9XG5cbiAgY3JlYXRlQ3VzdG9taXplZEJ1bGtPcGVyYXRpb24oJGV2ZW50PzogRXZlbnQpIHtcbiAgICBpZiAoJGV2ZW50KSB7XG4gICAgICAkZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgfVxuXG4gICAgdGhpcy5yb3V0ZXIubmF2aWdhdGVCeVVybChgL2RldmljZWNvbnRyb2wvc2luZ2xlL2NyZWF0ZS1idWxrLyR7dGhpcy5vcGVyYXRpb24uaWR9YCk7XG4gIH1cbn1cbiJdfQ==