import { __awaiter } from "tslib";
import { Component, ContentChildren, EventEmitter, Output, ViewChild } from '@angular/core';
import { AlertService, C8yStepper, gettext, ModalService, Status } from '@c8y/ngx-components';
import { get } from 'lodash-es';
import { Subject } from 'rxjs';
import { takeUntil } from 'rxjs/operators';
import { CreateBulkOperationDetailsComponent } from '@c8y/ngx-components/operations/create-bulk-operation-details';
import { CustomStep } from './custom-step.directive';
import { BulkOperationsService } from '@c8y/ngx-components/operations/bulk-operations-service';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@c8y/ngx-components/operations/bulk-operations-service';
import * as ɵngcc2 from '@c8y/ngx-components';
import * as ɵngcc3 from '@angular/common';
import * as ɵngcc4 from '@angular/cdk/stepper';
import * as ɵngcc5 from '@c8y/ngx-components/operations/device-selector';
import * as ɵngcc6 from '@c8y/ngx-components/operations/operation-summary';
import * as ɵngcc7 from '@c8y/ngx-components/operations/create-bulk-operation-details';

function BulkOperationStepper_c8y_stepper_1_cdk_step_1_ng_container_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementContainer(0);
} }
function BulkOperationStepper_c8y_stepper_1_cdk_step_1_c8y_stepper_buttons_3_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-stepper-buttons", 23);
    ɵngcc0.ɵɵlistener("onNext", function BulkOperationStepper_c8y_stepper_1_cdk_step_1_c8y_stepper_buttons_3_Template_c8y_stepper_buttons_onNext_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r9); const step_r4 = ɵngcc0.ɵɵnextContext().$implicit; return step_r4.onNext($event); })("onCancel", function BulkOperationStepper_c8y_stepper_1_cdk_step_1_c8y_stepper_buttons_3_Template_c8y_stepper_buttons_onCancel_0_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r10 = ɵngcc0.ɵɵnextContext(3); return ctx_r10.cancel(); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const step_r4 = ɵngcc0.ɵɵnextContext().$implicit;
    ɵngcc0.ɵɵproperty("disabled", step_r4.buttonsDisabled);
} }
function BulkOperationStepper_c8y_stepper_1_cdk_step_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "cdk-step", 20);
    ɵngcc0.ɵɵpipe(1, "translate");
    ɵngcc0.ɵɵtemplate(2, BulkOperationStepper_c8y_stepper_1_cdk_step_1_ng_container_2_Template, 1, 0, "ng-container", 21);
    ɵngcc0.ɵɵtemplate(3, BulkOperationStepper_c8y_stepper_1_cdk_step_1_c8y_stepper_buttons_3_Template, 1, 1, "c8y-stepper-buttons", 22);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const step_r4 = ctx.$implicit;
    const ctx_r1 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(1, 4, step_r4.label))("completed", step_r4.completed);
    ɵngcc0.ɵɵadvance(2);
    ɵngcc0.ɵɵproperty("ngTemplateOutlet", step_r4.templateRef);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r1.showButtons);
} }
function BulkOperationStepper_c8y_stepper_1_c8y_stepper_buttons_12_Template(rf, ctx) { if (rf & 1) {
    const _r13 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-stepper-buttons", 24);
    ɵngcc0.ɵɵlistener("onNext", function BulkOperationStepper_c8y_stepper_1_c8y_stepper_buttons_12_Template_c8y_stepper_buttons_onNext_0_listener($event) { ɵngcc0.ɵɵrestoreView(_r13); const ctx_r12 = ɵngcc0.ɵɵnextContext(2); return ctx_r12.confirmDeviceSelection($event); })("onCancel", function BulkOperationStepper_c8y_stepper_1_c8y_stepper_buttons_12_Template_c8y_stepper_buttons_onCancel_0_listener() { ɵngcc0.ɵɵrestoreView(_r13); const ctx_r14 = ɵngcc0.ɵɵnextContext(2); return ctx_r14.cancel(); });
    ɵngcc0.ɵɵelementEnd();
} }
function BulkOperationStepper_c8y_stepper_1_c8y_stepper_buttons_32_Template(rf, ctx) { if (rf & 1) {
    const _r16 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-stepper-buttons", 25);
    ɵngcc0.ɵɵlistener("onCancel", function BulkOperationStepper_c8y_stepper_1_c8y_stepper_buttons_32_Template_c8y_stepper_buttons_onCancel_0_listener() { ɵngcc0.ɵɵrestoreView(_r16); const ctx_r15 = ɵngcc0.ɵɵnextContext(2); return ctx_r15.cancel(); })("onCustom", function BulkOperationStepper_c8y_stepper_1_c8y_stepper_buttons_32_Template_c8y_stepper_buttons_onCustom_0_listener() { ɵngcc0.ɵɵrestoreView(_r16); const ctx_r17 = ɵngcc0.ɵɵnextContext(2); return ctx_r17.scheduleBulkOperation(); });
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵproperty("labels", ctx_r3.stepperButtonsLabels)("pending", ctx_r3.pendingStatus)("disabled", ctx_r3.operationDetailsForm == null ? null : ctx_r3.operationDetailsForm.invalid);
} }
const _c0 = function () { return { edit: true, done: false }; };
const _c1 = function () { return ["col-xs-10", "col-sm-8", "m-t-24", "m-b-40", "p-0", "flex-no-shrink"]; };
function BulkOperationStepper_c8y_stepper_1_Template(rf, ctx) { if (rf & 1) {
    const _r19 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "c8y-stepper", 2);
    ɵngcc0.ɵɵtemplate(1, BulkOperationStepper_c8y_stepper_1_cdk_step_1_Template, 4, 6, "cdk-step", 3);
    ɵngcc0.ɵɵelementStart(2, "cdk-step", 4);
    ɵngcc0.ɵɵpipe(3, "translate");
    ɵngcc0.ɵɵelementStart(4, "div", 5);
    ɵngcc0.ɵɵelementStart(5, "div", 6);
    ɵngcc0.ɵɵelementStart(6, "div", 7);
    ɵngcc0.ɵɵelementStart(7, "h4", 8);
    ɵngcc0.ɵɵtext(8);
    ɵngcc0.ɵɵpipe(9, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(10, "div", 9);
    ɵngcc0.ɵɵelementStart(11, "c8y-device-selector", 10);
    ɵngcc0.ɵɵlistener("onDeviceQueryStringChange", function BulkOperationStepper_c8y_stepper_1_Template_c8y_device_selector_onDeviceQueryStringChange_11_listener($event) { ɵngcc0.ɵɵrestoreView(_r19); const ctx_r18 = ɵngcc0.ɵɵnextContext(); return ctx_r18.deviceQueryString = $event; });
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(12, BulkOperationStepper_c8y_stepper_1_c8y_stepper_buttons_12_Template, 1, 0, "c8y-stepper-buttons", 11);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(13, "cdk-step", 4);
    ɵngcc0.ɵɵpipe(14, "translate");
    ɵngcc0.ɵɵelementStart(15, "div", 12);
    ɵngcc0.ɵɵelementStart(16, "div", 6);
    ɵngcc0.ɵɵelementStart(17, "div", 7);
    ɵngcc0.ɵɵelementStart(18, "h4", 8);
    ɵngcc0.ɵɵtext(19);
    ɵngcc0.ɵɵpipe(20, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(21, "div", 9);
    ɵngcc0.ɵɵelementStart(22, "div", 13);
    ɵngcc0.ɵɵelementStart(23, "div", 14);
    ɵngcc0.ɵɵelementStart(24, "div", 15);
    ɵngcc0.ɵɵelementStart(25, "div", 7);
    ɵngcc0.ɵɵelement(26, "c8y-operation-summary", 16);
    ɵngcc0.ɵɵpipe(27, "translate");
    ɵngcc0.ɵɵpipe(28, "translate");
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(29, "div", 17);
    ɵngcc0.ɵɵelementStart(30, "div", 7);
    ɵngcc0.ɵɵelement(31, "c8y-create-bulk-operation-details", 18);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(32, BulkOperationStepper_c8y_stepper_1_c8y_stepper_buttons_32_Template, 1, 3, "c8y-stepper-buttons", 19);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disableDefaultIcons", ɵngcc0.ɵɵpureFunction0(26, _c0))("customClasses", ɵngcc0.ɵɵpureFunction0(27, _c1));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngForOf", ctx_r0.steps);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(3, 14, "Filter target devices"));
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(9, 16, "Filter target devices"), " ");
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("deviceTypes", ctx_r0.deviceTypes$);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.showButtons);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("label", ɵngcc0.ɵɵpipeBind1(14, 18, "Confirm and schedule bulk operation"));
    ɵngcc0.ɵɵadvance(6);
    ɵngcc0.ɵɵtextInterpolate1(" ", ɵngcc0.ɵɵpipeBind1(20, 20, "Confirm and schedule bulk operation"), " ");
    ɵngcc0.ɵɵadvance(7);
    ɵngcc0.ɵɵproperty("name", ɵngcc0.ɵɵpipeBind1(27, 22, ctx_r0.operationDetails == null ? null : ctx_r0.operationDetails.name))("description", ɵngcc0.ɵɵpipeBind1(28, 24, ctx_r0.operationDetails == null ? null : ctx_r0.operationDetails.description))("deviceQueryString", ctx_r0.deviceQueryString);
    ɵngcc0.ɵɵadvance(5);
    ɵngcc0.ɵɵproperty("bulkOperationType", ctx_r0.bulkOperationType);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.showButtons);
} }
export class BulkOperationStepper {
    constructor(bulkOperationService, modal, alert) {
        this.bulkOperationService = bulkOperationService;
        this.modal = modal;
        this.alert = alert;
        this.selectionChange = new EventEmitter();
        this.steps = [];
        this.showStepper = false;
        this.showButtons = false;
        this.stepperButtonsLabels = { custom: gettext('Schedule bulk operation') };
        this.deviceTypesSubject$ = new Subject();
        this.endSubscriptions = new Subject();
        this.deviceTypes$ = this.deviceTypesSubject$.asObservable();
    }
    ngAfterViewInit() {
        setTimeout(() => {
            // wait for the next event loop turn as `steps` has already been checked in this CD cycle
            this.steps = this.customSteps.toArray();
            this.showStepper = true;
            setTimeout(() => {
                // postpone rendering of buttons for custom steps to the point where custom steps have already been rendered
                this.showButtons = true;
                if (this.stepper) {
                    this.stepper.selectionChange.pipe(takeUntil(this.endSubscriptions)).subscribe(event => {
                        this.selectionChange.next(event);
                    });
                    this.operationDetailsForm =
                        this.createBulkOperationDetailsComponent.fgOperationDescription;
                }
            });
        });
    }
    changeDeviceTypes(deviceTypes) {
        if (deviceTypes) {
            this.deviceTypesSubject$.next(Array.isArray(deviceTypes) ? deviceTypes : [deviceTypes]);
        }
        else {
            this.deviceTypesSubject$.next([]);
        }
    }
    confirmDeviceSelection($event) {
        return __awaiter(this, void 0, void 0, function* () {
            if (!this.deviceQueryString) {
                try {
                    yield this.modal.confirm(gettext('All devices selected'), gettext('You are about to schedule the bulk operation to be executed for all devices. Do you want to proceed?'), Status.WARNING, { ok: gettext('Schedule for all devices'), cancel: gettext('Cancel and select devices') });
                    $event.step.completed = true;
                    $event.stepper.next();
                    this.operationDetails = this.retrieveOperationDetails
                        ? yield this.retrieveOperationDetails()
                        : undefined;
                }
                catch (ex) {
                    // Intentionally empty
                }
            }
            else {
                $event.step.completed = true;
                $event.stepper.next();
                this.operationDetails = this.retrieveOperationDetails
                    ? yield this.retrieveOperationDetails()
                    : undefined;
            }
            this.bulkOperationType = this.bulkOperationService.retrieveBulkOperationType(get(this.operationDetails, 'prototype'));
            if (this.operationDetailsForm &&
                get(this.operationDetailsForm, 'controls.description.pristine') &&
                this.operationDetails) {
                this.operationDetailsForm.patchValue({
                    description: get(this.operationDetails, 'prototype.description')
                });
            }
        });
    }
    cancel() {
        this.close();
    }
    scheduleBulkOperation() {
        return __awaiter(this, void 0, void 0, function* () {
            this.pendingStatus = true;
            try {
                this.operationDetails.prototype.description = get(this.operationDetailsForm, 'controls.description.value');
                this.operationDetails.note = get(this.operationDetailsForm, 'controls.note.value');
                this.operationDetails.schedule = get(this.operationDetailsForm, 'controls.schedule.value');
                yield this.bulkOperationService.scheduleBulkOperation(this.deviceQueryString, this.operationDetails);
                this.alert.success(gettext('New bulk operation scheduled.'));
                this.close();
            }
            catch (ex) {
                this.alert.addServerFailure(ex);
            }
            this.pendingStatus = false;
        });
    }
    ngOnDestroy() {
        this.endSubscriptions.next();
        this.endSubscriptions.complete();
    }
    close() {
        this.stepper.reset();
        this.bulkOperationService.returnToBulkOperationOverview();
    }
}
BulkOperationStepper.ɵfac = function BulkOperationStepper_Factory(t) { return new (t || BulkOperationStepper)(ɵngcc0.ɵɵdirectiveInject(ɵngcc1.BulkOperationsService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.ModalService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.AlertService)); };
BulkOperationStepper.ɵcmp = /*@__PURE__*/ ɵngcc0.ɵɵdefineComponent({ type: BulkOperationStepper, selectors: [["c8y-bulk-operation-stepper"]], contentQueries: function BulkOperationStepper_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, CustomStep, 4);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.customSteps = _t);
    } }, viewQuery: function BulkOperationStepper_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(C8yStepper, 5);
        ɵngcc0.ɵɵviewQuery(CreateBulkOperationDetailsComponent, 5);
    } if (rf & 2) {
        let _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.stepper = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.createBulkOperationDetailsComponent = _t.first);
    } }, outputs: { selectionChange: "selectionChange" }, decls: 2, vars: 1, consts: [[1, "fit-h"], ["class", "flex-col no-align-items fit-h c8y-stepper--no-btns a-i-center", "linear", "", 3, "disableDefaultIcons", "customClasses", 4, "ngIf"], ["linear", "", 1, "flex-col", "no-align-items", "fit-h", "c8y-stepper--no-btns", "a-i-center", 3, "disableDefaultIcons", "customClasses"], [3, "label", "completed", 4, "ngFor", "ngForOf"], [3, "label"], [1, "card-block", "p-b-0", "p-t-0", "flex-no-shrink", "separator-bottom", "col-xs-12"], [1, "flex-row", "j-c-center", "p-b-8", "p-t-4"], [1, "col-xs-12", "col-sm-6"], [1, "text-center", "text-normal", "m-b-16"], [1, "col-xs-12", "flex-grow", "no-gutter"], [3, "deviceTypes", "onDeviceQueryStringChange"], ["class", "d-block card-footer p-24 separator fit-w", 3, "onNext", "onCancel", 4, "ngIf"], [1, "card-block", "flex-no-shrink", "p-b-0", "p-t-0", "separator-bottom", "col-xs-12"], [1, "card-inner-scroll", "fit-h"], [1, "card-block", "p-b-0"], [1, "flex-row", "j-c-center", "p-t-8", "p-b-8"], [3, "name", "description", "deviceQueryString"], [1, "flex-row", "j-c-center"], [3, "bulkOperationType"], ["class", "d-block card-footer p-24 separator fit-w", 3, "labels", "pending", "disabled", "onCancel", "onCustom", 4, "ngIf"], [3, "label", "completed"], [4, "ngTemplateOutlet"], ["class", "d-block card-footer p-24 separator fit-w", 3, "disabled", "onNext", "onCancel", 4, "ngIf"], [1, "d-block", "card-footer", "p-24", "separator", "fit-w", 3, "disabled", "onNext", "onCancel"], [1, "d-block", "card-footer", "p-24", "separator", "fit-w", 3, "onNext", "onCancel"], [1, "d-block", "card-footer", "p-24", "separator", "fit-w", 3, "labels", "pending", "disabled", "onCancel", "onCustom"]], template: function BulkOperationStepper_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵtemplate(1, BulkOperationStepper_c8y_stepper_1_Template, 33, 28, "c8y-stepper", 1);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showStepper);
    } }, directives: [ɵngcc3.NgIf, ɵngcc2.C8yStepper, ɵngcc3.NgForOf, ɵngcc4.CdkStep, ɵngcc5.DeviceSelectorComponent, ɵngcc6.OperationSummaryComponent, ɵngcc7.CreateBulkOperationDetailsComponent, ɵngcc3.NgTemplateOutlet, ɵngcc2.C8yStepperButtons], pipes: [ɵngcc2.C8yTranslatePipe], encapsulation: 2 });
BulkOperationStepper.ctorParameters = () => [
    { type: BulkOperationsService },
    { type: ModalService },
    { type: AlertService }
];
BulkOperationStepper.propDecorators = {
    selectionChange: [{ type: Output }],
    customSteps: [{ type: ContentChildren, args: [CustomStep,] }],
    stepper: [{ type: ViewChild, args: [C8yStepper, { static: false },] }],
    createBulkOperationDetailsComponent: [{ type: ViewChild, args: [CreateBulkOperationDetailsComponent, { static: false },] }]
};
(function () { (typeof ngDevMode === "undefined" || ngDevMode) && ɵngcc0.ɵsetClassMetadata(BulkOperationStepper, [{
        type: Component,
        args: [{
                selector: 'c8y-bulk-operation-stepper',
                template: "<div class=\"fit-h\">\n  <c8y-stepper\n    class=\"flex-col no-align-items fit-h c8y-stepper--no-btns a-i-center\"\n    linear\n    [disableDefaultIcons]=\"{ edit: true, done: false }\"\n    [customClasses]=\"['col-xs-10', 'col-sm-8', 'm-t-24', 'm-b-40', 'p-0', 'flex-no-shrink']\"\n    *ngIf=\"showStepper\"\n  >\n    <!-- CUSTOM STEPS 1 to N-2 -->\n    <cdk-step\n      *ngFor=\"let step of steps\"\n      [label]=\"step.label | translate\"\n      [completed]=\"step.completed\"\n    >\n      <ng-container *ngTemplateOutlet=\"step.templateRef\"></ng-container>\n      <c8y-stepper-buttons\n        class=\"d-block card-footer p-24 separator fit-w\"\n        *ngIf=\"showButtons\"\n        [disabled]=\"step.buttonsDisabled\"\n        (onNext)=\"step.onNext($event)\"\n        (onCancel)=\"cancel()\"\n      ></c8y-stepper-buttons>\n    </cdk-step>\n    <!-- STEP N-1 - Data-grid -->\n    <cdk-step [label]=\"'Filter target devices' | translate\">\n      <div class=\"card-block p-b-0 p-t-0 flex-no-shrink separator-bottom col-xs-12\">\n        <div class=\"flex-row j-c-center p-b-8 p-t-4\">\n          <div class=\"col-xs-12 col-sm-6\">\n            <h4 class=\"text-center text-normal m-b-16\">\n              {{ 'Filter target devices' | translate }}\n            </h4>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"col-xs-12 flex-grow no-gutter\">\n        <c8y-device-selector\n          [deviceTypes]=\"deviceTypes$\"\n          (onDeviceQueryStringChange)=\"deviceQueryString = $event\"\n        ></c8y-device-selector>\n      </div>\n      <c8y-stepper-buttons\n        class=\"d-block card-footer p-24 separator fit-w\"\n        *ngIf=\"showButtons\"\n        (onNext)=\"confirmDeviceSelection($event)\"\n        (onCancel)=\"cancel()\"\n      ></c8y-stepper-buttons>\n    </cdk-step>\n\n    <!-- STEP N - Scheduler -->\n    <cdk-step [label]=\"'Confirm and schedule bulk operation' | translate\">\n      <div class=\"card-block flex-no-shrink p-b-0 p-t-0 separator-bottom col-xs-12\">\n        <div class=\"flex-row j-c-center p-b-8 p-t-4\">\n          <div class=\"col-xs-12 col-sm-6\">\n            <h4 class=\"text-center text-normal m-b-16\">\n              {{ 'Confirm and schedule bulk operation' | translate }}\n            </h4>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"col-xs-12 flex-grow no-gutter\">\n        <div class=\"card-inner-scroll fit-h\">\n          <div class=\"card-block p-b-0\">\n            <div class=\"flex-row j-c-center p-t-8 p-b-8\">\n              <div class=\"col-xs-12 col-sm-6\">\n                <c8y-operation-summary\n                  [name]=\"operationDetails?.name | translate\"\n                  [description]=\"operationDetails?.description | translate\"\n                  [deviceQueryString]=\"deviceQueryString\"\n                ></c8y-operation-summary>\n              </div>\n            </div>\n            <div class=\"flex-row j-c-center\">\n              <div class=\"col-xs-12 col-sm-6\">\n                <c8y-create-bulk-operation-details\n                  [bulkOperationType]=\"bulkOperationType\"\n                ></c8y-create-bulk-operation-details>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n      <c8y-stepper-buttons\n        class=\"d-block card-footer p-24 separator fit-w\"\n        *ngIf=\"showButtons\"\n        [labels]=\"stepperButtonsLabels\"\n        [pending]=\"pendingStatus\"\n        [disabled]=\"operationDetailsForm?.invalid\"\n        (onCancel)=\"cancel()\"\n        (onCustom)=\"scheduleBulkOperation()\"\n      >\n      </c8y-stepper-buttons>\n    </cdk-step>\n  </c8y-stepper>\n</div>\n"
            }]
    }], function () { return [{ type: ɵngcc1.BulkOperationsService }, { type: ɵngcc2.ModalService }, { type: ɵngcc2.AlertService }]; }, { selectionChange: [{
            type: Output
        }], customSteps: [{
            type: ContentChildren,
            args: [CustomStep]
        }], stepper: [{
            type: ViewChild,
            args: [C8yStepper, { static: false }]
        }], createBulkOperationDetailsComponent: [{
            type: ViewChild,
            args: [CreateBulkOperationDetailsComponent, { static: false }]
        }] }); })();

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVsay1vcGVyYXRpb24tc3RlcHBlci5jb21wb25lbnQuanMiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL29wZXJhdGlvbnMvYnVsay1vcGVyYXRpb24tc3RlcHBlci9idWxrLW9wZXJhdGlvbi1zdGVwcGVyLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQ0EsT0FBTyxFQUNMLFNBQVMsRUFDVCxlQUFlLEVBQ2YsWUFBWSxFQUVaLE1BQU0sRUFFTixTQUFTLEVBQ1YsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUFFLFlBQVksRUFBRSxVQUFVLEVBQUUsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLEVBQUUsTUFBTSxxQkFBcUIsQ0FBQztBQUM5RixPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sV0FBVyxDQUFDO0FBQ2hDLE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLFNBQVMsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQzNDLE9BQU8sRUFBRSxtQ0FBbUMsRUFBRSxNQUFNLDhEQUE4RCxDQUFDO0FBRW5ILE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSx5QkFBeUIsQ0FBQztBQUNyRCxPQUFPLEVBR0wscUJBQXFCLEVBQ3RCLE1BQU0sd0RBQXdELENBQUM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBTWhFLE1BQU0sT0FBTyxvQkFBb0I7QUFBRyxJQXdCbEMsWUFDVSxvQkFBMkMsRUFDM0MsS0FBbUIsRUFDbkIsS0FBbUI7QUFDNUIsUUFIUyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXVCO0FBQUMsUUFDNUMsVUFBSyxHQUFMLEtBQUssQ0FBYztBQUFDLFFBQ3BCLFVBQUssR0FBTCxLQUFLLENB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QUFLLEVBQUUsQ0FBQztBQUN6QixRQUFJLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyw2QkFBNkIsRUFBRSxDQUFDO0FBQzlELElBQUUsQ0FBQztBQUNIO2dEQTdJQyxTQUFTLFNBQUMsa0JBQ1QsUUFBUSxFQUFFLDRCQUE0QixrQkFDdEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzhTQUVHO0FBQUM7QUFBOEMsWUFQbEQscUJBQXFCO0FBQ3BCLFlBWHlDLFlBQVk7QUFBSSxZQUFuRCxZQUFZO0FBQUc7QUFBRztBQUF3Qyw4QkFrQmhFLE1BQU07QUFBSywwQkFDWCxlQUFlLFNBQUMsVUFBVTtvREFKeUIsY0FDckQsbEVBR21DLHNCQUNqQyxTQUFTLFNBQUMsVUFBVSxFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTtBQUNyQyxrREFDRixTQUFTLFNBQUMsbUNBQW1DLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO0FBQy9EOzs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENka1N0ZXAsIFN0ZXBwZXJTZWxlY3Rpb25FdmVudCB9IGZyb20gJ0Bhbmd1bGFyL2Nkay9zdGVwcGVyJztcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQ29udGVudENoaWxkcmVuLFxuICBFdmVudEVtaXR0ZXIsXG4gIE9uRGVzdHJveSxcbiAgT3V0cHV0LFxuICBRdWVyeUxpc3QsXG4gIFZpZXdDaGlsZFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IEZvcm1Hcm91cCB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IEFsZXJ0U2VydmljZSwgQzh5U3RlcHBlciwgZ2V0dGV4dCwgTW9kYWxTZXJ2aWNlLCBTdGF0dXMgfSBmcm9tICdAYzh5L25neC1jb21wb25lbnRzJztcbmltcG9ydCB7IGdldCB9IGZyb20gJ2xvZGFzaC1lcyc7XG5pbXBvcnQgeyBPYnNlcnZhYmxlLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyB0YWtlVW50aWwgfSBmcm9tICdyeGpzL29wZXJhdG9ycyc7XG5pbXBvcnQgeyBDcmVhdGVCdWxrT3BlcmF0aW9uRGV0YWlsc0NvbXBvbmVudCB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMvb3BlcmF0aW9ucy9jcmVhdGUtYnVsay1vcGVyYXRpb24tZGV0YWlscyc7XG5pbXBvcnQgeyBPcGVyYXRpb25TY2hlZHVsZSB9IGZyb20gJ0BjOHkvbmd4LWNvbXBvbmVudHMvb3BlcmF0aW9ucy9idWxrLW9wZXJhdGlvbi1zY2hlZHVsZXInO1xuaW1wb3J0IHsgQ3VzdG9tU3RlcCB9IGZyb20gJy4vY3VzdG9tLXN0ZXAuZGlyZWN0aXZlJztcbmltcG9ydCB7XG4gIE9wZXJhdGlvbkRldGFpbHMsXG4gIEJ1bGtPcGVyYXRpb25UeXBlLFxuICBCdWxrT3BlcmF0aW9uc1NlcnZpY2Vcbn0gZnJvbSAnQGM4eS9uZ3gtY29tcG9uZW50cy9vcGVyYXRpb25zL2J1bGstb3BlcmF0aW9ucy1zZXJ2aWNlJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnYzh5LWJ1bGstb3BlcmF0aW9uLXN0ZXBwZXInLFxuICB0ZW1wbGF0ZVVybDogJ2J1bGstb3BlcmF0aW9uLXN0ZXBwZXIuY29tcG9uZW50Lmh0bWwnXG59KVxuZXhwb3J0IGNsYXNzIEJ1bGtPcGVyYXRpb25TdGVwcGVyIGltcGxlbWVudHMgT25EZXN0cm95IHtcbiAgQE91dHB1dCgpIHNlbGVjdGlvbkNoYW5nZTogRXZlbnRFbWl0dGVyPFN0ZXBwZXJTZWxlY3Rpb25FdmVudD4gPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gIEBDb250ZW50Q2hpbGRyZW4oQ3VzdG9tU3RlcCkgY3VzdG9tU3RlcHM6IFF1ZXJ5TGlzdDxDdXN0b21TdGVwPjtcbiAgQFZpZXdDaGlsZChDOHlTdGVwcGVyLCB7IHN0YXRpYzogZmFsc2UgfSlcbiAgc3RlcHBlcjogQzh5U3RlcHBlcjtcbiAgQFZpZXdDaGlsZChDcmVhdGVCdWxrT3BlcmF0aW9uRGV0YWlsc0NvbXBvbmVudCwgeyBzdGF0aWM6IGZhbHNlIH0pXG4gIGNyZWF0ZUJ1bGtPcGVyYXRpb25EZXRhaWxzQ29tcG9uZW50OiBDcmVhdGVCdWxrT3BlcmF0aW9uRGV0YWlsc0NvbXBvbmVudDtcblxuICBzdGVwczogQ3VzdG9tU3RlcFtdID0gW107XG4gIHNob3dTdGVwcGVyOiBib29sZWFuID0gZmFsc2U7XG4gIHNob3dCdXR0b25zOiBib29sZWFuID0gZmFsc2U7XG4gIHBlbmRpbmdTdGF0dXM6IGJvb2xlYW47XG4gIHN0ZXBwZXJCdXR0b25zTGFiZWxzID0geyBjdXN0b206IGdldHRleHQoJ1NjaGVkdWxlIGJ1bGsgb3BlcmF0aW9uJykgfTtcbiAgZGV2aWNlVHlwZXMkOiBPYnNlcnZhYmxlPHN0cmluZ1tdPjtcbiAgZGV2aWNlUXVlcnlTdHJpbmc6IHN0cmluZztcbiAgYnVsa09wZXJhdGlvblR5cGU6IEJ1bGtPcGVyYXRpb25UeXBlO1xuICBzY2hlZHVsZURhdGE6IE9wZXJhdGlvblNjaGVkdWxlO1xuICBvcGVyYXRpb25EZXRhaWxzRm9ybTogRm9ybUdyb3VwO1xuICBvcGVyYXRpb25EZXRhaWxzOiBPcGVyYXRpb25EZXRhaWxzO1xuICByZXRyaWV2ZU9wZXJhdGlvbkRldGFpbHM6ICgpID0+IE9wZXJhdGlvbkRldGFpbHMgfCBQcm9taXNlPE9wZXJhdGlvbkRldGFpbHM+O1xuXG4gIHByaXZhdGUgZGV2aWNlVHlwZXNTdWJqZWN0JDogU3ViamVjdDxzdHJpbmdbXT4gPSBuZXcgU3ViamVjdCgpO1xuICBwcml2YXRlIGVuZFN1YnNjcmlwdGlvbnM6IFN1YmplY3Q8dm9pZD4gPSBuZXcgU3ViamVjdCgpO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgYnVsa09wZXJhdGlvblNlcnZpY2U6IEJ1bGtPcGVyYXRpb25zU2VydmljZSxcbiAgICBwcml2YXRlIG1vZGFsOiBNb2RhbFNlcnZpY2UsXG4gICAgcHJpdmF0ZSBhbGVydDogQWxlcnRTZXJ2aWNlXG4gICkge1xuICAgIHRoaXMuZGV2aWNlVHlwZXMkID0gdGhpcy5kZXZpY2VUeXBlc1N1YmplY3QkLmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgLy8gd2FpdCBmb3IgdGhlIG5leHQgZXZlbnQgbG9vcCB0dXJuIGFzIGBzdGVwc2AgaGFzIGFscmVhZHkgYmVlbiBjaGVja2VkIGluIHRoaXMgQ0QgY3ljbGVcbiAgICAgIHRoaXMuc3RlcHMgPSB0aGlzLmN1c3RvbVN0ZXBzLnRvQXJyYXkoKTtcbiAgICAgIHRoaXMuc2hvd1N0ZXBwZXIgPSB0cnVlO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIC8vIHBvc3Rwb25lIHJlbmRlcmluZyBvZiBidXR0b25zIGZvciBjdXN0b20gc3RlcHMgdG8gdGhlIHBvaW50IHdoZXJlIGN1c3RvbSBzdGVwcyBoYXZlIGFscmVhZHkgYmVlbiByZW5kZXJlZFxuICAgICAgICB0aGlzLnNob3dCdXR0b25zID0gdHJ1ZTtcbiAgICAgICAgaWYgKHRoaXMuc3RlcHBlcikge1xuICAgICAgICAgIHRoaXMuc3RlcHBlci5zZWxlY3Rpb25DaGFuZ2UucGlwZSh0YWtlVW50aWwodGhpcy5lbmRTdWJzY3JpcHRpb25zKSkuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0aW9uQ2hhbmdlLm5leHQoZXZlbnQpO1xuICAgICAgICAgIH0pO1xuICAgICAgICAgIHRoaXMub3BlcmF0aW9uRGV0YWlsc0Zvcm0gPVxuICAgICAgICAgICAgdGhpcy5jcmVhdGVCdWxrT3BlcmF0aW9uRGV0YWlsc0NvbXBvbmVudC5mZ09wZXJhdGlvbkRlc2NyaXB0aW9uO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGNoYW5nZURldmljZVR5cGVzKGRldmljZVR5cGVzOiBzdHJpbmcgfCBzdHJpbmdbXSkge1xuICAgIGlmIChkZXZpY2VUeXBlcykge1xuICAgICAgdGhpcy5kZXZpY2VUeXBlc1N1YmplY3QkLm5leHQoQXJyYXkuaXNBcnJheShkZXZpY2VUeXBlcykgPyBkZXZpY2VUeXBlcyA6IFtkZXZpY2VUeXBlc10pO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmRldmljZVR5cGVzU3ViamVjdCQubmV4dChbXSk7XG4gICAgfVxuICB9XG5cbiAgYXN5bmMgY29uZmlybURldmljZVNlbGVjdGlvbigkZXZlbnQ6IHsgc3RlcHBlcjogQzh5U3RlcHBlcjsgc3RlcDogQ2RrU3RlcCB9KSB7XG4gICAgaWYgKCF0aGlzLmRldmljZVF1ZXJ5U3RyaW5nKSB7XG4gICAgICB0cnkge1xuICAgICAgICBhd2FpdCB0aGlzLm1vZGFsLmNvbmZpcm0oXG4gICAgICAgICAgZ2V0dGV4dCgnQWxsIGRldmljZXMgc2VsZWN0ZWQnKSxcbiAgICAgICAgICBnZXR0ZXh0KFxuICAgICAgICAgICAgJ1lvdSBhcmUgYWJvdXQgdG8gc2NoZWR1bGUgdGhlIGJ1bGsgb3BlcmF0aW9uIHRvIGJlIGV4ZWN1dGVkIGZvciBhbGwgZGV2aWNlcy4gRG8geW91IHdhbnQgdG8gcHJvY2VlZD8nXG4gICAgICAgICAgKSxcbiAgICAgICAgICBTdGF0dXMuV0FSTklORyxcbiAgICAgICAgICB7IG9rOiBnZXR0ZXh0KCdTY2hlZHVsZSBmb3IgYWxsIGRldmljZXMnKSwgY2FuY2VsOiBnZXR0ZXh0KCdDYW5jZWwgYW5kIHNlbGVjdCBkZXZpY2VzJykgfVxuICAgICAgICApO1xuICAgICAgICAkZXZlbnQuc3RlcC5jb21wbGV0ZWQgPSB0cnVlO1xuICAgICAgICAkZXZlbnQuc3RlcHBlci5uZXh0KCk7XG4gICAgICAgIHRoaXMub3BlcmF0aW9uRGV0YWlscyA9IHRoaXMucmV0cmlldmVPcGVyYXRpb25EZXRhaWxzXG4gICAgICAgICAgPyBhd2FpdCB0aGlzLnJldHJpZXZlT3BlcmF0aW9uRGV0YWlscygpXG4gICAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgICB9IGNhdGNoIChleCkge1xuICAgICAgICAvLyBJbnRlbnRpb25hbGx5IGVtcHR5XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICRldmVudC5zdGVwLmNvbXBsZXRlZCA9IHRydWU7XG4gICAgICAkZXZlbnQuc3RlcHBlci5uZXh0KCk7XG4gICAgICB0aGlzLm9wZXJhdGlvbkRldGFpbHMgPSB0aGlzLnJldHJpZXZlT3BlcmF0aW9uRGV0YWlsc1xuICAgICAgICA/IGF3YWl0IHRoaXMucmV0cmlldmVPcGVyYXRpb25EZXRhaWxzKClcbiAgICAgICAgOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgdGhpcy5idWxrT3BlcmF0aW9uVHlwZSA9IHRoaXMuYnVsa09wZXJhdGlvblNlcnZpY2UucmV0cmlldmVCdWxrT3BlcmF0aW9uVHlwZShcbiAgICAgIGdldCh0aGlzLm9wZXJhdGlvbkRldGFpbHMsICdwcm90b3R5cGUnKVxuICAgICk7XG4gICAgaWYgKFxuICAgICAgdGhpcy5vcGVyYXRpb25EZXRhaWxzRm9ybSAmJlxuICAgICAgZ2V0KHRoaXMub3BlcmF0aW9uRGV0YWlsc0Zvcm0sICdjb250cm9scy5kZXNjcmlwdGlvbi5wcmlzdGluZScpICYmXG4gICAgICB0aGlzLm9wZXJhdGlvbkRldGFpbHNcbiAgICApIHtcbiAgICAgIHRoaXMub3BlcmF0aW9uRGV0YWlsc0Zvcm0ucGF0Y2hWYWx1ZSh7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBnZXQodGhpcy5vcGVyYXRpb25EZXRhaWxzLCAncHJvdG90eXBlLmRlc2NyaXB0aW9uJylcbiAgICAgIH0pO1xuICAgIH1cbiAgfVxuXG4gIGNhbmNlbCgpIHtcbiAgICB0aGlzLmNsb3NlKCk7XG4gIH1cblxuICBhc3luYyBzY2hlZHVsZUJ1bGtPcGVyYXRpb24oKSB7XG4gICAgdGhpcy5wZW5kaW5nU3RhdHVzID0gdHJ1ZTtcblxuICAgIHRyeSB7XG4gICAgICB0aGlzLm9wZXJhdGlvbkRldGFpbHMucHJvdG90eXBlLmRlc2NyaXB0aW9uID0gZ2V0KFxuICAgICAgICB0aGlzLm9wZXJhdGlvbkRldGFpbHNGb3JtLFxuICAgICAgICAnY29udHJvbHMuZGVzY3JpcHRpb24udmFsdWUnXG4gICAgICApO1xuICAgICAgdGhpcy5vcGVyYXRpb25EZXRhaWxzLm5vdGUgPSBnZXQodGhpcy5vcGVyYXRpb25EZXRhaWxzRm9ybSwgJ2NvbnRyb2xzLm5vdGUudmFsdWUnKTtcbiAgICAgIHRoaXMub3BlcmF0aW9uRGV0YWlscy5zY2hlZHVsZSA9IGdldCh0aGlzLm9wZXJhdGlvbkRldGFpbHNGb3JtLCAnY29udHJvbHMuc2NoZWR1bGUudmFsdWUnKTtcblxuICAgICAgYXdhaXQgdGhpcy5idWxrT3BlcmF0aW9uU2VydmljZS5zY2hlZHVsZUJ1bGtPcGVyYXRpb24oXG4gICAgICAgIHRoaXMuZGV2aWNlUXVlcnlTdHJpbmcsXG4gICAgICAgIHRoaXMub3BlcmF0aW9uRGV0YWlsc1xuICAgICAgKTtcbiAgICAgIHRoaXMuYWxlcnQuc3VjY2VzcyhnZXR0ZXh0KCdOZXcgYnVsayBvcGVyYXRpb24gc2NoZWR1bGVkLicpKTtcbiAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICB9IGNhdGNoIChleCkge1xuICAgICAgdGhpcy5hbGVydC5hZGRTZXJ2ZXJGYWlsdXJlKGV4KTtcbiAgICB9XG5cbiAgICB0aGlzLnBlbmRpbmdTdGF0dXMgPSBmYWxzZTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZW5kU3Vic2NyaXB0aW9ucy5uZXh0KCk7XG4gICAgdGhpcy5lbmRTdWJzY3JpcHRpb25zLmNvbXBsZXRlKCk7XG4gIH1cblxuICBwcml2YXRlIGNsb3NlKCkge1xuICAgIHRoaXMuc3RlcHBlci5yZXNldCgpO1xuICAgIHRoaXMuYnVsa09wZXJhdGlvblNlcnZpY2UucmV0dXJuVG9CdWxrT3BlcmF0aW9uT3ZlcnZpZXcoKTtcbiAgfVxufVxuIl19