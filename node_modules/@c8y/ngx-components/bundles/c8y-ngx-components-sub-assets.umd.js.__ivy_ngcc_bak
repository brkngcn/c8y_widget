(function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports, require('@angular/core'), require('@c8y/client'), require('@c8y/ngx-components'), require('@c8y/ngx-components/assets-navigator'), require('@ngx-translate/core'), require('@c8y/ngx-components/device-grid'), require('@c8y/client'), require('@c8y/client'), require('@c8y/client'), require('@c8y/client'), require('@angular/router'), require('ngx-bootstrap/modal'), require('rxjs'), require('ngx-bootstrap/popover'), require('@angular/forms')) :
    typeof define === 'function' && define.amd ? define('@c8y/ngx-components/sub-assets', ['exports', '@angular/core', '@c8y/client', '@c8y/ngx-components', '@c8y/ngx-components/assets-navigator', '@ngx-translate/core', '@c8y/ngx-components/device-grid', '@c8y/client', '@c8y/client', '@c8y/client', '@c8y/client', '@angular/router', 'ngx-bootstrap/modal', 'rxjs', 'ngx-bootstrap/popover', '@angular/forms'], factory) :
    (global = typeof globalThis !== 'undefined' ? globalThis : global || self, factory((global.c8y = global.c8y || {}, global.c8y["ngx-components"] = global.c8y["ngx-components"] || {}, global.c8y["ngx-components"]["sub-assets"] = {}), global.ng.core, global.client, global.c8y["ngx-components"], global.c8y["ngx-components"]["assets-navigator"], global.i1, global.c8y["ngx-components"]["device-grid"], global.i2, global.i3, global.i6, global.i7, global.ng.router, global.modal, global.rxjs, global.popover, global.ng.forms));
})(this, (function (exports, i0, client, i4, i5, i1, deviceGrid, i2, i3, i6, i7, router, modal, rxjs, popover, forms) { 'use strict';

    function _interopNamespace(e) {
        if (e && e.__esModule) return e;
        var n = Object.create(null);
        if (e) {
            Object.keys(e).forEach(function (k) {
                if (k !== 'default') {
                    var d = Object.getOwnPropertyDescriptor(e, k);
                    Object.defineProperty(n, k, d.get ? d : {
                        enumerable: true,
                        get: function () { return e[k]; }
                    });
                }
            });
        }
        n["default"] = e;
        return Object.freeze(n);
    }

    var i0__namespace = /*#__PURE__*/_interopNamespace(i0);
    var i4__namespace = /*#__PURE__*/_interopNamespace(i4);
    var i5__namespace = /*#__PURE__*/_interopNamespace(i5);
    var i1__namespace = /*#__PURE__*/_interopNamespace(i1);
    var i2__namespace = /*#__PURE__*/_interopNamespace(i2);
    var i3__namespace = /*#__PURE__*/_interopNamespace(i3);
    var i6__namespace = /*#__PURE__*/_interopNamespace(i6);
    var i7__namespace = /*#__PURE__*/_interopNamespace(i7);

    /*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */
    /* global Reflect, Promise */
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b)
                if (Object.prototype.hasOwnProperty.call(b, p))
                    d[p] = b[p]; };
        return extendStatics(d, b);
    };
    function __extends(d, b) {
        if (typeof b !== "function" && b !== null)
            throw new TypeError("Class extends value " + String(b) + " is not a constructor or null");
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    }
    var __assign = function () {
        __assign = Object.assign || function __assign(t) {
            for (var s, i = 1, n = arguments.length; i < n; i++) {
                s = arguments[i];
                for (var p in s)
                    if (Object.prototype.hasOwnProperty.call(s, p))
                        t[p] = s[p];
            }
            return t;
        };
        return __assign.apply(this, arguments);
    };
    function __rest(s, e) {
        var t = {};
        for (var p in s)
            if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
                t[p] = s[p];
        if (s != null && typeof Object.getOwnPropertySymbols === "function")
            for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {
                if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))
                    t[p[i]] = s[p[i]];
            }
        return t;
    }
    function __decorate(decorators, target, key, desc) {
        var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
        if (typeof Reflect === "object" && typeof Reflect.decorate === "function")
            r = Reflect.decorate(decorators, target, key, desc);
        else
            for (var i = decorators.length - 1; i >= 0; i--)
                if (d = decorators[i])
                    r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
        return c > 3 && r && Object.defineProperty(target, key, r), r;
    }
    function __param(paramIndex, decorator) {
        return function (target, key) { decorator(target, key, paramIndex); };
    }
    function __metadata(metadataKey, metadataValue) {
        if (typeof Reflect === "object" && typeof Reflect.metadata === "function")
            return Reflect.metadata(metadataKey, metadataValue);
    }
    function __awaiter(thisArg, _arguments, P, generator) {
        function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }
        return new (P || (P = Promise))(function (resolve, reject) {
            function fulfilled(value) { try {
                step(generator.next(value));
            }
            catch (e) {
                reject(e);
            } }
            function rejected(value) { try {
                step(generator["throw"](value));
            }
            catch (e) {
                reject(e);
            } }
            function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }
            step((generator = generator.apply(thisArg, _arguments || [])).next());
        });
    }
    function __generator(thisArg, body) {
        var _ = { label: 0, sent: function () { if (t[0] & 1)
                throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
        return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function () { return this; }), g;
        function verb(n) { return function (v) { return step([n, v]); }; }
        function step(op) {
            if (f)
                throw new TypeError("Generator is already executing.");
            while (_)
                try {
                    if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done)
                        return t;
                    if (y = 0, t)
                        op = [op[0] & 2, t.value];
                    switch (op[0]) {
                        case 0:
                        case 1:
                            t = op;
                            break;
                        case 4:
                            _.label++;
                            return { value: op[1], done: false };
                        case 5:
                            _.label++;
                            y = op[1];
                            op = [0];
                            continue;
                        case 7:
                            op = _.ops.pop();
                            _.trys.pop();
                            continue;
                        default:
                            if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {
                                _ = 0;
                                continue;
                            }
                            if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) {
                                _.label = op[1];
                                break;
                            }
                            if (op[0] === 6 && _.label < t[1]) {
                                _.label = t[1];
                                t = op;
                                break;
                            }
                            if (t && _.label < t[2]) {
                                _.label = t[2];
                                _.ops.push(op);
                                break;
                            }
                            if (t[2])
                                _.ops.pop();
                            _.trys.pop();
                            continue;
                    }
                    op = body.call(thisArg, _);
                }
                catch (e) {
                    op = [6, e];
                    y = 0;
                }
                finally {
                    f = t = 0;
                }
            if (op[0] & 5)
                throw op[1];
            return { value: op[0] ? op[1] : void 0, done: true };
        }
    }
    var __createBinding = Object.create ? (function (o, m, k, k2) {
        if (k2 === undefined)
            k2 = k;
        Object.defineProperty(o, k2, { enumerable: true, get: function () { return m[k]; } });
    }) : (function (o, m, k, k2) {
        if (k2 === undefined)
            k2 = k;
        o[k2] = m[k];
    });
    function __exportStar(m, o) {
        for (var p in m)
            if (p !== "default" && !Object.prototype.hasOwnProperty.call(o, p))
                __createBinding(o, m, p);
    }
    function __values(o) {
        var s = typeof Symbol === "function" && Symbol.iterator, m = s && o[s], i = 0;
        if (m)
            return m.call(o);
        if (o && typeof o.length === "number")
            return {
                next: function () {
                    if (o && i >= o.length)
                        o = void 0;
                    return { value: o && o[i++], done: !o };
                }
            };
        throw new TypeError(s ? "Object is not iterable." : "Symbol.iterator is not defined.");
    }
    function __read(o, n) {
        var m = typeof Symbol === "function" && o[Symbol.iterator];
        if (!m)
            return o;
        var i = m.call(o), r, ar = [], e;
        try {
            while ((n === void 0 || n-- > 0) && !(r = i.next()).done)
                ar.push(r.value);
        }
        catch (error) {
            e = { error: error };
        }
        finally {
            try {
                if (r && !r.done && (m = i["return"]))
                    m.call(i);
            }
            finally {
                if (e)
                    throw e.error;
            }
        }
        return ar;
    }
    /** @deprecated */
    function __spread() {
        for (var ar = [], i = 0; i < arguments.length; i++)
            ar = ar.concat(__read(arguments[i]));
        return ar;
    }
    /** @deprecated */
    function __spreadArrays() {
        for (var s = 0, i = 0, il = arguments.length; i < il; i++)
            s += arguments[i].length;
        for (var r = Array(s), k = 0, i = 0; i < il; i++)
            for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
                r[k] = a[j];
        return r;
    }
    function __spreadArray(to, from, pack) {
        if (pack || arguments.length === 2)
            for (var i = 0, l = from.length, ar; i < l; i++) {
                if (ar || !(i in from)) {
                    if (!ar)
                        ar = Array.prototype.slice.call(from, 0, i);
                    ar[i] = from[i];
                }
            }
        return to.concat(ar || Array.prototype.slice.call(from));
    }
    function __await(v) {
        return this instanceof __await ? (this.v = v, this) : new __await(v);
    }
    function __asyncGenerator(thisArg, _arguments, generator) {
        if (!Symbol.asyncIterator)
            throw new TypeError("Symbol.asyncIterator is not defined.");
        var g = generator.apply(thisArg, _arguments || []), i, q = [];
        return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
        function verb(n) { if (g[n])
            i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
        function resume(n, v) { try {
            step(g[n](v));
        }
        catch (e) {
            settle(q[0][3], e);
        } }
        function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
        function fulfill(value) { resume("next", value); }
        function reject(value) { resume("throw", value); }
        function settle(f, v) { if (f(v), q.shift(), q.length)
            resume(q[0][0], q[0][1]); }
    }
    function __asyncDelegator(o) {
        var i, p;
        return i = {}, verb("next"), verb("throw", function (e) { throw e; }), verb("return"), i[Symbol.iterator] = function () { return this; }, i;
        function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }
    }
    function __asyncValues(o) {
        if (!Symbol.asyncIterator)
            throw new TypeError("Symbol.asyncIterator is not defined.");
        var m = o[Symbol.asyncIterator], i;
        return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
        function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
        function settle(resolve, reject, d, v) { Promise.resolve(v).then(function (v) { resolve({ value: v, done: d }); }, reject); }
    }
    function __makeTemplateObject(cooked, raw) {
        if (Object.defineProperty) {
            Object.defineProperty(cooked, "raw", { value: raw });
        }
        else {
            cooked.raw = raw;
        }
        return cooked;
    }
    ;
    var __setModuleDefault = Object.create ? (function (o, v) {
        Object.defineProperty(o, "default", { enumerable: true, value: v });
    }) : function (o, v) {
        o["default"] = v;
    };
    function __importStar(mod) {
        if (mod && mod.__esModule)
            return mod;
        var result = {};
        if (mod != null)
            for (var k in mod)
                if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k))
                    __createBinding(result, mod, k);
        __setModuleDefault(result, mod);
        return result;
    }
    function __importDefault(mod) {
        return (mod && mod.__esModule) ? mod : { default: mod };
    }
    function __classPrivateFieldGet(receiver, state, kind, f) {
        if (kind === "a" && !f)
            throw new TypeError("Private accessor was defined without a getter");
        if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver))
            throw new TypeError("Cannot read private member from an object whose class did not declare it");
        return kind === "m" ? f : kind === "a" ? f.call(receiver) : f ? f.value : state.get(receiver);
    }
    function __classPrivateFieldSet(receiver, state, value, kind, f) {
        if (kind === "m")
            throw new TypeError("Private method is not writable");
        if (kind === "a" && !f)
            throw new TypeError("Private accessor was defined without a setter");
        if (typeof state === "function" ? receiver !== state || !f : !state.has(receiver))
            throw new TypeError("Cannot write private member to an object whose class did not declare it");
        return (kind === "a" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value)), value;
    }

    var AssetTypeCellRendererComponent = /** @class */ (function () {
        function AssetTypeCellRendererComponent(context, assetNodeService) {
            this.context = context;
            this.assetNodeService = assetNodeService;
        }
        AssetTypeCellRendererComponent.prototype.ngOnInit = function () {
            this.isAnyGroup = this.assetNodeService.isAnyGroup(this.context.item);
            this.groupIcon = this.assetNodeService.icon(this.context.item);
            this.isDevice = this.assetNodeService.isDevice(this.context.item);
            this.isAsset = this.assetNodeService.isAsset(this.context.item);
            this.iconTitle = this.getIconTitle(this.groupIcon);
        };
        AssetTypeCellRendererComponent.prototype.getIconTitle = function (icon) {
            if (this.isAsset) {
                return this.context.item.type;
            }
            switch (icon) {
                case 'c8y-group':
                    return i4.gettext('Group');
                case 'c8y-group-smart':
                    return i4.gettext('Smart group');
                case 'c8y-group-remote-inactive':
                    return 'Inactive remote group';
                case 'c8y-group-remote':
                    return i4.gettext('Remote group');
                case 'exchange':
                    return i4.gettext('Device');
                default:
                    return i4.gettext('Asset');
            }
        };
        return AssetTypeCellRendererComponent;
    }());
    AssetTypeCellRendererComponent.decorators = [
        { type: i0.Component, args: [{
                    template: "<device-status class=\"m-l-8\" [mo]=\"context.item\" *ngIf=\"isDevice\"></device-status>\n<i\n  [c8yIcon]=\"groupIcon\"\n  title=\"{{ iconTitle | translate }}\"\n  class=\"m-l-8 c8y-icon-duocolor\"\n  *ngIf=\"isAnyGroup || !isDevice\"\n></i>\n"
                },] }
    ];
    AssetTypeCellRendererComponent.ctorParameters = function () { return [
        { type: i4.CellRendererContext },
        { type: i5.AssetNodeService }
    ]; };

    var AssetTypeGridColumn = /** @class */ (function (_super) {
        __extends(AssetTypeGridColumn, _super);
        function AssetTypeGridColumn(initialColumnConfig) {
            var _this = _super.call(this, initialColumnConfig) || this;
            _this.name = 'type';
            _this.header = i4.gettext('Type');
            _this.dataType = "icon" /* Icon */;
            _this.cellRendererComponent = AssetTypeCellRendererComponent;
            _this.sortable = true;
            _this.sortingConfig = {
                pathSortingConfigs: [{ path: "c8y_IsDeviceGroup" }]
            };
            _this.filterable = true;
            _this.filteringConfig = {
                fields: i4.getBasicInputArrayFormFieldConfig({
                    key: 'types',
                    label: i4.gettext('Show items with type'),
                    addText: i4.gettext('Add next`type`'),
                    tooltip: i4.gettext('Use * as a wildcard character'),
                    placeholder: i4.gettext('building`e.g. house`')
                }),
                getFilter: function (model) {
                    var filter = {};
                    if (model.types.length) {
                        filter.type = { __in: model.types };
                    }
                    return filter;
                }
            };
            return _this;
        }
        return AssetTypeGridColumn;
    }(deviceGrid.BaseDeviceGridColumn));

    var SubAssetsService = /** @class */ (function (_super) {
        __extends(SubAssetsService, _super);
        function SubAssetsService(translateService, inventoryService, userService, appState, user, assetNodeService, smartGroupsService, smartRulesService, alertService, permissionsService, modal, assetTypes, userPreferencesService, gainsightService) {
            var _this = _super.call(this, inventoryService, userService, translateService, alertService, modal, undefined, userPreferencesService, gainsightService) || this;
            _this.translateService = translateService;
            _this.inventoryService = inventoryService;
            _this.userService = userService;
            _this.appState = appState;
            _this.user = user;
            _this.assetNodeService = assetNodeService;
            _this.smartGroupsService = smartGroupsService;
            _this.smartRulesService = smartRulesService;
            _this.alertService = alertService;
            _this.permissionsService = permissionsService;
            _this.modal = modal;
            _this.assetTypes = assetTypes;
            _this.userPreferencesService = userPreferencesService;
            _this.gainsightService = gainsightService;
            _this.GRID_CONFIG_DEFAULT_STORAGE_KEY = 'sub-assets-grid-config';
            _this.IS_DEVICE_GROUP_FRAGMENT = 'c8y_IsDeviceGroup';
            _this.IS_DYNAMIC_GROUP_FRAGMENT = 'c8y_IsDynamicGroup';
            return _this;
        }
        SubAssetsService.prototype.getCustomProperties = function (group) {
            return __awaiter(this, void 0, void 0, function () {
                var assetType, data;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            assetType = this.assetTypes.getAssetTypeByName(group.type);
                            if (!assetType) return [3 /*break*/, 2];
                            return [4 /*yield*/, this.inventoryService.childAdditionsList(assetType, {
                                    pageSize: 2000,
                                    fragmentType: 'c8y_IsAssetProperty'
                                })];
                        case 1:
                            data = (_a.sent()).data;
                            return [2 /*return*/, data];
                        case 2: return [2 /*return*/, []];
                    }
                });
            });
        };
        SubAssetsService.prototype.getDefaultColumns = function (filterable, sortable) {
            if (filterable === void 0) { filterable = true; }
            if (sortable === void 0) { sortable = true; }
            var defaultColumns = [
                new AssetTypeGridColumn({ sortOrder: 'desc' }),
                new deviceGrid.NameDeviceGridColumn({ sortOrder: 'asc' }),
                new deviceGrid.ModelDeviceGridColumn(),
                new deviceGrid.SerialNumberDeviceGridColumn({ visible: false }),
                new deviceGrid.RegistrationDateDeviceGridColumn({ visible: false }),
                new deviceGrid.SystemIdDeviceGridColumn({ visible: false }),
                new deviceGrid.ImeiDeviceGridColumn({ visible: false }),
                new deviceGrid.AlarmsDeviceGridColumn()
            ];
            return defaultColumns;
        };
        SubAssetsService.prototype.getDefaultPagination = function () {
            var pagination = this.getConfig().pagination;
            return {
                pageSize: pagination.pageSize,
                currentPage: 1
            };
        };
        SubAssetsService.prototype.getDefaultActionControls = function () {
            return [];
        };
        SubAssetsService.prototype.unassignAsset = function (asset, parentRef) {
            return __awaiter(this, void 0, void 0, function () {
                var assetId, parentId, alertMessage, error_1, alertMessage;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            assetId = asset.id;
                            parentId = parentRef.id;
                            if (!this.isDevice(asset)) return [3 /*break*/, 6];
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4 /*yield*/, this.inventoryService.childAssetsRemove(assetId, parentId)];
                        case 2:
                            _a.sent();
                            alertMessage = this.translateService.instant(i4.gettext('Asset unassigned.'));
                            this.alertService.success(alertMessage);
                            return [3 /*break*/, 4];
                        case 3:
                            error_1 = _a.sent();
                            alertMessage = this.translateService.instant(i4.gettext('Could not unassign asset.'));
                            this.alertService.danger(alertMessage);
                            return [3 /*break*/, 4];
                        case 4: return [4 /*yield*/, this.deactivateSmartrulesForAsset(asset, parentRef)];
                        case 5:
                            _a.sent();
                            _a.label = 6;
                        case 6: return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsService.prototype.isDevice = function (asset) {
            return (!asset.hasOwnProperty(this.IS_DEVICE_GROUP_FRAGMENT) &&
                !asset.hasOwnProperty(this.IS_DYNAMIC_GROUP_FRAGMENT));
        };
        SubAssetsService.prototype.deleteAsset = function (asset, parentRef, params) {
            if (params === void 0) { params = {}; }
            return __awaiter(this, void 0, void 0, function () {
                var isGroup;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            isGroup = asset.hasOwnProperty(this.IS_DEVICE_GROUP_FRAGMENT) ||
                                this.smartGroupsService.isSmartGroup(asset);
                            if (!isGroup) return [3 /*break*/, 2];
                            return [4 /*yield*/, this.deleteGroup(asset, params)];
                        case 1:
                            _a.sent();
                            return [3 /*break*/, 4];
                        case 2: return [4 /*yield*/, this.deleteDevice(asset, params)];
                        case 3:
                            _a.sent();
                            _a.label = 4;
                        case 4:
                            if (!(parentRef &&
                                !this.smartGroupsService.isSmartGroup(asset) &&
                                !this.smartGroupsService.isSmartGroupV2(asset))) return [3 /*break*/, 6];
                            return [4 /*yield*/, this.deactivateSmartrulesForAsset(asset, parentRef)];
                        case 5:
                            _a.sent();
                            _a.label = 6;
                        case 6: return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsService.prototype.shouldShowWithDeviceUserCheckbox = function (asset) {
            var owner = asset.owner, isRootDevice = asset.c8y_IsDevice;
            var hasDeviceUserAsOwner = asset.owner && this.isDeviceUser(owner);
            return Boolean(isRootDevice && hasDeviceUserAsOwner);
        };
        SubAssetsService.prototype.getDefaultBulkActionControls = function () {
            return [];
        };
        SubAssetsService.prototype.getData = function (columns, pagination, parentReference, baseQuery) {
            if (baseQuery === void 0) { baseQuery = {}; }
            return __awaiter(this, void 0, void 0, function () {
                var isRoot, query, filters;
                return __generator(this, function (_a) {
                    isRoot = !parentReference;
                    if (isRoot) {
                        query = this.buildCombinedRootQueryFilter(columns, pagination);
                        return [2 /*return*/, this.assetNodeService.getRootNodes(Object.assign(Object.assign({}, pagination), { query: query }))];
                    }
                    filters = Object.assign(Object.assign({}, this.getAssetsFilters(columns, pagination, baseQuery)), { withParents: false });
                    if (this.assetNodeService.isGroup(parentReference)) {
                        return [2 /*return*/, this.assetNodeService.getGroupItems(parentReference.id, filters)];
                    }
                    if (this.assetNodeService.isDynamicGroup(parentReference)) {
                        return [2 /*return*/, this.assetNodeService.getDynamicGroupItems(parentReference.c8y_DeviceQueryString, filters)];
                    }
                    if (this.assetNodeService.isDevice(parentReference)) {
                        return [2 /*return*/, this.assetNodeService.getDeviceChildren(parentReference.id, filters)];
                    }
                    return [2 /*return*/];
                });
            });
        };
        SubAssetsService.prototype.getCount = function (columns, pagination, parentReference, baseQuery) {
            if (baseQuery === void 0) { baseQuery = {}; }
            return __awaiter(this, void 0, void 0, function () {
                var defaultFilters, filters;
                return __generator(this, function (_a) {
                    defaultFilters = {
                        pageSize: 1,
                        withChildren: false
                    };
                    filters = !parentReference
                        ? Object.assign({ query: this.buildCombinedRootQueryFilter(columns, pagination) }, defaultFilters) : Object.assign(Object.assign({}, this.getAssetsFilters(columns, pagination, baseQuery)), defaultFilters);
                    return [2 /*return*/, this.getAssetsStatistics(parentReference, filters)];
                });
            });
        };
        SubAssetsService.prototype.getTotal = function (parentReference, baseQuery) {
            if (baseQuery === void 0) { baseQuery = {}; }
            var queryFilter = this.assetNodeService.rootQueryFilter();
            var query = !parentReference
                ? this.queriesUtil.addAndFilter(queryFilter, baseQuery)
                : baseQuery;
            var filters = {
                query: this.queriesUtil.buildQuery(query),
                withChildren: false,
                withTotalPages: true,
                pageSize: 1
            };
            return this.getAssetsStatistics(parentReference, filters);
        };
        SubAssetsService.prototype.canEditGroup = function (group) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, this.permissionsService.canEdit(['ROLE_INVENTORY_ADMIN'], group)];
                        case 1: return [2 /*return*/, _a.sent()];
                    }
                });
            });
        };
        SubAssetsService.prototype.canCreateGroup = function () {
            var currentUser = this.appState.currentUser.value;
            var hasAdminRole = this.user.hasAnyRole(currentUser, [
                'ROLE_INVENTORY_ADMIN',
                'ROLE_INVENTORY_CREATE'
            ]);
            return hasAdminRole;
        };
        SubAssetsService.prototype.canAssignDevice = function (group) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0: return [4 /*yield*/, this.permissionsService.canEdit(['ROLE_INVENTORY_ADMIN'], group)];
                        case 1: return [2 /*return*/, _a.sent()];
                    }
                });
            });
        };
        SubAssetsService.prototype.canEditSmartGroup = function () {
            var SMART_GROUPS_ROLES_EDIT = ['ROLE_SMARTGROUP_UPDATE', 'ROLE_SMARTGROUP_ADMIN'];
            return this.permissionsService.hasAnyRole(SMART_GROUPS_ROLES_EDIT);
        };
        SubAssetsService.prototype.canDeleteSmartGroup = function () {
            var SMART_GROUPS_ROLES_DELETE = ['ROLE_SMARTGROUP_ADMIN', 'ROLE_INVENTORY_ADMIN'];
            return this.permissionsService.hasAnyRole(SMART_GROUPS_ROLES_DELETE);
        };
        SubAssetsService.prototype.isSmartGroup = function (group) {
            return (this.smartGroupsService.isSmartGroup(group) || this.smartGroupsService.isSmartGroupV2(group));
        };
        SubAssetsService.prototype.isUsingInventoryRoles = function () {
            var currentUser = this.appState.currentUser.value;
            var hasAnyInventoryRole = this.user.hasAnyRole(currentUser, [
                'ROLE_INVENTORY_ADMIN',
                'ROLE_INVENTORY_READ',
                'ROLE_INVENTORY_CREATE'
            ]);
            return !hasAnyInventoryRole;
        };
        SubAssetsService.prototype.getAssetsStatistics = function (parentReference, filters) {
            return __awaiter(this, void 0, void 0, function () {
                var isRoot;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            isRoot = !parentReference;
                            if (!isRoot) return [3 /*break*/, 2];
                            return [4 /*yield*/, this.assetNodeService.getRootNodes(filters)];
                        case 1: return [2 /*return*/, (_a.sent()).paging.totalPages];
                        case 2:
                            if (!this.assetNodeService.isGroup(parentReference)) return [3 /*break*/, 4];
                            return [4 /*yield*/, this.assetNodeService.getGroupItems(parentReference.id, filters)];
                        case 3: return [2 /*return*/, (_a.sent()).paging
                                .totalPages];
                        case 4:
                            if (!this.assetNodeService.isDynamicGroup(parentReference)) return [3 /*break*/, 6];
                            return [4 /*yield*/, this.assetNodeService.getDynamicGroupItems(parentReference.c8y_DeviceQueryString, filters)];
                        case 5: return [2 /*return*/, (_a.sent()).paging.totalPages];
                        case 6:
                            if (!this.assetNodeService.isDevice(parentReference)) return [3 /*break*/, 8];
                            return [4 /*yield*/, this.assetNodeService.getDeviceChildren(parentReference.id, filters)];
                        case 7: return [2 /*return*/, (_a.sent()).paging
                                .totalPages];
                        case 8: return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsService.prototype.buildCombinedRootQueryFilter = function (columns, pagination) {
            var queryFilter = this.assetNodeService.rootQueryFilter();
            var userQuery = this.getQueryObj(columns, pagination);
            var queryPart = this.queriesUtil.addOrderbys(queryFilter, userQuery.__orderby, 'append');
            var fullQuery = this.queriesUtil.addAndFilter(queryPart, userQuery.__filter);
            return this.queriesUtil.buildQuery(fullQuery);
        };
        SubAssetsService.prototype.deleteGroup = function (group, params) {
            if (params === void 0) { params = {}; }
            return __awaiter(this, void 0, void 0, function () {
                var cascade, _a, alertMessage, error_2, alertMessage;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            cascade = params.cascade;
                            _b.label = 1;
                        case 1:
                            _b.trys.push([1, 6, , 7]);
                            if (!(this.smartGroupsService.isSmartGroup(group) || this.smartGroupsService.isSmartGroupV2(group))) return [3 /*break*/, 3];
                            return [4 /*yield*/, this.smartGroupsService.delete(group, { cascade: cascade })];
                        case 2:
                            _a = _b.sent();
                            return [3 /*break*/, 5];
                        case 3: return [4 /*yield*/, this.inventoryService.delete(group, { cascade: cascade })];
                        case 4:
                            _a = _b.sent();
                            _b.label = 5;
                        case 5:
                            _a;
                            alertMessage = this.translateService.instant(i4.gettext('Asset deleted.'));
                            this.alertService.success(alertMessage);
                            return [3 /*break*/, 7];
                        case 6:
                            error_2 = _b.sent();
                            alertMessage = this.translateService.instant(i4.gettext('Could not delete asset.'));
                            this.alertService.danger(alertMessage);
                            return [3 /*break*/, 7];
                        case 7: return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsService.prototype.deleteDevice = function (device, params) {
            if (params === void 0) { params = {}; }
            return __awaiter(this, void 0, void 0, function () {
                var cascade, withDeviceUser, owner, shouldRemoveOwner, _a, alertMessage, error_3, alertMessage;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            cascade = params.cascade, withDeviceUser = params.withDeviceUser;
                            _b.label = 1;
                        case 1:
                            _b.trys.push([1, 6, , 7]);
                            owner = device.owner;
                            shouldRemoveOwner = withDeviceUser && owner && this.isDeviceUser(owner);
                            if (!shouldRemoveOwner) return [3 /*break*/, 3];
                            return [4 /*yield*/, this.deleteDeviceWithUser(device, cascade)];
                        case 2:
                            _a = _b.sent();
                            return [3 /*break*/, 5];
                        case 3: return [4 /*yield*/, this.inventoryService.delete(device, { cascade: cascade })];
                        case 4:
                            _a = _b.sent();
                            _b.label = 5;
                        case 5:
                            _a;
                            alertMessage = this.translateService.instant(i4.gettext('Asset deleted.'));
                            this.alertService.success(alertMessage);
                            return [3 /*break*/, 7];
                        case 6:
                            error_3 = _b.sent();
                            alertMessage = this.translateService.instant(i4.gettext('Could not delete asset.'));
                            this.alertService.danger(alertMessage);
                            return [3 /*break*/, 7];
                        case 7: return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsService.prototype.deactivateSmartrulesForAsset = function (asset, parentRef) {
            return __awaiter(this, void 0, void 0, function () {
                var assetId, parentId, rules, upateSmartrulesPromises, error_4, alertMessage;
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            assetId = asset.id;
                            parentId = parentRef.id;
                            return [4 /*yield*/, this.smartRulesService.listByContext(parentId)];
                        case 1:
                            rules = (_a.sent()).data;
                            upateSmartrulesPromises = rules.map(function (rule) { return _this.smartRulesService.bulkDeactivateEnabledSources(rule, [assetId]); });
                            _a.label = 2;
                        case 2:
                            _a.trys.push([2, 4, , 5]);
                            return [4 /*yield*/, Promise.all(upateSmartrulesPromises)];
                        case 3:
                            _a.sent();
                            return [3 /*break*/, 5];
                        case 4:
                            error_4 = _a.sent();
                            alertMessage = this.translateService.instant(i4.gettext('Could not deactivate smart rules.'));
                            this.alertService.danger(alertMessage);
                            return [3 /*break*/, 5];
                        case 5: return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsService.prototype.isDeviceUser = function (userId) {
            return userId.match(/^device_/);
        };
        SubAssetsService.prototype.deleteDeviceWithUser = function (device, cascade) {
            return __awaiter(this, void 0, void 0, function () {
                var params, error_5;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            params = { cascade: cascade, withDeviceUser: true };
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 5]);
                            return [4 /*yield*/, this.inventoryService.delete(device, params)];
                        case 2: return [2 /*return*/, _a.sent()];
                        case 3:
                            error_5 = _a.sent();
                            return [4 /*yield*/, this.inventoryService.delete(device, { cascade: cascade })];
                        case 4: return [2 /*return*/, _a.sent()];
                        case 5: return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsService.prototype.getAssetsFilters = function (columns, pagination, baseQuery) {
            var query = this.queriesUtil.addAndFilter(this.getQueryObj(columns), baseQuery);
            return {
                query: this.queriesUtil.buildQuery(query),
                pageSize: pagination.pageSize || this.DEFAULT_PAGE_SIZE,
                currentPage: pagination.currentPage,
                withTotalPages: true
            };
        };
        return SubAssetsService;
    }(deviceGrid.DeviceGridService));
    SubAssetsService.ɵprov = i0__namespace.ɵɵdefineInjectable({ factory: function SubAssetsService_Factory() { return new SubAssetsService(i0__namespace.ɵɵinject(i1__namespace.TranslateService), i0__namespace.ɵɵinject(i2__namespace.InventoryService), i0__namespace.ɵɵinject(i3__namespace.UserService), i0__namespace.ɵɵinject(i4__namespace.AppStateService), i0__namespace.ɵɵinject(i3__namespace.UserService), i0__namespace.ɵɵinject(i5__namespace.AssetNodeService), i0__namespace.ɵɵinject(i6__namespace.SmartGroupsService), i0__namespace.ɵɵinject(i7__namespace.SmartRulesService), i0__namespace.ɵɵinject(i4__namespace.AlertService), i0__namespace.ɵɵinject(i4__namespace.Permissions), i0__namespace.ɵɵinject(i4__namespace.ModalService), i0__namespace.ɵɵinject(i4__namespace.AssetTypesService), i0__namespace.ɵɵinject(i4__namespace.UserPreferencesService), i0__namespace.ɵɵinject(i4__namespace.GainsightService, 8)); }, token: SubAssetsService, providedIn: "root" });
    SubAssetsService.decorators = [
        { type: i0.Injectable, args: [{
                    providedIn: 'root'
                },] }
    ];
    SubAssetsService.ctorParameters = function () { return [
        { type: i1.TranslateService },
        { type: client.InventoryService },
        { type: client.UserService },
        { type: i4.AppStateService },
        { type: client.UserService },
        { type: i5.AssetNodeService },
        { type: client.SmartGroupsService },
        { type: client.SmartRulesService },
        { type: i4.AlertService },
        { type: i4.Permissions },
        { type: i4.ModalService },
        { type: i4.AssetTypesService },
        { type: i4.UserPreferencesService },
        { type: i4.GainsightService, decorators: [{ type: i0.Optional }] }
    ]; };

    var GroupInfoComponent = /** @class */ (function () {
        function GroupInfoComponent(inventory, subAssetsService, smartGroupsService, alertService, translate, modalService, assetNodeService) {
            this.inventory = inventory;
            this.subAssetsService = subAssetsService;
            this.smartGroupsService = smartGroupsService;
            this.alertService = alertService;
            this.translate = translate;
            this.modalService = modalService;
            this.assetNodeService = assetNodeService;
            this.onGroupChange = new i0.EventEmitter();
            this.filterMsg = i4.gettext('Smart groups are groups dynamically constructed based on filtering criteria.');
            this.canEditMsg = i4.gettext('You can edit the filter here.');
            this.GROUP_UPDATED_MSG = i4.gettext('Group updated.');
        }
        GroupInfoComponent.prototype.ngOnChanges = function (changes) {
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            if (!changes.group) return [3 /*break*/, 4];
                            _a = this;
                            if (!this.smartGroupsService.isSmartGroupV2(this.group)) return [3 /*break*/, 1];
                            _b = this.subAssetsService.canEditSmartGroup();
                            return [3 /*break*/, 3];
                        case 1: return [4 /*yield*/, this.subAssetsService.canEditGroup(this.group)];
                        case 2:
                            _b = _c.sent();
                            _c.label = 3;
                        case 3:
                            _a.canEdit = _b;
                            this.groupIcon = this.assetNodeService.icon(this.group);
                            this.smartGroupFilter = this.group.c8y_DeviceQueryString;
                            this.label = this.assetNodeService.isAsset(this.group) ? this.group.type : i4.gettext('Group');
                            this.setHintMsg();
                            _c.label = 4;
                        case 4: return [2 /*return*/];
                    }
                });
            });
        };
        GroupInfoComponent.prototype.isSmartGroup = function () {
            return this.subAssetsService.isSmartGroup(this.group);
        };
        GroupInfoComponent.prototype.update = function (partialGroup) {
            return __awaiter(this, void 0, void 0, function () {
                var isSmartGroup, _a, error_1;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            _b.trys.push([0, 5, , 6]);
                            isSmartGroup = this.subAssetsService.isSmartGroup(this.group);
                            if (!isSmartGroup) return [3 /*break*/, 2];
                            return [4 /*yield*/, this.updateSmartGroup(partialGroup)];
                        case 1:
                            _a = _b.sent();
                            return [3 /*break*/, 4];
                        case 2: return [4 /*yield*/, this.updateGroup(partialGroup)];
                        case 3:
                            _a = _b.sent();
                            _b.label = 4;
                        case 4:
                            _a;
                            return [3 /*break*/, 6];
                        case 5:
                            error_1 = _b.sent();
                            this.alertService.addServerFailure(error_1);
                            return [3 /*break*/, 6];
                        case 6: return [2 /*return*/];
                    }
                });
            });
        };
        GroupInfoComponent.prototype.setHintMsg = function () {
            var filterMsgTranslated = this.translate.instant(this.filterMsg);
            var canEditMsgTranslated = this.translate.instant(this.canEditMsg);
            this.filterHintMsg = this.canEdit
                ? filterMsgTranslated + " " + canEditMsgTranslated
                : this.filterMsg;
        };
        GroupInfoComponent.prototype.updateGroup = function (partialGroup) {
            return __awaiter(this, void 0, void 0, function () {
                var id, group, updatedGroup;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            id = this.group.id;
                            group = Object.assign({ id: id }, partialGroup);
                            return [4 /*yield*/, this.inventory.update(group)];
                        case 1:
                            updatedGroup = (_a.sent()).data;
                            this.setGroup(updatedGroup);
                            return [2 /*return*/];
                    }
                });
            });
        };
        GroupInfoComponent.prototype.updateSmartGroup = function (partialGroup) {
            return __awaiter(this, void 0, void 0, function () {
                var id, c8y_DeviceQueryString, group, updatedGroup, modalBody, title, e_1;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            id = this.group.id;
                            c8y_DeviceQueryString = partialGroup.c8y_DeviceQueryString;
                            group = Object.assign({ id: id }, partialGroup);
                            if (!!c8y_DeviceQueryString) return [3 /*break*/, 2];
                            return [4 /*yield*/, this.smartGroupsService.update(group)];
                        case 1:
                            updatedGroup = (_a.sent()).data;
                            this.setGroup(updatedGroup);
                            return [2 /*return*/];
                        case 2:
                            _a.trys.push([2, 5, , 6]);
                            modalBody = i4.gettext('You are about to change the smart group filter. Do you want to proceed?');
                            title = i4.gettext('Smart group filter');
                            return [4 /*yield*/, this.modalService.confirm(title, modalBody, i4.Status.WARNING, {
                                    ok: i4.gettext('Save'),
                                    cancel: i4.gettext('Cancel')
                                })];
                        case 3:
                            _a.sent();
                            return [4 /*yield*/, this.isQueryExecutable(c8y_DeviceQueryString)];
                        case 4:
                            if (!(_a.sent())) {
                                return [2 /*return*/];
                            }
                            return [3 /*break*/, 6];
                        case 5:
                            e_1 = _a.sent();
                            return [2 /*return*/];
                        case 6: return [4 /*yield*/, this.smartGroupsService.update(group)];
                        case 7:
                            updatedGroup = (_a.sent()).data;
                            this.setGroup(updatedGroup);
                            return [2 /*return*/];
                    }
                });
            });
        };
        GroupInfoComponent.prototype.setGroup = function (group) {
            this.onGroupChange.emit(group);
            this.alertService.success(this.GROUP_UPDATED_MSG);
        };
        GroupInfoComponent.prototype.isQueryExecutable = function (query) {
            return __awaiter(this, void 0, void 0, function () {
                var filter, error_2;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            _a.trys.push([0, 2, , 3]);
                            filter = { q: query };
                            return [4 /*yield*/, this.inventory.list(filter)];
                        case 1:
                            _a.sent();
                            return [2 /*return*/, true];
                        case 2:
                            error_2 = _a.sent();
                            this.alertService.addServerFailure(error_2);
                            return [2 /*return*/, false];
                        case 3: return [2 /*return*/];
                    }
                });
            });
        };
        return GroupInfoComponent;
    }());
    GroupInfoComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-group-info',
                    template: "<div class=\"bg-gray-white separator-bottom\">\n  <div class=\"card-block p-t-24 p-b-24 large-padding\">\n    <div class=\"content-flex-70\">\n      <div class=\"text-center\">\n        <i class=\"c8y-icon-duocolor icon-48\" [c8yIcon]=\"groupIcon\"></i>\n        <p>\n          <small class=\"label label-info\" *ngIf=\"group.c8y_IsDynamicGroup\">\n            {{ 'Smart group' | translate }}\n          </small>\n          <small\n            class=\"label label-info\"\n            *ngIf=\"!group.c8y_IsDynamicGroup && !group.com_cumulocity_model_Agent\"\n          >\n            {{ label | translate }}\n          </small>\n          <small class=\"label label-info\" *ngIf=\"group.com_cumulocity_model_Agent\">\n            {{ 'Remote group' | translate }}\n          </small>\n        </p>\n      </div>\n\n      <div class=\"flex-grow col-10\">\n        <div class=\"content-flex-80\">\n          <div class=\"col-9\">\n            <form #groupNameForm=\"ngForm\">\n              <c8y-form-group class=\"form-group-lg m-b-0\">\n                <label class=\"sr-only\" translate>\n                  Name\n                </label>\n\n                <p *ngIf=\"!canEdit\" class=\"form-control-static\">{{ group.name }}</p>\n                <div *ngIf=\"canEdit\" class=\"input-group input-group-editable\">\n                  <input\n                    type=\"text\"\n                    class=\"form-control\"\n                    [(ngModel)]=\"group.name\"\n                    name=\"name\"\n                    title=\"{{ 'Name' | translate }}\"\n                    size=\"{{ group.name.length + 2 }}\"\n                    placeholder=\"{{ 'e.g. My group' | translate }}\"\n                    maxlength=\"254\"\n                    required\n                    c8yProductExperience\n                    [actionName]=\"'groupInfo:EditName'\"\n                  />\n                  <span></span>\n                  <div class=\"input-group-btn\">\n                    <button\n                      (click)=\"update({ name: group.name }); groupNameForm.form.markAsPristine()\"\n                      class=\"btn btn-primary\"\n                      title=\"{{ 'Save' | translate }}\"\n                      [disabled]=\"groupNameForm.form.invalid\"\n                      c8yProductExperience\n                      [actionName]=\"'groupInfo:EditedNameSaved'\"\n                    >\n                      {{ 'Save' | translate }}\n                    </button>\n                  </div>\n                </div>\n              </c8y-form-group>\n            </form>\n            <form #groupDescriptionForm=\"ngForm\">\n              <label class=\"sr-only\" translate>\n                Description\n              </label>\n              <p *ngIf=\"!canEdit\" class=\"form-control-static\">{{ group.c8y_Notes }}</p>\n              <div *ngIf=\"canEdit\" class=\"input-group input-group-editable\">\n                <textarea\n                  class=\"form-control\"\n                  [(ngModel)]=\"group.c8y_Notes\"\n                  name=\"description\"\n                  title=\"{{ 'Description' | translate }}\"\n                  cols=\"{{ group.c8y_Notes ? group.c8y_Notes.length : 25 }}\"\n                  placeholder=\"{{ 'e.g. My description' | translate }}\"\n                  c8yProductExperience\n                  [actionName]=\"'groupInfo:EditDescription'\"\n                ></textarea>\n                <span></span>\n                <div class=\"input-group-btn\">\n                  <button\n                    (click)=\"\n                      update({ c8y_Notes: group.c8y_Notes });\n                      groupDescriptionForm.form.markAsPristine()\n                    \"\n                    class=\"btn btn-primary\"\n                    title=\"{{ 'Save' | translate }}\"\n                    [disabled]=\"groupDescriptionForm.form.invalid\"\n                    c8yProductExperience\n                    [actionName]=\"'groupInfo:EditedDescriptionSaved'\"\n                  >\n                    {{ 'Save' | translate }}\n                  </button>\n                </div>\n              </div>\n            </form>\n\n            <form #smartGroupFilterForm=\"ngForm\" *ngIf=\"isSmartGroup()\">\n              <c8y-form-group class=\"m-b-0 m-t-8\">\n                <label class=\"m-b-0 text-nowrap\">\n                  {{ 'Smart group filter' | translate }}\n                  <button\n                    class=\"btn-clean text-primary m-r-4\"\n                    type=\"button\"\n                    popover=\"{{ filterHintMsg | translate }}\"\n                    triggers=\"focus\"\n                  >\n                    <i c8yIcon=\"question-circle-o\"></i>\n                  </button>\n                </label>\n\n                <p *ngIf=\"!canEdit\" class=\"form-control-static\">\n                  {{ smartGroupFilter }}\n                </p>\n                <div *ngIf=\"canEdit\" class=\"input-group input-group-editable\">\n                  <input\n                    type=\"text\"\n                    class=\"form-control\"\n                    [(ngModel)]=\"smartGroupFilter\"\n                    name=\"filter\"\n                    size=\"{{ (smartGroupFilter || '').length + 2 }}\"\n                    placeholder=\"{{ 'e.g.' | translate }} $filter=(id eq '12*')\"\n                    maxlength=\"254\"\n                    title=\"{{ 'Smart group filter' | translate }}\"\n                  />\n                  <span></span>\n                  <div class=\"input-group-btn\">\n                    <button\n                      (click)=\"\n                        update({ c8y_DeviceQueryString: smartGroupFilter });\n                        smartGroupFilterForm.form.markAsPristine()\n                      \"\n                      class=\"btn btn-primary\"\n                      title=\"{{ 'Save' | translate }}\"\n                      [disabled]=\"smartGroupFilterForm.form.invalid\"\n                    >\n                      {{ 'Save' | translate }}\n                    </button>\n                  </div>\n                </div>\n              </c8y-form-group>\n            </form>\n          </div>\n          <div class=\"flex-grow\">\n            <ul class=\"list-unstyled small\">\n              <li class=\"p-t-4 p-b-4 flex-row separator-top-bottom text-nowrap\">\n                <label class=\"small m-b-0 m-r-8\">{{ 'Created' | translate }}</label>\n                <span class=\"flex-item-right\">{{ group.creationTime | c8yDate }}</span>\n              </li>\n              <li class=\"p-t-4 p-b-4 flex-row separator-bottom text-nowrap\">\n                <label class=\"small m-b-0 m-r-8\">{{ 'Last updated' | translate }}</label>\n                <span class=\"flex-item-right\">{{ group.lastUpdated | c8yDate }}</span>\n              </li>\n              <li\n                *ngIf=\"group.com_cumulocity_model_Agent\"\n                class=\"p-t-4 p-b-4 flex-row separator-bottom text-nowrap\"\n              >\n                <label class=\"small m-b-0 m-r-8\">{{ 'Status' | translate }}</label>\n                <span class=\"flex-item-right\" *ngIf=\"group.c8y_BrokerSource\">\n                  {{ group.c8y_BrokerSource.status }}\n                </span>\n                <span class=\"flex-item-right\" *ngIf=\"!group.c8y_BrokerSource\">\n                  {{ 'Offline' | translate }}\n                </span>\n              </li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n"
                },] }
    ];
    GroupInfoComponent.ctorParameters = function () { return [
        { type: client.InventoryService },
        { type: SubAssetsService },
        { type: client.SmartGroupsService },
        { type: i4.AlertService },
        { type: i1.TranslateService },
        { type: i4.ModalService },
        { type: i5.AssetNodeService }
    ]; };
    GroupInfoComponent.propDecorators = {
        group: [{ type: i0.Input }],
        onGroupChange: [{ type: i0.Output }]
    };

    var SubAssetsComponent = /** @class */ (function () {
        function SubAssetsComponent(route, subAssetsService, assetNodeService) {
            var _this = this;
            this.route = route;
            this.subAssetsService = subAssetsService;
            this.assetNodeService = assetNodeService;
            this.toggle = false;
            this.showAddGroup = false;
            this.showAssignDevices = false;
            this.showAssignChildDevices = false;
            this.refresh = new i0.EventEmitter();
            this.filterable = true;
            this.shouldDisableAddGroup = false;
            this.shouldDisableAssignDevices = false;
            this.shouldShowAssetsProperties = false;
            this.customProperties = [];
            this.dataSub = this.route.parent.data.subscribe(function (_a) {
                var contextData = _a.contextData;
                _this.init(contextData);
            });
        }
        SubAssetsComponent.prototype.ngOnInit = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    this.displayOptions = {
                        striped: true,
                        bordered: false,
                        gridHeader: true,
                        filter: !this.isSmartGroup()
                    };
                    return [2 /*return*/];
                });
            });
        };
        SubAssetsComponent.prototype.init = function (contextData) {
            return __awaiter(this, void 0, void 0, function () {
                var _a, _b;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            this.title = contextData.name;
                            this.currentGroupId = contextData.id;
                            this.group = contextData;
                            this.filterable = !this.assetNodeService.isDynamicGroup(contextData);
                            this.shouldDisableAddGroup = !this.subAssetsService.canCreateGroup();
                            _a = this;
                            return [4 /*yield*/, this.subAssetsService.canAssignDevice(this.group)];
                        case 1:
                            _a.shouldDisableAssignDevices = !(_c.sent());
                            _b = this;
                            return [4 /*yield*/, this.subAssetsService.getCustomProperties(this.group)];
                        case 2:
                            _b.customProperties = _c.sent();
                            this.shouldShowAssetsProperties = this.customProperties.length > 0;
                            return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsComponent.prototype.groupChange = function (group) {
            /**
             * Group is cached in the context-route guard. To avoid loading old data (when switching tabs) we need to update
             * this object in the cache.
             */
            Object.assign(this.group, group);
            this.title = group.name;
            this.refresh.emit();
        };
        SubAssetsComponent.prototype.isSmartGroup = function () {
            return this.subAssetsService.isSmartGroup(this.group);
        };
        SubAssetsComponent.prototype.ngOnDestroy = function () {
            if (this.dataSub) {
                this.dataSub.unsubscribe();
            }
        };
        return SubAssetsComponent;
    }());
    SubAssetsComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-sub-assets',
                    template: "<c8y-title>\n  {{ title }}\n</c8y-title>\n\n<c8y-action-bar-item [placement]=\"'right'\" *ngIf=\"!isSmartGroup()\">\n  <button\n    class=\"btn btn-link\"\n    title=\"{{ 'Add group' | translate }}\"\n    (click)=\"showAddGroup = !showAddGroup\"\n    [disabled]=\"shouldDisableAddGroup\"\n  >\n    <i c8yIcon=\"plus-circle\" class=\"m-r-4\"></i><span translate>Add group</span>\n  </button>\n</c8y-action-bar-item>\n\n<c8y-action-bar-item [placement]=\"'right'\" *ngIf=\"!isSmartGroup()\">\n  <button\n    class=\"btn btn-link\"\n    title=\"{{ 'Assign devices' | translate }}\"\n    (click)=\"showAssignDevices = !showAssignDevices\"\n    [disabled]=\"shouldDisableAssignDevices\"\n  >\n    <i c8yIcon=\"plus-circle\" class=\"m-r-4\"></i><span translate>Assign devices</span>\n  </button>\n</c8y-action-bar-item>\n\n<div\n  class=\"content-fullpage shadow1\"\n  [ngClass]=\"{\n    'card--grid grid__col--8-4--md grid__row--fit-auto': shouldShowAssetsProperties,\n    'd-flex d-col': !shouldShowAssetsProperties\n  }\"\n>\n  <c8y-group-info\n    [group]=\"group\"\n    (onGroupChange)=\"groupChange($event)\"\n    class=\"grid__col--fullspan\"\n  ></c8y-group-info>\n  <c8y-sub-assets-grid\n    [refresh]=\"refresh\"\n    [parent-group]=\"group\"\n    [filterable]=\"filterable\"\n    [displayOptions]=\"displayOptions\"\n  ></c8y-sub-assets-grid>\n  <div class=\"inner-scroll bg-gray-white\" *ngIf=\"shouldShowAssetsProperties\">\n    <c8y-asset-properties\n      [properties]=\"customProperties\"\n      [asset]=\"group\"\n      class=\"d-contents\"\n    ></c8y-asset-properties>\n  </div>\n</div>\n\n<div [ngClass]=\"{ drawerOpen: showAddGroup }\">\n  <div class=\"bottom-drawer\">\n    <c8y-add-group\n      [currentGroupId]=\"currentGroupId\"\n      [refresh]=\"refresh\"\n      (onCancel)=\"showAddGroup = false\"\n      *ngIf=\"showAddGroup\"\n    ></c8y-add-group>\n  </div>\n</div>\n\n<div [ngClass]=\"{ drawerOpen: showAssignDevices }\">\n  <div class=\"bottom-drawer\">\n    <div class=\"d-flex d-col no-align-items fit-h\">\n      <c8y-assign-devices\n        class=\"d-contents\"\n        (onCancel)=\"showAssignDevices = false\"\n        [refresh]=\"refresh\"\n        [currentGroupId]=\"currentGroupId\"\n        (onShowChildDevices)=\"showAssignChildDevices = $event\"\n        (selectedDevice)=\"showChildrenForDevice = $event\"\n        *ngIf=\"showAssignDevices\"\n      ></c8y-assign-devices>\n    </div>\n  </div>\n</div>\n\n<div [ngClass]=\"{ drawerOpen: showAssignChildDevices }\">\n  <div class=\"bottom-drawer m-t-40\">\n    <div class=\"d-flex d-col no-align-items fit-h\">\n      <c8y-assign-child-devices\n        *ngIf=\"showAssignChildDevices\"\n        class=\"d-contents\"\n        (onCancel)=\"showAssignChildDevices = false\"\n        [refresh]=\"refresh\"\n        [currentGroupId]=\"currentGroupId\"\n        [parentDevice]=\"showChildrenForDevice\"\n      ></c8y-assign-child-devices>\n    </div>\n  </div>\n</div>\n"
                },] }
    ];
    SubAssetsComponent.ctorParameters = function () { return [
        { type: router.ActivatedRoute },
        { type: SubAssetsService },
        { type: i5.AssetNodeService }
    ]; };

    var DeleteAssetsModalComponent = /** @class */ (function () {
        function DeleteAssetsModalComponent(translateService, gainsightService) {
            this.translateService = translateService;
            this.gainsightService = gainsightService;
            this.showWithCascadeCheckbox = true;
            this.showWithDeviceUserCheckbox = false;
            this.closeSubject = new rxjs.Subject();
            this.labels = { ok: i4.gettext('Delete'), cancel: i4.gettext('Cancel') };
            this.title = i4.gettext('Delete');
            this.status = i4.Status.DANGER;
            this.config = {
                cascade: false,
                withDeviceUser: false
            };
        }
        DeleteAssetsModalComponent.prototype.ngOnInit = function () {
            this.message = this.translateService.instant(i4.gettext('You are about to delete asset: "{{name}}". This operation is irreversible. Do you want to proceed?'), { name: this.asset.name });
        };
        DeleteAssetsModalComponent.prototype.ngAfterViewInit = function () {
            return __awaiter(this, void 0, void 0, function () {
                var error_1;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            _a.trys.push([0, 2, , 3]);
                            return [4 /*yield*/, this.modalRef.result];
                        case 1:
                            _a.sent();
                            this.onClose();
                            return [3 /*break*/, 3];
                        case 2:
                            error_1 = _a.sent();
                            this.onDismiss();
                            return [3 /*break*/, 3];
                        case 3: return [2 /*return*/];
                    }
                });
            });
        };
        DeleteAssetsModalComponent.prototype.onClose = function () {
            this.gainsightService.triggerEvent('deleteAssetsModal:AssetDeleted');
            this.closeSubject.next(this.config);
            this.closeSubject.complete();
        };
        DeleteAssetsModalComponent.prototype.onDismiss = function () {
            this.gainsightService.triggerEvent('deleteAssetsModal:Cancel');
            this.closeSubject.complete();
        };
        return DeleteAssetsModalComponent;
    }());
    DeleteAssetsModalComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-delete-assets-modal',
                    template: "<c8y-confirm-modal [title]=\"title\" [status]=\"status\" [labels]=\"labels\" #modalRef>\n  <form #assetsForm=\"ngForm\">\n    <p class=\"text-wrap m-b-16\">\n      {{ message | translate }}\n    </p>\n    <c8y-form-group *ngIf=\"showWithCascadeCheckbox\" class=\"m-b-0\">\n      <label title=\"{{ 'Delete devices' | translate }}\" class=\"c8y-checkbox\">\n        <input\n          type=\"checkbox\"\n          name=\"cascade\" [(ngModel)]=\"config.cascade\"\n          c8yProductExperience\n          [actionName]=\"'deleteAssetsModal:DeleteDevices'\"\n          [disabled]=\"config?.withDeviceUser\"\n        />\n        <span></span>\n        <span>\n          {{ 'Also delete all devices inside selected asset and its subassets.' | translate }}\n        </span>\n      </label>\n    </c8y-form-group>\n    <c8y-form-group *ngIf=\"showWithDeviceUserCheckbox\" class=\"m-b-0\">\n      <label title=\"{{ 'Delete associated device owner' | translate }}\" class=\"c8y-checkbox\">\n        <input\n          type=\"checkbox\"\n          name=\"withDeviceUser\" [(ngModel)]=\"config.withDeviceUser\"\n          c8yProductExperience\n          [actionName]=\"'deleteAssetsModal:DeleteDeviceOwner'\"\n          [disabled]=\"config?.cascade\"\n        />\n        <span></span>\n        <span>\n          {{ 'Also delete associated device owner.' | translate }}\n        </span>\n      </label>\n    </c8y-form-group>\n  </form>\n</c8y-confirm-modal>\n"
                },] }
    ];
    DeleteAssetsModalComponent.ctorParameters = function () { return [
        { type: i1.TranslateService },
        { type: i4.GainsightService }
    ]; };
    DeleteAssetsModalComponent.propDecorators = {
        showWithCascadeCheckbox: [{ type: i0.Input }],
        showWithDeviceUserCheckbox: [{ type: i0.Input }],
        asset: [{ type: i0.Input }],
        modalRef: [{ type: i0.ViewChild, args: ['modalRef', { static: false },] }]
    };

    var UnassignModalComponent = /** @class */ (function () {
        function UnassignModalComponent(translateService, gainsightService) {
            this.translateService = translateService;
            this.gainsightService = gainsightService;
            this.closeSubject = new rxjs.Subject();
            this.labels = { ok: i4.gettext('Unassign'), cancel: i4.gettext('Cancel') };
            this.title = i4.gettext('Unassign asset');
            this.status = i4.Status.WARNING;
        }
        UnassignModalComponent.prototype.ngOnInit = function () {
            this.message = this.translateService.instant(i4.gettext('You are about to unassign asset "{{name}}". Do you want to proceed?'), { name: this.asset.name });
        };
        UnassignModalComponent.prototype.ngAfterViewInit = function () {
            return __awaiter(this, void 0, void 0, function () {
                var error_1;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            _a.trys.push([0, 2, , 3]);
                            return [4 /*yield*/, this.modalRef.result];
                        case 1:
                            _a.sent();
                            this.onClose();
                            return [3 /*break*/, 3];
                        case 2:
                            error_1 = _a.sent();
                            this.onDismiss();
                            return [3 /*break*/, 3];
                        case 3: return [2 /*return*/];
                    }
                });
            });
        };
        UnassignModalComponent.prototype.onClose = function () {
            this.gainsightService.triggerEvent('unassignAssetModal:AssetUnassigned');
            this.closeSubject.next(true);
            this.closeSubject.complete();
        };
        UnassignModalComponent.prototype.onDismiss = function () {
            this.gainsightService.triggerEvent('unassignAssetModal:Cancel');
            this.closeSubject.complete();
        };
        return UnassignModalComponent;
    }());
    UnassignModalComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-unassign-modal',
                    template: "<c8y-confirm-modal [title]=\"title\" [status]=\"status\" [labels]=\"labels\" #modalRef>\n  <span>{{ message | translate }}</span>\n</c8y-confirm-modal>\n"
                },] }
    ];
    UnassignModalComponent.ctorParameters = function () { return [
        { type: i1.TranslateService },
        { type: i4.GainsightService }
    ]; };
    UnassignModalComponent.propDecorators = {
        asset: [{ type: i0.Input }],
        modalRef: [{ type: i0.ViewChild, args: ['modalRef', { static: false },] }]
    };

    var SubAssetsGridComponent = /** @class */ (function () {
        function SubAssetsGridComponent(subAssetsGridService, bsModalService, smartGroupsService) {
            this.subAssetsGridService = subAssetsGridService;
            this.bsModalService = bsModalService;
            this.smartGroupsService = smartGroupsService;
            this.title = i4.gettext('Subassets');
            this.emptyStateText = i4.gettext('Add your first group or assign devices using the buttons on the action bar.');
            this.loadingItemsLabel = i4.gettext('Loading assets…');
            this.selectable = false;
            this.baseQuery = {};
            this.filterable = true;
            this.sortable = true;
            this.onColumnsChange = new i0.EventEmitter();
            this.itemsSelect = new i0.EventEmitter();
            this.pagination = this.subAssetsGridService.getDefaultPagination();
            this.showCounterWarning = false;
            this.bulkActionControls = this.subAssetsGridService.getDefaultBulkActionControls();
            this.displayOptions = {
                striped: true,
                bordered: false,
                gridHeader: true,
                filter: true
            };
            this.serverSideDataCallback = this.onDataSourceModifier.bind(this);
        }
        Object.defineProperty(SubAssetsGridComponent.prototype, "columns", {
            get: function () {
                return this._columns;
            },
            set: function (value) {
                if (value) {
                    this._columns = this.subAssetsGridService.getUserConfiguredColumns(value);
                }
                else {
                    this._columns = this.subAssetsGridService.getUserConfiguredColumns(this.subAssetsGridService.getDefaultColumns());
                }
            },
            enumerable: false,
            configurable: true
        });
        Object.defineProperty(SubAssetsGridComponent.prototype, "_pagination", {
            set: function (value) {
                if (value) {
                    this.pagination = value;
                }
                else {
                    this.pagination = this.subAssetsGridService.getDefaultPagination();
                }
            },
            enumerable: false,
            configurable: true
        });
        Object.defineProperty(SubAssetsGridComponent.prototype, "_actionControls", {
            set: function (value) {
                if (value) {
                    this.actionControls = value;
                }
                else {
                    this.actionControls = this.subAssetsGridService.getDefaultActionControls();
                }
            },
            enumerable: false,
            configurable: true
        });
        Object.defineProperty(SubAssetsGridComponent.prototype, "_bulkActionControls", {
            set: function (value) {
                if (value) {
                    this.bulkActionControls = value;
                }
                else {
                    this.bulkActionControls = this.subAssetsGridService.getDefaultBulkActionControls();
                }
            },
            enumerable: false,
            configurable: true
        });
        Object.defineProperty(SubAssetsGridComponent.prototype, "isRootGroup", {
            get: function () {
                return !this.parentGroup;
            },
            enumerable: false,
            configurable: true
        });
        Object.defineProperty(SubAssetsGridComponent.prototype, "getInfiniteScrollMode", {
            get: function () {
                return this.isRootGroup && this.subAssetsGridService.isUsingInventoryRoles()
                    ? 'auto'
                    : undefined;
            },
            enumerable: false,
            configurable: true
        });
        Object.defineProperty(SubAssetsGridComponent.prototype, "_displayOptions", {
            set: function (displayOptions) {
                this.displayOptions = Object.assign(Object.assign({}, this.displayOptions), displayOptions);
            },
            enumerable: false,
            configurable: true
        });
        SubAssetsGridComponent.prototype.ngOnInit = function () {
            var _this = this;
            this.columns = this.subAssetsGridService.getDefaultColumns(this.filterable, this.sortable);
            if (!this.filterable || !this.sortable) {
                this.columns.forEach(function (column) {
                    column.filterable = _this.filterable;
                    column.sortable = _this.sortable;
                });
            }
            this.setActionControls();
        };
        SubAssetsGridComponent.prototype.setActionControls = function () {
            return __awaiter(this, void 0, void 0, function () {
                var actionControls, isMicroserviceInstalled, deleteAction, unassignAction;
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            actionControls = [];
                            return [4 /*yield*/, this.smartGroupsService.isSmartGroupsV2MicroserviceInstalled()];
                        case 1:
                            isMicroserviceInstalled = (_a.sent()).data;
                            deleteAction = {
                                type: "DELETE" /* Delete */,
                                callback: function (asset) { return _this.onDeleteAsset(asset, _this.parentGroup); },
                                showIf: function (asset) {
                                    if (_this.smartGroupsService.isSmartGroupV2(asset)) {
                                        return isMicroserviceInstalled ? _this.subAssetsGridService.canDeleteSmartGroup() : false;
                                    }
                                    if (_this.smartGroupsService.isSmartGroup(asset)) {
                                        return _this.subAssetsGridService.canDeleteSmartGroup();
                                    }
                                    return true;
                                }
                            };
                            actionControls.push(deleteAction);
                            unassignAction = {
                                type: 'UNASSIGN',
                                icon: 'unlink',
                                text: i4.gettext('Unassign'),
                                callback: function (asset) { return _this.onUnassignAsset(asset, _this.parentGroup); },
                                showIf: function (asset) { return _this.subAssetsGridService.isDevice(asset) &&
                                    !_this.subAssetsGridService.isSmartGroup(_this.parentGroup); }
                            };
                            actionControls.push(unassignAction);
                            if (!this.actionControls) {
                                this.actionControls = actionControls;
                            }
                            return [2 /*return*/];
                    }
                });
            });
        };
        SubAssetsGridComponent.prototype.onUnassignAsset = function (asset, parentRef) {
            var _this = this;
            var initialState = {
                asset: asset
            };
            var modalRef = this.bsModalService.show(UnassignModalComponent, { initialState: initialState });
            modalRef.content.closeSubject.subscribe(function (result) { return __awaiter(_this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!result) return [3 /*break*/, 2];
                            return [4 /*yield*/, this.subAssetsGridService.unassignAsset(asset, parentRef)];
                        case 1:
                            _a.sent();
                            this.refresh.emit();
                            _a.label = 2;
                        case 2: return [2 /*return*/];
                    }
                });
            }); });
        };
        SubAssetsGridComponent.prototype.onDeleteAsset = function (asset, parentRef) {
            return __awaiter(this, void 0, void 0, function () {
                var initialState, modalRef;
                var _this = this;
                return __generator(this, function (_a) {
                    initialState = {
                        showWithDeviceUserCheckbox: this.subAssetsGridService.shouldShowWithDeviceUserCheckbox(asset),
                        asset: asset,
                        showWithCascadeCheckbox: !this.smartGroupsService.isSmartGroup(asset) &&
                            !this.smartGroupsService.isSmartGroupV2(asset)
                    };
                    modalRef = this.bsModalService.show(DeleteAssetsModalComponent, { initialState: initialState });
                    modalRef.content.closeSubject.subscribe(function (result) { return __awaiter(_this, void 0, void 0, function () {
                        return __generator(this, function (_a) {
                            switch (_a.label) {
                                case 0:
                                    if (!result) return [3 /*break*/, 2];
                                    return [4 /*yield*/, this.subAssetsGridService.deleteAsset(asset, parentRef, result)];
                                case 1:
                                    _a.sent();
                                    this.showCounterWarning = true;
                                    this.refresh.emit();
                                    _a.label = 2;
                                case 2: return [2 /*return*/];
                            }
                        });
                    }); });
                    return [2 /*return*/];
                });
            });
        };
        SubAssetsGridComponent.prototype.ngOnChanges = function (changes) {
            if (changes.parentGroup && !changes.parentGroup.firstChange) {
                this.dataGrid.reload();
            }
        };
        SubAssetsGridComponent.prototype.trackByName = function (_index, column) {
            return column.name;
        };
        SubAssetsGridComponent.prototype.onDataSourceModifier = function (dataSourceModifier) {
            return __awaiter(this, void 0, void 0, function () {
                var promises, counters, _a, dataResponse, size, filteredSize;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            promises = [];
                            promises.push(this.subAssetsGridService.getData(dataSourceModifier.columns, dataSourceModifier.pagination, this.parentGroup, this.baseQuery));
                            promises.push(this.subAssetsGridService.getTotal(this.parentGroup, this.baseQuery));
                            promises.push(this.subAssetsGridService.getCount(dataSourceModifier.columns, dataSourceModifier.pagination, this.parentGroup, this.baseQuery));
                            return [4 /*yield*/, Promise.all(promises)];
                        case 1:
                            _a = __read.apply(void 0, [_b.sent(), 3]), dataResponse = _a[0], size = _a[1], filteredSize = _a[2];
                            if (!counters) {
                                counters = {
                                    size: size,
                                    filteredSize: filteredSize
                                };
                            }
                            this.onColumnsChange.emit(dataSourceModifier.columns);
                            return [2 /*return*/, Object.assign({ res: dataResponse.res, data: dataResponse.data, paging: dataResponse.paging }, counters)];
                    }
                });
            });
        };
        SubAssetsGridComponent.prototype.configChange = function (config) {
            this.subAssetsGridService.saveConfig(config);
        };
        return SubAssetsGridComponent;
    }());
    SubAssetsGridComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-sub-assets-grid',
                    template: "<c8y-data-grid\n  [title]=\"title\"\n  [loadingItemsLabel]=\"loadingItemsLabel\"\n  [columns]=\"columns\"\n  [pagination]=\"pagination\"\n  [actionControls]=\"actionControls\"\n  [selectable]=\"selectable\"\n  [bulkActionControls]=\"bulkActionControls\"\n  [serverSideDataCallback]=\"serverSideDataCallback\"\n  [infiniteScroll]=\"getInfiniteScrollMode\"\n  [showCounterWarning]=\"showCounterWarning\"\n  [refresh]=\"refresh\"\n  [displayOptions]=\"displayOptions\"\n  (onConfigChange)=\"configChange($event)\"\n  (itemsSelect)=\"itemsSelect.emit($event)\"\n>\n  <c8y-ui-empty-state\n    [icon]=\"'c8y-group-add'\"\n    [title]=\"'No items to display.' | translate\"\n    [subtitle]=\"emptyStateText | translate\"\n    [horizontal]=\"true\"\n  ></c8y-ui-empty-state>\n\n  <ng-container *ngFor=\"let column of columns; trackBy: trackByName\">\n    <c8y-column [name]=\"column.name\"></c8y-column>\n  </ng-container>\n</c8y-data-grid>\n"
                },] }
    ];
    SubAssetsGridComponent.ctorParameters = function () { return [
        { type: SubAssetsService },
        { type: modal.BsModalService },
        { type: client.SmartGroupsService }
    ]; };
    SubAssetsGridComponent.propDecorators = {
        parentGroup: [{ type: i0.Input, args: ['parent-group',] }],
        refresh: [{ type: i0.Input }],
        title: [{ type: i0.Input }],
        emptyStateText: [{ type: i0.Input }],
        loadingItemsLabel: [{ type: i0.Input }],
        columns: [{ type: i0.Input }],
        _pagination: [{ type: i0.Input, args: ['pagination',] }],
        _actionControls: [{ type: i0.Input, args: ['actionControls',] }],
        selectable: [{ type: i0.Input }],
        baseQuery: [{ type: i0.Input }],
        _bulkActionControls: [{ type: i0.Input, args: ['bulkActionControls',] }],
        filterable: [{ type: i0.Input }],
        sortable: [{ type: i0.Input }],
        onColumnsChange: [{ type: i0.Output }],
        itemsSelect: [{ type: i0.Output }],
        dataGrid: [{ type: i0.ViewChild, args: [i4.DataGridComponent, { static: true },] }],
        _displayOptions: [{ type: i0.Input, args: ['displayOptions',] }]
    };

    var AddGroupService = /** @class */ (function () {
        function AddGroupService(inventoryService) {
            this.inventoryService = inventoryService;
            this.GROUP_FRAGMENT_TYPE = 'c8y_IsDeviceGroup';
        }
        AddGroupService.prototype.createGroupAndAssignDevices = function (groupForm, groupContextId, selectedDevices) {
            return __awaiter(this, void 0, void 0, function () {
                var group, name, description, newGroupMO;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            name = groupForm.name, description = groupForm.description;
                            newGroupMO = this.getGroupMO(name, description, groupContextId);
                            if (!groupContextId) return [3 /*break*/, 2];
                            return [4 /*yield*/, this.inventoryService.childAssetsCreate(newGroupMO, groupContextId)];
                        case 1:
                            group = (_a.sent()).data;
                            return [3 /*break*/, 4];
                        case 2: return [4 /*yield*/, this.inventoryService.create(newGroupMO)];
                        case 3:
                            group = (_a.sent()).data;
                            _a.label = 4;
                        case 4:
                            if (!(selectedDevices.length > 0)) return [3 /*break*/, 6];
                            return [4 /*yield*/, this.assignDevices(group.id, selectedDevices)];
                        case 5:
                            _a.sent();
                            _a.label = 6;
                        case 6: return [2 /*return*/, group];
                    }
                });
            });
        };
        AddGroupService.prototype.getGroupMO = function (name, description, groupContextId) {
            var _a;
            if (description === void 0) { description = ''; }
            var group = (_a = {
                    type: this.getGroupType(groupContextId)
                },
                _a[this.GROUP_FRAGMENT_TYPE] = {},
                _a.name = name,
                _a.c8y_Notes = description,
                _a);
            return group;
        };
        AddGroupService.prototype.getGroupType = function (groupContextId) {
            return groupContextId ? i5.GroupFragment.subGroupType : i5.GroupFragment.groupType;
        };
        AddGroupService.prototype.assignDevices = function (id, selectedDevices) {
            return __awaiter(this, void 0, void 0, function () {
                var promises;
                var _this = this;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            promises = [];
                            selectedDevices.forEach(function (moId) {
                                promises.push(_this.inventoryService.childAssetsAdd(moId, id));
                            });
                            return [4 /*yield*/, Promise.all(promises)];
                        case 1: return [2 /*return*/, _a.sent()];
                    }
                });
            });
        };
        return AddGroupService;
    }());
    AddGroupService.decorators = [
        { type: i0.Injectable }
    ];
    AddGroupService.ctorParameters = function () { return [
        { type: client.InventoryService }
    ]; };

    var AddGroupComponent = /** @class */ (function () {
        function AddGroupComponent(deviceGridService, fb, addGroupService, alert, subAssetsService) {
            this.deviceGridService = deviceGridService;
            this.fb = fb;
            this.addGroupService = addGroupService;
            this.alert = alert;
            this.subAssetsService = subAssetsService;
            this.refresh = new i0.EventEmitter();
            this.onDeviceQueryStringChange = new i0.EventEmitter();
            this.onCancel = new i0.EventEmitter();
            this.pendingStatus = false;
            this.pagination = { pageSize: 20, currentPage: 1 };
            this.selected = [];
            this.canCreateGroup = false;
            this.canAssignDevice = false;
            this.ITEMS_SELECT_LIMIT = 15;
            this.btnLabels = {
                next: i4.gettext('Next'),
                cancel: i4.gettext('Cancel'),
                create: i4.gettext('Create')
            };
        }
        AddGroupComponent.prototype.onEnterKeyDown = function (event) {
            // Order matters! Needs to be placed before this.stepper.next
            if ((this.isGroupDetailsStep() && !this.canAssignDevice) || this.isAssignDeviceStep()) {
                this.createGroup();
                return;
            }
            this.stepper.next();
        };
        AddGroupComponent.prototype.onEscapeKeyDown = function (event) {
            this.onCancel.emit();
        };
        AddGroupComponent.prototype.ngOnInit = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                var _this = this;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            this.formGroupStepOne = this.fb.group({
                                name: ['', forms.Validators.required],
                                description: ['']
                            });
                            this.subscription = this.onCancel.subscribe(function () { return _this.resetStepper(); });
                            this.canCreateGroup = this.subAssetsService.canCreateGroup();
                            _a = this;
                            return [4 /*yield*/, this.subAssetsService.canAssignDevice({
                                    id: this.currentGroupId
                                })];
                        case 1:
                            _a.canAssignDevice = _b.sent();
                            return [2 /*return*/];
                    }
                });
            });
        };
        AddGroupComponent.prototype.ngAfterViewInit = function () {
            this.nameInput = this.nameInputRef.nativeElement;
            this.setFocusOnNameInput();
        };
        AddGroupComponent.prototype.createGroup = function () {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (this.canCreateGroup === false) {
                                return [2 /*return*/];
                            }
                            this.pendingStatus = true;
                            return [4 /*yield*/, this.addGroupService.createGroupAndAssignDevices(this.formGroupStepOne.value, this.currentGroupId, this.selected)];
                        case 1:
                            _a.sent();
                            this.pendingStatus = false;
                            this.resetStepper();
                            this.alert.success(i4.gettext('Group created.'));
                            this.refresh.emit();
                            this.onCancel.emit();
                            return [2 /*return*/];
                    }
                });
            });
        };
        AddGroupComponent.prototype.onSelected = function (selectedDevicesIDs) {
            this.selected = selectedDevicesIDs;
        };
        AddGroupComponent.prototype.resetStepper = function () {
            this.stepper.reset();
            this.stepper.selectedIndex = 1;
            this.selected = [];
        };
        AddGroupComponent.prototype.ngOnDestroy = function () {
            if (this.subscription) {
                this.subscription.unsubscribe();
            }
        };
        AddGroupComponent.prototype.isGroupDetailsStep = function () {
            return this.stepper.selectedIndex === 0;
        };
        AddGroupComponent.prototype.isAssignDeviceStep = function () {
            return this.stepper.selectedIndex === 1;
        };
        AddGroupComponent.prototype.setFocusOnNameInput = function () {
            if (this.nameInput) {
                this.nameInput.focus();
                this.nameInput.select();
            }
        };
        return AddGroupComponent;
    }());
    AddGroupComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-add-group',
                    template: "<c8y-title *ngIf=\"!currentGroupId\">\n  {{ 'Add group' | translate }}\n</c8y-title>\n\n<div class=\"d-contents\" *ngIf=\"!currentGroupId; else stepper\">\n  <ng-container [ngTemplateOutlet]=\"stepper\"></ng-container>\n</div>\n\n<ng-template #stepper>\n  <c8y-stepper\n    class=\"flex-col flex-nowrap no-align-items fit-h c8y-stepper--no-btns\"\n    [disableDefaultIcons]=\"{ edit: true, done: false }\"\n    [customClasses]=\"['col-md-6', 'col-md-offset-3', 'm-t-24', 'm-b-40', 'p-0', 'flex-no-shrink']\"\n    linear\n  >\n    <cdk-step [stepControl]=\"formGroupStepOne\" [label]=\"'New group' | translate\">\n      <div class=\"p-16 p-t-0 flex-no-shrink separator-bottom col-xs-12\">\n        <div class=\"row\">\n          <div class=\"col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4\">\n            <h4 class=\"text-center text-medium\">\n              {{ 'New group' | translate }}\n            </h4>\n          </div>\n        </div>\n      </div>\n      <div class=\"col-xs-12 flex-grow no-gutter\">\n        <div class=\"card-inner-scroll fit-h\">\n          <div class=\"card-block p-b-0\">\n            <div class=\"row\">\n              <div class=\"col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4\">\n                <c8y-form-group [novalidation]=\"true\">\n                  <div [formGroup]=\"formGroupStepOne\">\n                    <c8y-form-group>\n                      <label translate>Name</label>\n                      <input\n                        class=\"form-control\"\n                        type=\"text\"\n                        formControlName=\"name\"\n                        placeholder=\"{{ 'e.g. First floor' | translate }} \"\n                        maxlength=\"254\"\n                        #nameRef\n                        required\n                      />\n                    </c8y-form-group>\n\n                    <c8y-form-group>\n                      <label translate>Description</label>\n                      <input\n                        class=\"form-control\"\n                        type=\"text\"\n                        formControlName=\"description\"\n                        placeholder=\"{{ 'e.g. first floor devices' | translate }}\"\n                      />\n                    </c8y-form-group>\n                  </div>\n                </c8y-form-group>\n                <c8y-form-group>\n                  <div [formGroup]=\"formGroupStepOne\"></div>\n                </c8y-form-group>\n                <div class=\"alert alert-info max-width-100\" translate *ngIf=\"!canAssignDevice\">\n                  You don't have permission to assign devices.\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <c8y-stepper-buttons\n        class=\"d-block card-footer p-24 separator\"\n        (onCancel)=\"onCancel.emit()\"\n        (onCustom)=\"createGroup()\"\n        [disabled]=\"!canCreateGroup\"\n        [labels]=\"\n          canAssignDevice\n            ? { next: btnLabels.next, cancel: btnLabels.cancel }\n            : { custom: btnLabels.create, cancel: btnLabels.cancel }\n        \"\n        [showButtons]=\"\n          canAssignDevice ? { next: true, cancel: true } : { custom: true, cancel: true }\n        \"\n      ></c8y-stepper-buttons>\n    </cdk-step>\n    <cdk-step [label]=\"'Assign devices' | translate\">\n      <div class=\"p-16 p-t-0 flex-no-shrink separator-bottom col-xs-12\">\n        <div class=\"row\">\n          <div class=\"col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4\">\n            <h4 class=\"text-center text-medium\">\n              {{ 'Assign devices' | translate }}\n            </h4>\n          </div>\n        </div>\n      </div>\n      <div class=\"col-xs-12 no-gutter flex-grow\">\n        <c8y-device-grid\n          [title]=\"'Select target devices' | translate\"\n          [actionControls]=\"[]\"\n          [infiniteScroll]=\"'auto'\"\n          [selectable]=\"true\"\n          [pagination]=\"pagination\"\n          (itemsSelect)=\"onSelected($event)\"\n          [refresh]=\"refresh\"\n        >\n        </c8y-device-grid>\n      </div>\n      <c8y-stepper-buttons\n        class=\"d-block card-footer p-24 separator\"\n        (onCancel)=\"onCancel.emit()\"\n        (onCustom)=\"createGroup()\"\n        [labels]=\"{ custom: btnLabels.create }\"\n        [disabled]=\"!canAssignDevice\"\n        [pending]=\"pendingStatus\"\n      ></c8y-stepper-buttons>\n    </cdk-step>\n  </c8y-stepper>\n</ng-template>\n"
                },] }
    ];
    AddGroupComponent.ctorParameters = function () { return [
        { type: deviceGrid.DeviceGridService },
        { type: forms.FormBuilder },
        { type: AddGroupService },
        { type: i4.AlertService },
        { type: SubAssetsService }
    ]; };
    AddGroupComponent.propDecorators = {
        currentGroupId: [{ type: i0.Input }],
        refresh: [{ type: i0.Input }],
        onDeviceQueryStringChange: [{ type: i0.Output }],
        onCancel: [{ type: i0.Output }],
        stepper: [{ type: i0.ViewChild, args: [i4.C8yStepper, { static: false },] }],
        nameInputRef: [{ type: i0.ViewChild, args: ['nameRef', { static: false },] }],
        onEnterKeyDown: [{ type: i0.HostListener, args: ['document:keydown.enter', ['$event'],] }],
        onEscapeKeyDown: [{ type: i0.HostListener, args: ['document:keydown.escape', ['$event'],] }]
    };

    var ɵ0$1 = [
        {
            path: 'add-group',
            component: AddGroupComponent
        }
    ];
    var AddGroupModule = /** @class */ (function () {
        function AddGroupModule() {
        }
        return AddGroupModule;
    }());
    AddGroupModule.decorators = [
        { type: i0.NgModule, args: [{
                    declarations: [AddGroupComponent],
                    imports: [i4.CoreModule, deviceGrid.DeviceGridModule, forms.FormsModule, forms.ReactiveFormsModule],
                    entryComponents: [AddGroupComponent],
                    exports: [AddGroupComponent],
                    providers: [
                        {
                            provide: i4.HOOK_ROUTE,
                            useValue: ɵ0$1,
                            multi: true
                        },
                        AddGroupService
                    ]
                },] }
    ];

    var GroupsComponent = /** @class */ (function () {
        function GroupsComponent(permissions, subAssetsService) {
            this.permissions = permissions;
            this.subAssetsService = subAssetsService;
            this.refresh = new i0.EventEmitter();
            this.showAddGroup = false;
            this.filterable = true;
            this.sortable = true;
            this.shouldDisableAddGroup = false;
        }
        GroupsComponent.prototype.ngOnInit = function () {
            if (!this.permissions.hasRole('ROLE_INVENTORY_READ')) {
                this.sortable = false;
            }
            this.shouldDisableAddGroup = !this.subAssetsService.canCreateGroup();
        };
        return GroupsComponent;
    }());
    GroupsComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-groups-name',
                    template: "<c8y-title>\n  {{ 'Groups' | translate }}\n</c8y-title>\n<c8y-action-bar-item [placement]=\"'right'\">\n  <button\n    class=\"btn btn-link\"\n    title=\"{{ 'Add group' | translate }}\"\n    (click)=\"showAddGroup = !showAddGroup\"\n    [disabled]=\"shouldDisableAddGroup\"\n  >\n    <i c8yIcon=\"plus-circle\" class=\"m-r-4\"></i>\n    {{ 'Add group' | translate }}\n  </button>\n</c8y-action-bar-item>\n\n<c8y-help src=\"/users-guide/device-management/#grouping-devices\"></c8y-help>\n\n<div [ngClass]=\"{ drawerOpen: showAddGroup }\">\n  <div class=\"bottom-drawer\">\n    <c8y-add-group\n      [refresh]=\"refresh\"\n      (onCancel)=\"showAddGroup = false\"\n      *ngIf=\"showAddGroup\"\n    ></c8y-add-group>\n  </div>\n</div>\n<c8y-sub-assets-grid\n  [refresh]=\"refresh\"\n  [filterable]=\"filterable\"\n  [sortable]=\"sortable\"\n  class=\"content-fullpage d-flex d-col shadow1\"\n></c8y-sub-assets-grid>\n"
                },] }
    ];
    GroupsComponent.ctorParameters = function () { return [
        { type: i4.Permissions },
        { type: SubAssetsService }
    ]; };

    var AssignDevicesComponent = /** @class */ (function () {
        function AssignDevicesComponent(alert, subAssetsService, inventoryService, gainsightService) {
            this.alert = alert;
            this.subAssetsService = subAssetsService;
            this.inventoryService = inventoryService;
            this.gainsightService = gainsightService;
            this.refresh = new i0.EventEmitter();
            this.onCancel = new i0.EventEmitter();
            this.onShowChildDevices = new i0.EventEmitter();
            this.selectedDevice = new i0.EventEmitter();
            this.pendingStatus = false;
            this.pagination = { pageSize: 20, currentPage: 1 };
            this.selected = [];
            this.canAssignDevice = false;
            this.actionControls = [];
            this.headerActionControls = [];
            this.showChildren = false;
            this.isSelectable = true;
        }
        AssignDevicesComponent.prototype.onEnterKeyDown = function (event) {
            if (this.selected.length > 0) {
                this.assignDevices();
            }
        };
        AssignDevicesComponent.prototype.onEscapeKeyDown = function (event) {
            this.onCancel.emit();
        };
        AssignDevicesComponent.prototype.ngOnInit = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            this.setNotIncludedInGroupQuery();
                            _a = this;
                            return [4 /*yield*/, this.subAssetsService.canAssignDevice({
                                    id: this.currentGroupId
                                })];
                        case 1:
                            _a.canAssignDevice = _b.sent();
                            this.setHeaderActionControls();
                            return [2 /*return*/];
                    }
                });
            });
        };
        AssignDevicesComponent.prototype.setNotIncludedInGroupQuery = function () {
            var notIncludedInGroupQuery = { __not: { __bygroupid: this.currentGroupId } };
            this.baseQuery = notIncludedInGroupQuery;
        };
        AssignDevicesComponent.prototype.setHeaderActionControls = function () {
            var _this = this;
            var headerActionControls = [];
            var showChildDevices = {
                type: 'DISPLAY_CHILD_DEVICES_BUTTON',
                text: i4.gettext('Display child devices button'),
                template: this.showDevicesToggle,
                callback: function () {
                    _this.showChildren = !_this.showChildren;
                    _this.setActionControls(_this.showChildren);
                    _this.gainsightService.triggerEvent('assignDevices:DisplayChildDevices');
                }
            };
            headerActionControls.push(showChildDevices);
            this.headerActionControls = headerActionControls;
        };
        AssignDevicesComponent.prototype.setActionControls = function (showChildren) {
            var _this = this;
            var actionControls = [];
            var selectChildrenAction = {
                type: 'SHOW_TARGET_CHILD_DEVICES',
                icon: 'enter-bottom',
                text: i4.gettext('Show target child devices'),
                callback: function (asset) { return _this.selectChildren(asset); },
                showIf: function (asset) { return asset.childDevices.references.length > 0; }
            };
            if (showChildren) {
                actionControls.push(selectChildrenAction);
            }
            this.actionControls = actionControls;
            this.refresh.emit();
        };
        AssignDevicesComponent.prototype.assignDevices = function () {
            return __awaiter(this, void 0, void 0, function () {
                var error_1;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (this.canAssignDevice === false) {
                                return [2 /*return*/];
                            }
                            this.pendingStatus = true;
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4 /*yield*/, this.inventoryService.childAssetsBulkAdd(this.selected, this.currentGroupId)];
                        case 2:
                            _a.sent();
                            this.refresh.emit();
                            this.alert.success(i4.gettext('Devices assigned to the group.'));
                            return [3 /*break*/, 4];
                        case 3:
                            error_1 = _a.sent();
                            this.alert.danger(i4.gettext('Could not assign devices to the group'), error_1);
                            return [3 /*break*/, 4];
                        case 4:
                            this.pendingStatus = false;
                            this.selected = [];
                            this.onCancel.emit();
                            return [2 /*return*/];
                    }
                });
            });
        };
        AssignDevicesComponent.prototype.onSelected = function (selectedDevicesIDs) {
            this.selected = selectedDevicesIDs;
        };
        AssignDevicesComponent.prototype.selectChildren = function (asset) {
            this.onShowChildDevices.emit(true);
            this.selectedDevice.emit(asset);
        };
        return AssignDevicesComponent;
    }());
    AssignDevicesComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-assign-devices',
                    template: "<div class=\"card-block flex-no-shrink separator-bottom col-xs-12 large-padding p-t-24 p-b-24\">\n  <div class=\"row\">\n    <div class=\"col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4\">\n      <h4 class=\"text-center text-medium\">\n        {{ 'Assign devices' | translate }}\n      </h4>\n    </div>\n  </div>\n</div>\n<c8y-device-grid\n  [title]=\"'Select devices' | translate\"\n  [actionControls]=\"actionControls\"\n  [infiniteScroll]=\"'auto'\"\n  [selectable]=\"isSelectable\"\n  [pagination]=\"pagination\"\n  (itemsSelect)=\"onSelected($event)\"\n  [refresh]=\"refresh\"\n  [baseQuery]=\"baseQuery\"\n  [headerActionControls]=\"headerActionControls\"\n  [withChildren]=\"true\"\n  class=\"flex-grow col-xs-12 no-gutter\"\n>\n</c8y-device-grid>\n\n<div class=\"text-center card-footer p-24 separator\">\n  <button\n    (click)=\"onCancel.emit()\"\n    type=\"button\"\n    class=\"btn btn-default\"\n    title=\"{{ 'Cancel' | translate }}\"\n    c8yProductExperience\n    [actionName]=\"'assignDevices:Cancel'\"\n  >\n    <span>{{ 'Cancel' | translate }}</span>\n  </button>\n  <button\n    (click)=\"assignDevices()\"\n    type=\"button\"\n    class=\"btn btn-primary\"\n    [ngClass]=\"{ 'btn-pending': pendingStatus }\"\n    title=\"{{ 'Assign' | translate }}\"\n    [disabled]=\"selected.length === 0 || !canAssignDevice\"\n    c8yProductExperience\n    [actionName]=\"'assignDevices:Assign'\"\n  >\n    <span>{{ 'Assign' | translate }}</span>\n  </button>\n</div>\n\n<ng-template #showDevicesToggle let-control=\"headerActionControl\">\n  <label class=\"c8y-switch\">\n    <input type=\"checkbox\" [(ngModel)]=\"showChildren\" (click)=\"control.callback()\" />\n    <span></span>\n    <span>{{ control.text | translate }}</span>\n  </label>\n  <button\n    class=\"btn-clean m-r-8\"\n    [popover]=\"childDevicesPop\"\n    placement=\"bottom\"\n    [outsideClick]=\"true\"\n  >\n    <i c8yIcon=\"question-circle-o\" class=\"text-primary\"></i>\n  </button>\n  <ng-template #childDevicesPop>\n    <span translate>\n      Displays the button\n      <button class=\"btn btn-xs btn-icon btn-default no-pointer\">\n        <i class=\"text-primary dlt-c8y-icon-enter-bottom\"></i>\n      </button>\n      next to target devices with children. Clicking it displays a list with all child devices of\n      the selected target device.\n    </span>\n  </ng-template>\n</ng-template>\n"
                },] }
    ];
    AssignDevicesComponent.ctorParameters = function () { return [
        { type: i4.AlertService },
        { type: SubAssetsService },
        { type: client.InventoryService },
        { type: i4.GainsightService }
    ]; };
    AssignDevicesComponent.propDecorators = {
        currentGroupId: [{ type: i0.Input }],
        refresh: [{ type: i0.Input }],
        onCancel: [{ type: i0.Output }],
        onShowChildDevices: [{ type: i0.Output }],
        selectedDevice: [{ type: i0.Output }],
        showDevicesToggle: [{ type: i0.ViewChild, args: ['showDevicesToggle', { read: i0.TemplateRef },] }],
        onEnterKeyDown: [{ type: i0.HostListener, args: ['document:keydown.enter', ['$event'],] }],
        onEscapeKeyDown: [{ type: i0.HostListener, args: ['document:keydown.escape', ['$event'],] }]
    };

    var AssignChildDevicesComponent = /** @class */ (function () {
        function AssignChildDevicesComponent(alert, subAssetsService, inventoryService) {
            this.alert = alert;
            this.subAssetsService = subAssetsService;
            this.inventoryService = inventoryService;
            this.onCancel = new i0.EventEmitter();
            this.refresh = new i0.EventEmitter();
            this.selected = [];
            this.canAssignDevice = false;
            this.pendingStatus = false;
        }
        AssignChildDevicesComponent.prototype.onEnterKeyDown = function (event) {
            if (this.selected.length > 0) {
                this.assignDevices();
            }
        };
        AssignChildDevicesComponent.prototype.onEscapeKeyDown = function (event) {
            this.onCancel.emit();
        };
        AssignChildDevicesComponent.prototype.ngOnInit = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _a;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            this.setNotIncludedInGroupQuery();
                            _a = this;
                            return [4 /*yield*/, this.subAssetsService.canAssignDevice({
                                    id: this.currentGroupId
                                })];
                        case 1:
                            _a.canAssignDevice = _b.sent();
                            return [2 /*return*/];
                    }
                });
            });
        };
        AssignChildDevicesComponent.prototype.setNotIncludedInGroupQuery = function () {
            var notIncludedInGroupQuery = { __not: { __bygroupid: this.currentGroupId } };
            this.baseQuery = notIncludedInGroupQuery;
        };
        AssignChildDevicesComponent.prototype.assignDevices = function () {
            return __awaiter(this, void 0, void 0, function () {
                var error_1;
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (this.canAssignDevice === false) {
                                return [2 /*return*/];
                            }
                            this.pendingStatus = true;
                            _a.label = 1;
                        case 1:
                            _a.trys.push([1, 3, , 4]);
                            return [4 /*yield*/, this.inventoryService.childAssetsBulkAdd(this.selected, this.currentGroupId)];
                        case 2:
                            _a.sent();
                            this.refresh.emit();
                            this.alert.success(i4.gettext('Child devices assigned to the group.'));
                            return [3 /*break*/, 4];
                        case 3:
                            error_1 = _a.sent();
                            this.alert.danger(i4.gettext('Could not assign child devices to the group'), error_1);
                            return [3 /*break*/, 4];
                        case 4:
                            this.pendingStatus = false;
                            this.selected = [];
                            this.onCancel.emit();
                            return [2 /*return*/];
                    }
                });
            });
        };
        AssignChildDevicesComponent.prototype.onSelected = function (selectedDevicesIDs) {
            this.selected = selectedDevicesIDs;
        };
        return AssignChildDevicesComponent;
    }());
    AssignChildDevicesComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-assign-child-devices',
                    template: "<div class=\"card-block flex-no-shrink separator-bottom col-xs-12 large-padding p-t-24 p-b-24\">\n  <div class=\"row\">\n    <div class=\"col-md-6 col-md-offset-3 col-lg-4 col-lg-offset-4\">\n      <h4 class=\"text-center text-medium\">\n        {{ 'Assign child devices' | translate }}\n      </h4>\n    </div>\n  </div>\n</div>\n\n<div class=\"d-flex d-col no-align-items fit-h\">\n  <c8y-sub-assets-grid\n    [title]=\"'Select child devices' | translate\"\n    [emptyStateText]=\"'All child devices are already assigned to the group' | translate\"\n    [refresh]=\"refresh\"\n    [actionControls]=\"[]\"\n    [selectable]=\"true\"\n    [parent-group]=\"parentDevice\"\n    [baseQuery]=\"baseQuery\"\n    (itemsSelect)=\"onSelected($event)\"\n  >\n  </c8y-sub-assets-grid>\n</div>\n\n<div class=\"text-center card-footer p-24 separator\">\n  <button\n    (click)=\"onCancel.emit()\"\n    type=\"button\"\n    class=\"btn btn-default\"\n    title=\"{{ 'Cancel' | translate }}\"\n  >\n    <span>{{ 'Cancel' | translate }}</span>\n  </button>\n  <button\n    (click)=\"assignDevices()\"\n    type=\"button\"\n    class=\"btn btn-primary\"\n    [ngClass]=\"{ 'btn-pending': pendingStatus }\"\n    title=\"{{ 'Assign' | translate }}\"\n    [disabled]=\"selected.length === 0 || !canAssignDevice\"\n  >\n    <span>{{ 'Assign' | translate }}</span>\n  </button>\n</div>\n"
                },] }
    ];
    AssignChildDevicesComponent.ctorParameters = function () { return [
        { type: i4.AlertService },
        { type: SubAssetsService },
        { type: client.InventoryService }
    ]; };
    AssignChildDevicesComponent.propDecorators = {
        currentGroupId: [{ type: i0.Input }],
        parentDevice: [{ type: i0.Input }],
        onCancel: [{ type: i0.Output }],
        refresh: [{ type: i0.Input }],
        onEnterKeyDown: [{ type: i0.HostListener, args: ['document:keydown.enter', ['$event'],] }],
        onEscapeKeyDown: [{ type: i0.HostListener, args: ['document:keydown.escape', ['$event'],] }]
    };

    var AssetPropertiesComponent = /** @class */ (function () {
        function AssetPropertiesComponent(assetTypes, inventory, inventoryBinary, alert, contextRouteService, activatedRoute) {
            this.assetTypes = assetTypes;
            this.inventory = inventory;
            this.inventoryBinary = inventoryBinary;
            this.alert = alert;
            this.contextRouteService = contextRouteService;
            this.activatedRoute = activatedRoute;
            this.properties = [];
            this.customProperties = [];
            this.isEdit = false;
            this.isLoading = false;
        }
        AssetPropertiesComponent.prototype.ngOnChanges = function (changes) {
            if (changes.asset) {
                // Back button handling, as component is not destroyed
                this.assetType = undefined;
                this.customProperties = [];
                this.loadAsset();
            }
        };
        AssetPropertiesComponent.prototype.loadAsset = function () {
            return __awaiter(this, void 0, void 0, function () {
                var _c;
                return __generator(this, function (_d) {
                    switch (_d.label) {
                        case 0:
                            this.isLoading = true;
                            this.assetType = this.assetTypes.getAssetTypeByName(this.asset.type);
                            _c = this;
                            return [4 /*yield*/, this.resolveCustomProperties(this.properties)];
                        case 1:
                            _c.customProperties = _d.sent();
                            this.isLoading = false;
                            return [2 /*return*/];
                    }
                });
            });
        };
        AssetPropertiesComponent.prototype.resolveCustomProperties = function (managedObjects) {
            return __awaiter(this, void 0, void 0, function () {
                var properties, managedObjects_1, managedObjects_1_1, mo, items, e_1_1;
                var e_1, _c;
                return __generator(this, function (_d) {
                    switch (_d.label) {
                        case 0:
                            properties = [];
                            _d.label = 1;
                        case 1:
                            _d.trys.push([1, 6, 7, 8]);
                            managedObjects_1 = __values(managedObjects), managedObjects_1_1 = managedObjects_1.next();
                            _d.label = 2;
                        case 2:
                            if (!!managedObjects_1_1.done) return [3 /*break*/, 5];
                            mo = managedObjects_1_1.value;
                            if (!mo.c8y_JsonSchema) return [3 /*break*/, 4];
                            return [4 /*yield*/, this.parseItem(mo, mo.c8y_JsonSchema.properties, this.asset)];
                        case 3:
                            items = _d.sent();
                            properties.push(items[0]);
                            _d.label = 4;
                        case 4:
                            managedObjects_1_1 = managedObjects_1.next();
                            return [3 /*break*/, 2];
                        case 5: return [3 /*break*/, 8];
                        case 6:
                            e_1_1 = _d.sent();
                            e_1 = { error: e_1_1 };
                            return [3 /*break*/, 8];
                        case 7:
                            try {
                                if (managedObjects_1_1 && !managedObjects_1_1.done && (_c = managedObjects_1.return)) _c.call(managedObjects_1);
                            }
                            finally { if (e_1) throw e_1.error; }
                            return [7 /*endfinally*/];
                        case 8: return [2 /*return*/, properties];
                    }
                });
            });
        };
        AssetPropertiesComponent.prototype.parseItem = function (mo, properties, asset) {
            var _a, _b;
            return __awaiter(this, void 0, void 0, function () {
                var keys, items, keys_1, keys_1_1, key, value, type, title, file, fileId, fileData, _c, _d, _e, _f, e_2_1;
                var e_2, _g;
                return __generator(this, function (_h) {
                    switch (_h.label) {
                        case 0:
                            if (!asset) {
                                return [2 /*return*/, []];
                            }
                            keys = Object.keys(properties);
                            items = [];
                            _h.label = 1;
                        case 1:
                            _h.trys.push([1, 10, 11, 12]);
                            keys_1 = __values(keys), keys_1_1 = keys_1.next();
                            _h.label = 2;
                        case 2:
                            if (!!keys_1_1.done) return [3 /*break*/, 9];
                            key = keys_1_1.value;
                            value = asset[key];
                            type = properties[key].type;
                            title = properties[key].title;
                            file = void 0;
                            if (!(type === 'file' && value)) return [3 /*break*/, 4];
                            fileId = typeof value === 'object' ? (_b = (_a = value[0]) === null || _a === void 0 ? void 0 : _a.file) === null || _b === void 0 ? void 0 : _b.id : value;
                            return [4 /*yield*/, this.getFileManagedObject(fileId)];
                        case 3:
                            fileData = _h.sent();
                            file = fileData;
                            value = [fileData];
                            _h.label = 4;
                        case 4:
                            _d = (_c = items).push;
                            _e = {
                                key: key,
                                value: value,
                                label: title || mo.label,
                                type: type,
                                description: mo.description,
                                file: file
                            };
                            if (!(type === 'object')) return [3 /*break*/, 6];
                            return [4 /*yield*/, this.parseItem(mo, properties[key].properties, asset[key])];
                        case 5:
                            _f = _h.sent();
                            return [3 /*break*/, 7];
                        case 6:
                            _f = undefined;
                            _h.label = 7;
                        case 7:
                            _d.apply(_c, [(_e.complex = _f,
                                    _e.isEdit = false,
                                    _e.jsonSchema = mo.c8y_JsonSchema,
                                    _e)]);
                            _h.label = 8;
                        case 8:
                            keys_1_1 = keys_1.next();
                            return [3 /*break*/, 2];
                        case 9: return [3 /*break*/, 12];
                        case 10:
                            e_2_1 = _h.sent();
                            e_2 = { error: e_2_1 };
                            return [3 /*break*/, 12];
                        case 11:
                            try {
                                if (keys_1_1 && !keys_1_1.done && (_g = keys_1.return)) _g.call(keys_1);
                            }
                            finally { if (e_2) throw e_2.error; }
                            return [7 /*endfinally*/];
                        case 12: return [2 /*return*/, items];
                    }
                });
            });
        };
        AssetPropertiesComponent.prototype.toggleEdit = function (prop) {
            prop.isEdit = !prop.isEdit;
        };
        AssetPropertiesComponent.prototype.getFileManagedObject = function (id) {
            return __awaiter(this, void 0, void 0, function () {
                var data, ex_1;
                return __generator(this, function (_c) {
                    switch (_c.label) {
                        case 0:
                            _c.trys.push([0, 2, , 3]);
                            return [4 /*yield*/, this.inventory.detail(id)];
                        case 1:
                            data = (_c.sent()).data;
                            return [2 /*return*/, data];
                        case 2:
                            ex_1 = _c.sent();
                            this.alert.addServerFailure(ex_1);
                            return [3 /*break*/, 3];
                        case 3: return [2 /*return*/];
                    }
                });
            });
        };
        AssetPropertiesComponent.prototype.save = function (model, prop) {
            return __awaiter(this, void 0, void 0, function () {
                var _c, _d, updatedAsset, data, ex_2;
                return __generator(this, function (_e) {
                    switch (_e.label) {
                        case 0:
                            _e.trys.push([0, 7, , 8]);
                            if (!(prop.type === 'object')) return [3 /*break*/, 2];
                            _c = model;
                            _d = prop.key;
                            return [4 /*yield*/, this.uploadFiles(model[prop.key], prop.value)];
                        case 1:
                            _c[_d] = _e.sent();
                            return [3 /*break*/, 4];
                        case 2: return [4 /*yield*/, this.uploadFiles(model, prop.value)];
                        case 3:
                            model = _e.sent();
                            _e.label = 4;
                        case 4:
                            updatedAsset = Object.assign({ id: this.asset.id }, model);
                            return [4 /*yield*/, this.inventory.update(updatedAsset)];
                        case 5:
                            data = (_e.sent()).data;
                            this.toggleEdit(prop);
                            this.asset = data;
                            return [4 /*yield*/, this.loadAsset()];
                        case 6:
                            _e.sent();
                            this.contextRouteService.refreshContext();
                            this.alert.success(i4.gettext('Asset properties updated.'));
                            this.contextRouteService.setContext(this.activatedRoute, data);
                            return [3 /*break*/, 8];
                        case 7:
                            ex_2 = _e.sent();
                            this.alert.addServerFailure(ex_2);
                            return [3 /*break*/, 8];
                        case 8: return [2 /*return*/];
                    }
                });
            });
        };
        AssetPropertiesComponent.prototype.uploadFiles = function (model, moId) {
            var _a;
            return __awaiter(this, void 0, void 0, function () {
                var keys, keys_2, keys_2_1, key, upload, ex_3, ex_4, e_3_1;
                var e_3, _c;
                return __generator(this, function (_d) {
                    switch (_d.label) {
                        case 0:
                            keys = Object.keys(model);
                            _d.label = 1;
                        case 1:
                            _d.trys.push([1, 14, 15, 16]);
                            keys_2 = __values(keys), keys_2_1 = keys_2.next();
                            _d.label = 2;
                        case 2:
                            if (!!keys_2_1.done) return [3 /*break*/, 13];
                            key = keys_2_1.value;
                            if (!(Array.isArray(model[key]) && ((_a = model[key][0]) === null || _a === void 0 ? void 0 : _a.file) instanceof File)) return [3 /*break*/, 12];
                            _d.label = 3;
                        case 3:
                            _d.trys.push([3, 11, , 12]);
                            return [4 /*yield*/, this.inventoryBinary.create(model[key][0].file)];
                        case 4:
                            upload = _d.sent();
                            _d.label = 5;
                        case 5:
                            _d.trys.push([5, 8, , 9]);
                            if (!(moId && moId[0])) return [3 /*break*/, 7];
                            return [4 /*yield*/, this.inventory.childAdditionsRemove(moId[0], this.asset.id)];
                        case 6:
                            _d.sent();
                            _d.label = 7;
                        case 7: return [3 /*break*/, 9];
                        case 8:
                            ex_3 = _d.sent();
                            this.alert.addServerFailure(ex_3);
                            return [3 /*break*/, 9];
                        case 9:
                            model[key] = upload.data.id;
                            return [4 /*yield*/, this.inventory.childAdditionsAdd(upload.data.id, this.asset.id)];
                        case 10:
                            _d.sent();
                            return [3 /*break*/, 12];
                        case 11:
                            ex_4 = _d.sent();
                            this.alert.addServerFailure(ex_4);
                            return [3 /*break*/, 12];
                        case 12:
                            keys_2_1 = keys_2.next();
                            return [3 /*break*/, 2];
                        case 13: return [3 /*break*/, 16];
                        case 14:
                            e_3_1 = _d.sent();
                            e_3 = { error: e_3_1 };
                            return [3 /*break*/, 16];
                        case 15:
                            try {
                                if (keys_2_1 && !keys_2_1.done && (_c = keys_2.return)) _c.call(keys_2);
                            }
                            finally { if (e_3) throw e_3.error; }
                            return [7 /*endfinally*/];
                        case 16: return [2 /*return*/, model];
                    }
                });
            });
        };
        return AssetPropertiesComponent;
    }());
    AssetPropertiesComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-asset-properties',
                    template: "<ng-container>\n  <div class=\"card-header bg-inherit separator sticky-top\">\n    <h4\n      class=\"card-title p-t-4 p-b-4\"\n      ngNonBindable\n      translate\n      [translateParams]=\"{ label: (assetType?.label || '') | humanize }\"\n    >\n      {{ label }} properties\n    </h4>\n  </div>\n  <div class=\"card-block\">\n    <div class=\"text-center\" *ngIf=\"isLoading\">\n      <c8y-loading></c8y-loading>\n    </div>\n\n    <ng-container *ngIf=\"!isLoading\">\n      <div\n        class=\"card m-b-8\"\n        *ngFor=\"let prop of customProperties\"\n        [ngClass]=\"{ 'card-highlight': prop.isEdit }\"\n        title=\"{{ prop.description | translate }}\"\n      >\n        <div class=\"card-block \" [ngClass]=\"{'p-b-0': prop.isEdit}\">\n          <div class=\"d-flex p-b-8\" *ngIf=\"!prop.isEdit\">\n            <p class=\"text-medium\">{{ prop?.label | humanize }}</p>\n            <button\n              class=\"btn btn-clean text-primary m-l-auto text-12\"\n              title=\"{{ 'Edit' | translate }}\"\n              (click)=\"toggleEdit(prop)\"\n            >\n              <i c8yIcon=\"pencil\"></i>\n            </button>\n          </div>\n          <c8y-asset-properties-item\n            #assetProps\n            [file]=\"prop.file\"\n            [key]=\"prop.key\"\n            [type]=\"prop.type\"\n            [value]=\"prop.value\"\n            [complex]=\"prop.complex\"\n            [isEdit]=\"prop.isEdit\"\n            [jsonSchema]=\"prop.jsonSchema\"\n          ></c8y-asset-properties-item>\n        </div>\n        <div class=\"card-footer p-t-0\" *ngIf=\"prop.isEdit\">\n          <button type=\"button\" class=\"btn btn-default btn-sm\" translate (click)=\"toggleEdit(prop)\">\n            Cancel\n          </button>\n          <button\n            type=\"button\"\n            class=\"btn btn-primary btn-sm\"\n            translate\n            [disabled]=\"!assetProps?.form?.valid\"\n            (click)=\"save(assetProps.model, prop)\"\n          >\n            Save\n          </button>\n        </div>\n      </div>\n    </ng-container>\n  </div>\n</ng-container>\n"
                },] }
    ];
    AssetPropertiesComponent.ctorParameters = function () { return [
        { type: i4.AssetTypesService },
        { type: client.InventoryService },
        { type: client.InventoryBinaryService },
        { type: i4.AlertService },
        { type: i4.ContextRouteService },
        { type: router.ActivatedRoute }
    ]; };
    AssetPropertiesComponent.propDecorators = {
        asset: [{ type: i0.Input }],
        properties: [{ type: i0.Input }]
    };

    var AssetPropertiesItemComponent = /** @class */ (function () {
        function AssetPropertiesItemComponent(alert, c8yJsonSchemaService, filesService) {
            this.alert = alert;
            this.c8yJsonSchemaService = c8yJsonSchemaService;
            this.filesService = filesService;
        }
        AssetPropertiesItemComponent.prototype.ngOnChanges = function (changes) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    switch (_a.label) {
                        case 0:
                            if (!changes.isEdit) return [3 /*break*/, 2];
                            this.resolveJsonSchema();
                            return [4 /*yield*/, this.resolveFile()];
                        case 1:
                            _a.sent();
                            _a.label = 2;
                        case 2: return [2 /*return*/];
                    }
                });
            });
        };
        AssetPropertiesItemComponent.prototype.resolveFile = function () {
            return __awaiter(this, void 0, void 0, function () {
                var imageFile, _a, ex_1;
                return __generator(this, function (_b) {
                    switch (_b.label) {
                        case 0:
                            if (!this.file) return [3 /*break*/, 5];
                            _b.label = 1;
                        case 1:
                            _b.trys.push([1, 4, , 5]);
                            return [4 /*yield*/, this.filesService.getFile(this.file)];
                        case 2:
                            imageFile = _b.sent();
                            _a = this;
                            return [4 /*yield*/, this.getPreviewIfImage(imageFile)];
                        case 3:
                            _a.previewImage = _b.sent();
                            return [3 /*break*/, 5];
                        case 4:
                            ex_1 = _b.sent();
                            this.alert.danger(i4.gettext('File could not be loaded.'));
                            return [3 /*break*/, 5];
                        case 5: return [2 /*return*/];
                    }
                });
            });
        };
        AssetPropertiesItemComponent.prototype.resolveJsonSchema = function () {
            var _a;
            if (this.jsonSchema) {
                var fieldConfig = this.c8yJsonSchemaService.toFieldConfig(this.jsonSchema, this.jsonSchema);
                this.form = new forms.FormGroup({});
                this.fields = [fieldConfig];
                this.model = (_a = {},
                    _a[this.key] = this.value,
                    _a);
            }
        };
        AssetPropertiesItemComponent.prototype.getPreviewIfImage = function (imageFile) {
            return __awaiter(this, void 0, void 0, function () {
                return __generator(this, function (_a) {
                    if (this.filesService.haveValidExtensions(imageFile, 'image')) {
                        return [2 /*return*/, this.filesService.toBase64(imageFile)];
                    }
                    return [2 /*return*/];
                });
            });
        };
        return AssetPropertiesItemComponent;
    }());
    AssetPropertiesItemComponent.decorators = [
        { type: i0.Component, args: [{
                    selector: 'c8y-asset-properties-item',
                    template: "<ng-container [ngSwitch]=\"type\" *ngIf=\"!isEdit\">\n  <ng-container *ngSwitchCase=\"'date'\">\n    {{ value | c8yDate: 'fullDate' }}\n  </ng-container>\n  <ng-container *ngSwitchCase=\"'file'\">\n    <ng-container *ngIf=\"file\">\n      <img *ngIf=\"previewImage\" [src]=\"previewImage\" class=\"img-responsive\" />\n      <button\n        *ngIf=\"!previewImage\"\n        (click)=\"filesService.download(file)\"\n        type=\"button\"\n        title=\"{{ 'Download' | translate }} {{ file.name }}\"\n        class=\"btn btn-clean text-truncate p-0\"\n      >\n        {{ file.name }}\n      </button>\n    </ng-container>\n    <ng-container *ngIf=\"!file\">\n      {{ 'No file attached.' | translate }}\n    </ng-container>\n  </ng-container>\n  <ng-container *ngSwitchCase=\"'object'\">\n    <ul class=\"list-unstyled c8y-custom-properties\">\n      <li\n        *ngFor=\"let prop of complex; let i = index\"\n        [ngClass]=\"{ 'separator-top-bottom': i === 0, 'separator-bottom': i > 0 }\"\n        class=\"p-t-4 p-b-4 flex-row text-nowrap\"\n      >\n        <label class=\"small m-b-0 m-r-8\" [ngClass]=\"{ 'a-s-start': prop.file }\">\n          {{ prop.label | humanize }}\n        </label>\n        <span class=\"m-l-auto\" style=\"max-width: {{ prop.file ? '50%' : '100%' }}\">\n          <c8y-asset-properties-item\n            [file]=\"prop.file\"\n            [key]=\"prop.key\"\n            [type]=\"prop.type\"\n            [value]=\"prop.value\"\n          ></c8y-asset-properties-item>\n        </span>\n      </li>\n    </ul>\n  </ng-container>\n  <!--  \n  <ng-container *ngSwitchCase=\"'boolean'\">\n      <input type=\"checkbox\" [checked]=\"value\" [disabled]=\"true\" />\n    </ng-container>\n  -->\n  <ng-container *ngSwitchDefault>\n    <p>{{ (value | translate) || ('Undefined' | translate) }}</p>\n  </ng-container>\n</ng-container>\n<formly-form *ngIf=\"isEdit\" [form]=\"form\" [fields]=\"fields\" [model]=\"model\"></formly-form>\n"
                },] }
    ];
    AssetPropertiesItemComponent.ctorParameters = function () { return [
        { type: i4.AlertService },
        { type: i4.C8yJSONSchema },
        { type: i4.FilesService }
    ]; };
    AssetPropertiesItemComponent.propDecorators = {
        key: [{ type: i0.Input }],
        value: [{ type: i0.Input }],
        label: [{ type: i0.Input }],
        type: [{ type: i0.Input }],
        file: [{ type: i0.Input }],
        complex: [{ type: i0.Input }],
        isEdit: [{ type: i0.Input }],
        jsonSchema: [{ type: i0.Input }]
    };

    var ɵ0 = [
        {
            context: i4.ViewContext.Group,
            path: 'subassets',
            priority: 1000,
            icon: 'c8y-group-open',
            label: i4.gettext('Subassets'),
            component: SubAssetsComponent,
            featureId: 'subassets'
        },
        {
            path: 'group',
            component: GroupsComponent
        }
    ];
    var SubAssetsModule = /** @class */ (function () {
        function SubAssetsModule() {
        }
        return SubAssetsModule;
    }());
    SubAssetsModule.decorators = [
        { type: i0.NgModule, args: [{
                    declarations: [
                        SubAssetsComponent,
                        SubAssetsGridComponent,
                        AssetTypeCellRendererComponent,
                        GroupsComponent,
                        GroupInfoComponent,
                        DeleteAssetsModalComponent,
                        UnassignModalComponent,
                        AssignDevicesComponent,
                        AssignChildDevicesComponent,
                        AssetPropertiesComponent,
                        AssetPropertiesItemComponent
                    ],
                    imports: [i4.CoreModule, deviceGrid.DeviceGridModule, AddGroupModule, popover.PopoverModule],
                    entryComponents: [
                        SubAssetsComponent,
                        AssetTypeCellRendererComponent,
                        GroupsComponent,
                        DeleteAssetsModalComponent,
                        UnassignModalComponent
                    ],
                    exports: [],
                    providers: [
                        {
                            provide: i4.HOOK_ROUTE,
                            useValue: ɵ0,
                            multi: true
                        },
                        SubAssetsService
                    ]
                },] }
    ];

    /**
     * Generated bundle index. Do not edit.
     */

    exports.AddGroupComponent = AddGroupComponent;
    exports.AddGroupModule = AddGroupModule;
    exports.AddGroupService = AddGroupService;
    exports.AssetTypeCellRendererComponent = AssetTypeCellRendererComponent;
    exports.AssetTypeGridColumn = AssetTypeGridColumn;
    exports.AssignChildDevicesComponent = AssignChildDevicesComponent;
    exports.AssignDevicesComponent = AssignDevicesComponent;
    exports.DeleteAssetsModalComponent = DeleteAssetsModalComponent;
    exports.GroupInfoComponent = GroupInfoComponent;
    exports.GroupsComponent = GroupsComponent;
    exports.SubAssetsComponent = SubAssetsComponent;
    exports.SubAssetsGridComponent = SubAssetsGridComponent;
    exports.SubAssetsModule = SubAssetsModule;
    exports.SubAssetsService = SubAssetsService;
    exports.UnassignModalComponent = UnassignModalComponent;
    exports["ɵa"] = AssetTypeCellRendererComponent;
    exports["ɵb"] = DeleteAssetsModalComponent;
    exports["ɵc"] = UnassignModalComponent;
    exports["ɵd"] = AssetPropertiesComponent;
    exports["ɵe"] = AssetPropertiesItemComponent;
    exports["ɵf"] = AddGroupModule;
    exports["ɵg"] = AddGroupComponent;
    exports["ɵh"] = AddGroupService;

    Object.defineProperty(exports, '__esModule', { value: true });

}));
//# sourceMappingURL=c8y-ngx-components-sub-assets.umd.js.map
