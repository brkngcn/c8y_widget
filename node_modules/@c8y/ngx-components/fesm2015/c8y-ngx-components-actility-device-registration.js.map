{"version":3,"file":"c8y-ngx-components-actility-device-registration.js","sources":["../../actility-device-registration/actility-device-registration.service.ts","../../actility-device-registration/actility-device-registration.component.ts","../../actility-device-registration/actility-device-registration-button.component.ts","../../actility-device-registration/actility-device-registration.factory.ts","../../actility-device-registration/actility-device-registration.module.ts","../../actility-device-registration/c8y-ngx-components-actility-device-registration.ts"],"names":[],"mappings":"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","sourcesContent":["import { Injectable } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport {\n  FetchClient,\n  IFetchOptions,\n  ApplicationService,\n  IManagedObject,\n  InventoryService,\n  IResultList\n} from '@c8y/client';\nimport { gettext, OptionsService } from '@c8y/ngx-components';\nimport {\n  ActilityDeviceRegistration,\n  ConnectivityPlan,\n  DeviceProfile\n} from './actility-device-registration.model';\nimport { some } from 'lodash-es';\n\nexport enum ErrorName {\n  NoConnectivityPlansError = 'NoConnectivityPlansError',\n  NoFreeSlotsInConnectivityPlansError = 'NoFreeSlotsInConnectivityPlansError',\n  NoConnectivitySettingsError = 'NoConnectivitySettingsError',\n  NoDeviceProfilesError = 'NoDeviceProfilesError',\n  DeviceProfilesFetchError = 'DeviceProfilesFetchError',\n  NoDeviceProtocolsError = 'NoDeviceProtocolsError',\n  DeviceProtocolsFetchError = 'DeviceProtocolsFetchError',\n  RegistrationError = 'RegistrationError'\n}\n\n@Injectable({ providedIn: 'root' })\nexport class ActilityDeviceRegistrationService {\n  private baseUrl = '/service/actility';\n  private registrationUrl: string = `${this.baseUrl}/newDeviceRequest`;\n  private connectivityPlansUrl: string = `${this.baseUrl}/connectivityPlans`;\n  private deviceProfilesUrl: string = `${this.baseUrl}/deviceProfiles`;\n  private headers: object = {\n    'Content-Type': 'application/json'\n  };\n\n  constructor(\n    private inventoryService: InventoryService,\n    private client: FetchClient,\n    private translateService: TranslateService,\n    private applicationService: ApplicationService,\n    private optionsService: OptionsService\n  ) {}\n\n  async getConnections() {\n    const options: IFetchOptions = {\n      method: 'GET',\n      headers: this.headers\n    };\n    const res = await this.client.fetch(`${this.baseUrl}/lns-connection`, options);\n    const data = await res.json();\n\n    if (res.status === 200) {\n      if (data.length === 0) {\n      await this.throwNoConnectivitySettingsError();\n      }\n    } else {\n      await this.throwNoConnectivitySettingsError();\n    }\n    return { res, data };\n  }\n  /**\n   * Gets connectivity plans from LoRa platform.\n   * @param connectionName The name of connection for which connectivity plans will be retrieved\n   * @returns The result list with connectivity plans, or throws an error with exception.\n   */\n  async getConnectivityPlans(connectionName: string): Promise<IResultList<ConnectivityPlan>> {\n    const options: IFetchOptions = {\n      method: 'GET',\n      headers: this.headers,\n      params: {\n        actilityConnectionName: connectionName\n      }\n    };\n\n    const res = await this.client.fetch(this.connectivityPlansUrl, options);\n    const data = await res.json();\n\n    if (res.status === 200) {\n      if (data.length === 0) {\n        this.throwNoConnectivityPlansError();\n      } else {\n        if (!this.hasAvailableConnections(data)) {\n          this.throwNoFreeSlotsInConnectivityPlansError();\n        }\n      }\n    } else {\n      await this.throwNoConnectivitySettingsError();\n    }\n\n    return { res, data };\n  }\n\n  /**\n   * Gets the device profiles from LoRa platform.\n   * @param connectionName The name of connection for which device profiles will be retrieved\n   * @returns The result list with device profiles, or throws an error with exception.\n   */\n  async getDeviceProfiles(connectionName: string): Promise<IResultList<DeviceProfile>> {\n    const options: IFetchOptions = {\n      method: 'GET',\n      headers: this.headers,\n      params: {\n        actilityConnectionName: connectionName\n      }\n    };\n\n    const res = await this.client.fetch(this.deviceProfilesUrl, options);\n    const data = await res.json();\n\n    if (res.status === 200) {\n      if (data.length === 0) {\n        this.throwNoDeviceProfilesError();\n      }\n    } else {\n      this.throwDeviceProfilesFetchError();\n    }\n\n    return { res, data };\n  }\n\n  /**\n   * Gets the device protocols\n   */\n  async getDeviceProtocols(): Promise<IResultList<IManagedObject>> {\n    const filters = {\n      pageSize: 20,\n      withTotalPages: true\n    };\n    const query = {\n      __filter: {\n        __and: [\n          { __has: 'c8y_IsDeviceType' },\n          {\n            type: { __in: ['c8y_ActilityDeviceType', 'c8y_LoraDeviceType', 'c8y_LpwanDeviceType'] }\n          }\n        ]\n      },\n      __orderby: [{ name: 1 }]\n    };\n    const { res, data } = await this.inventoryService.listQuery(query, filters);\n\n    if (res.status === 200) {\n      if (data.length === 0) {\n        this.throwNoDeviceProtocolsError();\n      }\n    } else {\n      this.throwDeviceProtocolsFetchError();\n    }\n\n    return { res, data };\n  }\n\n  /**\n   * Creates device registration\n   */\n  async register(registration: ActilityDeviceRegistration) {\n    const options: IFetchOptions = {\n      method: 'POST',\n      headers: this.headers,\n      body: JSON.stringify(registration)\n    };\n\n    const res = await this.client.fetch(this.registrationUrl, options);\n    const data = await res.json();\n\n    if (res.status !== 201) {\n      this.throwRegistrationError(data);\n    }\n\n    return { res, data };\n  }\n\n  /**\n   * checks if used connections is less then granted connections\n   */\n  private hasAvailableConnections(connectivityPlans) {\n    return some(\n      connectivityPlans,\n      plan => parseInt(plan.grantedConnections, 10) > parseInt(plan.usedConnections, 10)\n    );\n  }\n\n  private async throwNoConnectivitySettingsError() {\n    const error = new Error();\n    error.name = ErrorName.NoConnectivitySettingsError;\n\n    if ((await this.applicationService.isAvailable('administration')).data) {\n      error.message = this.translateService.instant(\n        gettext(\n          `Could not get connectivity plans from the LoRa platform. Verify the ThingPark credentials in the Administration app under <a href=\"{{ link }}\">Settings</a>.`\n        ),\n        {\n          link: '/apps/administration/index.html#/connectivitySettings/actility_lora_provider_settings'\n        }\n      );\n    } else {\n      error.message = gettext(\n        'Could not get connectivity plans from the LoRa platform. Please contact the administrator.'\n      );\n    }\n\n    throw error;\n  }\n\n  private throwNoConnectivityPlansError() {\n    const error = new Error();\n    error.name = ErrorName.NoConnectivityPlansError;\n    error.message = gettext(\n      'No connectivity plans found. New connectivity plans must be created via the LoRa platform.'\n    );\n    throw error;\n  }\n\n  private throwNoFreeSlotsInConnectivityPlansError() {\n    const companyName = this.optionsService.get('companyName', 'Cumulocity IoT');\n    const error = new Error();\n    error.name = ErrorName.NoFreeSlotsInConnectivityPlansError;\n    error.message = this.translateService.instant(\n      gettext(\n        `No connectivity plans with free slots available. Please contact ThingPark on the device quota limits for your connectivity plans or remove unused devices from ThingPark and retry registering the device in the {{companyName}} platform.`\n      ),\n      {\n        companyName\n      }\n    );\n    throw error;\n  }\n\n  private throwDeviceProfilesFetchError() {\n    const error = new Error();\n    error.name = ErrorName.DeviceProfilesFetchError;\n    error.message = gettext('Could not load device profiles from the LoRa platform.');\n    throw error;\n  }\n\n  private throwNoDeviceProfilesError() {\n    const error = new Error();\n    error.name = ErrorName.NoDeviceProfilesError;\n    error.message = gettext(\n      'No device profiles found. Create a new device profile via the LoRa platform.'\n    );\n    throw error;\n  }\n\n  private throwDeviceProtocolsFetchError() {\n    const error = new Error();\n    error.name = ErrorName.DeviceProtocolsFetchError;\n    error.message = gettext('Could not load device protocols.');\n    throw error;\n  }\n\n  private throwNoDeviceProtocolsError() {\n    const error = new Error();\n    error.name = ErrorName.NoDeviceProtocolsError;\n    error.message = this.translateService.instant(\n      gettext(\n        `No device protocols configured. Create a LoRa device protocol in <a href=\"{{ link }}\">Device protocols</a>.`\n      ),\n      {\n        link: '/apps/devicemanagement/#/deviceprotocols'\n      }\n    );\n    throw error;\n  }\n\n  private throwRegistrationError(data: { message: string }) {\n    const error = new Error();\n    error.name = ErrorName.RegistrationError;\n    error.message = data.message;\n    throw error;\n  }\n}\n","import { Component } from '@angular/core';\nimport { FormlyFieldConfig } from '@ngx-formly/core';\nimport { gettext, C8yStepper } from '@c8y/ngx-components';\nimport { AbstractControl, FormGroup } from '@angular/forms';\nimport { from, forkJoin, of, BehaviorSubject, throwError, defer, Subject } from 'rxjs';\nimport { cloneDeep, uniq } from 'lodash-es';\nimport { CdkStep } from '@angular/cdk/stepper';\nimport { BsModalRef } from 'ngx-bootstrap/modal';\nimport {\n  ActilityDeviceRegistrationService,\n  ErrorName\n} from './actility-device-registration.service';\nimport { ActilityDeviceRegistration } from './actility-device-registration.model';\nimport { map, catchError, switchMap, shareReplay, takeUntil, mergeMap } from 'rxjs/operators';\ntype State =\n  | 'loadPending'\n  | 'loadSuccess'\n  | 'loadError'\n  | 'registrationPending'\n  | 'registrationSuccess'\n  | 'registrationError';\n@Component({\n  selector: 'c8y-actility-registration',\n  templateUrl: 'actility-device-registration.component.html'\n})\nexport class ActilityDeviceRegistrationComponent {\n  stepper: C8yStepper;\n  registrationStepLabels = {\n    next: gettext('Register')\n  };\n  finalStepLabels = {\n    custom: gettext('Close')\n  };\n\n  state: State = 'loadPending';\n  errors$ = new BehaviorSubject<Error[]>([]);\n  errorMessages$ = this.errors$.pipe(\n    map(errors => errors.map(error => error.message)),\n    map(messages => uniq(messages))\n  );\n\n  connections$ = this.getConnections$();\n  deviceProtocols$ = this.getDeviceProtocols$();\n  unsubscribe$: Subject<void> = new Subject();\n  load$ = this.connections$.pipe(\n    catchError((error: Error) => of(error)),\n    switchMap(connections => {\n      if (\n        connections instanceof Error &&\n        connections.name === ErrorName.NoConnectivitySettingsError\n      ) {\n        return of([connections]);\n      }\n\n      return forkJoin([\n        of(connections),\n        this.deviceProtocols$.pipe(catchError((error: Error) => of(error)))\n      ]);\n    }),\n    map(results => results.filter(result => result instanceof Error)),\n    switchMap(errors => (errors.length === 0 ? of([]) : throwError(errors)))\n  );\n\n  form = new FormGroup({});\n  model = {} as ActilityDeviceRegistration;\n\n  // Formly schema definition to render actility device registration form\n  fields: FormlyFieldConfig[] = [\n    {\n      key: 'connection',\n      type: 'typeahead',\n      templateOptions: {\n        label: gettext('Connection'),\n        required: true,\n        c8yForOptions: this.connections$,\n        displayProperty: 'name',\n        valueProperties: ['name']\n      }\n    },\n    {\n      key: 'deviceProfile',\n      type: 'typeahead',\n      templateOptions: {\n        label: gettext('Device profile'),\n        required: true,\n        displayProperty: 'name',\n        placeholder: 'IWM-LR3',\n        valueProperties: ['id', 'name', 'typeMAC']\n      },\n      hooks: {\n        onInit: field => {\n          const connectionControl = field.form.get('connection');\n          connectionControl.valueChanges\n            .pipe(\n              takeUntil(this.unsubscribe$),\n              mergeMap(() => this.getDeviceProfiles$(this.form.get('connection').value.name))\n            )\n            .subscribe(\n              profiles => {\n                field.templateOptions.c8yForOptions = of(profiles);\n                field.formControl.setValue(null);\n              },\n              error => {\n                field.form.controls.deviceProfile.setErrors({ deviceProfile: true });\n                field.validators.deviceProfile.message = error.message;\n              }\n            );\n        }\n      },\n      validators: {\n        deviceProfile: {\n          expression: (control: AbstractControl) => {\n            return control.status === 'VALID';\n          },\n          message: () => ''\n        }\n      }\n    },\n    {\n      key: 'deviceType',\n      type: 'typeahead',\n      templateOptions: {\n        label: gettext('Device protocol'),\n        required: true,\n        c8yForOptions: this.deviceProtocols$,\n        displayProperty: 'name',\n        valueProperties: ['id', 'name']\n      }\n    },\n    {\n      key: 'devEUI',\n      type: 'input',\n      templateOptions: {\n        placeholder: '0018A20000000004',\n        label: gettext('Device EUI'),\n        required: true,\n        pattern: '^([a-fA-F0-9]{16})$'\n      },\n      validation: {\n        messages: {\n          pattern: gettext('Must be a valid 16 digit hexadecimal number.')\n        }\n      }\n    },\n    {\n      key: 'applicationEUI',\n      type: 'input',\n      templateOptions: {\n        placeholder: '70B3D53260000003',\n        label: gettext('Application EUI'),\n        required: true,\n        pattern: '^([a-fA-F0-9]{16})$'\n      },\n      validation: {\n        messages: {\n          pattern: gettext('Must be a valid 16 digit hexadecimal number.')\n        }\n      }\n    },\n    {\n      key: 'applicationKey',\n      type: 'input',\n      templateOptions: {\n        label: gettext('Application key'),\n        placeholder: '258DB54023EA74F0D55085F7351737D0',\n        required: true,\n        pattern: '^([a-fA-F0-9]{32})$'\n      },\n      validation: {\n        messages: {\n          pattern: gettext('Must be a valid 32 digit hexadecimal number.')\n        }\n      }\n    },\n    {\n      key: 'connectivityPlan',\n      type: 'typeahead',\n      templateOptions: {\n        label: gettext('Connectivity plan'),\n        description: gettext('Only connectivity plans with free slots are displayed'),\n        required: true,\n        placeholder: 'Dev-ope testing CP',\n        displayProperty: 'name',\n        valueProperties: ['id', 'ref', 'name', 'grantedConnections', 'usedConnections']\n      },\n      hooks: {\n        onInit: field => {\n          const connectionControl = field.form.get('connection');\n          connectionControl.valueChanges\n            .pipe(\n              takeUntil(this.unsubscribe$),\n              mergeMap(() => this.getConnectivityPlans$(this.form.get('connection').value.name))\n            )\n            .subscribe(\n              profiles => {\n                field.templateOptions.c8yForOptions = of(profiles);\n                field.formControl.setValue(null);\n              },\n              error => {\n                field.form.controls.connectivityPlan.setErrors({ connectivityPlan: true });\n                field.validators.connectivityPlan.message = error.message;\n              }\n            );\n        }\n      },\n      validators: {\n        connectivityPlan: {\n          expression: (control: AbstractControl) => {\n            return control.status === 'VALID';\n          },\n          message: () => ''\n        }\n      }\n    }\n  ];\n\n  constructor(\n    public bsModalRef: BsModalRef,\n    private registrationService: ActilityDeviceRegistrationService\n  ) {\n    this.load$.subscribe(\n      () => {\n        this.state = 'loadSuccess';\n      },\n      errors => {\n        this.state = 'loadError';\n        this.errors$.next(errors);\n      }\n    );\n  }\n\n  getConnectivityPlans$(name) {\n    return defer(() => from(this.registrationService.getConnectivityPlans(name))).pipe(\n      shareReplay(1)\n    );\n  }\n\n  getDeviceProfiles$(name) {\n    return defer(() => from(this.registrationService.getDeviceProfiles(name))).pipe(shareReplay(1));\n  }\n\n  getDeviceProtocols$() {\n    return defer(() => from(this.registrationService.getDeviceProtocols())).pipe(shareReplay(1));\n  }\n\n  getConnections$() {\n    return defer(() => from(this.registrationService.getConnections())).pipe(shareReplay(1));\n  }\n\n  async register(event: { stepper: C8yStepper; step: CdkStep }) {\n    event.stepper.next();\n    this.state = 'registrationPending';\n    try {\n      const actilityDevice = this.getActilityDeviceToSend();\n      await this.registrationService.register(actilityDevice);\n      this.state = 'registrationSuccess';\n    } catch (error) {\n      this.state = 'registrationError';\n      this.errors$.next([error]);\n    }\n  }\n\n  getActilityDeviceToSend() {\n    const actilityDevice: ActilityDeviceRegistration = cloneDeep(this.model);\n    actilityDevice.lnsConnectionName = this.model.connection.name;\n    delete (actilityDevice as any).connection;\n    return actilityDevice;\n  }\n  ngOnDestroy(): void {\n    this.unsubscribe$.next();\n    this.unsubscribe$.complete();\n  }\n}\n","import { Component } from '@angular/core';\nimport { BsModalService } from 'ngx-bootstrap/modal';\nimport { ActilityDeviceRegistrationComponent } from './actility-device-registration.component';\n\n@Component({\n  selector: 'c8y-actility-registration-button',\n  templateUrl: 'actility-device-registration-button.component.html'\n})\nexport class ActilityDeviceRegistrationButtonComponent {\n  constructor(private modalService: BsModalService) {}\n\n  open() {\n    this.modalService.show(ActilityDeviceRegistrationComponent, {\n      class: 'modal-sm',\n      ignoreBackdropClick: true\n    });\n  }\n}\n","import { Injectable } from '@angular/core';\nimport { TenantUiService } from '@c8y/ngx-components';\nimport { ActilityDeviceRegistrationButtonComponent } from './actility-device-registration-button.component';\nimport { RegisterDeviceFactory, RegisterDeviceItem } from '@c8y/ngx-components/register-device';\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActilityDeviceRegistrationFactory implements RegisterDeviceFactory {\n  constructor(private tenantService: TenantUiService) {}\n\n  get() {\n    const actions: RegisterDeviceItem[] = [];\n    if (this.tenantService.isMicroserviceSubscribedInCurrentTenant('actility')) {\n      actions.push({\n        template: ActilityDeviceRegistrationButtonComponent,\n        priority: 99,\n        category: 'single'\n      } as RegisterDeviceItem);\n    }\n    return actions;\n  }\n}\n","import { NgModule } from '@angular/core';\nimport { CommonModule, CoreModule } from '@c8y/ngx-components';\nimport { HOOK_DEVICE_REGISTRATION} from '@c8y/ngx-components/register-device';\nimport { ActilityDeviceRegistrationButtonComponent } from './actility-device-registration-button.component';\nimport { ActilityDeviceRegistrationFactory } from './actility-device-registration.factory';\nimport { ActilityDeviceRegistrationComponent } from './actility-device-registration.component';\nimport { ActilityDeviceRegistrationService } from './actility-device-registration.service';\n\n@NgModule({\n  imports: [CoreModule, CommonModule],\n  declarations: [ActilityDeviceRegistrationButtonComponent, ActilityDeviceRegistrationComponent],\n  providers: [\n    ActilityDeviceRegistrationService,\n    {\n      provide: HOOK_DEVICE_REGISTRATION,\n      useClass: ActilityDeviceRegistrationFactory,\n      multi: true\n    }\n  ]\n})\nexport class ActilityDeviceRegistrationModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {ActilityDeviceRegistrationService as ɵa} from './actility-device-registration.service';"]}