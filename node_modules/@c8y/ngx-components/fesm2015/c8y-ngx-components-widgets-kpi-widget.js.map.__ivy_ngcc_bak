{"version":3,"file":"c8y-ngx-components-widgets-kpi-widget.js","sources":["../../widgets/kpi-widget/kpi-widget-config/kpi-widget-config.component.ts","../../widgets/kpi-widget/kpi-widget-view/kpi-widget-view.component.ts","../../widgets/kpi-widget/kpi-widget.module.ts","../../widgets/kpi-widget/c8y-ngx-components-widgets-kpi-widget.ts"],"sourcesContent":["import { Component, Input, OnInit } from '@angular/core';\nimport {\n  AbstractControl,\n  ControlContainer,\n  FormBuilder,\n  FormGroup,\n  NgForm,\n  ValidationErrors,\n  ValidatorFn,\n  Validators\n} from '@angular/forms';\nimport { OnBeforeSave } from '@c8y/ngx-components';\nimport { WidgetConfigComponent } from '@c8y/ngx-components/context-dashboard';\nimport {\n  DatapointAttributesFormConfig,\n  DatapointLibraryService,\n  DatapointSelectorModalOptions,\n  KPIDetails\n} from '@c8y/ngx-components/datapoint-selector';\nimport { IconSelectorService } from '@c8y/ngx-components/icon-selector';\nimport { Observable } from 'rxjs';\nimport { KpiWidgetConfig } from '../kpi-widget.model';\n\nexport function exactlyASingleDatapointActive(): ValidatorFn {\n  return (control: AbstractControl): ValidationErrors | null => {\n    const datapoints: KPIDetails[] = control.value;\n\n    if (!datapoints || !datapoints.length) {\n      return null;\n    }\n\n    const activeDatapoints = datapoints.filter(datapoint => datapoint.__active);\n\n    if (activeDatapoints.length === 1) {\n      return null;\n    }\n\n    return { exactlyOneDatapointNeedsToBeActive: true };\n  };\n}\n\n@Component({\n  selector: 'c8y-kpi-widget-config',\n  templateUrl: './kpi-widget-config.component.html',\n  viewProviders: [{ provide: ControlContainer, useExisting: NgForm }]\n})\nexport class KpiWidgetConfigComponent implements OnInit, OnBeforeSave {\n  @Input() config: KpiWidgetConfig;\n  datapointSelectionConfig: Partial<DatapointSelectorModalOptions> = {};\n  defaultFormOptions: Partial<DatapointAttributesFormConfig> = {\n    showRedRange: true,\n    showYellowRange: true\n  };\n  formGroup: FormGroup;\n  availableIcons: string[] = [];\n  limits = {\n    fontSizeMax: 72,\n    fontSizeMin: 18,\n    numberOfDecimalPlacesMax: 10,\n    numberOfDecimalPlacesMin: 0\n  };\n\n  constructor(\n    private formBuilder: FormBuilder,\n    private form: NgForm,\n    private iconSelector: IconSelectorService,\n    private widgetConfig: WidgetConfigComponent,\n    private datapointLibrary: DatapointLibraryService\n  ) {}\n\n  onBeforeSave(config?: KpiWidgetConfig): boolean | Promise<boolean> | Observable<boolean> {\n    if (this.formGroup.valid) {\n      Object.assign(config, this.formGroup.value);\n      return true;\n    }\n    return false;\n  }\n\n  async ngOnInit() {\n    if (this.widgetConfig.context?.id) {\n      this.datapointSelectionConfig.contextAsset = this.widgetConfig?.context;\n    }\n    this.initForm();\n    if (this.config?.datapoints) {\n      this.config.datapoints = await this.datapointLibrary.updateDatapoints(\n        this.config?.datapoints\n      );\n      this.formGroup.patchValue({ datapoints: this.config.datapoints });\n    }\n  }\n\n  async openIconSelector() {\n    try {\n      const icon = await this.iconSelector.selectIcon({\n        currentSelection: this.formGroup.value.icon\n      });\n      this.formGroup.patchValue({ icon });\n    } catch {\n      // nothing to do\n    }\n  }\n\n  private initForm(): void {\n    this.formGroup = this.formBuilder.group({\n      numberOfDecimalPlaces: [\n        1,\n        [\n          Validators.required,\n          Validators.min(this.limits.numberOfDecimalPlacesMin),\n          Validators.max(this.limits.numberOfDecimalPlacesMax)\n        ]\n      ],\n      showTimestamp: [true, []],\n      showTrend: [true, []],\n      showIcon: [true, []],\n      icon: ['water', [Validators.required, Validators.minLength(1)]],\n      fontSize: [\n        36,\n        [\n          Validators.required,\n          Validators.min(this.limits.fontSizeMin),\n          Validators.max(this.limits.fontSizeMax)\n        ]\n      ],\n      datapoints: [\n        [],\n        [Validators.required, Validators.minLength(1), exactlyASingleDatapointActive()]\n      ]\n    });\n    this.form.form.addControl('config', this.formGroup);\n    this.formGroup.patchValue(this.config);\n  }\n}\n","import { Component, Input, OnInit, Optional } from '@angular/core';\nimport { MeasurementRealtimeService } from '@c8y/ngx-components';\nimport { DatapointLibraryService, KPIDetails } from '@c8y/ngx-components/datapoint-selector';\nimport { combineLatest, from, NEVER, Observable } from 'rxjs';\nimport { distinctUntilChanged, filter, map, pairwise, startWith, tap } from 'rxjs/operators';\nimport { ContextDashboardComponent } from '@c8y/ngx-components/context-dashboard';\nimport { KpiWidgetConfig } from '../kpi-widget.model';\n\ninterface MeasurementValue {\n  unit?: string;\n  value: number;\n  date: string;\n}\n\nenum ColorClass {\n  danger = 'text-danger',\n  warning = 'text-warning',\n  unknown = ''\n}\n\n@Component({\n  selector: 'c8y-kpi-widget-view',\n  templateUrl: './kpi-widget-view.component.html',\n  providers: [MeasurementRealtimeService]\n})\nexport class KpiWidgetViewComponent implements OnInit {\n  @Input() config: KpiWidgetConfig = { datapoints: [] };\n  state$: Observable<{\n    latestMeasurement: MeasurementValue;\n    previousValue: MeasurementValue;\n    trend: string;\n    unit: string;\n    colorClass: ColorClass;\n  }> = NEVER;\n\n  // used to differentiate between loading state and empty state\n  noDataInitiallyInDB = false;\n\n  constructor(\n    private measurementRealtime: MeasurementRealtimeService,\n    private datapointLib: DatapointLibraryService,\n    @Optional() private dashboard: ContextDashboardComponent\n  ) {}\n\n  async ngOnInit() {\n    const datapoints = this.config.datapoints || [];\n    const datapoint: KPIDetails = datapoints.find(tmp => tmp.__active);\n    if (!datapoint) {\n      return;\n    }\n\n    this.state$ = this.setupObservable(datapoint);\n  }\n\n  setupObservable(datapoint: KPIDetails): Observable<{\n    latestMeasurement: MeasurementValue;\n    previousValue: any;\n    trend: string;\n    unit: string;\n    colorClass: ColorClass;\n  }> {\n    this.assignContextFromContextDashboard(datapoint);\n    const latestMeasurement$ = this.getLatestMeasurement$(datapoint);\n    const lastTwoValues$ = this.getLastTwoValuesOfObservable$(latestMeasurement$);\n\n    const previousValue$ = lastTwoValues$.pipe(\n      map(res => res[0]),\n      startWith(undefined as any)\n    );\n\n    const datapointUpdate$ = this.getDatapointLibraryEntry$(datapoint);\n\n    const combineMeasurementAndDatapointLibEntry$ = combineLatest([\n      latestMeasurement$,\n      datapointUpdate$\n    ]);\n\n    const unit$ = combineMeasurementAndDatapointLibEntry$.pipe(\n      map(\n        ([latestMeasurementValue, currentDatapoint]) =>\n          currentDatapoint.unit || latestMeasurementValue.unit || ''\n      ),\n      startWith(''),\n      distinctUntilChanged()\n    );\n\n    return combineLatest([\n      latestMeasurement$,\n      previousValue$,\n      this.getTrendOfLatestMeasurements$(lastTwoValues$),\n      unit$,\n      this.getColorClass$(combineMeasurementAndDatapointLibEntry$)\n    ]).pipe(\n      map(([latestMeasurement, previousValue, trend, unit, colorClass]) => {\n        return {\n          latestMeasurement,\n          previousValue,\n          trend,\n          unit,\n          colorClass\n        };\n      })\n    );\n  }\n\n  private getLatestMeasurement$(datapoint: KPIDetails): Observable<MeasurementValue> {\n    return this.measurementRealtime\n      .latestValueOfSpecificMeasurement$(\n        datapoint.fragment,\n        datapoint.series,\n        datapoint.__target,\n        // we only need the last two values in case we want to show a trend\n        this.config.showTrend ? 2 : 1,\n        // null will be emitted in case no measurement was found initially\n        true\n      )\n      .pipe(\n        tap(measurement => {\n          if (!measurement) {\n            this.noDataInitiallyInDB = true;\n          }\n        }),\n        filter(measurement => !!measurement),\n        map(measurement => {\n          return {\n            unit: measurement[datapoint.fragment][datapoint.series].unit,\n            value: measurement[datapoint.fragment][datapoint.series].value,\n            date: measurement.time as string\n          };\n        })\n      );\n  }\n\n  private getDatapointLibraryEntry$(datapoint: KPIDetails): Observable<KPIDetails> {\n    return from(this.datapointLib.updateDatapoints([datapoint], true)).pipe(\n      map(tmp => tmp[0]),\n      filter(tmp => !!tmp),\n      startWith(datapoint)\n    );\n  }\n\n  private getColorClass$(\n    measurementAndDatapointCombination$: Observable<[MeasurementValue, KPIDetails]>\n  ): Observable<ColorClass> {\n    return measurementAndDatapointCombination$.pipe(\n      map(([latestMeasurementValue, currentDatapoint]) => {\n        if (\n          this.inRangeOf(\n            currentDatapoint,\n            latestMeasurementValue.value,\n            'redRangeMin',\n            'redRangeMax'\n          )\n        ) {\n          return ColorClass.danger;\n        }\n\n        if (\n          this.inRangeOf(\n            currentDatapoint,\n            latestMeasurementValue.value,\n            'yellowRangeMin',\n            'yellowRangeMax'\n          )\n        ) {\n          return ColorClass.warning;\n        }\n\n        return ColorClass.unknown;\n      }),\n      startWith(ColorClass.unknown),\n      distinctUntilChanged()\n    );\n  }\n\n  private getLastTwoValuesOfObservable$<T>(input$: Observable<T>): Observable<T[]> {\n    return input$.pipe(pairwise());\n  }\n\n  private getTrendOfLatestMeasurements$(latestMeasurement$: Observable<MeasurementValue[]>) {\n    return latestMeasurement$.pipe(\n      map(res => {\n        if (res.length === 2) {\n          const oldValue = res[0].value;\n          const newValue = res[1].value;\n          if (oldValue < newValue) {\n            return '45deg';\n          }\n          if (oldValue > newValue) {\n            return '135deg';\n          }\n        }\n        return '90deg';\n      }),\n      startWith('90deg'),\n      distinctUntilChanged()\n    );\n  }\n\n  private inRangeOf(\n    datapoint: KPIDetails,\n    measurementValue: number,\n    minAttribute: string,\n    maxAttribute: string\n  ): boolean {\n    if (\n      typeof datapoint[minAttribute] === 'number' &&\n      typeof datapoint[maxAttribute] === 'number'\n    ) {\n      if (\n        measurementValue >= datapoint[minAttribute] &&\n        measurementValue < datapoint[maxAttribute]\n      ) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  private assignContextFromContextDashboard(datapoint: KPIDetails) {\n    if (!this.dashboard?.isDeviceTypeDashboard) {\n      return;\n    }\n    const context = this.dashboard?.context;\n    if (context?.id) {\n      const { name, id } = context;\n      datapoint.__target = { name, id };\n    }\n  }\n}\n","import { NgModule } from '@angular/core';\nimport {\n  CoreModule,\n  DynamicComponentDefinition,\n  gettext,\n  HOOK_COMPONENTS\n} from '@c8y/ngx-components';\nimport { ContextWidgetConfig } from '@c8y/ngx-components/context-dashboard';\nimport { DatapointSelectorModule } from '@c8y/ngx-components/datapoint-selector';\nimport { IconSelectorModule } from '@c8y/ngx-components/icon-selector';\nimport { PopoverModule } from 'ngx-bootstrap/popover';\nimport { KpiWidgetConfigComponent } from './kpi-widget-config/kpi-widget-config.component';\nimport { KpiWidgetViewComponent } from './kpi-widget-view/kpi-widget-view.component';\n\n// import for the preview img to get into the build.\nlet previewImage = '';\ntry {\n  // tslint:disable-next-line: no-var-requires\n  previewImage = require('@c8y/style/img/kpi-widget.png');\n} catch (ex) {\n  // intended empty\n}\n\n@NgModule({\n  imports: [CoreModule, DatapointSelectorModule, IconSelectorModule, PopoverModule],\n  declarations: [KpiWidgetViewComponent, KpiWidgetConfigComponent],\n  providers: [\n    {\n      provide: HOOK_COMPONENTS,\n      useValue: [\n        {\n          id: 'kpi.widget',\n          label: gettext('KPI Widget'),\n          description: gettext('Displays the last measurement value of a device.'),\n          component: KpiWidgetViewComponent,\n          configComponent: KpiWidgetConfigComponent,\n          previewImage,\n          data: {\n            settings: {\n              noNewWidgets: false,\n              widgetDefaults: {\n                _width: 2,\n                _height: 2\n              },\n              ng1: {\n                options: {\n                  noDeviceTarget: true,\n                  groupsSelectable: false\n                }\n              }\n            }\n          } as ContextWidgetConfig\n        }\n      ] as DynamicComponentDefinition[],\n      multi: true\n    }\n  ]\n})\nexport class KpiWidgetModule {}\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './index';\n\nexport {KpiWidgetConfigComponent as ɵb} from './kpi-widget-config/kpi-widget-config.component';\nexport {KpiWidgetViewComponent as ɵa} from './kpi-widget-view/kpi-widget-view.component';"],"names":[],"mappings":"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"}